import{f as U,a as B,c as De}from"../chunks/CEHU2p6w.js";import"../chunks/CNMWd6ta.js";import{F as It,i as Te,x as ga,C as zt,j as ha,O as fa,g as n,a6 as Le,Q as ba,R as pa,S as Xt,U as Bt,B as xt,ag as ma,aI as wa,as as qt,H as xa,L as Rt,N as _a,aG as Wt,w as ia,ae as Jt,$ as ee,aO as Ca,aP as ya,aQ as Sa,aR as Je,I as ra,K as oa,aS as Et,aC as ka,aT as Ia,aF as za,J as Ba,aU as la,X as sa,aV as Ea,aW as Pa,aX as Ra,aY as Ta,aZ as Ma,p as we,t as te,n as xe,s as k,k as S,l as _,a0 as O,b as z,a_ as me,a$ as St,e as he,at as Aa,m as ye}from"../chunks/DL0h0sBs.js";import{p as v,b as Tt,i as Q,s as Me,a as kt}from"../chunks/Dd6Z9Yti.js";import{i as Se}from"../chunks/D4qP8xMW.js";import{e as I,s as Ie}from"../chunks/MAvR_4Wi.js";import{c as Ha,o as Ua,d as Nt,w as Ve}from"../chunks/BDE9GExf.js";let Vt=!1;function Fa(){Vt||(Vt=!0,document.addEventListener("reset",a=>{Promise.resolve().then(()=>{if(!a.defaultPrevented)for(const t of a.target.elements)t.__on_r?.()})},{capture:!0}))}function lt(a,t){return t}function Da(a,t,e){for(var i=[],r=t.length,l,d=t.length,g=0;g<r;g++){let y=t[g];oa(y,()=>{if(l){if(l.pending.delete(y),l.done.add(y),l.pending.size===0){var m=a.outrogroups;Mt(Wt(l.done)),m.delete(l),m.size===0&&(a.outrogroups=null)}}else d-=1},!1)}if(d===0){var s=i.length===0&&e!==null;if(s){var h=e,b=h.parentNode;za(b),b.append(h),a.items.clear()}Mt(t,!s)}else l={pending:new Set(t),done:new Set},(a.outrogroups??=new Set).add(l)}function Mt(a,t=!0){for(var e=0;e<a.length;e++)Ba(a[e],t)}var Gt;function st(a,t,e,i,r,l=null){var d=a,g=new Map,s=(t&la)!==0;if(s){var h=a;d=Te?It(ga(h)):h.appendChild(zt())}Te&&ha();var b=null,y=Le(()=>{var u=e();return ia(u)?u:u==null?[]:Wt(u)}),m,p=!0;function x(){o.fallback=b,La(o,m,d,t,i),b!==null&&(m.length===0?(b.f&Je)===0?ra(b):(b.f^=Je,ft(b,null,d)):oa(b,()=>{b=null}))}var P=fa(()=>{m=n(y);var u=m.length;let T=!1;if(Te){var C=ba(d)===pa;C!==(u===0)&&(d=Xt(),It(d),Bt(!1),T=!0)}for(var E=new Set,q=xa,F=_a(),M=0;M<u;M+=1){Te&&xt.nodeType===ma&&xt.data===wa&&(d=xt,T=!0,Bt(!1));var L=m[M],J=i(L,M),D=p?null:g.get(J);D?(D.v&&qt(D.v,L),D.i&&qt(D.i,M),F&&q.skipped_effects.delete(D.e)):(D=Wa(g,p?d:Gt??=zt(),L,J,M,r,t,e),p||(D.e.f|=Je),g.set(J,D)),E.add(J)}if(u===0&&l&&!b&&(p?b=Rt(()=>l(d)):(b=Rt(()=>l(Gt??=zt())),b.f|=Je)),Te&&u>0&&It(Xt()),!p)if(F){for(const[V,ve]of g)E.has(V)||q.skipped_effects.add(ve.e);q.oncommit(x),q.ondiscard(()=>{})}else x();T&&Bt(!0),n(y)}),o={effect:P,items:g,outrogroups:null,fallback:b};p=!1,Te&&(d=xt)}function ht(a){for(;a!==null&&(a.f&Ia)===0;)a=a.next;return a}function La(a,t,e,i,r){var l=(i&Ea)!==0,d=t.length,g=a.items,s=ht(a.effect.first),h,b=null,y,m=[],p=[],x,P,o,u;if(l)for(u=0;u<d;u+=1)x=t[u],P=r(x,u),o=g.get(P).e,(o.f&Je)===0&&(o.nodes?.a?.measure(),(y??=new Set).add(o));for(u=0;u<d;u+=1){if(x=t[u],P=r(x,u),o=g.get(P).e,a.outrogroups!==null)for(const D of a.outrogroups)D.pending.delete(o),D.done.delete(o);if((o.f&Je)!==0)if(o.f^=Je,o===s)ft(o,null,e);else{var T=b?b.next:s;o===a.effect.last&&(a.effect.last=o.prev),o.prev&&(o.prev.next=o.next),o.next&&(o.next.prev=o.prev),$e(a,b,o),$e(a,o,T),ft(o,T,e),b=o,m=[],p=[],s=ht(b.next);continue}if((o.f&Et)!==0&&(ra(o),l&&(o.nodes?.a?.unfix(),(y??=new Set).delete(o))),o!==s){if(h!==void 0&&h.has(o)){if(m.length<p.length){var C=p[0],E;b=C.prev;var q=m[0],F=m[m.length-1];for(E=0;E<m.length;E+=1)ft(m[E],C,e);for(E=0;E<p.length;E+=1)h.delete(p[E]);$e(a,q.prev,F.next),$e(a,b,q),$e(a,F,C),s=C,b=F,u-=1,m=[],p=[]}else h.delete(o),ft(o,s,e),$e(a,o.prev,o.next),$e(a,o,b===null?a.effect.first:b.next),$e(a,b,o),b=o;continue}for(m=[],p=[];s!==null&&s!==o;)(h??=new Set).add(s),p.push(s),s=ht(s.next);if(s===null)continue}(o.f&Je)===0&&m.push(o),b=o,s=ht(o.next)}if(a.outrogroups!==null){for(const D of a.outrogroups)D.pending.size===0&&(Mt(Wt(D.done)),a.outrogroups?.delete(D));a.outrogroups.size===0&&(a.outrogroups=null)}if(s!==null||h!==void 0){var M=[];if(h!==void 0)for(o of h)(o.f&Et)===0&&M.push(o);for(;s!==null;)(s.f&Et)===0&&s!==a.fallback&&M.push(s),s=ht(s.next);var L=M.length;if(L>0){var J=(i&la)!==0&&d===0?e:null;if(l){for(u=0;u<L;u+=1)M[u].nodes?.a?.measure();for(u=0;u<L;u+=1)M[u].nodes?.a?.fix()}Da(a,M,J)}}l&&sa(()=>{if(y!==void 0)for(o of y)o.nodes?.a?.apply()})}function Wa(a,t,e,i,r,l,d,g){var s=(d&ya)!==0?(d&Sa)===0?ee(e,!1,!1):Jt(e):null,h=(d&Ca)!==0?Jt(r):null;return{v:s,i:h,e:Rt(()=>(l(t,s??e,h??r,g),()=>{a.delete(i)}))}}function ft(a,t,e){if(a.nodes)for(var i=a.nodes.start,r=a.nodes.end,l=t&&(t.f&Je)===0?t.nodes.start:e;i!==null;){var d=ka(i);if(l.before(i),i===r)return;i=d}}function $e(a,t,e){t===null?a.effect.first=e:t.next=e,e===null?a.effect.last=t:e.prev=t}const Zt=[...` 	
\r\fÂ \v\uFEFF`];function Na(a,t,e){var i=a==null?"":""+a;if(e){for(var r in e)if(e[r])i=i?i+" "+r:r;else if(i.length)for(var l=r.length,d=0;(d=i.indexOf(r,d))>=0;){var g=d+l;(d===0||Zt.includes(i[d-1]))&&(g===i.length||Zt.includes(i[g]))?i=(d===0?"":i.substring(0,d))+i.substring(g+1):d=g}}return i===""?null:i}function Oa(a,t){return a==null?null:String(a)}function ke(a,t,e,i,r,l){var d=a.__className;if(Te||d!==e||d===void 0){var g=Na(e,i,l);(!Te||g!==a.getAttribute("class"))&&(g==null?a.removeAttribute("class"):a.className=g),a.__className=e}else if(l&&r!==l)for(var s in l){var h=!!l[s];(r==null||h!==!!r[s])&&a.classList.toggle(s,h)}return l}function Re(a,t,e,i){var r=a.__style;if(Te||r!==t){var l=Oa(t);(!Te||l!==a.getAttribute("style"))&&(l==null?a.removeAttribute("style"):a.style.cssText=l),a.__style=t}return i}const Ya=Symbol("is custom element"),ja=Symbol("is html");function yt(a){if(Te){var t=!1,e=()=>{if(!t){if(t=!0,a.hasAttribute("value")){var i=a.value;ue(a,"value",null),a.value=i}if(a.hasAttribute("checked")){var r=a.checked;ue(a,"checked",null),a.checked=r}}};a.__on_r=e,sa(e),Fa()}}function At(a,t){var e=Ot(a);e.value===(e.value=t??void 0)||a.value===t&&(t!==0||a.nodeName!=="PROGRESS")||(a.value=t??"")}function Xa(a,t){var e=Ot(a);e.checked!==(e.checked=t??void 0)&&(a.checked=t)}function ue(a,t,e,i){var r=Ot(a);Te&&(r[t]=a.getAttribute(t),t==="src"||t==="srcset"||t==="href"&&a.nodeName==="LINK")||r[t]!==(r[t]=e)&&(t==="loading"&&(a[Pa]=e),e==null?a.removeAttribute(t):typeof e!="string"&&qa(a).includes(t)?a[t]=e:a.setAttribute(t,e))}function Ot(a){return a.__attributes??={[Ya]:a.nodeName.includes("-"),[ja]:a.namespaceURI===Ra}}var Qt=new Map;function qa(a){var t=a.getAttribute("is")||a.nodeName,e=Qt.get(t);if(e)return e;Qt.set(t,e=[]);for(var i,r=a,l=Element.prototype;l!==r;){i=Ma(r);for(var d in i)i[d].set&&e.push(d);r=Ta(r)}return e}function Fe(a){return function(...t){var e=t[0];return e.stopPropagation(),a?.apply(this,t)}}function Kt(a,t){var e=a.$$events?.[t.type],i=ia(e)?e.slice():e==null?[]:[e];for(var r of i)r.call(this,t)}var Ja=U('<header class="header svelte-hv3zzy"><img src="/logos/logo-picflam-logotype.png" alt="PicFlam" class="header-logo svelte-hv3zzy"/> <nav class="header-nav svelte-hv3zzy"><button aria-label="Crop tab"><img src="/icons/icon-crop.svg" alt="" class="nav-icon svelte-hv3zzy"/></button> <button aria-label="AI tab"><img src="/icons/icon-ai.svg" alt="" class="nav-icon svelte-hv3zzy"/></button> <button aria-label="Design tab"><img src="/icons/icon-design.svg" alt="" class="nav-icon svelte-hv3zzy"/></button></nav></header>');function Va(a,t){we(t,!1);let e=v(t,"activeTab",8,"crop"),i=v(t,"onTabChange",8);Se();var r=Ja(),l=k(S(r),2),d=S(l);let g;var s=k(d,2);let h;var b=k(s,2);let y;_(l),_(r),te(()=>{g=ke(d,1,"nav-btn svelte-hv3zzy",null,g,{active:e()==="crop"}),h=ke(s,1,"nav-btn svelte-hv3zzy",null,h,{active:e()==="ai"}),y=ke(b,1,"nav-btn svelte-hv3zzy",null,y,{active:e()==="design"})}),I("click",d,()=>i()("crop")),I("click",s,()=>i()("ai")),I("click",b,()=>i()("design")),B(a,r),xe()}function ca(a){return new Promise((t,e)=>{const i=new FileReader;i.onload=r=>t(r.target.result),i.onerror=e,i.readAsDataURL(a)})}function ct(a){return new Promise((t,e)=>{const i=new Image;i.onload=()=>t(i),i.onerror=e,i.src=a})}async function _t(a){const t=await ct(a);return{width:t.naturalWidth,height:t.naturalHeight}}function $t(a,t=2048){return new Promise(async e=>{const i=await ct(a),{naturalWidth:r,naturalHeight:l}=i;if(r<=t&&l<=t){e(a);return}const d=document.createElement("canvas"),g=d.getContext("2d");let s,h;r>l?(s=t,h=l/r*t):(h=t,s=r/l*t),d.width=s,d.height=h,g.drawImage(i,0,0,s,h),e(d.toDataURL("image/jpeg",.92))})}async function Ga(){try{const a=await navigator.clipboard.read();for(const t of a)for(const e of t.types)if(e.startsWith("image/")){const i=await t.getType(e);return await ca(i)}return null}catch(a){return console.error("Failed to paste from clipboard:",a),null}}async function Ht(a){try{const e=await(await fetch(a)).blob();return await navigator.clipboard.write([new ClipboardItem({[e.type]:e})]),!0}catch(t){return console.error("Failed to copy to clipboard:",t),!1}}function Ut(a,t="picflam-export.png"){const e=document.createElement("a");e.href=a,e.download=t,document.body.appendChild(e),e.click(),document.body.removeChild(e)}async function da(a,t,e,i){const r=await ct(a),l=document.createElement("canvas"),d=l.getContext("2d"),g=t.x/100*e,s=t.y/100*i,h=t.width/100*e,b=t.height/100*i;return l.width=h,l.height=b,d.drawImage(r,g,s,h,b,0,0,h,b),l.toDataURL("image/png")}async function Za(a,t){const e=await ct(a),i=document.createElement("canvas"),r=i.getContext("2d");return i.width=e.naturalHeight,i.height=e.naturalWidth,r.translate(i.width/2,i.height/2),r.rotate(t*Math.PI/180),r.drawImage(e,-e.naturalWidth/2,-e.naturalHeight/2),i.toDataURL("image/png")}async function Qa(a,t){const e=await ct(a),i=document.createElement("canvas"),r=i.getContext("2d");return i.width=e.naturalWidth,i.height=e.naturalHeight,r.translate(i.width,0),r.scale(-1,1),r.drawImage(e,0,0),i.toDataURL("image/png")}async function Ka(a,t,e){const i=await ct(a),r=document.createElement("canvas"),l=r.getContext("2d");if(r.width=i.naturalWidth,r.height=i.naturalHeight,t&&t!=="none"&&(l.filter=t),l.drawImage(i,0,0),l.filter="none",e&&Array.isArray(e)&&e.length>0)if(e.some(g=>g.invert)){const s=.5+e.reduce((o,u)=>o+(u.strength||50),0)/e.length/100*9.5,h=document.createElement("canvas");h.width=r.width,h.height=r.height;const b=h.getContext("2d");b.filter=`blur(${s}px)`,t&&t!=="none"&&(b.filter=`blur(${s}px) ${t}`),b.drawImage(i,0,0);const y=document.createElement("canvas");y.width=r.width,y.height=r.height;const m=y.getContext("2d");m.fillStyle="white",m.fillRect(0,0,y.width,y.height);for(const o of e){if(!o.invert)continue;const u=(o.soften||50)/100,T=m.createRadialGradient(o.x,o.y,0,o.x,o.y,o.radius);T.addColorStop(0,"rgba(0,0,0,1)"),T.addColorStop(.5+u*.3,"rgba(0,0,0,0.5)"),T.addColorStop(1,"rgba(0,0,0,0)"),m.fillStyle=T,m.beginPath(),m.arc(o.x,o.y,o.radius,0,Math.PI*2),m.fill()}const p=l.getImageData(0,0,r.width,r.height),x=b.getImageData(0,0,r.width,r.height),P=m.getImageData(0,0,r.width,r.height);for(let o=0;o<p.data.length;o+=4){const u=P.data[o]/255;p.data[o]=p.data[o]*u+x.data[o]*(1-u),p.data[o+1]=p.data[o+1]*u+x.data[o+1]*(1-u),p.data[o+2]=p.data[o+2]*u+x.data[o+2]*(1-u)}l.putImageData(p,0,0)}else for(const g of e){const s=g.strength||50,h=(g.soften||50)/100,b=.5+s/100*9.5,y=document.createElement("canvas");y.width=r.width,y.height=r.height;const m=y.getContext("2d");m.filter=`blur(${b}px)`,t&&t!=="none"&&(m.filter=`blur(${b}px) ${t}`),m.drawImage(i,0,0);const p=document.createElement("canvas");p.width=r.width,p.height=r.height;const x=p.getContext("2d"),P=x.createRadialGradient(g.x,g.y,0,g.x,g.y,g.radius);P.addColorStop(0,"rgba(255,255,255,1)"),P.addColorStop(.5+h*.3,"rgba(255,255,255,0.5)"),P.addColorStop(1,"rgba(255,255,255,0)"),x.fillStyle=P,x.beginPath(),x.arc(g.x,g.y,g.radius,0,Math.PI*2),x.fill();const o=l.getImageData(0,0,r.width,r.height),u=m.getImageData(0,0,r.width,r.height),T=x.getImageData(0,0,r.width,r.height);for(let C=0;C<o.data.length;C+=4){const E=T.data[C]/255;o.data[C]=o.data[C]*(1-E)+u.data[C]*E,o.data[C+1]=o.data[C+1]*(1-E)+u.data[C+1]*E,o.data[C+2]=o.data[C+2]*(1-E)+u.data[C+2]*E}l.putImageData(o,0,0)}return r.toDataURL("image/png")}var $a=U('<div role="button" tabindex="0"><p class="import-title svelte-f1bndr"> </p> <img src="/icons/icon-upload.svg" alt="" class="import-icon svelte-f1bndr"/> <p class="import-hint svelte-f1bndr"> </p> <button class="btn-paste svelte-f1bndr">Paste</button> <input type="file" accept="image/*" class="sr-only"/></div>');function ua(a,t){we(t,!1);let e=v(t,"title",8,"Import an image"),i=v(t,"hint",8,"Import, drag or paste an image"),r=v(t,"onImageImport",8,F=>{}),l=ee(!1),d=ee();async function g(F){if(!F||!F.type.startsWith("image/"))return;const M=await ca(F),L=await $t(M,2048);r()(L)}function s(F){const M=F.target.files?.[0];M&&g(M)}function h(F){F.preventDefault(),O(l,!1);const M=F.dataTransfer?.files?.[0];M&&g(M)}function b(F){F.preventDefault(),O(l,!0)}function y(){O(l,!1)}async function m(){const F=await Ga();if(F){const M=await $t(F,2048);r()(M)}}function p(){n(d)?.click()}Se();var x=$a();let P;var o=S(x),u=S(o,!0);_(o);var T=k(o,4),C=S(T,!0);_(T);var E=k(T,2),q=k(E,2);Tt(q,F=>O(d,F),()=>n(d)),_(x),te(()=>{P=ke(x,1,"import-area svelte-f1bndr",null,P,{dragging:n(l)}),Ie(u,e()),Ie(C,i())}),I("click",E,Fe(m)),I("change",q,s),I("click",x,p),I("drop",x,h),I("dragover",x,b),I("dragleave",x,y),I("keypress",x,F=>F.key==="Enter"&&p()),B(a,x),xe()}var en=U('<div class="action-bar svelte-96zw02"><div class="action-group svelte-96zw02"><button class="action-btn svelte-96zw02" aria-label="Undo"><img src="/icons/icon-undo.svg" alt="" class="action-icon svelte-96zw02"/></button> <button class="action-btn svelte-96zw02" aria-label="Redo"><img src="/icons/icon-redo.svg" alt="" class="action-icon svelte-96zw02"/></button></div> <div class="action-group svelte-96zw02"><button class="action-btn svelte-96zw02" aria-label="Start again"><img src="/icons/icon-startagain.svg" alt="" class="action-icon svelte-96zw02"/></button> <button class="action-btn svelte-96zw02" aria-label="Copy to clipboard"><img src="/icons/icon-copy.svg" alt="" class="action-icon svelte-96zw02"/></button> <button class="action-btn svelte-96zw02" aria-label="Export"><img src="/icons/icon-export.svg" alt="" class="action-icon svelte-96zw02"/></button></div></div>');function Yt(a,t){let e=v(t,"canUndo",8,!1),i=v(t,"canRedo",8,!1),r=v(t,"onUndo",8,()=>{}),l=v(t,"onRedo",8,()=>{}),d=v(t,"onStartAgain",8,()=>{}),g=v(t,"onCopy",8,()=>{}),s=v(t,"onExport",8,()=>{});var h=en(),b=S(h),y=S(b),m=k(y,2);_(b);var p=k(b,2),x=S(p),P=k(x,2),o=k(P,2);_(p),_(h),te(()=>{y.disabled=!e(),m.disabled=!i()}),I("click",y,function(...u){r()?.apply(this,u)}),I("click",m,function(...u){l()?.apply(this,u)}),I("click",x,function(...u){d()?.apply(this,u)}),I("click",P,function(...u){g()?.apply(this,u)}),I("click",o,function(...u){s()?.apply(this,u)}),B(a,h)}var tn=U("<button> </button>"),an=U('<div class="sub-menu-tabs svelte-tv6tw8"></div>');function jt(a,t){we(t,!1);let e=v(t,"tabs",24,()=>[]),i=v(t,"activeTab",8,""),r=v(t,"onTabChange",8,d=>{});Se();var l=an();st(l,5,e,lt,(d,g)=>{var s=tn();let h;var b=S(s,!0);_(s),te(()=>{h=ke(s,1,"sub-menu-tab svelte-tv6tw8",null,h,{active:i()===n(g).id}),Ie(b,(n(g),z(()=>n(g).label)))}),I("click",s,()=>r()(n(g).id)),B(d,s)}),_(l),B(a,l),xe()}var nn=U('<div class="modal-overlay svelte-qik81a" role="dialog" aria-modal="true" tabindex="-1"><div class="modal svelte-qik81a" role="document"><p class="modal-message svelte-qik81a"> </p> <div class="modal-actions svelte-qik81a"><button class="btn-text svelte-qik81a"> </button> <button class="btn-text btn-confirm svelte-qik81a"> </button></div></div></div>');function Ft(a,t){we(t,!1);let e=v(t,"message",8,""),i=v(t,"confirmText",8,"Yes"),r=v(t,"cancelText",8,"Cancel"),l=v(t,"onConfirm",8,()=>{}),d=v(t,"onCancel",8,()=>{});Se();var g=nn(),s=S(g),h=S(s),b=S(h,!0);_(h);var y=k(h,2),m=S(y),p=S(m,!0);_(m);var x=k(m,2),P=S(x,!0);_(x),_(y),_(s),_(g),te(()=>{Ie(b,e()),Ie(p,r()),Ie(P,i())}),I("click",m,function(...o){d()?.apply(this,o)}),I("click",x,function(...o){l()?.apply(this,o)}),I("click",s,Fe(function(o){Kt.call(this,t,o)})),I("keydown",s,Fe(function(o){Kt.call(this,t,o)})),I("click",g,function(...o){d()?.apply(this,o)}),I("keydown",g,o=>o.key==="Escape"&&d()()),B(a,g),xe()}var rn=U('<canvas class="blur-canvas svelte-pjowa5"></canvas>'),on=U('<div class="blur-brush-indicator svelte-pjowa5"></div>'),ln=U('<div class="blur-brush-preview svelte-pjowa5"></div>'),sn=U('<div class="crop-overlay svelte-pjowa5"><div class="overlay-top svelte-pjowa5"></div> <div class="overlay-bottom svelte-pjowa5"></div> <div class="overlay-left svelte-pjowa5"></div> <div class="overlay-right svelte-pjowa5"></div> <div class="crop-box svelte-pjowa5" role="button" aria-label="Drag to move crop area" tabindex="0"><div class="crop-border svelte-pjowa5"></div> <div class="corner-handle top-left svelte-pjowa5" role="button" aria-label="Resize top-left corner" tabindex="0"></div> <div class="corner-handle top-right svelte-pjowa5" role="button" aria-label="Resize top-right corner" tabindex="0"></div> <div class="corner-handle bottom-left svelte-pjowa5" role="button" aria-label="Resize bottom-left corner" tabindex="0"></div> <div class="corner-handle bottom-right svelte-pjowa5" role="button" aria-label="Resize bottom-right corner" tabindex="0"></div></div></div>'),cn=U('<div class="crop-canvas svelte-pjowa5" role="application" aria-label="Image crop canvas"><div class="image-wrapper svelte-pjowa5"><img alt="Crop preview" class="canvas-image svelte-pjowa5" draggable="false"/> <!></div> <!> <!> <!></div>');function dn(a,t){we(t,!1);const e=ee(),i=ee(),r=ee(),l=ee();let d=v(t,"imageSrc",8,""),g=v(t,"cropBox",24,()=>({x:10,y:10,width:80,height:80})),s=v(t,"isCropping",8,!1),h=v(t,"scale",8,1),b=v(t,"offsetX",8,0),y=v(t,"offsetY",8,0),m=v(t,"imageWidth",8,0),p=v(t,"imageHeight",8,0),x=v(t,"editFilters",8,""),P=v(t,"blurEnabled",8,!1),o=v(t,"blurBrushSize",8,50),u=v(t,"blurStrength",8,50),T=v(t,"blurSoften",8,50),C=v(t,"blurInvert",8,!1),E=v(t,"blurMask",24,()=>[]),q=v(t,"showBrushPreview",8,!1);const F=Ha();let M=ee(),L=ee(),J=ee({width:0,height:0}),D=!1,V=null,ve=0,ze=0,Z=null,le=0,Y=1,$=!1,ae=ee({x:0,y:0,visible:!1}),fe=ee(null),be=ee("");async function ge(){O(be,d());const f=new Image;f.crossOrigin="anonymous",f.onload=()=>{O(fe,f)},f.src=d()}function Ge(f){const W=document.createElement("canvas");W.width=n(fe).naturalWidth,W.height=n(fe).naturalHeight;const G=W.getContext("2d");return G.filter=`blur(${f}px)`,G.drawImage(n(fe),0,0),W}function Ze(){if(!n(L)||!n(fe)||!E())return;const f=n(L).getContext("2d"),W=n(L).width,G=n(L).height;if(f.clearRect(0,0,W,G),E().length===0)return;const A=W/m(),K=G/p();if(E().some(X=>X.invert)){const X=E().reduce((R,j)=>R+(j.strength||50),0)/E().length;E().reduce((R,j)=>R+(j.soften||50),0)/E().length;const c=.5+X/100*9.5,w=Ge(c);f.drawImage(w,0,0,W,G),f.globalCompositeOperation="destination-out";for(const R of E()){if(!R.invert)continue;const j=R.x*A,H=R.y*K,ne=R.radius*Math.min(A,K),ie=(R.soften||50)/100,se=Math.max(0,.3-ie*.3),ce=.3+(1-ie)*.4,oe=f.createRadialGradient(j,H,0,j,H,ne);oe.addColorStop(se,"rgba(0,0,0,1)"),oe.addColorStop(ce,`rgba(0,0,0,${.5+ie*.3})`),oe.addColorStop(1,"rgba(0,0,0,0)"),f.fillStyle=oe,f.beginPath(),f.arc(j,H,ne,0,Math.PI*2),f.fill()}f.globalCompositeOperation="source-over"}else for(const X of E()){const c=X.x*A,w=X.y*K,R=X.radius*Math.min(A,K),j=X.strength||50,H=(X.soften||50)/100,ne=.5+j/100*9.5,ie=Ge(ne);f.save();const se=Math.max(0,.2-H*.2),ce=.2+(1-H)*.5,oe=f.createRadialGradient(c,w,0,c,w,R);oe.addColorStop(se,"rgba(255,255,255,1)"),oe.addColorStop(ce,`rgba(255,255,255,${.4+H*.3})`),oe.addColorStop(1,"rgba(255,255,255,0)"),f.beginPath(),f.arc(c,w,R,0,Math.PI*2),f.clip(),f.drawImage(ie,0,0,W,G),f.restore()}}Ua(()=>(Ne(),window.addEventListener("resize",Ne),()=>window.removeEventListener("resize",Ne)));function Ne(){if(n(M)){const f=n(M).getBoundingClientRect();O(J,{width:f.width,height:f.height})}}function _e(f){return f.touches&&f.touches.length>0?{x:f.touches[0].clientX,y:f.touches[0].clientY}:{x:f.clientX,y:f.clientY}}function Ae(f){if(f.touches&&f.touches.length>=2){const W=f.touches[0].clientX-f.touches[1].clientX,G=f.touches[0].clientY-f.touches[1].clientY;return Math.sqrt(W*W+G*G)}return 0}function pe(f,W="move"){if(!s())return;if(f.touches&&f.touches.length>=2){le=Ae(f),Y=h(),V="pinch";return}f.preventDefault(),D=!0,V=W;const G=_e(f);ve=G.x,ze=G.y,Z={...g()}}function Qe(f){if(!s())return;if(V==="pinch"&&f.touches&&f.touches.length>=2){const de=Ae(f),X=Y*(de/le);F("scaleChange",{scale:Math.max(.5,Math.min(3,X))});return}if(!D||!Z)return;f.preventDefault();const W=_e(f),G=(W.x-ve)/n(e)*100,A=(W.y-ze)/n(i)*100;let K={...Z};if(V==="move")K.x=Math.max(0,Math.min(100-Z.width,Z.x+G)),K.y=Math.max(0,Math.min(100-Z.height,Z.y+A));else if(V.includes("corner")){if(V.includes("left")){const X=Z.x+G,c=Z.width-G;c>=10&&X>=0&&(K.x=X,K.width=c)}if(V.includes("right")){const X=Z.width+G;X>=10&&Z.x+X<=100&&(K.width=X)}if(V.includes("top")){const X=Z.y+A,c=Z.height-A;c>=10&&X>=0&&(K.y=X,K.height=c)}if(V.includes("bottom")){const X=Z.height+A;X>=10&&Z.y+X<=100&&(K.height=X)}}F("cropChange",{cropBox:K})}function Oe(){D=!1,V=null,Z=null,$&&($=!1)}function Be(f){P()&&(f.preventDefault(),$=!0,We(f))}function He(f){if(!P())return;const W=n(M).getBoundingClientRect(),G=_e(f);O(ae,{x:G.x-W.left,y:G.y-W.top,visible:!0}),$&&We(f)}function tt(){O(ae,{...n(ae),visible:!1}),$&&($=!1)}function We(f){const W=n(M).getBoundingClientRect(),G=_e(f),A=(G.x-W.left)/n(e)*m(),K=(G.y-W.top)/n(i)*p(),de=o()/100*Math.min(m(),p())*.15;F("blurPaint",{point:{x:A,y:K,radius:de,strength:u(),soften:T(),invert:C()}})}me(()=>n(J),()=>{O(e,n(J).width)}),me(()=>(he(p()),he(m()),n(e)),()=>{O(i,p()&&m()?n(e)*p()/m():0)}),me(()=>(he(o()),n(e),n(i)),()=>{O(r,o()/100*Math.min(n(e),n(i))*.3)}),me(()=>(he(d()),n(L),n(be)),()=>{d()&&n(L)&&d()!==n(be)&&ge()}),me(()=>(he(E()),n(L),n(fe)),()=>{E()&&Array.isArray(E())&&E().length>0&&n(L)&&n(fe)&&Ze()}),me(()=>(he(g()),n(e),n(i)),()=>{O(l,{x:g().x/100*n(e),y:g().y/100*n(i),width:g().width/100*n(e),height:g().height/100*n(i)})}),St(),Se();var re=cn(),Ce=S(re),Ee=S(Ce),dt=k(Ee,2);{var ut=f=>{var W=rn();Tt(W,G=>O(L,G),()=>n(L)),te(()=>{ue(W,"width",n(e)),ue(W,"height",n(i)),Re(W,`filter: ${x()??""};`)}),B(f,W)};Q(dt,f=>{P()&&n(e)>0&&n(i)>0&&f(ut)})}_(Ce);var at=k(Ce,2);{var nt=f=>{var W=on();te(()=>Re(W,`
				left: ${n(ae),z(()=>n(ae).x)??""}px;
				top: ${n(ae),z(()=>n(ae).y)??""}px;
				width: ${n(r)??""}px;
				height: ${n(r)??""}px;
			`)),B(f,W)};Q(at,f=>{he(P()),n(ae),z(()=>P()&&n(ae).visible)&&f(nt)})}var Ue=k(at,2);{var rt=f=>{var W=ln();te(()=>Re(W,`
				left: ${n(e)/2}px;
				top: ${n(i)/2}px;
				width: ${n(r)??""}px;
				height: ${n(r)??""}px;
			`)),B(f,W)};Q(Ue,f=>{q()&&n(e)>0&&n(i)>0&&f(rt)})}var ot=k(Ue,2);{var Ye=f=>{var W=sn(),G=S(W),A=k(G,2),K=k(A,2),de=k(K,2),X=k(de,2),c=k(S(X),2),w=k(c,2),R=k(w,2),j=k(R,2);_(X),_(W),te(()=>{Re(G,`height: ${n(l),z(()=>n(l).y)??""}px;`),Re(A,`top: ${n(l),z(()=>n(l).y+n(l).height)??""}px; height: ${n(i),n(l),z(()=>n(i)-n(l).y-n(l).height)??""}px;`),Re(K,`top: ${n(l),z(()=>n(l).y)??""}px; height: ${n(l),z(()=>n(l).height)??""}px; width: ${n(l),z(()=>n(l).x)??""}px;`),Re(de,`top: ${n(l),z(()=>n(l).y)??""}px; height: ${n(l),z(()=>n(l).height)??""}px; left: ${n(l),z(()=>n(l).x+n(l).width)??""}px; width: ${n(e),n(l),z(()=>n(e)-n(l).x-n(l).width)??""}px;`),Re(X,`left: ${n(l),z(()=>n(l).x)??""}px; top: ${n(l),z(()=>n(l).y)??""}px; width: ${n(l),z(()=>n(l).width)??""}px; height: ${n(l),z(()=>n(l).height)??""}px;`)}),I("mousedown",c,Fe(H=>pe(H,"corner-top-left"))),I("touchstart",c,Fe(H=>pe(H,"corner-top-left"))),I("mousedown",w,Fe(H=>pe(H,"corner-top-right"))),I("touchstart",w,Fe(H=>pe(H,"corner-top-right"))),I("mousedown",R,Fe(H=>pe(H,"corner-bottom-left"))),I("touchstart",R,Fe(H=>pe(H,"corner-bottom-left"))),I("mousedown",j,Fe(H=>pe(H,"corner-bottom-right"))),I("touchstart",j,Fe(H=>pe(H,"corner-bottom-right"))),I("mousedown",X,H=>pe(H,"move")),I("touchstart",X,H=>pe(H,"move")),B(f,W)};Q(ot,f=>{s()&&n(i)>0&&f(Ye)})}_(re),Tt(re,f=>O(M,f),()=>n(M)),te(()=>{Re(Ce,`transform: scale(${h()??""}) translate(${b()??""}px, ${y()??""}px);`),ue(Ee,"src",d()),Re(Ee,`filter: ${x()??""};`)}),I("mousemove",re,function(...f){(P()?He:Qe)?.apply(this,f)}),I("mouseup",re,Oe),I("mouseleave",re,function(...f){(P()?tt:Oe)?.apply(this,f)}),I("touchmove",re,function(...f){(P()?He:Qe)?.apply(this,f)}),I("touchend",re,Oe),I("mousedown",re,function(...f){(P()?Be:null)?.apply(this,f)}),I("touchstart",re,function(...f){(P()?Be:null)?.apply(this,f)}),B(a,re),xe()}var un=U('<img alt="" class="toggle-icon svelte-1gdqxne"/>'),vn=U('<span class="toggle-label svelte-1gdqxne"> </span>'),gn=U("<div><button><!></button> <!></div>"),hn=U('<div class="toggle-group svelte-1gdqxne"></div>');function fn(a,t){we(t,!1);let e=v(t,"options",24,()=>[]),i=v(t,"value",8,""),r=v(t,"onChange",8,g=>{}),l=v(t,"showLabels",8,!0);Se();var d=hn();st(d,5,e,lt,(g,s)=>{var h=gn();let b;var y=S(h);let m;var p=S(y);{var x=u=>{var T=un();te(()=>ue(T,"src",`/icons/${n(s),z(()=>n(s).icon)??""}.svg`)),B(u,T)};Q(p,u=>{n(s),z(()=>n(s).icon)&&u(x)})}_(y);var P=k(y,2);{var o=u=>{var T=vn(),C=S(T,!0);_(T),te(()=>Ie(C,(n(s),z(()=>n(s).label)))),B(u,T)};Q(P,u=>{he(l()),n(s),z(()=>l()&&n(s).label)&&u(o)})}_(h),te(()=>{b=ke(h,1,"toggle-item svelte-1gdqxne",null,b,{active:i()===n(s).id}),m=ke(y,1,"toggle-btn svelte-1gdqxne",null,m,{active:i()===n(s).id}),ue(y,"aria-label",(n(s),z(()=>n(s).label)))}),I("click",y,()=>r()(n(s).id)),B(g,h)}),_(d),B(a,d),xe()}var bn=U('<label class="input-label svelte-1r47u3b"> <input class="input svelte-1r47u3b"/></label>'),pn=U('<input class="input svelte-1r47u3b"/>'),mn=U('<div class="input-field svelte-1r47u3b"><!></div>');function ea(a,t){we(t,!1);let e=v(t,"label",8,""),i=v(t,"value",12,""),r=v(t,"type",8,"text"),l=v(t,"placeholder",8,""),d=v(t,"disabled",8,!1),g=v(t,"onChange",8,p=>{});function s(p){i(p.target.value),g()(i())}Se();var h=mn(),b=S(h);{var y=p=>{var x=bn(),P=S(x),o=k(P);yt(o),_(x),te(()=>{Ie(P,`${e()??""} `),ue(o,"type",r()),At(o,i()),ue(o,"placeholder",l()),o.disabled=d()}),I("input",o,s),B(p,x)},m=p=>{var x=pn();yt(x),te(()=>{ue(x,"type",r()),At(x,i()),ue(x,"placeholder",l()),x.disabled=d()}),I("input",x,s),B(p,x)};Q(b,p=>{e()?p(y):p(m,!1)})}_(h),B(a,h),xe()}var wn=U('<span class="slider-value svelte-jchife"> </span>'),xn=U('<div class="slider-header svelte-jchife"><span class="slider-label svelte-jchife"> </span> <!></div>'),_n=U('<div class="slider-container svelte-jchife"><!> <input type="range" class="slider svelte-jchife"/></div>');function pt(a,t){we(t,!1);let e=v(t,"label",8,""),i=v(t,"min",8,0),r=v(t,"max",8,100),l=v(t,"value",8,50),d=v(t,"step",8,1),g=v(t,"showValue",8,!1),s=v(t,"onChange",8,T=>{}),h=v(t,"onInteractionStart",8,()=>{}),b=v(t,"onInteractionEnd",8,()=>{});function y(T){const C=Number(T.target.value);s()(C)}function m(){h()()}function p(){b()()}Se();var x=_n(),P=S(x);{var o=T=>{var C=xn(),E=S(C),q=S(E,!0);_(E);var F=k(E,2);{var M=L=>{var J=wn(),D=S(J,!0);_(J),te(()=>Ie(D,l())),B(L,J)};Q(F,L=>{g()&&L(M)})}_(C),te(()=>Ie(q,e())),B(T,C)};Q(P,T=>{e()&&T(o)})}var u=k(P,2);yt(u),_(x),te(()=>{ue(u,"min",i()),ue(u,"max",r()),ue(u,"step",d()),At(u,l())}),I("input",u,y),I("mousedown",u,m),I("touchstart",u,m),I("mouseup",u,p),I("touchend",u,p),B(a,x),xe()}var Cn=U('<div class="apply-row svelte-17iy3mz"><button class="btn-apply svelte-17iy3mz">Apply</button></div>'),yn=U('<div class="crop-controls svelte-17iy3mz"><!> <div class="dimensions-row svelte-17iy3mz"><div class="dimension-input svelte-17iy3mz"><!></div> <button class="icon-btn svelte-17iy3mz"><img alt="" class="icon-btn-img svelte-17iy3mz"/></button> <div class="dimension-input svelte-17iy3mz"><!></div> <button class="icon-btn svelte-17iy3mz" aria-label="Flip horizontal"><img src="/icons/icon-flip-horizontal.svg" alt="" class="icon-btn-img svelte-17iy3mz"/></button> <button class="icon-btn svelte-17iy3mz" aria-label="Rotate"><img src="/icons/icon-rotate.svg" alt="" class="icon-btn-img svelte-17iy3mz"/></button></div> <!> <!></div>');function Sn(a,t){we(t,!1);let e=v(t,"aspectRatio",8,"9:16"),i=v(t,"cropWidth",8,1080),r=v(t,"cropHeight",8,1920),l=v(t,"ratioLocked",8,!0),d=v(t,"scale",8,100),g=v(t,"cropPending",8,!1),s=v(t,"onRatioChange",8,Y=>{}),h=v(t,"onDimensionsChange",8,({width:Y,height:$})=>{}),b=v(t,"onLockToggle",8,()=>{}),y=v(t,"onFlip",8,()=>{}),m=v(t,"onRotate",8,()=>{}),p=v(t,"onScaleChange",8,Y=>{}),x=v(t,"onApply",8,()=>{});const P=[{id:"9:16",label:"9:16",icon:"icon-vertical"},{id:"1:1",label:"1:1",icon:"icon-square"},{id:"16:9",label:"16:9",icon:"icon-horizontal"},{id:"custom",label:"Custom",icon:"icon-custom"}];function o(Y){const $=parseInt(Y)||0;h()({width:$,height:r()})}function u(Y){const $=parseInt(Y)||0;h()({width:i(),height:$})}Se();var T=yn(),C=S(T);fn(C,{get options(){return P},get value(){return e()},get onChange(){return s()},showLabels:!0});var E=k(C,2),q=S(E),F=S(q);{let Y=Le(()=>(he(i()),z(()=>i().toString())));ea(F,{label:"Width",type:"number",get value(){return n(Y)},onChange:o})}_(q);var M=k(q,2),L=S(M);_(M);var J=k(M,2),D=S(J);{let Y=Le(()=>(he(r()),z(()=>r().toString())));ea(D,{label:"Height",type:"number",get value(){return n(Y)},onChange:u})}_(J);var V=k(J,2),ve=k(V,2);_(E);var ze=k(E,2);pt(ze,{label:"Scale",min:50,max:200,get value(){return d()},step:1,showValue:!0,get onChange(){return p()}});var Z=k(ze,2);{var le=Y=>{var $=Cn(),ae=S($);_($),I("click",ae,function(...fe){x()?.apply(this,fe)}),B(Y,$)};Q(Z,Y=>{g()&&Y(le)})}_(T),te(()=>{ue(M,"aria-label",l()?"Unlock aspect ratio":"Lock aspect ratio"),ue(L,"src",`/icons/${l()?"icon-lock":"icon-unlock"}.svg`)}),I("click",M,function(...Y){b()?.apply(this,Y)}),I("click",V,function(...Y){y()?.apply(this,Y)}),I("click",ve,function(...Y){m()?.apply(this,Y)}),B(a,T),xe()}var kn=U("<button> </button>"),In=U("<button> </button>"),zn=U('<div class="blur-controls svelte-1e1k0ax"><div class="blur-control-row svelte-1e1k0ax"><!> <label class="invert-checkbox svelte-1e1k0ax"><input type="checkbox" class="svelte-1e1k0ax"/> <span class="checkbox-label svelte-1e1k0ax">Invert</span></label></div> <div class="slider-row svelte-1e1k0ax"><div class="slider-track svelte-1e1k0ax"><!></div> <button class="reset-btn svelte-1e1k0ax" aria-label="Reset"><img src="/icons/icon-reset.svg" alt="" class="reset-icon svelte-1e1k0ax"/></button></div> <div class="zoom-row svelte-1e1k0ax"><span class="zoom-label svelte-1e1k0ax">Zoom in</span> <div class="zoom-slider-row svelte-1e1k0ax"><div class="slider-track svelte-1e1k0ax"><!></div> <button class="reset-btn svelte-1e1k0ax" aria-label="Reset zoom"><img src="/icons/icon-reset.svg" alt="" class="reset-icon svelte-1e1k0ax"/></button></div></div> <div class="nudge-row svelte-1e1k0ax"><button class="nudge-btn svelte-1e1k0ax" aria-label="Nudge up"><img src="/icons/icon-nudge-up.svg" alt="" class="svelte-1e1k0ax"/></button> <button class="nudge-btn svelte-1e1k0ax" aria-label="Nudge down"><img src="/icons/icon-nudge-down.svg" alt="" class="svelte-1e1k0ax"/></button> <button class="nudge-btn svelte-1e1k0ax" aria-label="Nudge left"><img src="/icons/icon-nudge-left.svg" alt="" class="svelte-1e1k0ax"/></button> <button class="nudge-btn svelte-1e1k0ax" aria-label="Nudge right"><img src="/icons/icon-nudge-right.svg" alt="" class="svelte-1e1k0ax"/></button></div></div>'),Bn=U('<div class="edit-controls svelte-1e1k0ax"><div class="enhancement-row svelte-1e1k0ax"></div> <div class="slider-row svelte-1e1k0ax"><div class="slider-track svelte-1e1k0ax"><!></div> <button class="reset-btn svelte-1e1k0ax" aria-label="Reset"><img src="/icons/icon-reset.svg" alt="" class="reset-icon svelte-1e1k0ax"/></button></div> <div class="blur-section svelte-1e1k0ax"><div class="blur-header svelte-1e1k0ax"><button class="chevron-btn svelte-1e1k0ax"><img alt=""/></button> <span class="blur-label svelte-1e1k0ax">Blur</span> <button><span class="toggle-thumb svelte-1e1k0ax"></span></button></div> <!></div></div>');function En(a,t){we(t,!1);const e=ee(),i=ee(),r=ee(),l=ee(),d=ee(),g=ee();let s=v(t,"brightness",8,0),h=v(t,"shadows",8,0),b=v(t,"contrast",8,0),y=v(t,"hdr",8,0),m=v(t,"blurBrushSize",8,50),p=v(t,"blurStrength",8,50),x=v(t,"blurSoften",8,50),P=v(t,"blurInvert",8,!1),o=v(t,"zoomLevel",8,1),u=v(t,"blurEnabled",8,!1),T=v(t,"onBrightnessChange",8,A=>{}),C=v(t,"onShadowsChange",8,A=>{}),E=v(t,"onContrastChange",8,A=>{}),q=v(t,"onHdrChange",8,A=>{}),F=v(t,"onBlurBrushSizeChange",8,A=>{}),M=v(t,"onBlurStrengthChange",8,A=>{}),L=v(t,"onBlurSoftenChange",8,A=>{}),J=v(t,"onBlurInvertChange",8,A=>{}),D=v(t,"onZoomChange",8,A=>{}),V=v(t,"onNudge",8,A=>{}),ve=v(t,"onResetZoom",8,()=>{}),ze=v(t,"onBlurToggle",8,A=>{}),Z=v(t,"onBrushPreviewChange",8,A=>{}),le=v(t,"onEditEnd",8,()=>{}),Y=ee("brightness"),$=ee(u()),ae=ee("brushSize");const fe=[{id:"brightness",label:"Brightness"},{id:"shadows",label:"Shadows"},{id:"contrast",label:"Contrast"},{id:"hdr",label:"HDR"}],be=[{id:"brushSize",label:"Brush size"},{id:"strength",label:"Strength"},{id:"soften",label:"Soften edges"}];function ge(A){switch(n(Y)){case"brightness":T()(A);break;case"shadows":C()(A);break;case"contrast":E()(A);break;case"hdr":q()(A);break}}function Ge(){ge(0)}function Ze(A){switch(n(ae)){case"brushSize":F()(A);break;case"strength":M()(A);break;case"soften":L()(A);break}}function Ne(){Ze(50)}function _e(){const A=!u();ze()(A),O($,A)}function Ae(){u()&&O($,!n($))}function pe(){J()(!P())}function Qe(A){O(Y,A),O($,!1)}function Oe(A){O(ae,A)}function Be(){le()()}function He(){n(ae)==="brushSize"&&Z()(!0)}function tt(){Z()(!1),le()()}me(()=>(n(Y),he(s()),he(h()),he(b()),he(y())),()=>{O(e,(()=>{switch(n(Y)){case"brightness":return s();case"shadows":return h();case"contrast":return b();case"hdr":return y();default:return 0}})())}),me(()=>n(Y),()=>{O(i,n(Y)==="hdr"?0:-100)}),me(()=>{},()=>{O(r,100)}),me(()=>(n(ae),he(m()),he(p()),he(x())),()=>{O(l,(()=>{switch(n(ae)){case"brushSize":return m();case"strength":return p();case"soften":return x();default:return 50}})())}),me(()=>{},()=>{O(d,1)}),me(()=>{},()=>{O(g,100)}),St(),Se();var We=Bn(),re=S(We);st(re,5,()=>fe,lt,(A,K)=>{var de=kn();let X;var c=S(de,!0);_(de),te(()=>{X=ke(de,1,"enhancement-btn svelte-1e1k0ax",null,X,{active:n(Y)===n(K).id}),Ie(c,(n(K),z(()=>n(K).label)))}),I("click",de,()=>Qe(n(K).id)),B(A,de)}),_(re);var Ce=k(re,2),Ee=S(Ce),dt=S(Ee);pt(dt,{get min(){return n(i)},get max(){return n(r)},get value(){return n(e)},step:1,onChange:ge,onInteractionEnd:Be}),_(Ee);var ut=k(Ee,2);_(Ce);var at=k(Ce,2),nt=S(at),Ue=S(nt),rt=S(Ue);let ot;_(Ue);var Ye=k(Ue,4);let f;_(nt);var W=k(nt,2);{var G=A=>{var K=zn(),de=S(K),X=S(de);st(X,1,()=>be,lt,(gt,Ke)=>{var qe=In();let wt;var va=S(qe,!0);_(qe),te(()=>{wt=ke(qe,1,"blur-control-btn svelte-1e1k0ax",null,wt,{active:n(ae)===n(Ke).id}),Ie(va,(n(Ke),z(()=>n(Ke).label)))}),I("click",qe,()=>Oe(n(Ke).id)),B(gt,qe)});var c=k(X,2),w=S(c);yt(w),Aa(2),_(c),_(de);var R=k(de,2),j=S(R),H=S(j);pt(H,{get min(){return n(d)},get max(){return n(g)},get value(){return n(l)},step:1,onChange:Ze,onInteractionStart:He,onInteractionEnd:tt}),_(j);var ne=k(j,2);_(R);var ie=k(R,2),se=k(S(ie),2),ce=S(se),oe=S(ce);pt(oe,{min:1,max:3,step:.1,get value(){return o()},get onChange(){return D()}}),_(ce);var it=k(ce,2);_(se),_(ie);var Pe=k(ie,2),mt=S(Pe),je=k(mt,2),Xe=k(je,2),vt=k(Xe,2);_(Pe),_(K),te(()=>Xa(w,P())),I("change",w,pe),I("click",ne,Ne),I("click",it,function(...gt){ve()?.apply(this,gt)}),I("click",mt,()=>V()("up")),I("click",je,()=>V()("down")),I("click",Xe,()=>V()("left")),I("click",vt,()=>V()("right")),B(A,K)};Q(W,A=>{n($)&&u()&&A(G)})}_(at),_(We),te(()=>{Ue.disabled=!u(),ue(Ue,"aria-label",n($)?"Collapse":"Expand"),ue(rt,"src",`/icons/${n($)?"icon-collapse":"icon-expand"}.svg`),ot=ke(rt,1,"chevron-icon svelte-1e1k0ax",null,ot,{disabled:!u()}),f=ke(Ye,1,"toggle-switch svelte-1e1k0ax",null,f,{active:u()}),ue(Ye,"aria-label",u()?"Disable blur":"Enable blur")}),I("click",ut,Ge),I("click",Ue,Ae),I("click",Ye,_e),B(a,We),xe()}var Pn=U('<button><div class="filter-preview svelte-183y0dt"></div> <span> </span></button>'),Rn=U('<div class="filter-grid svelte-183y0dt"></div>');function Tn(a,t){we(t,!1);let e=v(t,"filters",24,()=>[]),i=v(t,"value",8,"original"),r=v(t,"imageUrl",8,""),l=v(t,"onChange",8,g=>{});Se();var d=Rn();st(d,5,e,lt,(g,s)=>{var h=Pn();let b;var y=S(h),m=k(y,2);let p;var x=S(m,!0);_(m),_(h),te(()=>{b=ke(h,1,"filter-card svelte-183y0dt",null,b,{active:i()===n(s).id}),Re(y,`
					background-image: url(${r()??""});
					filter: ${n(s),z(()=>n(s).css||"none")??""};
				`),p=ke(m,1,"filter-label svelte-183y0dt",null,p,{active:i()===n(s).id}),Ie(x,(n(s),z(()=>n(s).label)))}),I("click",h,()=>l()(n(s).id)),B(g,h)}),_(d),B(a,d),xe()}var Mn=U('<div class="filter-controls svelte-1274k9v"><!> <div><div class="slider-track svelte-1274k9v"><!></div> <button class="reset-btn svelte-1274k9v" aria-label="Reset filter"><img src="/icons/icon-reset.svg" alt="" class="reset-icon svelte-1274k9v"/></button></div></div>');function An(a,t){we(t,!1);const e=ee();let i=v(t,"imageUrl",8,""),r=v(t,"activeFilter",8,"original"),l=v(t,"filterStrength",8,50),d=v(t,"onFilterChange",8,u=>{}),g=v(t,"onStrengthChange",8,u=>{}),s=v(t,"onReset",8,()=>{});const h=[{id:"original",label:"Original",css:"none"},{id:"greyscale",label:"Greyscale",css:"grayscale(100%)"},{id:"sepia",label:"Sepia",css:"sepia(100%)"},{id:"sunset",label:"Sunset",css:"sepia(30%) saturate(140%) brightness(110%) hue-rotate(-10deg)"},{id:"azure",label:"Azure",css:"saturate(120%) brightness(105%) hue-rotate(180deg)"},{id:"teal",label:"Teal",css:"saturate(130%) hue-rotate(140deg)"}];me(()=>he(r()),()=>{O(e,r()==="original")}),St();var b=Mn(),y=S(b);Tn(y,{get filters(){return h},get value(){return r()},get imageUrl(){return i()},get onChange(){return d()}});var m=k(y,2);let p;var x=S(m),P=S(x);{let u=Le(()=>n(e)?()=>{}:g());pt(P,{label:"Strength",min:0,max:100,get value(){return l()},get onChange(){return n(u)}})}_(x);var o=k(x,2);_(m),_(b),te(()=>p=ke(m,1,"slider-row svelte-1274k9v",null,p,{disabled:n(e)})),I("click",o,function(...u){s()?.apply(this,u)}),B(a,b),xe()}const ta=[{id:"original",label:"Original",css:"none"},{id:"greyscale",label:"Greyscale",css:"grayscale(100%)"},{id:"sepia",label:"Sepia",css:"sepia(100%)"},{id:"sunset",label:"Sunset",css:"sepia(30%) saturate(140%) brightness(110%) hue-rotate(-10deg)"},{id:"azure",label:"Azure",css:"saturate(120%) brightness(105%) hue-rotate(180deg)"},{id:"teal",label:"Teal",css:"saturate(130%) hue-rotate(140deg)"}];function Hn(a){const t=[a];let e=0,i=0;const r=Ve({canUndo:!1,canRedo:!1}),{subscribe:l,set:d,update:g}=Ve(a);function s(){r.set({canUndo:e>i,canRedo:e<t.length-1})}return{subscribe:l,undoState:r,set:h=>{t.splice(e+1),t.push(h),e=t.length-1,d(h),s()},update:h=>{g(b=>{const y=h(b);return t.splice(e+1),t.push(y),e=t.length-1,s(),y})},silentUpdate:h=>{g(h)},setBaseState:()=>{i=e,s()},undo:()=>{e>i&&(e--,d(t[e]),s())},redo:()=>{e<t.length-1&&(e++,d(t[e]),s())},canUndo:()=>e>i,canRedo:()=>e<t.length-1,reset:()=>{t.length=0,t.push(a),e=0,i=0,d(a),s()}}}const Un={originalImage:null,currentImage:null,aspectRatio:"custom",width:0,height:0,ratioLocked:!1,scale:1,offsetX:0,offsetY:0,brightness:0,contrast:0,shadows:0,hdr:0,activeFilter:"original",filterStrength:50,cropBox:{x:0,y:0,width:0,height:0},isCropping:!1,cropPending:!1,imageWidth:0,imageHeight:0,blurEnabled:!1,blurBrushSize:50,blurStrength:50,blurSoften:50,blurInvert:!1,blurMask:null,showBrushPreview:!1,zoomLevel:1,zoomOffsetX:0,zoomOffsetY:0},N=Hn(Un),bt=Ve("none"),Fn=Nt(N,a=>a.currentImage!==null);function Dn(){N.reset(),bt.set("none")}var Ln=U('<div class="controls-panel svelte-c9tnuw"><!></div>'),Wn=U('<div class="controls-panel svelte-c9tnuw"><!></div>'),Nn=U("<!> <!> <!> <!>",1),On=U('<div class="crop-tab svelte-c9tnuw"><!> <!> <!></div>');function Yn(a,t){we(t,!1);const e=()=>Me(N,"$cropState",d),i=()=>Me(bt,"$activeSubMenu",d),r=()=>Me(Fn,"$hasImage",d),l=()=>Me(y,"$undoState",d),[d,g]=kt(),s=ee(),h=ee(),b=ee(),y=N.undoState,m=[{id:"crop",label:"Crop"},{id:"edit",label:"Edit"},{id:"filter",label:"Filter"}];let p=ee(null),x=null;async function P(c){const w=await _t(c);N.set({...e(),originalImage:c,currentImage:c,imageWidth:w.width,imageHeight:w.height,width:w.width,height:w.height,cropBox:{x:0,y:0,width:100,height:100},isCropping:!0,cropPending:!1,aspectRatio:"custom",ratioLocked:!1}),N.setBaseState(),bt.set("crop")}function o(c){if(e().cropPending&&i()==="crop"&&c!=="crop"){x=()=>{bt.set(c),N.silentUpdate(w=>({...w,isCropping:!1}))},O(p,"save");return}c==="crop"?N.silentUpdate(w=>({...w,isCropping:!0})):N.silentUpdate(w=>({...w,isCropping:!1})),bt.set(i()===c?"none":c)}async function u(){return await Ka(e().currentImage,n(b),e().blurMask)}async function T(){if(e().cropPending){x=async()=>{const c=await u();await Ht(c)},O(p,"save");return}if(e().currentImage){const c=await u();await Ht(c)}}async function C(){if(e().cropPending){x=async()=>{const c=await u();Ut(c,"picflam-export.png")},O(p,"save");return}if(e().currentImage){const c=await u();Ut(c,"picflam-export.png")}}function E(){O(p,"startAgain")}function q(){N.undo()}function F(){N.redo()}async function M(){O(p,null),await V(),x&&(await x(),x=null)}function L(){O(p,null),x=null}function J(){O(p,null),Dn()}function D(){O(p,null)}async function V(){const c=e();if(!c.currentImage||!c.cropPending)return;const w=await da(c.currentImage,c.cropBox,c.imageWidth,c.imageHeight),R=await _t(w);N.set({...c,currentImage:w,imageWidth:R.width,imageHeight:R.height,width:R.width,height:R.height,cropBox:{x:0,y:0,width:100,height:100},cropPending:!1})}function ve(c){if(c==="custom"){N.silentUpdate(ne=>({...ne,aspectRatio:"custom",cropBox:{x:0,y:0,width:100,height:100},ratioLocked:!1,cropPending:!1}));return}const R={"9:16":9/16,"1:1":1,"16:9":16/9}[c],j=e().imageWidth/e().imageHeight;let H;if(c==="9:16"){const ie=R/j*100;if(ie<=100)H={x:(100-ie)/2,y:0,width:ie,height:100};else{const se=j/R*100;H={x:0,y:(100-se)/2,width:100,height:se}}}else if(c==="16:9"){const ie=j/R*100;if(ie<=100)H={x:0,y:(100-ie)/2,width:100,height:ie};else{const se=R/j*100;H={x:(100-se)/2,y:0,width:se,height:100}}}else if(c==="1:1")if(j>1){const ne=100/j;H={x:(100-ne)/2,y:0,width:ne,height:100}}else{const ne=100*j;H={x:0,y:(100-ne)/2,width:100,height:ne}}N.silentUpdate(ne=>({...ne,aspectRatio:c,cropBox:H,cropPending:!0,isCropping:!0,ratioLocked:!0}))}function ze({width:c,height:w}){const R=e().imageWidth,j=e().imageHeight,H=Math.min(Math.max(1,c),R),ne=Math.min(Math.max(1,w),j),ie=H/R*100,se=ne/j*100;let ce;if(e().ratioLocked){const oe=n(s)/n(h);if(c!==n(s)){const Pe=H/oe/j*100;ce={x:(100-ie)/2,y:(100-Math.min(100,Pe))/2,width:ie,height:Math.min(100,Pe)}}else{const Pe=ne*oe/R*100;ce={x:(100-Math.min(100,Pe))/2,y:(100-se)/2,width:Math.min(100,Pe),height:se}}}else ce={x:(100-ie)/2,y:(100-se)/2,width:ie,height:se};N.silentUpdate(oe=>({...oe,cropBox:ce,cropPending:!0}))}function Z(){N.silentUpdate(c=>({...c,ratioLocked:!c.ratioLocked}))}async function le(){const c=await Qa(e().currentImage);N.set({...e(),currentImage:c})}async function Y(){const c=await Za(e().currentImage,90),w=await _t(c);N.set({...e(),currentImage:c,imageWidth:w.width,imageHeight:w.height,cropBox:{x:0,y:0,width:100,height:100},cropPending:!1})}function $(c){N.silentUpdate(w=>({...w,scale:c/100}))}function ae(c){const w=c.detail.cropBox;if(e().ratioLocked&&e().aspectRatio!=="custom"){const j={"9:16":.5625,"1:1":1,"16:9":1.7777777777777777}[e().aspectRatio];e().imageWidth/e().imageHeight;const H=w.width*e().imageWidth/(w.height*e().imageHeight);if(Math.abs(H-j)>.01){const se=w.width/100*e().imageWidth/j/e().imageHeight*100;w.height=Math.min(100,se),w.y+w.height>100&&(w.y=100-w.height)}}N.silentUpdate(R=>({...R,cropBox:w,cropPending:!0}))}function fe(){V()}let be=null;function ge(){be===null&&(be={...e()})}function Ge(){be!==null&&(N.set(e()),be=null)}function Ze(c){ge(),N.silentUpdate(w=>({...w,brightness:c}))}function Ne(c){ge(),N.silentUpdate(w=>({...w,shadows:c}))}function _e(c){ge(),N.silentUpdate(w=>({...w,contrast:c}))}function Ae(c){ge(),N.silentUpdate(w=>({...w,hdr:c}))}function pe(c){N.set({...e(),blurEnabled:c})}function Qe(c){ge(),N.silentUpdate(w=>({...w,blurBrushSize:c}))}function Oe(c){ge(),N.silentUpdate(w=>({...w,blurStrength:c}))}function Be(c){ge(),N.silentUpdate(w=>({...w,blurSoften:c}))}function He(c){N.set({...e(),blurInvert:c})}function tt(c){N.silentUpdate(w=>({...w,showBrushPreview:c}))}function We(){Ge()}let re=null,Ce=[],Ee=null;function dt(c){const w=c.detail.point;Ee===null&&(Ee=e().blurMask?[...e().blurMask]:[]),Ce.push(w),N.silentUpdate(R=>({...R,blurMask:[...R.blurMask||[],w]})),re&&clearTimeout(re),re=setTimeout(()=>{if(Ce.length>0){const R=[...Ee,...Ce];N.set({...e(),blurMask:R}),Ce=[],Ee=null}re=null},300)}function ut(c){N.silentUpdate(w=>({...w,zoomLevel:c}))}function at(c){N.silentUpdate(R=>{let{zoomOffsetX:j,zoomOffsetY:H}=R;switch(c){case"up":H-=20;break;case"down":H+=20;break;case"left":j-=20;break;case"right":j+=20;break}return{...R,zoomOffsetX:j,zoomOffsetY:H}})}function nt(){N.silentUpdate(c=>({...c,zoomLevel:1,zoomOffsetX:0,zoomOffsetY:0}))}function Ue(c){N.silentUpdate(w=>({...w,activeFilter:c}))}function rt(c){ge(),N.silentUpdate(w=>({...w,filterStrength:c}))}function ot(){N.set({...e(),activeFilter:"original",filterStrength:50})}me(()=>e(),()=>{O(s,Math.round(e().imageWidth*e().cropBox.width/100))}),me(()=>e(),()=>{O(h,Math.round(e().imageHeight*e().cropBox.height/100))}),me(()=>(e(),ta),()=>{O(b,(()=>{let c=[];if(e().brightness!==0&&c.push(`brightness(${1+e().brightness/100})`),e().contrast!==0&&c.push(`contrast(${1+e().contrast/100})`),e().shadows!==0){const w=1+e().shadows/200;c.push(`brightness(${w})`)}if(e().hdr!==0){const w=1+e().hdr/100*.3,R=1+e().hdr/100*.2;c.push(`saturate(${w}) contrast(${R})`)}if(e().activeFilter!=="original"){const w=ta.find(R=>R.id===e().activeFilter);if(w&&w.css!=="none"){const R=e().filterStrength/100,j=w.css.replace(/(\d+)%/g,(H,ne)=>`${Math.round(parseInt(ne)*R)}%`);c.push(j)}}return c.length>0?c.join(" "):"none"})())}),St(),Se();var Ye=On(),f=S(Ye);{var W=c=>{ua(c,{title:"Crop, edit and add filters to photos",hint:"Import, drag or paste an image",onImageImport:P})},G=c=>{var w=Nn(),R=ye(w);Yt(R,{get canUndo(){return l(),z(()=>l().canUndo)},get canRedo(){return l(),z(()=>l().canRedo)},onUndo:q,onRedo:F,onStartAgain:E,onCopy:T,onExport:C});var j=k(R,2);{let ce=Le(()=>(i(),e(),z(()=>i()==="edit"?e().zoomLevel:e().scale))),oe=Le(()=>(i(),e(),z(()=>i()==="edit"?e().zoomOffsetX:e().offsetX))),it=Le(()=>(i(),e(),z(()=>i()==="edit"?e().zoomOffsetY:e().offsetY))),Pe=Le(()=>(e(),z(()=>e().blurMask||[])));dn(j,{get imageSrc(){return e(),z(()=>e().currentImage)},get cropBox(){return e(),z(()=>e().cropBox)},get isCropping(){return e(),z(()=>e().isCropping)},get scale(){return n(ce)},get offsetX(){return n(oe)},get offsetY(){return n(it)},get imageWidth(){return e(),z(()=>e().imageWidth)},get imageHeight(){return e(),z(()=>e().imageHeight)},get editFilters(){return n(b)},get blurEnabled(){return e(),z(()=>e().blurEnabled)},get blurBrushSize(){return e(),z(()=>e().blurBrushSize)},get blurStrength(){return e(),z(()=>e().blurStrength)},get blurSoften(){return e(),z(()=>e().blurSoften)},get blurInvert(){return e(),z(()=>e().blurInvert)},get blurMask(){return n(Pe)},get showBrushPreview(){return e(),z(()=>e().showBrushPreview)},$$events:{cropChange:ae,blurPaint:dt}})}var H=k(j,2);jt(H,{get tabs(){return m},get activeTab(){return i()},onTabChange:o});var ne=k(H,2);{var ie=ce=>{{let oe=Le(()=>(e(),z(()=>Math.round(e().scale*100))));Sn(ce,{get aspectRatio(){return e(),z(()=>e().aspectRatio)},get cropWidth(){return n(s)},get cropHeight(){return n(h)},get ratioLocked(){return e(),z(()=>e().ratioLocked)},get scale(){return n(oe)},get cropPending(){return e(),z(()=>e().cropPending)},onRatioChange:ve,onDimensionsChange:ze,onLockToggle:Z,onFlip:le,onRotate:Y,onScaleChange:$,onApply:fe})}},se=ce=>{var oe=De(),it=ye(oe);{var Pe=je=>{var Xe=Ln(),vt=S(Xe);En(vt,{get brightness(){return e(),z(()=>e().brightness)},get shadows(){return e(),z(()=>e().shadows)},get contrast(){return e(),z(()=>e().contrast)},get hdr(){return e(),z(()=>e().hdr)},get blurEnabled(){return e(),z(()=>e().blurEnabled)},get blurBrushSize(){return e(),z(()=>e().blurBrushSize)},get blurStrength(){return e(),z(()=>e().blurStrength)},get blurSoften(){return e(),z(()=>e().blurSoften)},get blurInvert(){return e(),z(()=>e().blurInvert)},get zoomLevel(){return e(),z(()=>e().zoomLevel)},onBrightnessChange:Ze,onShadowsChange:Ne,onContrastChange:_e,onHdrChange:Ae,onBlurToggle:pe,onBlurBrushSizeChange:Qe,onBlurStrengthChange:Oe,onBlurSoftenChange:Be,onBlurInvertChange:He,onZoomChange:ut,onNudge:at,onResetZoom:nt,onBrushPreviewChange:tt,onEditEnd:We}),_(Xe),B(je,Xe)},mt=je=>{var Xe=De(),vt=ye(Xe);{var gt=Ke=>{var qe=Wn(),wt=S(qe);An(wt,{get imageUrl(){return e(),z(()=>e().currentImage)},get activeFilter(){return e(),z(()=>e().activeFilter)},get filterStrength(){return e(),z(()=>e().filterStrength)},onFilterChange:Ue,onStrengthChange:rt,onReset:ot}),_(qe),B(Ke,qe)};Q(vt,Ke=>{i()==="filter"&&Ke(gt)},!0)}B(je,Xe)};Q(it,je=>{i()==="edit"?je(Pe):je(mt,!1)},!0)}B(ce,oe)};Q(ne,ce=>{i()==="crop"?ce(ie):ce(se,!1)})}B(c,w)};Q(f,c=>{r()?c(G,!1):c(W)})}var A=k(f,2);{var K=c=>{Ft(c,{message:"Save changes?",confirmText:"Yes",cancelText:"Cancel",onConfirm:M,onCancel:L})};Q(A,c=>{n(p)==="save"&&c(K)})}var de=k(A,2);{var X=c=>{Ft(c,{message:"Start again? Your changes will be lost.",confirmText:"Yes",cancelText:"Cancel",onConfirm:J,onCancel:D})};Q(de,c=>{n(p)==="startAgain"&&c(X)})}_(Ye),B(a,Ye),xe(),g()}const aa={originalImage:null,currentImage:null,processedImage:null,isProcessing:!1,processingType:null,upscaleFactor:1,showComparison:!1,comparisonPosition:50};function jn(){const{subscribe:a,set:t,update:e}=Ve(aa);return{subscribe:a,setImage:i=>e(r=>({...r,originalImage:i,currentImage:i,processedImage:null})),startProcessing:i=>e(r=>({...r,isProcessing:!0,processingType:i})),finishProcessing:i=>e(r=>({...r,isProcessing:!1,processingType:null,processedImage:i,currentImage:i,showComparison:!0})),cancelProcessing:()=>e(i=>({...i,isProcessing:!1,processingType:null})),setUpscaleFactor:i=>e(r=>({...r,upscaleFactor:i})),setComparisonPosition:i=>e(r=>({...r,comparisonPosition:i})),reset:()=>t(aa)}}const Ct=jn(),na=Ve("enhance"),Xn=Nt(Ct,a=>a.currentImage!==null);var qn=U('<div class="controls-panel svelte-17agwu4"><button class="ai-action-btn svelte-17agwu4"><img src="/icons/icon-ai.svg" alt="" class="ai-icon svelte-17agwu4"/> Enhance image</button> <p class="ai-hint svelte-17agwu4">Sharpens and enhances images at the same size</p></div>'),Jn=U('<div class="controls-panel svelte-17agwu4"><p class="placeholder svelte-17agwu4">Upscale controls coming in Phase 4</p></div>'),Vn=U('<div class="controls-panel svelte-17agwu4"><p class="placeholder svelte-17agwu4">Background removal coming in Phase 4</p></div>'),Gn=U('<!> <div class="image-container svelte-17agwu4"><img alt="Working image" class="working-image svelte-17agwu4"/></div> <!> <!>',1),Zn=U('<div class="ai-tab svelte-17agwu4"><!></div>');function Qn(a,t){we(t,!1);const e=()=>Me(Ct,"$aiState",l),i=()=>Me(Xn,"$hasAiImage",l),r=()=>Me(na,"$activeAiMenu",l),[l,d]=kt(),g=[{id:"enhance",label:"Enhance"},{id:"upscale",label:"Upscale"},{id:"background",label:"Remove background"}];function s(o){Ct.setImage(o)}function h(o){na.set(o)}async function b(){e().currentImage&&await Ht(e().currentImage)}function y(){e().currentImage&&Ut(e().currentImage,"picflam-ai.png")}Se();var m=Zn(),p=S(m);{var x=o=>{ua(o,{title:"Enhance, upscale and remove backgrounds using AI power",hint:"Import, drag or paste an image",onImageImport:s})},P=o=>{var u=Gn(),T=ye(u);Yt(T,{canUndo:!1,canRedo:!1,onUndo:()=>{},onRedo:()=>{},onStartAgain:()=>Ct.reset(),onCopy:b,onExport:y});var C=k(T,2),E=S(C);_(C);var q=k(C,2);jt(q,{get tabs(){return g},get activeTab(){return r()},onTabChange:h});var F=k(q,2);{var M=J=>{var D=qn();B(J,D)},L=J=>{var D=De(),V=ye(D);{var ve=Z=>{var le=Jn();B(Z,le)},ze=Z=>{var le=De(),Y=ye(le);{var $=ae=>{var fe=Vn();B(ae,fe)};Q(Y,ae=>{r()==="background"&&ae($)},!0)}B(Z,le)};Q(V,Z=>{r()==="upscale"?Z(ve):Z(ze,!1)},!0)}B(J,D)};Q(F,J=>{r()==="enhance"?J(M):J(L,!1)})}te(()=>ue(E,"src",e().currentImage)),B(o,u)};Q(p,o=>{i()?o(P,!1):o(x)})}_(m),B(a,m),xe(),d()}const Kn={canvasSize:"1/1",background:{type:"solid",value:"#FFFFFF"},text1:"",text1Font:"Inter",text1Size:5,text1YPosition:3,text1LineSpacing:5,text1Color:"#000000",text1HighlightColor:"transparent",text1IsBold:!0,text1Align:"center",text1QuoteStyle:"none",text1QuoteSize:5,text2:"",text2Font:"Inter",text2Size:3,text2YPosition:8,text2LineSpacing:5,text2Color:"#000000",text2LabelColor:"transparent",text2IsBold:!1,text2Align:"center",overlay:null,overlayScale:1,overlayOpacity:1,overlayX:0,overlayY:0,overlayMask:"none",overlayWrap:!1,overlayBorderWidth:0,overlayBorderColor:"#FFFFFF"};function $n(a){const t=[JSON.parse(JSON.stringify(a))];let e=0;const{subscribe:i,set:r,update:l}=Ve(a);return{subscribe:i,set:d=>{t.splice(e+1),t.push(JSON.parse(JSON.stringify(d))),e=t.length-1,r(d)},update:d=>{l(g=>{const s=d(g);return t.splice(e+1),t.push(JSON.parse(JSON.stringify(s))),e=t.length-1,s})},undo:()=>e>0?(e--,r(JSON.parse(JSON.stringify(t[e]))),!0):!1,redo:()=>e<t.length-1?(e++,r(JSON.parse(JSON.stringify(t[e]))),!0):!1,canUndo:()=>e>0,canRedo:()=>e<t.length-1,reset:()=>{const d=JSON.parse(JSON.stringify(a));t.length=0,t.push(d),e=0,r(d)}}}const et=$n(Kn),Dt=Ve(!0),Lt=Ve("none");Nt(et,a=>a.text1||a.text2||a.overlay||a.background.value!=="#FFFFFF");function ei(){et.reset(),Dt.set(!0),Lt.set("none")}var ti=U('<button class="template-card svelte-fxk5n4"><div class="template-placeholder svelte-fxk5n4"> </div></button>'),ai=U('<div class="template-picker svelte-fxk5n4"><p class="picker-title svelte-fxk5n4">Create quotes and cards. Start with a template or blank canvas</p> <button class="blank-canvas-btn svelte-fxk5n4"><img src="/icons/icon-add.svg" alt="" class="add-icon svelte-fxk5n4"/></button> <div class="template-grid svelte-fxk5n4"></div></div>'),ni=U('<p class="placeholder svelte-fxk5n4">Size controls coming in Phase 5</p>'),ii=U('<p class="placeholder svelte-fxk5n4">Background controls coming in Phase 5</p>'),ri=U('<p class="placeholder svelte-fxk5n4">Text 1 controls coming in Phase 5</p>'),oi=U('<p class="placeholder svelte-fxk5n4">Text 2 controls coming in Phase 5</p>'),li=U('<p class="placeholder svelte-fxk5n4">Quote controls coming in Phase 5</p>'),si=U('<p class="placeholder svelte-fxk5n4">Overlay controls coming in Phase 5</p>'),ci=U('<!> <div class="canvas-container svelte-fxk5n4"><div class="design-canvas svelte-fxk5n4"></div></div> <!> <div class="controls-panel svelte-fxk5n4"><!></div>',1),di=U('<div class="design-tab svelte-fxk5n4"><!></div>');function ui(a,t){we(t,!1);const e=()=>Me(Lt,"$activeDesignMenu",l),i=()=>Me(Dt,"$showTemplatePicker",l),r=()=>Me(et,"$slideState",l),[l,d]=kt(),g=[{id:"size",label:"Size"},{id:"background",label:"Background"},{id:"text1",label:"Text 1"},{id:"text2",label:"Text 2"},{id:"quote",label:"Quote"},{id:"overlay",label:"Overlay"}];function s(o){o==="blank"&&et.reset(),Dt.set(!1)}function h(o){Lt.set(e()===o?"none":o)}async function b(){}function y(){}Se();var m=di(),p=S(m);{var x=o=>{var u=ai(),T=k(S(u),2),C=k(T,2);st(C,4,()=>[1,2,3,4,5,6],lt,(E,q)=>{var F=ti(),M=S(F),L=S(M);_(M),_(F),te(()=>Ie(L,`Template ${q??""}`)),I("click",F,()=>s(`template-${q}`)),B(E,F)}),_(C),_(u),I("click",T,()=>s("blank")),B(o,u)},P=o=>{var u=ci(),T=ye(u);{let D=Le(()=>et.canUndo()),V=Le(()=>et.canRedo());Yt(T,{get canUndo(){return n(D)},get canRedo(){return n(V)},onUndo:()=>et.undo(),onRedo:()=>et.redo(),get onStartAgain(){return ei},onCopy:b,onExport:y})}var C=k(T,2),E=S(C);_(C);var q=k(C,2);jt(q,{get tabs(){return g},get activeTab(){return e()},onTabChange:h});var F=k(q,2),M=S(F);{var L=D=>{var V=ni();B(D,V)},J=D=>{var V=De(),ve=ye(V);{var ze=le=>{var Y=ii();B(le,Y)},Z=le=>{var Y=De(),$=ye(Y);{var ae=be=>{var ge=ri();B(be,ge)},fe=be=>{var ge=De(),Ge=ye(ge);{var Ze=_e=>{var Ae=oi();B(_e,Ae)},Ne=_e=>{var Ae=De(),pe=ye(Ae);{var Qe=Be=>{var He=li();B(Be,He)},Oe=Be=>{var He=De(),tt=ye(He);{var We=re=>{var Ce=si();B(re,Ce)};Q(tt,re=>{e()==="overlay"&&re(We)},!0)}B(Be,He)};Q(pe,Be=>{e()==="quote"?Be(Qe):Be(Oe,!1)},!0)}B(_e,Ae)};Q(Ge,_e=>{e()==="text2"?_e(Ze):_e(Ne,!1)},!0)}B(be,ge)};Q($,be=>{e()==="text1"?be(ae):be(fe,!1)},!0)}B(le,Y)};Q(ve,le=>{e()==="background"?le(ze):le(Z,!1)},!0)}B(D,V)};Q(M,D=>{e()==="size"?D(L):D(J,!1)})}_(F),te(()=>Re(E,`
					aspect-ratio: ${r().canvasSize??""};
					background: ${r().background.type==="solid",r().background.value??""};
				`)),B(o,u)};Q(p,o=>{i()?o(x):o(P,!1)})}_(m),B(a,m),xe(),d()}const Pt=Ve("crop");var vi=U('<!> <main class="main svelte-1uha8ag"><!></main> <!>',1);function xi(a,t){we(t,!1);const e=()=>Me(Pt,"$activeTab",r),i=()=>Me(N,"$cropState",r),[r,l]=kt();let d=ee(!1),g=null;function s(C){if(e()==="crop"&&i().cropPending&&C!=="crop"){g=C,O(d,!0);return}Pt.set(C)}async function h(){O(d,!1);const C=i();if(C.currentImage&&C.cropPending){const E=await da(C.currentImage,C.cropBox,C.imageWidth,C.imageHeight),q=await _t(E);N.set({...C,currentImage:E,imageWidth:q.width,imageHeight:q.height,cropBox:{x:0,y:0,width:100,height:100},cropPending:!1,isCropping:!1})}g&&(Pt.set(g),g=null)}function b(){O(d,!1),g=null}Se();var y=vi(),m=ye(y);Va(m,{get activeTab(){return e()},onTabChange:s});var p=k(m,2),x=S(p);{var P=C=>{Yn(C,{})},o=C=>{var E=De(),q=ye(E);{var F=L=>{Qn(L,{})},M=L=>{var J=De(),D=ye(J);{var V=ve=>{ui(ve,{})};Q(D,ve=>{e()==="design"&&ve(V)},!0)}B(L,J)};Q(q,L=>{e()==="ai"?L(F):L(M,!1)},!0)}B(C,E)};Q(x,C=>{e()==="crop"?C(P):C(o,!1)})}_(p);var u=k(p,2);{var T=C=>{Ft(C,{message:"Save changes?",confirmText:"Yes",cancelText:"Cancel",onConfirm:h,onCancel:b})};Q(u,C=>{n(d)&&C(T)})}B(a,y),xe(),l()}export{xi as component};

import{b as la,d as Oa,f as N,a as D,c as ut}from"../chunks/CTT2nEcH.js";import"../chunks/DUHCFzxV.js";import{i as st,x as Ft,al as Ca,F as Ot,C as Yt,j as Gt,M as Na,g as a,aI as tt,aA as Ha,O as Ua,a5 as sa,aj as Wt,B as Bt,N as Sa,ao as Ya,a2 as ca,ax as Wa,P as Qt,az as ja,am as ta,w as Ia,I as da,at as J,aO as Xa,aP as Ga,aQ as Qa,aR as pt,ay as za,R as Fa,aS as jt,ah as Ba,aT as Za,a3 as Ja,aU as Ra,L as Ea,aV as Va,t as $,A as Ka,aW as $a,ap as en,ai as tn,aX as an,aY as nn,aZ as on,a_ as rn,p as Ne,n as He,s as l,k as f,l as u,aq as I,m as Ge,b as h,a$ as et,b0 as yt,e as Be,a4 as Ht,b1 as va}from"../chunks/Dowq9yQq.js";import{p as b,i as ee,b as bt,s as vt,a as Pt,_ as ln}from"../chunks/CzwPkIKx.js";import{i as We}from"../chunks/Dqy9l8l1.js";import{e as s,s as Ze}from"../chunks/CgNPIS03.js";import{c as sn,o as Lt,d as aa,w as xt,a as na}from"../chunks/C99_Sh4f.js";function Pa(o){st&&Ft(o)!==null&&Ca(o)}let ua=!1;function cn(){ua||(ua=!0,document.addEventListener("reset",o=>{Promise.resolve().then(()=>{if(!o.defaultPrevented)for(const t of o.target.elements)t.__on_r?.()})},{capture:!0}))}function mt(o,t){return t}function dn(o,t,e){for(var n=[],i=t.length,r,d=t.length,v=0;v<i;v++){let C=t[v];Fa(C,()=>{if(r){if(r.pending.delete(C),r.done.add(C),r.pending.size===0){var F=o.outrogroups;Zt(ta(r.done)),F.delete(r),F.size===0&&(o.outrogroups=null)}}else d-=1},!1)}if(d===0){var c=n.length===0&&e!==null;if(c){var m=e,p=m.parentNode;Ca(p),p.append(m),o.items.clear()}Zt(t,!c)}else r={pending:new Set(t),done:new Set},(o.outrogroups??=new Set).add(r)}function Zt(o,t=!0){for(var e=0;e<o.length;e++)Ja(o[e],t)}var ga;function ft(o,t,e,n,i,r=null){var d=o,v=new Map,c=(t&Ra)!==0;if(c){var m=o;d=st?Ot(Ft(m)):m.appendChild(Yt())}st&&Gt();var p=null,C=tt(()=>{var y=e();return Ia(y)?y:y==null?[]:ta(y)}),F,x=!0;function _(){g.fallback=p,vn(g,F,d,t,n),p!==null&&(F.length===0?(p.f&pt)===0?za(p):(p.f^=pt,qt(p,null,d)):Fa(p,()=>{p=null}))}var B=Na(()=>{F=a(C);var y=F.length;let T=!1;if(st){var L=Ha(d)===Ua;L!==(y===0)&&(d=sa(),Ot(d),Wt(!1),T=!0)}for(var S=new Set,O=Wa,Q=ja(),Z=0;Z<y;Z+=1){st&&Bt.nodeType===Sa&&Bt.data===Ya&&(d=Bt,T=!0,Wt(!1));var H=F[Z],A=n(H,Z),U=x?null:v.get(A);U?(U.v&&ca(U.v,H),U.i&&ca(U.i,Z),Q&&O.skipped_effects.delete(U.e)):(U=un(v,x?d:ga??=Yt(),H,A,Z,i,t,e),x||(U.e.f|=pt),v.set(A,U)),S.add(A)}if(y===0&&r&&!p&&(x?p=Qt(()=>r(d)):(p=Qt(()=>r(ga??=Yt())),p.f|=pt)),st&&y>0&&Ot(sa()),!x)if(Q){for(const[ve,Se]of v)S.has(ve)||O.skipped_effects.add(Se.e);O.oncommit(_),O.ondiscard(()=>{})}else _();T&&Wt(!0),a(C)}),g={effect:B,items:v,outrogroups:null,fallback:p};x=!1,st&&(d=Bt)}function Mt(o){for(;o!==null&&(o.f&Za)===0;)o=o.next;return o}function vn(o,t,e,n,i){var r=(n&Va)!==0,d=t.length,v=o.items,c=Mt(o.effect.first),m,p=null,C,F=[],x=[],_,B,g,y;if(r)for(y=0;y<d;y+=1)_=t[y],B=i(_,y),g=v.get(B).e,(g.f&pt)===0&&(g.nodes?.a?.measure(),(C??=new Set).add(g));for(y=0;y<d;y+=1){if(_=t[y],B=i(_,y),g=v.get(B).e,o.outrogroups!==null)for(const U of o.outrogroups)U.pending.delete(g),U.done.delete(g);if((g.f&pt)!==0)if(g.f^=pt,g===c)qt(g,null,e);else{var T=p?p.next:c;g===o.effect.last&&(o.effect.last=g.prev),g.prev&&(g.prev.next=g.next),g.next&&(g.next.prev=g.prev),kt(o,p,g),kt(o,g,T),qt(g,T,e),p=g,F=[],x=[],c=Mt(p.next);continue}if((g.f&jt)!==0&&(za(g),r&&(g.nodes?.a?.unfix(),(C??=new Set).delete(g))),g!==c){if(m!==void 0&&m.has(g)){if(F.length<x.length){var L=x[0],S;p=L.prev;var O=F[0],Q=F[F.length-1];for(S=0;S<F.length;S+=1)qt(F[S],L,e);for(S=0;S<x.length;S+=1)m.delete(x[S]);kt(o,O.prev,Q.next),kt(o,p,O),kt(o,Q,L),c=L,p=Q,y-=1,F=[],x=[]}else m.delete(g),qt(g,c,e),kt(o,g.prev,g.next),kt(o,g,p===null?o.effect.first:p.next),kt(o,p,g),p=g;continue}for(F=[],x=[];c!==null&&c!==g;)(m??=new Set).add(c),x.push(c),c=Mt(c.next);if(c===null)continue}(g.f&pt)===0&&F.push(g),p=g,c=Mt(g.next)}if(o.outrogroups!==null){for(const U of o.outrogroups)U.pending.size===0&&(Zt(ta(U.done)),o.outrogroups?.delete(U));o.outrogroups.size===0&&(o.outrogroups=null)}if(c!==null||m!==void 0){var Z=[];if(m!==void 0)for(g of m)(g.f&jt)===0&&Z.push(g);for(;c!==null;)(c.f&jt)===0&&c!==o.fallback&&Z.push(c),c=Mt(c.next);var H=Z.length;if(H>0){var A=(n&Ra)!==0&&d===0?e:null;if(r){for(y=0;y<H;y+=1)Z[y].nodes?.a?.measure();for(y=0;y<H;y+=1)Z[y].nodes?.a?.fix()}dn(o,Z,A)}}r&&Ea(()=>{if(C!==void 0)for(g of C)g.nodes?.a?.apply()})}function un(o,t,e,n,i,r,d,v){var c=(d&Ga)!==0?(d&Qa)===0?J(e,!1,!1):da(e):null,m=(d&Xa)!==0?da(i):null;return{v:c,i:m,e:Qt(()=>(r(t,c??e,m??i,v),()=>{o.delete(n)}))}}function qt(o,t,e){if(o.nodes)for(var n=o.nodes.start,i=o.nodes.end,r=t&&(t.f&pt)===0?t.nodes.start:e;n!==null;){var d=Ba(n);if(r.before(n),n===i)return;n=d}}function kt(o,t,e){t===null?o.effect.first=e:t.next=e,e===null?o.effect.last=t:e.prev=t}function ha(o,t,e=!1,n=!1,i=!1){var r=o,d="";$(()=>{var v=Ka;if(d===(d=t()??"")){st&&Gt();return}if(v.nodes!==null&&($a(v.nodes.start,v.nodes.end),v.nodes=null),d!==""){if(st){Bt.data;for(var c=Gt(),m=c;c!==null&&(c.nodeType!==Sa||c.data!=="");)m=c,c=Ba(c);if(c===null)throw en(),tn;la(Bt,m),r=Ot(c);return}var p=d+"";e?p=`<svg>${p}</svg>`:n&&(p=`<math>${p}</math>`);var C=Oa(p);if((e||n)&&(C=Ft(C)),la(Ft(C),C.lastChild),e||n)for(;Ft(C);)r.before(Ft(C));else r.before(C)}})}const fa=[...` 	
\r\fÂ \v\uFEFF`];function gn(o,t,e){var n=o==null?"":""+o;if(e){for(var i in e)if(e[i])n=n?n+" "+i:i;else if(n.length)for(var r=i.length,d=0;(d=n.indexOf(i,d))>=0;){var v=d+r;(d===0||fa.includes(n[d-1]))&&(v===n.length||fa.includes(n[v]))?n=(d===0?"":n.substring(0,d))+n.substring(v+1):d=v}}return n===""?null:n}function hn(o,t){return o==null?null:String(o)}function de(o,t,e,n,i,r){var d=o.__className;if(st||d!==e||d===void 0){var v=gn(e,n,r);(!st||v!==o.getAttribute("class"))&&(v==null?o.removeAttribute("class"):o.className=v),o.__className=e}else if(r&&i!==r)for(var c in r){var m=!!r[c];(i==null||m!==!!i[c])&&o.classList.toggle(c,m)}return r}function Ce(o,t,e,n){var i=o.__style;if(st||i!==t){var r=hn(t);(!st||r!==o.getAttribute("style"))&&(r==null?o.removeAttribute("style"):o.style.cssText=r),o.__style=t}return n}const fn=Symbol("is custom element"),bn=Symbol("is html");function ct(o){if(st){var t=!1,e=()=>{if(!t){if(t=!0,o.hasAttribute("value")){var n=o.value;se(o,"value",null),o.value=n}if(o.hasAttribute("checked")){var i=o.checked;se(o,"checked",null),o.checked=i}}};o.__on_r=e,Ea(e),cn()}}function rt(o,t){var e=ia(o);e.value===(e.value=t??void 0)||o.value===t&&(t!==0||o.nodeName!=="PROGRESS")||(o.value=t??"")}function mn(o,t){var e=ia(o);e.checked!==(e.checked=t??void 0)&&(o.checked=t)}function se(o,t,e,n){var i=ia(o);st&&(i[t]=o.getAttribute(t),t==="src"||t==="srcset"||t==="href"&&o.nodeName==="LINK")||i[t]!==(i[t]=e)&&(t==="loading"&&(o[an]=e),e==null?o.removeAttribute(t):typeof e!="string"&&pn(o).includes(t)?o[t]=e:o.setAttribute(t,e))}function ia(o){return o.__attributes??={[fn]:o.nodeName.includes("-"),[bn]:o.namespaceURI===nn}}var ba=new Map;function pn(o){var t=o.getAttribute("is")||o.nodeName,e=ba.get(t);if(e)return e;ba.set(t,e=[]);for(var n,i=o,r=Element.prototype;r!==i;){n=rn(i);for(var d in n)n[d].set&&e.push(d);i=on(i)}return e}function gt(o){return function(...t){var e=t[0];return e.stopPropagation(),o?.apply(this,t)}}function Jt(o,t){var e=o.$$events?.[t.type],n=Ia(e)?e.slice():e==null?[]:[e];for(var i of n)i.call(this,t)}var xn=N('<header class="header svelte-hv3zzy"><img src="/logos/logo-picflam-logotype.png" alt="PicFlam" class="header-logo svelte-hv3zzy"/> <nav class="header-nav svelte-hv3zzy"><button aria-label="Crop tab"><img src="/icons/icon-crop.svg" alt="" class="nav-icon svelte-hv3zzy"/></button> <button aria-label="AI tab"><img src="/icons/icon-ai.svg" alt="" class="nav-icon svelte-hv3zzy"/></button> <button aria-label="Design tab"><img src="/icons/icon-design.svg" alt="" class="nav-icon svelte-hv3zzy"/></button></nav></header>');function wn(o,t){Ne(t,!1);let e=b(t,"activeTab",8,"crop"),n=b(t,"onTabChange",8);We();var i=xn(),r=l(f(i),2),d=f(r);let v;var c=l(d,2);let m;var p=l(c,2);let C;u(r),u(i),$(()=>{v=de(d,1,"nav-btn svelte-hv3zzy",null,v,{active:e()==="crop"}),m=de(c,1,"nav-btn svelte-hv3zzy",null,m,{active:e()==="ai"}),C=de(p,1,"nav-btn svelte-hv3zzy",null,C,{active:e()==="design"})}),s("click",d,()=>n()("crop")),s("click",c,()=>n()("ai")),s("click",p,()=>n()("design")),D(o,i),He()}function La(o){return new Promise((t,e)=>{const n=new FileReader;n.onload=i=>t(i.target.result),n.onerror=e,n.readAsDataURL(o)})}function wt(o){return new Promise((t,e)=>{const n=new Image;n.onload=()=>t(n),n.onerror=e,n.src=o})}async function Nt(o){const t=await wt(o);return{width:t.naturalWidth,height:t.naturalHeight}}function ma(o,t=2048){return new Promise(async e=>{const n=await wt(o),{naturalWidth:i,naturalHeight:r}=n;if(i<=t&&r<=t){e(o);return}const d=document.createElement("canvas"),v=d.getContext("2d");let c,m;i>r?(c=t,m=r/i*t):(m=t,c=i/r*t),d.width=c,d.height=m,v.drawImage(n,0,0,c,m),e(d.toDataURL("image/jpeg",.92))})}async function yn(){try{const o=await navigator.clipboard.read();for(const t of o)for(const e of t.types)if(e.startsWith("image/")){const n=await t.getType(e);return await La(n)}return null}catch(o){return console.error("Failed to paste from clipboard:",o),null}}async function Vt(o){try{const e=await(await fetch(o)).blob();return await navigator.clipboard.write([new ClipboardItem({[e.type]:e})]),!0}catch(t){return console.error("Failed to copy to clipboard:",t),!1}}function Kt(o,t="picflam-export.png"){const e=document.createElement("a");e.href=o,e.download=t,document.body.appendChild(e),e.click(),document.body.removeChild(e)}async function Ma(o,t,e,n){const i=await wt(o),r=document.createElement("canvas"),d=r.getContext("2d"),v=t.x/100*e,c=t.y/100*n,m=t.width/100*e,p=t.height/100*n;return r.width=m,r.height=p,d.drawImage(i,v,c,m,p,0,0,m,p),r.toDataURL("image/png")}async function _n(o,t){const e=await wt(o),n=document.createElement("canvas"),i=n.getContext("2d");return n.width=e.naturalHeight,n.height=e.naturalWidth,i.translate(n.width/2,n.height/2),i.rotate(t*Math.PI/180),i.drawImage(e,-e.naturalWidth/2,-e.naturalHeight/2),n.toDataURL("image/png")}async function kn(o,t){const e=await wt(o),n=document.createElement("canvas"),i=n.getContext("2d");return n.width=e.naturalWidth,n.height=e.naturalHeight,i.translate(n.width,0),i.scale(-1,1),i.drawImage(e,0,0),n.toDataURL("image/png")}async function Cn(o,t,e){const n=await wt(o),i=document.createElement("canvas"),r=i.getContext("2d");if(i.width=n.naturalWidth,i.height=n.naturalHeight,t&&t!=="none"&&(r.filter=t),r.drawImage(n,0,0),r.filter="none",e&&Array.isArray(e)&&e.length>0)if(e.some(v=>v.invert)){const c=.5+e.reduce((g,y)=>g+(y.strength||50),0)/e.length/100*9.5,m=document.createElement("canvas");m.width=i.width,m.height=i.height;const p=m.getContext("2d");p.filter=`blur(${c}px)`,t&&t!=="none"&&(p.filter=`blur(${c}px) ${t}`),p.drawImage(n,0,0);const C=document.createElement("canvas");C.width=i.width,C.height=i.height;const F=C.getContext("2d");F.fillStyle="white",F.fillRect(0,0,C.width,C.height);for(const g of e){if(!g.invert)continue;const y=(g.soften||50)/100,T=F.createRadialGradient(g.x,g.y,0,g.x,g.y,g.radius);T.addColorStop(0,"rgba(0,0,0,1)"),T.addColorStop(.5+y*.3,"rgba(0,0,0,0.5)"),T.addColorStop(1,"rgba(0,0,0,0)"),F.fillStyle=T,F.beginPath(),F.arc(g.x,g.y,g.radius,0,Math.PI*2),F.fill()}const x=r.getImageData(0,0,i.width,i.height),_=p.getImageData(0,0,i.width,i.height),B=F.getImageData(0,0,i.width,i.height);for(let g=0;g<x.data.length;g+=4){const y=B.data[g]/255;x.data[g]=x.data[g]*y+_.data[g]*(1-y),x.data[g+1]=x.data[g+1]*y+_.data[g+1]*(1-y),x.data[g+2]=x.data[g+2]*y+_.data[g+2]*(1-y)}r.putImageData(x,0,0)}else for(const v of e){const c=v.strength||50,m=(v.soften||50)/100,p=.5+c/100*9.5,C=document.createElement("canvas");C.width=i.width,C.height=i.height;const F=C.getContext("2d");F.filter=`blur(${p}px)`,t&&t!=="none"&&(F.filter=`blur(${p}px) ${t}`),F.drawImage(n,0,0);const x=document.createElement("canvas");x.width=i.width,x.height=i.height;const _=x.getContext("2d"),B=_.createRadialGradient(v.x,v.y,0,v.x,v.y,v.radius);B.addColorStop(0,"rgba(255,255,255,1)"),B.addColorStop(.5+m*.3,"rgba(255,255,255,0.5)"),B.addColorStop(1,"rgba(255,255,255,0)"),_.fillStyle=B,_.beginPath(),_.arc(v.x,v.y,v.radius,0,Math.PI*2),_.fill();const g=r.getImageData(0,0,i.width,i.height),y=F.getImageData(0,0,i.width,i.height),T=_.getImageData(0,0,i.width,i.height);for(let L=0;L<g.data.length;L+=4){const S=T.data[L]/255;g.data[L]=g.data[L]*(1-S)+y.data[L]*S,g.data[L+1]=g.data[L+1]*(1-S)+y.data[L+1]*S,g.data[L+2]=g.data[L+2]*(1-S)+y.data[L+2]*S}r.putImageData(g,0,0)}return i.toDataURL("image/png")}var Sn=N("<br/> ",1),In=N('<div role="button" tabindex="0"><p class="import-title svelte-f1bndr"> <!></p> <img src="/icons/icon-upload.svg" alt="" class="import-icon svelte-f1bndr"/> <p class="import-hint svelte-f1bndr"> </p> <button class="btn-paste svelte-f1bndr">Paste</button> <input type="file" accept="image/*" class="sr-only"/></div>');function Da(o,t){Ne(t,!1);let e=b(t,"title",8,"Import an image"),n=b(t,"subtitle",8,""),i=b(t,"hint",8,"Import, drag or paste an image"),r=b(t,"onImageImport",8,A=>{}),d=J(!1),v=J();async function c(A){if(!A||!A.type.startsWith("image/"))return;const U=await La(A),ve=await ma(U,2048);r()(ve)}function m(A){const U=A.target.files?.[0];U&&c(U)}function p(A){A.preventDefault(),I(d,!1);const U=A.dataTransfer?.files?.[0];U&&c(U)}function C(A){A.preventDefault(),I(d,!0)}function F(){I(d,!1)}async function x(){const A=await yn();if(A){const U=await ma(A,2048);r()(U)}}function _(){a(v)?.click()}We();var B=In();let g;var y=f(B),T=f(y,!0),L=l(T);{var S=A=>{var U=Sn(),ve=l(Ge(U),1,!0);$(()=>Ze(ve,n())),D(A,U)};ee(L,A=>{n()&&A(S)})}u(y);var O=l(y,4),Q=f(O,!0);u(O);var Z=l(O,2),H=l(Z,2);bt(H,A=>I(v,A),()=>a(v)),u(B),$(()=>{g=de(B,1,"import-area svelte-f1bndr",null,g,{dragging:a(d)}),Ze(T,e()),Ze(Q,i())}),s("click",Z,gt(x)),s("change",H,m),s("click",B,_),s("drop",B,p),s("dragover",B,C),s("dragleave",B,F),s("keypress",B,A=>A.key==="Enter"&&_()),D(o,B),He()}var zn=N('<div class="action-bar svelte-96zw02"><div class="action-group svelte-96zw02"><button class="action-btn svelte-96zw02" aria-label="Undo"><img src="/icons/icon-undo.svg" alt="" class="action-icon svelte-96zw02"/></button> <button class="action-btn svelte-96zw02" aria-label="Redo"><img src="/icons/icon-redo.svg" alt="" class="action-icon svelte-96zw02"/></button></div> <div class="action-group svelte-96zw02"><button class="action-btn svelte-96zw02" aria-label="Start again"><img src="/icons/icon-startagain.svg" alt="" class="action-icon svelte-96zw02"/></button> <button class="action-btn svelte-96zw02" aria-label="Copy to clipboard"><img src="/icons/icon-copy.svg" alt="" class="action-icon svelte-96zw02"/></button> <button class="action-btn svelte-96zw02" aria-label="Export"><img src="/icons/icon-export.svg" alt="" class="action-icon svelte-96zw02"/></button></div></div>');function oa(o,t){let e=b(t,"canUndo",8,!1),n=b(t,"canRedo",8,!1),i=b(t,"onUndo",8,()=>{}),r=b(t,"onRedo",8,()=>{}),d=b(t,"onStartAgain",8,()=>{}),v=b(t,"onCopy",8,()=>{}),c=b(t,"onExport",8,()=>{});var m=zn(),p=f(m),C=f(p),F=l(C,2);u(p);var x=l(p,2),_=f(x),B=l(_,2),g=l(B,2);u(x),u(m),$(()=>{C.disabled=!e(),F.disabled=!n()}),s("click",C,function(...y){i()?.apply(this,y)}),s("click",F,function(...y){r()?.apply(this,y)}),s("click",_,function(...y){d()?.apply(this,y)}),s("click",B,function(...y){v()?.apply(this,y)}),s("click",g,function(...y){c()?.apply(this,y)}),D(o,m)}var Fn=N("<button> </button>"),Bn=N('<div class="sub-menu-tabs svelte-tv6tw8"></div>');function ra(o,t){Ne(t,!1);let e=b(t,"tabs",24,()=>[]),n=b(t,"activeTab",8,""),i=b(t,"onTabChange",8,d=>{});We();var r=Bn();ft(r,5,e,mt,(d,v)=>{var c=Fn();let m;var p=f(c,!0);u(c),$(()=>{m=de(c,1,"sub-menu-tab svelte-tv6tw8",null,m,{active:n()===a(v).id}),Ze(p,(a(v),h(()=>a(v).label)))}),s("click",c,()=>i()(a(v).id)),D(d,c)}),u(r),D(o,r),He()}var Rn=N('<div class="modal-overlay svelte-qik81a" role="dialog" aria-modal="true" tabindex="-1"><div class="modal svelte-qik81a" role="document"><p class="modal-message svelte-qik81a"><span class="modal-message-first svelte-qik81a">Start again?</span><br/><span class="modal-message-second svelte-qik81a">Your changes will be lost.</span></p> <div class="modal-actions svelte-qik81a"><button class="btn-text svelte-qik81a"> </button> <button class="btn-text btn-confirm svelte-qik81a"> </button></div></div></div>');function $t(o,t){Ne(t,!1),b(t,"message",8,"");let e=b(t,"confirmText",8,"Yes"),n=b(t,"cancelText",8,"Cancel"),i=b(t,"onConfirm",8,()=>{}),r=b(t,"onCancel",8,()=>{});We();var d=Rn(),v=f(d),c=l(f(v),2),m=f(c),p=f(m,!0);u(m);var C=l(m,2),F=f(C,!0);u(C),u(c),u(v),u(d),$(()=>{Ze(p,n()),Ze(F,e())}),s("click",m,function(...x){r()?.apply(this,x)}),s("click",C,function(...x){i()?.apply(this,x)}),s("click",v,gt(function(x){Jt.call(this,t,x)})),s("keydown",v,gt(function(x){Jt.call(this,t,x)})),s("click",d,function(...x){r()?.apply(this,x)}),s("keydown",d,x=>x.key==="Escape"&&r()()),D(o,d),He()}var En=N('<canvas class="blur-canvas svelte-pjowa5"></canvas>'),Pn=N('<div class="blur-brush-indicator svelte-pjowa5"></div>'),Ln=N('<div class="blur-brush-preview svelte-pjowa5"></div>'),Mn=N('<div class="crop-overlay svelte-pjowa5"><div class="overlay-top svelte-pjowa5"></div> <div class="overlay-bottom svelte-pjowa5"></div> <div class="overlay-left svelte-pjowa5"></div> <div class="overlay-right svelte-pjowa5"></div> <div class="crop-box svelte-pjowa5" role="button" aria-label="Drag to move crop area" tabindex="0"><div class="crop-border svelte-pjowa5"></div> <div class="corner-handle top-left svelte-pjowa5" role="button" aria-label="Resize top-left corner" tabindex="0"></div> <div class="corner-handle top-right svelte-pjowa5" role="button" aria-label="Resize top-right corner" tabindex="0"></div> <div class="corner-handle bottom-left svelte-pjowa5" role="button" aria-label="Resize bottom-left corner" tabindex="0"></div> <div class="corner-handle bottom-right svelte-pjowa5" role="button" aria-label="Resize bottom-right corner" tabindex="0"></div></div></div>'),Dn=N('<div class="crop-canvas svelte-pjowa5" role="application" aria-label="Image crop canvas"><div class="image-wrapper svelte-pjowa5"><img alt="Crop preview" class="canvas-image svelte-pjowa5" draggable="false"/> <!></div> <!> <!> <!></div>');function An(o,t){Ne(t,!1);const e=J(),n=J(),i=J(),r=J();let d=b(t,"imageSrc",8,""),v=b(t,"cropBox",24,()=>({x:10,y:10,width:80,height:80})),c=b(t,"isCropping",8,!1),m=b(t,"scale",8,1),p=b(t,"offsetX",8,0),C=b(t,"offsetY",8,0),F=b(t,"imageWidth",8,0),x=b(t,"imageHeight",8,0),_=b(t,"editFilters",8,""),B=b(t,"blurEnabled",8,!1),g=b(t,"blurBrushSize",8,50),y=b(t,"blurStrength",8,50),T=b(t,"blurSoften",8,50),L=b(t,"blurInvert",8,!1),S=b(t,"blurMask",24,()=>[]),O=b(t,"showBrushPreview",8,!1);const Q=sn();let Z=J(),H=J(),A=J({width:0,height:0}),U=!1,ve=null,Se=0,xe=0,W=null,ne=0,P=1,q=!1,ie=J({x:0,y:0,visible:!1}),_e=J(null),Pe=J("");async function Ie(){I(Pe,d());const z=new Image;z.crossOrigin="anonymous",z.onload=()=>{I(_e,z)},z.src=d()}function De(z){const oe=document.createElement("canvas");oe.width=a(_e).naturalWidth,oe.height=a(_e).naturalHeight;const fe=oe.getContext("2d");return fe.filter=`blur(${z}px)`,fe.drawImage(a(_e),0,0),oe}function Je(){if(!a(H)||!a(_e)||!S())return;const z=a(H).getContext("2d"),oe=a(H).width,fe=a(H).height;if(z.clearRect(0,0,oe,fe),S().length===0)return;const E=oe/F(),ae=fe/x();if(S().some(re=>re.invert)){const re=S().reduce((X,Y)=>X+(Y.strength||50),0)/S().length;S().reduce((X,Y)=>X+(Y.soften||50),0)/S().length;const w=.5+re/100*9.5,M=De(w);z.drawImage(M,0,0,oe,fe),z.globalCompositeOperation="destination-out";for(const X of S()){if(!X.invert)continue;const Y=X.x*E,k=X.y*ae,G=X.radius*Math.min(E,ae),K=(X.soften||50)/100,le=Math.max(0,.3-K*.3),ce=.3+(1-K)*.4,ge=z.createRadialGradient(Y,k,0,Y,k,G);ge.addColorStop(le,"rgba(0,0,0,1)"),ge.addColorStop(ce,`rgba(0,0,0,${.5+K*.3})`),ge.addColorStop(1,"rgba(0,0,0,0)"),z.fillStyle=ge,z.beginPath(),z.arc(Y,k,G,0,Math.PI*2),z.fill()}z.globalCompositeOperation="source-over"}else for(const re of S()){const w=re.x*E,M=re.y*ae,X=re.radius*Math.min(E,ae),Y=re.strength||50,k=(re.soften||50)/100,G=.5+Y/100*9.5,K=De(G);z.save();const le=Math.max(0,.2-k*.2),ce=.2+(1-k)*.5,ge=z.createRadialGradient(w,M,0,w,M,X);ge.addColorStop(le,"rgba(255,255,255,1)"),ge.addColorStop(ce,`rgba(255,255,255,${.4+k*.3})`),ge.addColorStop(1,"rgba(255,255,255,0)"),z.beginPath(),z.arc(w,M,X,0,Math.PI*2),z.clip(),z.drawImage(K,0,0,oe,fe),z.restore()}}Lt(()=>(Ue(),window.addEventListener("resize",Ue),()=>window.removeEventListener("resize",Ue)));function Ue(){if(a(Z)){const z=a(Z).getBoundingClientRect();I(A,{width:z.width,height:z.height})}}function Qe(z){return z.touches&&z.touches.length>0?{x:z.touches[0].clientX,y:z.touches[0].clientY}:{x:z.clientX,y:z.clientY}}function Ae(z){if(z.touches&&z.touches.length>=2){const oe=z.touches[0].clientX-z.touches[1].clientX,fe=z.touches[0].clientY-z.touches[1].clientY;return Math.sqrt(oe*oe+fe*fe)}return 0}function ze(z,oe="move"){if(!c())return;if(z.touches&&z.touches.length>=2){ne=Ae(z),P=m(),ve="pinch";return}z.preventDefault(),U=!0,ve=oe;const fe=Qe(z);Se=fe.x,xe=fe.y,W={...v()}}function Ve(z){if(!c())return;if(ve==="pinch"&&z.touches&&z.touches.length>=2){const we=Ae(z),re=P*(we/ne);Q("scaleChange",{scale:Math.max(.5,Math.min(3,re))});return}if(!U||!W)return;z.preventDefault();const oe=Qe(z),fe=(oe.x-Se)/a(e)*100,E=(oe.y-xe)/a(n)*100;let ae={...W};if(ve==="move")ae.x=Math.max(0,Math.min(100-W.width,W.x+fe)),ae.y=Math.max(0,Math.min(100-W.height,W.y+E));else if(ve.includes("corner")){if(ve.includes("left")){const re=Math.max(0,W.x+fe),w=W.width-(re-W.x);w>=10&&(ae.x=re,ae.width=w)}if(ve.includes("right")){const re=Math.min(100-W.x,W.width+fe);re>=10&&(ae.width=re)}if(ve.includes("top")){const re=Math.max(0,W.y+E),w=W.height-(re-W.y);w>=10&&(ae.y=re,ae.height=w)}if(ve.includes("bottom")){const re=Math.min(100-W.y,W.height+E);re>=10&&(ae.height=re)}}Q("cropChange",{cropBox:ae})}function Ke(){U=!1,ve=null,W=null,q&&(q=!1)}function $e(z){B()&&(z.preventDefault(),q=!0,Le(z))}function Ee(z){if(!B())return;const oe=a(Z).getBoundingClientRect(),fe=Qe(z);I(ie,{x:fe.x-oe.left,y:fe.y-oe.top,visible:!0}),q&&Le(z)}function at(){I(ie,{...a(ie),visible:!1}),q&&(q=!1)}function Le(z){const oe=a(Z).getBoundingClientRect(),fe=Qe(z),E=(fe.x-oe.left)/a(e)*F(),ae=(fe.y-oe.top)/a(n)*x(),we=g()/100*Math.min(F(),x())*.15;Q("blurPaint",{point:{x:E,y:ae,radius:we,strength:y(),soften:T(),invert:L()}})}et(()=>a(A),()=>{I(e,a(A).width)}),et(()=>(Be(x()),Be(F()),a(e)),()=>{I(n,x()&&F()?a(e)*x()/F():0)}),et(()=>(Be(g()),a(e),a(n)),()=>{I(i,g()/100*Math.min(a(e),a(n))*.3)}),et(()=>(Be(d()),a(H),a(Pe)),()=>{d()&&a(H)&&d()!==a(Pe)&&Ie()}),et(()=>(Be(S()),a(H),a(_e)),()=>{S()&&Array.isArray(S())&&S().length>0&&a(H)&&a(_e)&&Je()}),et(()=>(Be(v()),a(e),a(n)),()=>{I(r,{x:v().x/100*a(e),y:v().y/100*a(n),width:v().width/100*a(e),height:v().height/100*a(n)})}),yt(),We();var be=Dn(),Ye=f(be),qe=f(Ye),R=l(qe,2);{var j=z=>{var oe=En();bt(oe,fe=>I(H,fe),()=>a(H)),$(()=>{se(oe,"width",a(e)),se(oe,"height",a(n)),Ce(oe,`filter: ${_()??""};`)}),D(z,oe)};ee(R,z=>{B()&&a(e)>0&&a(n)>0&&z(j)})}u(Ye);var te=l(Ye,2);{var ue=z=>{var oe=Pn();$(()=>Ce(oe,`
				left: ${a(ie),h(()=>a(ie).x)??""}px;
				top: ${a(ie),h(()=>a(ie).y)??""}px;
				width: ${a(i)??""}px;
				height: ${a(i)??""}px;
			`)),D(z,oe)};ee(te,z=>{Be(B()),a(ie),h(()=>B()&&a(ie).visible)&&z(ue)})}var he=l(te,2);{var Fe=z=>{var oe=Ln();$(()=>Ce(oe,`
				left: ${a(e)/2}px;
				top: ${a(n)/2}px;
				width: ${a(i)??""}px;
				height: ${a(i)??""}px;
			`)),D(z,oe)};ee(he,z=>{O()&&a(e)>0&&a(n)>0&&z(Fe)})}var ke=l(he,2);{var ye=z=>{var oe=Mn(),fe=f(oe),E=l(fe,2),ae=l(E,2),we=l(ae,2),re=l(we,2),w=l(f(re),2),M=l(w,2),X=l(M,2),Y=l(X,2);u(re),u(oe),$(()=>{Ce(fe,`height: ${a(r),h(()=>a(r).y)??""}px;`),Ce(E,`top: ${a(r),h(()=>a(r).y+a(r).height)??""}px; height: ${a(n),a(r),h(()=>a(n)-a(r).y-a(r).height)??""}px;`),Ce(ae,`top: ${a(r),h(()=>a(r).y)??""}px; height: ${a(r),h(()=>a(r).height)??""}px; width: ${a(r),h(()=>a(r).x)??""}px;`),Ce(we,`top: ${a(r),h(()=>a(r).y)??""}px; height: ${a(r),h(()=>a(r).height)??""}px; left: ${a(r),h(()=>a(r).x+a(r).width)??""}px; width: ${a(e),a(r),h(()=>a(e)-a(r).x-a(r).width)??""}px;`),Ce(re,`left: ${a(r),h(()=>a(r).x)??""}px; top: ${a(r),h(()=>a(r).y)??""}px; width: ${a(r),h(()=>a(r).width)??""}px; height: ${a(r),h(()=>a(r).height)??""}px;`)}),s("mousedown",w,gt(k=>ze(k,"corner-top-left"))),s("touchstart",w,gt(k=>ze(k,"corner-top-left"))),s("mousedown",M,gt(k=>ze(k,"corner-top-right"))),s("touchstart",M,gt(k=>ze(k,"corner-top-right"))),s("mousedown",X,gt(k=>ze(k,"corner-bottom-left"))),s("touchstart",X,gt(k=>ze(k,"corner-bottom-left"))),s("mousedown",Y,gt(k=>ze(k,"corner-bottom-right"))),s("touchstart",Y,gt(k=>ze(k,"corner-bottom-right"))),s("mousedown",re,k=>ze(k,"move")),s("touchstart",re,k=>ze(k,"move")),D(z,oe)};ee(ke,z=>{c()&&a(n)>0&&z(ye)})}u(be),bt(be,z=>I(Z,z),()=>a(Z)),$(()=>{Ce(Ye,`transform: scale(${m()??""}) translate(${p()??""}px, ${C()??""}px);`),se(qe,"src",d()),Ce(qe,`filter: ${_()??""};`)}),s("mousemove",be,function(...z){(B()?Ee:Ve)?.apply(this,z)}),s("mouseup",be,Ke),s("mouseleave",be,function(...z){(B()?at:Ke)?.apply(this,z)}),s("touchmove",be,function(...z){(B()?Ee:Ve)?.apply(this,z)}),s("touchend",be,Ke),s("mousedown",be,function(...z){(B()?$e:null)?.apply(this,z)}),s("touchstart",be,function(...z){(B()?$e:null)?.apply(this,z)}),D(o,be),He()}var qn=N('<img alt="" class="toggle-icon svelte-1gdqxne"/>'),Tn=N('<span class="toggle-label svelte-1gdqxne"> </span>'),On=N("<div><button><!></button> <!></div>"),Nn=N("<div></div>");function Aa(o,t){Ne(t,!1);let e=b(t,"options",24,()=>[]),n=b(t,"value",8,""),i=b(t,"onChange",8,m=>{}),r=b(t,"showLabels",8,!0),d=b(t,"centered",8,!1);We();var v=Nn();let c;ft(v,5,e,mt,(m,p)=>{var C=On();let F;var x=f(C);let _;var B=f(x);{var g=L=>{var S=qn();$(()=>se(S,"src",`/icons/${a(p),h(()=>a(p).icon)??""}.svg`)),D(L,S)};ee(B,L=>{a(p),h(()=>a(p).icon)&&L(g)})}u(x);var y=l(x,2);{var T=L=>{var S=Tn(),O=f(S,!0);u(S),$(()=>Ze(O,(a(p),h(()=>a(p).label)))),D(L,S)};ee(y,L=>{Be(r()),a(p),h(()=>r()&&a(p).label)&&L(T)})}u(C),$(()=>{F=de(C,1,"toggle-item svelte-1gdqxne",null,F,{active:n()===a(p).id}),_=de(x,1,"toggle-btn svelte-1gdqxne",null,_,{active:n()===a(p).id}),se(x,"aria-label",(a(p),h(()=>a(p).label)))}),s("click",x,()=>i()(a(p).id)),D(m,C)}),u(v),$(()=>c=de(v,1,"toggle-group svelte-1gdqxne",null,c,{centered:d()})),D(o,v),He()}var Hn=N('<label class="input-label svelte-1r47u3b"> <input class="input svelte-1r47u3b"/></label>'),Un=N('<input class="input svelte-1r47u3b"/>'),Yn=N('<div class="input-field svelte-1r47u3b"><!></div>');function pa(o,t){Ne(t,!1);let e=b(t,"label",8,""),n=b(t,"value",12,""),i=b(t,"type",8,"text"),r=b(t,"placeholder",8,""),d=b(t,"disabled",8,!1),v=b(t,"onChange",8,x=>{});function c(x){n(x.target.value),v()(n())}We();var m=Yn(),p=f(m);{var C=x=>{var _=Hn(),B=f(_),g=l(B);ct(g),u(_),$(()=>{Ze(B,`${e()??""} `),se(g,"type",i()),rt(g,n()),se(g,"placeholder",r()),g.disabled=d()}),s("input",g,c),D(x,_)},F=x=>{var _=Un();ct(_),$(()=>{se(_,"type",i()),rt(_,n()),se(_,"placeholder",r()),_.disabled=d()}),s("input",_,c),D(x,_)};ee(p,x=>{e()?x(C):x(F,!1)})}u(m),D(o,m),He()}var Wn=N('<span class="slider-value svelte-jchife"> </span>'),jn=N('<div class="slider-header svelte-jchife"><span class="slider-label svelte-jchife"> </span> <!></div>'),Xn=N('<div class="slider-container svelte-jchife"><!> <input type="range" class="slider svelte-jchife"/></div>');function Ct(o,t){Ne(t,!1);let e=b(t,"label",8,""),n=b(t,"min",8,0),i=b(t,"max",8,100),r=b(t,"value",8,50),d=b(t,"step",8,1),v=b(t,"showValue",8,!1),c=b(t,"onChange",8,T=>{}),m=b(t,"onInteractionStart",8,()=>{}),p=b(t,"onInteractionEnd",8,()=>{});function C(T){const L=Number(T.target.value);c()(L)}function F(){m()()}function x(){p()()}We();var _=Xn(),B=f(_);{var g=T=>{var L=jn(),S=f(L),O=f(S,!0);u(S);var Q=l(S,2);{var Z=H=>{var A=Wn(),U=f(A,!0);u(A),$(()=>Ze(U,r())),D(H,A)};ee(Q,H=>{v()&&H(Z)})}u(L),$(()=>Ze(O,e())),D(T,L)};ee(B,T=>{e()&&T(g)})}var y=l(B,2);ct(y),u(_),$(()=>{se(y,"min",n()),se(y,"max",i()),se(y,"step",d()),rt(y,r())}),s("input",y,C),s("mousedown",y,F),s("touchstart",y,F),s("mouseup",y,x),s("touchend",y,x),D(o,_),He()}var Gn=N('<div class="apply-row svelte-17iy3mz"><button class="btn-apply svelte-17iy3mz">Apply</button></div>'),Qn=N('<div class="crop-controls svelte-17iy3mz"><!> <div class="dimensions-row svelte-17iy3mz"><div class="dimension-input svelte-17iy3mz"><!></div> <button class="icon-btn svelte-17iy3mz"><img alt="" class="icon-btn-img svelte-17iy3mz"/></button> <div class="dimension-input svelte-17iy3mz"><!></div> <button class="icon-btn svelte-17iy3mz" aria-label="Flip horizontal"><img src="/icons/icon-flip-horizontal.svg" alt="" class="icon-btn-img svelte-17iy3mz"/></button> <button class="icon-btn svelte-17iy3mz" aria-label="Rotate"><img src="/icons/icon-rotate.svg" alt="" class="icon-btn-img svelte-17iy3mz"/></button></div> <!> <!></div>');function Zn(o,t){Ne(t,!1);let e=b(t,"aspectRatio",8,"9:16"),n=b(t,"cropWidth",8,1080),i=b(t,"cropHeight",8,1920),r=b(t,"ratioLocked",8,!0),d=b(t,"scale",8,100),v=b(t,"cropPending",8,!1),c=b(t,"onRatioChange",8,P=>{}),m=b(t,"onDimensionsChange",8,({width:P,height:q})=>{}),p=b(t,"onLockToggle",8,()=>{}),C=b(t,"onFlip",8,()=>{}),F=b(t,"onRotate",8,()=>{}),x=b(t,"onScaleChange",8,P=>{}),_=b(t,"onApply",8,()=>{});const B=[{id:"9:16",label:"9:16",icon:"icon-vertical"},{id:"1:1",label:"1:1",icon:"icon-square"},{id:"16:9",label:"16:9",icon:"icon-horizontal"},{id:"custom",label:"Custom",icon:"icon-custom"}];function g(P){const q=parseInt(P)||0;m()({width:q,height:i()})}function y(P){const q=parseInt(P)||0;m()({width:n(),height:q})}We();var T=Qn(),L=f(T);Aa(L,{get options(){return B},get value(){return e()},get onChange(){return c()},showLabels:!0,centered:!0});var S=l(L,2),O=f(S),Q=f(O);{let P=tt(()=>(Be(n()),h(()=>n().toString())));pa(Q,{label:"Width",type:"number",get value(){return a(P)},onChange:g})}u(O);var Z=l(O,2),H=f(Z);u(Z);var A=l(Z,2),U=f(A);{let P=tt(()=>(Be(i()),h(()=>i().toString())));pa(U,{label:"Height",type:"number",get value(){return a(P)},onChange:y})}u(A);var ve=l(A,2),Se=l(ve,2);u(S);var xe=l(S,2);Ct(xe,{label:"Scale",min:50,max:200,get value(){return d()},step:1,showValue:!0,get onChange(){return x()}});var W=l(xe,2);{var ne=P=>{var q=Gn(),ie=f(q);u(q),s("click",ie,function(..._e){_()?.apply(this,_e)}),D(P,q)};ee(W,P=>{v()&&P(ne)})}u(T),$(()=>{se(Z,"aria-label",r()?"Unlock aspect ratio":"Lock aspect ratio"),se(H,"src",`/icons/${r()?"icon-lock":"icon-unlock"}.svg`)}),s("click",Z,function(...P){p()?.apply(this,P)}),s("click",ve,function(...P){C()?.apply(this,P)}),s("click",Se,function(...P){F()?.apply(this,P)}),D(o,T),He()}var Jn=N("<button> </button>"),Vn=N("<button> </button>"),Kn=N('<div class="blur-controls svelte-1e1k0ax"><div class="blur-control-row svelte-1e1k0ax"><!> <label class="invert-checkbox svelte-1e1k0ax"><input type="checkbox" class="svelte-1e1k0ax"/> <span class="checkbox-label svelte-1e1k0ax">Invert</span></label></div> <div class="slider-row svelte-1e1k0ax"><div class="slider-track svelte-1e1k0ax"><!></div> <button class="reset-btn svelte-1e1k0ax" aria-label="Reset"><img src="/icons/icon-reset.svg" alt="" class="reset-icon svelte-1e1k0ax"/></button></div> <div class="zoom-row svelte-1e1k0ax"><span class="zoom-label svelte-1e1k0ax">Zoom in</span> <div class="zoom-slider-row svelte-1e1k0ax"><div class="slider-track svelte-1e1k0ax"><!></div> <button class="reset-btn svelte-1e1k0ax" aria-label="Reset zoom"><img src="/icons/icon-reset.svg" alt="" class="reset-icon svelte-1e1k0ax"/></button></div></div> <div class="nudge-row svelte-1e1k0ax"><button class="nudge-btn svelte-1e1k0ax" aria-label="Nudge up"><img src="/icons/icon-nudge-up.svg" alt="" class="svelte-1e1k0ax"/></button> <button class="nudge-btn svelte-1e1k0ax" aria-label="Nudge down"><img src="/icons/icon-nudge-down.svg" alt="" class="svelte-1e1k0ax"/></button> <button class="nudge-btn svelte-1e1k0ax" aria-label="Nudge left"><img src="/icons/icon-nudge-left.svg" alt="" class="svelte-1e1k0ax"/></button> <button class="nudge-btn svelte-1e1k0ax" aria-label="Nudge right"><img src="/icons/icon-nudge-right.svg" alt="" class="svelte-1e1k0ax"/></button></div></div>'),$n=N('<div class="edit-controls svelte-1e1k0ax"><div class="enhancement-row svelte-1e1k0ax"></div> <div class="slider-row svelte-1e1k0ax"><div class="slider-track svelte-1e1k0ax"><!></div> <button class="reset-btn svelte-1e1k0ax" aria-label="Reset"><img src="/icons/icon-reset.svg" alt="" class="reset-icon svelte-1e1k0ax"/></button></div> <div class="blur-section svelte-1e1k0ax"><div class="blur-header svelte-1e1k0ax"><button class="chevron-btn svelte-1e1k0ax"><img alt=""/></button> <span class="blur-label svelte-1e1k0ax">Blur</span> <button><span class="toggle-thumb svelte-1e1k0ax"></span></button></div> <!></div></div>');function ei(o,t){Ne(t,!1);const e=J(),n=J(),i=J(),r=J(),d=J(),v=J();let c=b(t,"brightness",8,0),m=b(t,"shadows",8,0),p=b(t,"contrast",8,0),C=b(t,"hdr",8,0),F=b(t,"blurBrushSize",8,50),x=b(t,"blurStrength",8,50),_=b(t,"blurSoften",8,50),B=b(t,"blurInvert",8,!1),g=b(t,"zoomLevel",8,1),y=b(t,"blurEnabled",8,!1),T=b(t,"onBrightnessChange",8,E=>{}),L=b(t,"onShadowsChange",8,E=>{}),S=b(t,"onContrastChange",8,E=>{}),O=b(t,"onHdrChange",8,E=>{}),Q=b(t,"onBlurBrushSizeChange",8,E=>{}),Z=b(t,"onBlurStrengthChange",8,E=>{}),H=b(t,"onBlurSoftenChange",8,E=>{}),A=b(t,"onBlurInvertChange",8,E=>{}),U=b(t,"onZoomChange",8,E=>{}),ve=b(t,"onNudge",8,E=>{}),Se=b(t,"onResetZoom",8,()=>{}),xe=b(t,"onBlurToggle",8,E=>{}),W=b(t,"onBrushPreviewChange",8,E=>{}),ne=b(t,"onEditEnd",8,()=>{}),P=J("brightness"),q=J(y()),ie=J("brushSize");const _e=[{id:"brightness",label:"Brightness"},{id:"shadows",label:"Shadows"},{id:"contrast",label:"Contrast"},{id:"hdr",label:"HDR"}],Pe=[{id:"brushSize",label:"Brush size"},{id:"strength",label:"Strength"},{id:"soften",label:"Soften edges"}];function Ie(E){switch(a(P)){case"brightness":T()(E);break;case"shadows":L()(E);break;case"contrast":S()(E);break;case"hdr":O()(E);break}}function De(){Ie(0)}function Je(E){switch(a(ie)){case"brushSize":Q()(E);break;case"strength":Z()(E);break;case"soften":H()(E);break}}function Ue(){Je(50)}function Qe(){const E=!y();xe()(E),I(q,E)}function Ae(){y()&&I(q,!a(q))}function ze(){A()(!B())}function Ve(E){I(P,E),I(q,!1)}function Ke(E){I(ie,E)}function $e(){ne()()}function Ee(){a(ie)==="brushSize"&&W()(!0)}function at(){W()(!1),ne()()}et(()=>(a(P),Be(c()),Be(m()),Be(p()),Be(C())),()=>{I(e,(()=>{switch(a(P)){case"brightness":return c();case"shadows":return m();case"contrast":return p();case"hdr":return C();default:return 0}})())}),et(()=>a(P),()=>{I(n,a(P)==="hdr"?0:-100)}),et(()=>{},()=>{I(i,100)}),et(()=>(a(ie),Be(F()),Be(x()),Be(_())),()=>{I(r,(()=>{switch(a(ie)){case"brushSize":return F();case"strength":return x();case"soften":return _();default:return 50}})())}),et(()=>{},()=>{I(d,1)}),et(()=>{},()=>{I(v,100)}),yt(),We();var Le=$n(),be=f(Le);ft(be,5,()=>_e,mt,(E,ae)=>{var we=Jn();let re;var w=f(we,!0);u(we),$(()=>{re=de(we,1,"enhancement-btn svelte-1e1k0ax",null,re,{active:a(P)===a(ae).id}),Ze(w,(a(ae),h(()=>a(ae).label)))}),s("click",we,()=>Ve(a(ae).id)),D(E,we)}),u(be);var Ye=l(be,2),qe=f(Ye),R=f(qe);Ct(R,{get min(){return a(n)},get max(){return a(i)},get value(){return a(e)},step:1,onChange:Ie,onInteractionEnd:$e}),u(qe);var j=l(qe,2);u(Ye);var te=l(Ye,2),ue=f(te),he=f(ue),Fe=f(he);let ke;u(he);var ye=l(he,4);let z;u(ue);var oe=l(ue,2);{var fe=E=>{var ae=Kn(),we=f(ae),re=f(we);ft(re,1,()=>Pe,mt,(V,me)=>{var Me=Vn();let it;var St=f(Me,!0);u(Me),$(()=>{it=de(Me,1,"blur-control-btn svelte-1e1k0ax",null,it,{active:a(ie)===a(me).id}),Ze(St,(a(me),h(()=>a(me).label)))}),s("click",Me,()=>Ke(a(me).id)),D(V,Me)});var w=l(re,2),M=f(w);ct(M),Ht(2),u(w),u(we);var X=l(we,2),Y=f(X),k=f(Y);Ct(k,{get min(){return a(d)},get max(){return a(v)},get value(){return a(r)},step:1,onChange:Je,onInteractionStart:Ee,onInteractionEnd:at}),u(Y);var G=l(Y,2);u(X);var K=l(X,2),le=l(f(K),2),ce=f(le),ge=f(ce);Ct(ge,{min:1,max:3,step:.1,get value(){return g()},get onChange(){return U()}}),u(ce);var Re=l(ce,2);u(le),u(K);var Te=l(K,2),nt=f(Te),Oe=l(nt,2),je=l(Oe,2),lt=l(je,2);u(Te),u(ae),$(()=>mn(M,B())),s("change",M,ze),s("click",G,Ue),s("click",Re,function(...V){Se()?.apply(this,V)}),s("click",nt,()=>ve()("up")),s("click",Oe,()=>ve()("down")),s("click",je,()=>ve()("left")),s("click",lt,()=>ve()("right")),D(E,ae)};ee(oe,E=>{a(q)&&y()&&E(fe)})}u(te),u(Le),$(()=>{he.disabled=!y(),se(he,"aria-label",a(q)?"Collapse":"Expand"),se(Fe,"src",`/icons/${a(q)?"icon-collapse":"icon-expand"}.svg`),ke=de(Fe,1,"chevron-icon svelte-1e1k0ax",null,ke,{disabled:!y()}),z=de(ye,1,"toggle-switch svelte-1e1k0ax",null,z,{active:y()}),se(ye,"aria-label",y()?"Disable blur":"Enable blur")}),s("click",j,De),s("click",he,Ae),s("click",ye,Qe),D(o,Le),He()}var ti=N('<button><div class="filter-preview svelte-183y0dt"></div> <span> </span></button>'),ai=N('<div class="filter-grid svelte-183y0dt"></div>');function ni(o,t){Ne(t,!1);let e=b(t,"filters",24,()=>[]),n=b(t,"value",8,"original"),i=b(t,"imageUrl",8,""),r=b(t,"onChange",8,v=>{});We();var d=ai();ft(d,5,e,mt,(v,c)=>{var m=ti();let p;var C=f(m),F=l(C,2);let x;var _=f(F,!0);u(F),u(m),$(()=>{p=de(m,1,"filter-card svelte-183y0dt",null,p,{active:n()===a(c).id}),Ce(C,`
					background-image: url(${i()??""});
					filter: ${a(c),h(()=>a(c).css||"none")??""};
				`),x=de(F,1,"filter-label svelte-183y0dt",null,x,{active:n()===a(c).id}),Ze(_,(a(c),h(()=>a(c).label)))}),s("click",m,()=>r()(a(c).id)),D(v,m)}),u(d),D(o,d),He()}var ii=N('<div class="filter-controls svelte-1274k9v"><!> <div><div class="slider-track svelte-1274k9v"><!></div> <button class="reset-btn svelte-1274k9v" aria-label="Reset filter"><img src="/icons/icon-reset.svg" alt="" class="reset-icon svelte-1274k9v"/></button></div></div>');function oi(o,t){Ne(t,!1);const e=J();let n=b(t,"imageUrl",8,""),i=b(t,"activeFilter",8,"original"),r=b(t,"filterStrength",8,50),d=b(t,"onFilterChange",8,y=>{}),v=b(t,"onStrengthChange",8,y=>{}),c=b(t,"onReset",8,()=>{});const m=[{id:"original",label:"Original",css:"none"},{id:"greyscale",label:"Greyscale",css:"grayscale(100%)"},{id:"sepia",label:"Sepia",css:"sepia(100%)"},{id:"sunset",label:"Sunset",css:"sepia(30%) saturate(140%) brightness(110%) hue-rotate(-10deg)"},{id:"azure",label:"Azure",css:"saturate(120%) brightness(105%) hue-rotate(180deg)"},{id:"teal",label:"Teal",css:"saturate(130%) hue-rotate(140deg)"}];et(()=>Be(i()),()=>{I(e,i()==="original")}),yt();var p=ii(),C=f(p);ni(C,{get filters(){return m},get value(){return i()},get imageUrl(){return n()},get onChange(){return d()}});var F=l(C,2);let x;var _=f(F),B=f(_);{let y=tt(()=>a(e)?()=>{}:v());Ct(B,{label:"Strength",min:0,max:100,get value(){return r()},get onChange(){return a(y)}})}u(_);var g=l(_,2);u(F),u(p),$(()=>x=de(F,1,"slider-row svelte-1274k9v",null,x,{disabled:a(e)})),s("click",g,function(...y){c()?.apply(this,y)}),D(o,p),He()}const xa=[{id:"original",label:"Original",css:"none"},{id:"greyscale",label:"Greyscale",css:"grayscale(100%)"},{id:"sepia",label:"Sepia",css:"sepia(100%)"},{id:"sunset",label:"Sunset",css:"sepia(30%) saturate(140%) brightness(110%) hue-rotate(-10deg)"},{id:"azure",label:"Azure",css:"saturate(120%) brightness(105%) hue-rotate(180deg)"},{id:"teal",label:"Teal",css:"saturate(130%) hue-rotate(140deg)"}];function ri(o){const t=[o];let e=0,n=0;const i=xt({canUndo:!1,canRedo:!1}),{subscribe:r,set:d,update:v}=xt(o);function c(){i.set({canUndo:e>n,canRedo:e<t.length-1})}return{subscribe:r,undoState:i,set:m=>{t.splice(e+1),t.push(m),e=t.length-1,d(m),c()},update:m=>{v(p=>{const C=m(p);return t.splice(e+1),t.push(C),e=t.length-1,c(),C})},silentUpdate:m=>{v(m)},setBaseState:()=>{n=e,c()},undo:()=>{e>n&&(e--,d(t[e]),c())},redo:()=>{e<t.length-1&&(e++,d(t[e]),c())},canUndo:()=>e>n,canRedo:()=>e<t.length-1,reset:()=>{t.length=0,t.push(o),e=0,n=0,d(o),c()}}}const li={originalImage:null,currentImage:null,aspectRatio:"custom",width:0,height:0,ratioLocked:!1,scale:1,offsetX:0,offsetY:0,brightness:0,contrast:0,shadows:0,hdr:0,activeFilter:"original",filterStrength:50,cropBox:{x:0,y:0,width:0,height:0},isCropping:!1,cropPending:!1,imageWidth:0,imageHeight:0,blurEnabled:!1,blurBrushSize:50,blurStrength:50,blurSoften:50,blurInvert:!1,blurMask:null,showBrushPreview:!1,zoomLevel:1,zoomOffsetX:0,zoomOffsetY:0},pe=ri(li),Tt=xt("none"),si=aa(pe,o=>o.currentImage!==null);function ci(){pe.reset(),Tt.set("none")}var di=N('<div class="controls-panel svelte-c9tnuw"><!></div>'),vi=N('<div class="controls-panel svelte-c9tnuw"><!></div>'),ui=N("<!> <!> <!> <!>",1),gi=N('<div class="crop-tab svelte-c9tnuw"><!> <!> <!></div>');function hi(o,t){Ne(t,!1);const e=()=>vt(pe,"$cropState",d),n=()=>vt(Tt,"$activeSubMenu",d),i=()=>vt(si,"$hasImage",d),r=()=>vt(C,"$undoState",d),[d,v]=Pt(),c=J(),m=J(),p=J(),C=pe.undoState,F=[{id:"crop",label:"Crop"},{id:"edit",label:"Edit"},{id:"filter",label:"Filter"}];let x=J(null),_=null;async function B(w){const M=await Nt(w);pe.set({...e(),originalImage:w,currentImage:w,imageWidth:M.width,imageHeight:M.height,width:M.width,height:M.height,cropBox:{x:0,y:0,width:100,height:100},isCropping:!0,cropPending:!1,aspectRatio:"custom",ratioLocked:!1}),pe.setBaseState(),Tt.set("crop")}function g(w){if(e().cropPending&&n()==="crop"&&w!=="crop"){_=()=>{Tt.set(w),pe.silentUpdate(M=>({...M,isCropping:!1}))},I(x,"save");return}w==="crop"?pe.silentUpdate(M=>({...M,isCropping:!0})):pe.silentUpdate(M=>({...M,isCropping:!1})),Tt.set(n()===w?"none":w)}async function y(){return await Cn(e().currentImage,a(p),e().blurMask)}async function T(){if(e().cropPending){_=async()=>{const w=await y();await Vt(w)},I(x,"save");return}if(e().currentImage){const w=await y();await Vt(w)}}async function L(){if(e().cropPending){_=async()=>{const w=await y();Kt(w,"picflam-export.png")},I(x,"save");return}if(e().currentImage){const w=await y();Kt(w,"picflam-export.png")}}function S(){I(x,"startAgain")}function O(){pe.undo()}function Q(){pe.redo()}async function Z(){I(x,null),await ve(),_&&(await _(),_=null)}function H(){I(x,null),_=null}function A(){I(x,null),ci()}function U(){I(x,null)}async function ve(){const w=e();if(!w.currentImage||!w.cropPending)return;const M=await Ma(w.currentImage,w.cropBox,w.imageWidth,w.imageHeight),X=await Nt(M);pe.set({...w,currentImage:M,imageWidth:X.width,imageHeight:X.height,width:X.width,height:X.height,cropBox:{x:0,y:0,width:100,height:100},cropPending:!1})}function Se(w){if(w==="custom"){pe.silentUpdate(G=>({...G,aspectRatio:"custom",cropBox:{x:0,y:0,width:100,height:100},ratioLocked:!1,cropPending:!1}));return}const X={"9:16":9/16,"1:1":1,"16:9":16/9}[w],Y=e().imageWidth/e().imageHeight;let k;if(w==="9:16"){const K=X/Y*100;if(K<=100)k={x:(100-K)/2,y:0,width:K,height:100};else{const le=Y/X*100;k={x:0,y:(100-le)/2,width:100,height:le}}}else if(w==="16:9"){const K=Y/X*100;if(K<=100)k={x:0,y:(100-K)/2,width:100,height:K};else{const le=X/Y*100;k={x:(100-le)/2,y:0,width:le,height:100}}}else if(w==="1:1")if(Y>1){const G=100/Y;k={x:(100-G)/2,y:0,width:G,height:100}}else{const G=100*Y;k={x:0,y:(100-G)/2,width:100,height:G}}pe.silentUpdate(G=>({...G,aspectRatio:w,cropBox:k,cropPending:!0,isCropping:!0,ratioLocked:!0}))}function xe({width:w,height:M}){const X=e().imageWidth,Y=e().imageHeight,k=Math.min(Math.max(1,w),X),G=Math.min(Math.max(1,M),Y),K=k/X*100,le=G/Y*100;let ce;if(e().ratioLocked){const ge=a(c)/a(m);if(w!==a(c)){const Te=k/ge/Y*100;ce={x:(100-K)/2,y:(100-Math.min(100,Te))/2,width:K,height:Math.min(100,Te)}}else{const Te=G*ge/X*100;ce={x:(100-Math.min(100,Te))/2,y:(100-le)/2,width:Math.min(100,Te),height:le}}}else ce={x:(100-K)/2,y:(100-le)/2,width:K,height:le};pe.silentUpdate(ge=>({...ge,cropBox:ce,cropPending:!0}))}function W(){pe.silentUpdate(w=>({...w,ratioLocked:!w.ratioLocked}))}async function ne(){const w=await kn(e().currentImage);pe.set({...e(),currentImage:w})}async function P(){const w=await _n(e().currentImage,90),M=await Nt(w);pe.set({...e(),currentImage:w,imageWidth:M.width,imageHeight:M.height,cropBox:{x:0,y:0,width:100,height:100},cropPending:!1})}function q(w){pe.silentUpdate(M=>({...M,scale:w/100}))}function ie(w){const M=w.detail.cropBox;if(e().ratioLocked&&e().aspectRatio!=="custom"){const Y={"9:16":.5625,"1:1":1,"16:9":1.7777777777777777}[e().aspectRatio];e().imageWidth/e().imageHeight;const k=M.width*e().imageWidth/(M.height*e().imageHeight);if(Math.abs(k-Y)>.01){const le=M.width/100*e().imageWidth/Y/e().imageHeight*100;M.height=Math.min(100,le),M.y+M.height>100&&(M.y=100-M.height)}}pe.silentUpdate(X=>({...X,cropBox:M,cropPending:!0}))}function _e(){ve()}let Pe=null;function Ie(){Pe===null&&(Pe={...e()})}function De(){Pe!==null&&(pe.set(e()),Pe=null)}function Je(w){Ie(),pe.silentUpdate(M=>({...M,brightness:w}))}function Ue(w){Ie(),pe.silentUpdate(M=>({...M,shadows:w}))}function Qe(w){Ie(),pe.silentUpdate(M=>({...M,contrast:w}))}function Ae(w){Ie(),pe.silentUpdate(M=>({...M,hdr:w}))}function ze(w){pe.set({...e(),blurEnabled:w})}function Ve(w){Ie(),pe.silentUpdate(M=>({...M,blurBrushSize:w}))}function Ke(w){Ie(),pe.silentUpdate(M=>({...M,blurStrength:w}))}function $e(w){Ie(),pe.silentUpdate(M=>({...M,blurSoften:w}))}function Ee(w){pe.set({...e(),blurInvert:w})}function at(w){pe.silentUpdate(M=>({...M,showBrushPreview:w}))}function Le(){De()}let be=null,Ye=[],qe=null;function R(w){const M=w.detail.point;qe===null&&(qe=e().blurMask?[...e().blurMask]:[]),Ye.push(M),pe.silentUpdate(X=>({...X,blurMask:[...X.blurMask||[],M]})),be&&clearTimeout(be),be=setTimeout(()=>{if(Ye.length>0){const X=[...qe,...Ye];pe.set({...e(),blurMask:X}),Ye=[],qe=null}be=null},300)}function j(w){pe.silentUpdate(M=>({...M,zoomLevel:w}))}function te(w){pe.silentUpdate(X=>{let{zoomOffsetX:Y,zoomOffsetY:k}=X;switch(w){case"up":k-=20;break;case"down":k+=20;break;case"left":Y-=20;break;case"right":Y+=20;break}return{...X,zoomOffsetX:Y,zoomOffsetY:k}})}function ue(){pe.silentUpdate(w=>({...w,zoomLevel:1,zoomOffsetX:0,zoomOffsetY:0}))}function he(w){pe.silentUpdate(M=>({...M,activeFilter:w}))}function Fe(w){Ie(),pe.silentUpdate(M=>({...M,filterStrength:w}))}function ke(){pe.set({...e(),activeFilter:"original",filterStrength:50})}et(()=>e(),()=>{I(c,Math.round(e().imageWidth*e().cropBox.width/100))}),et(()=>e(),()=>{I(m,Math.round(e().imageHeight*e().cropBox.height/100))}),et(()=>(e(),xa),()=>{I(p,(()=>{let w=[];if(e().brightness!==0&&w.push(`brightness(${1+e().brightness/100})`),e().contrast!==0&&w.push(`contrast(${1+e().contrast/100})`),e().shadows!==0){const M=1+e().shadows/200;w.push(`brightness(${M})`)}if(e().hdr!==0){const M=1+e().hdr/100*.3,X=1+e().hdr/100*.2;w.push(`saturate(${M}) contrast(${X})`)}if(e().activeFilter!=="original"){const M=xa.find(X=>X.id===e().activeFilter);if(M&&M.css!=="none"){const X=e().filterStrength/100,Y=M.css.replace(/(\d+)%/g,(k,G)=>`${Math.round(parseInt(G)*X)}%`);w.push(Y)}}return w.length>0?w.join(" "):"none"})())}),yt(),We();var ye=gi(),z=f(ye);{var oe=w=>{Da(w,{title:"Crop, edit and add",subtitle:"filters to photos",hint:"Import, drag or paste an image",onImageImport:B})},fe=w=>{var M=ui(),X=Ge(M);oa(X,{get canUndo(){return r(),h(()=>r().canUndo)},get canRedo(){return r(),h(()=>r().canRedo)},onUndo:O,onRedo:Q,onStartAgain:S,onCopy:T,onExport:L});var Y=l(X,2);{let ce=tt(()=>(n(),e(),h(()=>n()==="edit"?e().zoomLevel:e().scale))),ge=tt(()=>(n(),e(),h(()=>n()==="edit"?e().zoomOffsetX:e().offsetX))),Re=tt(()=>(n(),e(),h(()=>n()==="edit"?e().zoomOffsetY:e().offsetY))),Te=tt(()=>(e(),h(()=>e().blurMask||[])));An(Y,{get imageSrc(){return e(),h(()=>e().currentImage)},get cropBox(){return e(),h(()=>e().cropBox)},get isCropping(){return e(),h(()=>e().isCropping)},get scale(){return a(ce)},get offsetX(){return a(ge)},get offsetY(){return a(Re)},get imageWidth(){return e(),h(()=>e().imageWidth)},get imageHeight(){return e(),h(()=>e().imageHeight)},get editFilters(){return a(p)},get blurEnabled(){return e(),h(()=>e().blurEnabled)},get blurBrushSize(){return e(),h(()=>e().blurBrushSize)},get blurStrength(){return e(),h(()=>e().blurStrength)},get blurSoften(){return e(),h(()=>e().blurSoften)},get blurInvert(){return e(),h(()=>e().blurInvert)},get blurMask(){return a(Te)},get showBrushPreview(){return e(),h(()=>e().showBrushPreview)},$$events:{cropChange:ie,blurPaint:R}})}var k=l(Y,2);ra(k,{get tabs(){return F},get activeTab(){return n()},onTabChange:g});var G=l(k,2);{var K=ce=>{{let ge=tt(()=>(e(),h(()=>Math.round(e().scale*100))));Zn(ce,{get aspectRatio(){return e(),h(()=>e().aspectRatio)},get cropWidth(){return a(c)},get cropHeight(){return a(m)},get ratioLocked(){return e(),h(()=>e().ratioLocked)},get scale(){return a(ge)},get cropPending(){return e(),h(()=>e().cropPending)},onRatioChange:Se,onDimensionsChange:xe,onLockToggle:W,onFlip:ne,onRotate:P,onScaleChange:q,onApply:_e})}},le=ce=>{var ge=ut(),Re=Ge(ge);{var Te=Oe=>{var je=di(),lt=f(je);ei(lt,{get brightness(){return e(),h(()=>e().brightness)},get shadows(){return e(),h(()=>e().shadows)},get contrast(){return e(),h(()=>e().contrast)},get hdr(){return e(),h(()=>e().hdr)},get blurEnabled(){return e(),h(()=>e().blurEnabled)},get blurBrushSize(){return e(),h(()=>e().blurBrushSize)},get blurStrength(){return e(),h(()=>e().blurStrength)},get blurSoften(){return e(),h(()=>e().blurSoften)},get blurInvert(){return e(),h(()=>e().blurInvert)},get zoomLevel(){return e(),h(()=>e().zoomLevel)},onBrightnessChange:Je,onShadowsChange:Ue,onContrastChange:Qe,onHdrChange:Ae,onBlurToggle:ze,onBlurBrushSizeChange:Ve,onBlurStrengthChange:Ke,onBlurSoftenChange:$e,onBlurInvertChange:Ee,onZoomChange:j,onNudge:te,onResetZoom:ue,onBrushPreviewChange:at,onEditEnd:Le}),u(je),D(Oe,je)},nt=Oe=>{var je=ut(),lt=Ge(je);{var V=me=>{var Me=vi(),it=f(Me);oi(it,{get imageUrl(){return e(),h(()=>e().currentImage)},get activeFilter(){return e(),h(()=>e().activeFilter)},get filterStrength(){return e(),h(()=>e().filterStrength)},onFilterChange:he,onStrengthChange:Fe,onReset:ke}),u(Me),D(me,Me)};ee(lt,me=>{n()==="filter"&&me(V)},!0)}D(Oe,je)};ee(Re,Oe=>{n()==="edit"?Oe(Te):Oe(nt,!1)},!0)}D(ce,ge)};ee(G,ce=>{n()==="crop"?ce(K):ce(le,!1)})}D(w,M)};ee(z,w=>{i()?w(fe,!1):w(oe)})}var E=l(z,2);{var ae=w=>{$t(w,{message:"Save changes?",confirmText:"Yes",cancelText:"Cancel",onConfirm:Z,onCancel:H})};ee(E,w=>{a(x)==="save"&&w(ae)})}var we=l(E,2);{var re=w=>{$t(w,{message:"Start again? Your changes will be lost.",confirmText:"Yes",cancelText:"Cancel",onConfirm:A,onCancel:U})};ee(we,w=>{a(x)==="startAgain"&&w(re)})}u(ye),D(o,ye),He(),v()}var fi=N('<div class="before-after-container svelte-1i0ztfp" role="slider" aria-label="Before and after comparison" tabindex="0"><div class="before-image svelte-1i0ztfp"><img alt="Before" class="svelte-1i0ztfp"/></div> <div class="after-image svelte-1i0ztfp"><img alt="After" class="svelte-1i0ztfp"/></div> <div class="slider-handle svelte-1i0ztfp" role="presentation"><div class="slider-line svelte-1i0ztfp"></div> <div class="slider-thumb svelte-1i0ztfp"><img src="/icons/icon-ai-slider.svg" alt="" class="slider-icon svelte-1i0ztfp"/></div></div></div>');function bi(o,t){Ne(t,!1);let e=b(t,"beforeImage",8,""),n=b(t,"afterImage",8,""),i=b(t,"position",12,50),r=b(t,"onChange",8,()=>{}),d=J(),v=!1;Lt(()=>(window.addEventListener("mousemove",p),window.addEventListener("touchmove",C,{passive:!1}),window.addEventListener("mouseup",F),window.addEventListener("touchend",F),()=>{window.removeEventListener("mousemove",p),window.removeEventListener("touchmove",C),window.removeEventListener("mouseup",F),window.removeEventListener("touchend",F)}));function c(){v=!0}function m(O){O.touches.length===1&&(v=!0)}function p(O){!v||!a(d)||x(O.clientX)}function C(O){!v||!a(d)||O.touches.length!==1||(O.preventDefault(),x(O.touches[0].clientX))}function F(){v=!1}function x(O){const Q=a(d).getBoundingClientRect(),Z=Math.max(0,Math.min(100,(O-Q.left)/Q.width*100));i(Z),r()(Z)}function _(O){if(!a(d))return;const Q=a(d).getBoundingClientRect(),Z=(O.clientX-Q.left)/Q.width*100;i(Math.max(0,Math.min(100,Z))),r()(i())}We();var B=fi(),g=f(B),y=f(g);u(g);var T=l(g,2),L=f(T);u(T);var S=l(T,2);u(B),bt(B,O=>I(d,O),()=>a(d)),$(()=>{se(y,"src",e()),Ce(T,`clip-path: inset(0 ${100-i()}% 0 0)`),se(L,"src",n()),Ce(S,`left: ${i()??""}%`)}),s("mousedown",S,c),s("touchstart",S,m),s("click",B,_),D(o,B),He()}const wa={originalImage:null,currentImage:null,processedImage:null,isProcessing:!1,processingType:null,upscaleFactor:1,showComparison:!1,comparisonPosition:50};function mi(){const{subscribe:o,set:t,update:e}=xt(wa);return{subscribe:o,setImage:n=>e(i=>({...i,originalImage:n,currentImage:n,processedImage:null})),startProcessing:n=>e(i=>({...i,isProcessing:!0,processingType:n})),finishProcessing:n=>e(i=>({...i,isProcessing:!1,processingType:null,processedImage:n,currentImage:n,showComparison:!0})),cancelProcessing:()=>e(n=>({...n,isProcessing:!1,processingType:null})),setUpscaleFactor:n=>e(i=>({...i,upscaleFactor:n})),setComparisonPosition:n=>e(i=>({...i,comparisonPosition:n})),reset:()=>t(wa)}}const ot=mi(),ya=xt("enhance"),pi=aa(ot,o=>o.currentImage!==null);let Dt=null;async function xi(o,t=4,e){e?.("Invoking AI ...");const n=await fetch("/api/face-enhance",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({image:o,scale:t,faceEnhance:.5})}),i=await n.json();if(!n.ok)throw new Error(i.error||`API error: ${n.status}`);if(i.status==="succeeded"&&i.output)return e?.("Final checks ..."),await qa(i.output);if(i.status==="processing"||i.status==="starting")return e?.("Processing with CodeFormer..."),await wi(i.pollUrl,e);throw new Error("Unexpected response")}async function wi(o,t,e=60){for(let n=0;n<e;n++){await new Promise(d=>setTimeout(d,2e3));const i=await fetch(`/api/upscale?pollUrl=${encodeURIComponent(o)}`),r=await i.json();if(!i.ok)throw new Error(r.error||`Polling error: ${i.status}`);if(r.status==="succeeded"&&r.output)return t?.("Final checks ..."),await qa(r.output);if(r.status==="failed")throw new Error(r.error||"Upscaling failed");t?.(`Processing in cloud (${(n+1)*2}s)...`)}throw new Error("Timeout waiting for result")}async function qa(o){const e=await(await fetch(o)).blob();return new Promise((n,i)=>{const r=new FileReader;r.onload=()=>n(r.result),r.onerror=i,r.readAsDataURL(e)})}async function yi(o){if(Dt)return Dt;console.log("[AI] Loading RMBG background removal model...");const{pipeline:t,env:e}=await ln(async()=>{const{pipeline:n,env:i}=await import("../chunks/bLAnV4ll.js");return{pipeline:n,env:i}},[],import.meta.url);e.allowLocalModels=!1;try{Dt=await t("image-segmentation","briaai/RMBG-1.4",{device:"webgpu",dtype:"fp32"}),console.log("[AI] RMBG model ready (WebGPU)")}catch(n){console.log("[AI] WebGPU not available, falling back to WASM...",n.message),Dt=await t("image-segmentation","briaai/RMBG-1.4",{dtype:"q8"}),console.log("[AI] RMBG model ready (WASM)")}return Dt}async function _i(o,t){try{console.log("[AI] Starting background removal..."),t?.("Starting engine ...");const e=await yi(t);t?.("Processing ...");const n=await e(o);if(console.log("[AI] Segmentation result:",n),!n||n.length===0)throw new Error("No segmentation result returned");const i=n[0];if(console.log("[AI] Segment keys:",Object.keys(i)),i.mask&&i.mask.toDataURL)return console.log("[AI] Background removal complete (RawImage mask)"),await _a(o,i.mask);if(i.mask&&i.mask.data)return console.log("[AI] Background removal complete (data mask)"),await _a(o,i.mask);if(typeof i=="string"&&i.startsWith("data:"))return console.log("[AI] Background removal complete (direct output)"),i;throw console.log("[AI] Segment structure:",JSON.stringify(i,null,2).substring(0,500)),new Error("Unexpected segmentation result format")}catch(e){throw console.error("[AI] Background removal failed:",e),new Error("Background removal failed: "+e.message)}}async function _a(o,t){return new Promise((e,n)=>{const i=new Image;i.onload=async()=>{try{const r=document.createElement("canvas");r.width=i.width,r.height=i.height;const d=r.getContext("2d");d.drawImage(i,0,0);const v=d.getImageData(0,0,r.width,r.height),c=v.data;let m,p,C;if(t.toDataURL){const x=document.createElement("canvas");x.width=t.width,x.height=t.height;const _=x.getContext("2d"),B=new Image;B.onload=()=>{_.drawImage(B,0,0);const g=_.getImageData(0,0,t.width,t.height);ka(c,g.data,r.width,r.height,t.width,t.height,!0),d.putImageData(v,0,0),e(r.toDataURL("image/png"))},B.onerror=n,B.src=t.toDataURL();return}else m=t.data,p=t.width,C=t.height;const F=m.length===p*C*4;ka(c,m,r.width,r.height,p,C,F),d.putImageData(v,0,0),e(r.toDataURL("image/png"))}catch(r){n(r)}},i.onerror=n,i.src=o})}function ka(o,t,e,n,i,r,d){const v=i/e,c=r/n;for(let m=0;m<n;m++)for(let p=0;p<e;p++){const C=Math.floor(p*v),F=Math.floor(m*c);let x;if(d){const B=(F*i+C)*4;x=t[B]}else{const B=F*i+C;x=t[B]||0}const _=(m*e+p)*4;o[_+3]=x}}var ki=N('<button class="processing-btn svelte-1rgvkgu" disabled><span class="spinner svelte-1rgvkgu"></span> </button> <button class="cancel-btn svelte-1rgvkgu">Cancel</button>',1),Ci=N('<div class="size-display svelte-1rgvkgu"> </div>'),Si=N('<button class="upscale-btn svelte-1rgvkgu"><img src="/icons/icon-ai.svg" alt="" class="btn-icon svelte-1rgvkgu"/> Upscale image</button> <!>',1),Ii=N('<div class="error-message svelte-1rgvkgu"> </div>'),zi=N('<div class="upscale-controls svelte-1rgvkgu"><div class="controls-content svelte-1rgvkgu"><!> <!></div></div>');function Fi(o,t){Ne(t,!1);const e=()=>vt(ot,"$aiState",n),[n,i]=Pt(),r=4;let d=J(!1),v=J(""),c=J(null),m=J(null);async function p(){try{const S=await wt(e().originalImage),O=Math.round(S.naturalWidth*r),Q=Math.round(S.naturalHeight*r);I(m,`${O} x ${Q}`)}catch(S){console.error("Failed to get image dimensions:",S)}}async function C(){if(e().originalImage)try{I(d,!0),I(c,null),I(v,"Starting..."),ot.startProcessing("upscale");const S=await xi(e().originalImage,r,O=>{I(v,O)});ot.finishProcessing(S)}catch(S){I(c,S.message||"Upscaling failed"),ot.cancelProcessing()}finally{I(d,!1),I(v,"")}}function F(){I(d,!1),I(v,""),I(c,null),ot.cancelProcessing()}et(()=>e(),()=>{e().originalImage&&p()}),yt(),We();var x=zi(),_=f(x),B=f(_);{var g=S=>{var O=ki(),Q=Ge(O),Z=l(f(Q));u(Q);var H=l(Q,2);$(()=>Ze(Z,` ${a(v)||"Processing..."}`)),s("click",H,F),D(S,O)},y=S=>{var O=Si(),Q=Ge(O),Z=l(Q,2);{var H=A=>{var U=Ci(),ve=f(U);u(U),$(()=>Ze(ve,`Output: ${a(m)??""}`)),D(A,U)};ee(Z,A=>{a(m)&&A(H)})}s("click",Q,C),D(S,O)};ee(B,S=>{a(d)?S(g):S(y,!1)})}var T=l(B,2);{var L=S=>{var O=Ii(),Q=f(O,!0);u(O),$(()=>Ze(Q,a(c))),D(S,O)};ee(T,S=>{a(c)&&S(L)})}u(_),u(x),D(o,x),He(),i()}var Bi=N('<img alt="Original" class="compare-overlay svelte-1ibkqf6"/>'),Ri=N('<div class="brush-indicator svelte-1ibkqf6"></div>'),Ei=N('<div class="brush-preview svelte-1ibkqf6"></div>'),Pi=N('<div class="drawer-overlay svelte-1ibkqf6" role="presentation"><div class="drawer svelte-1ibkqf6" role="dialog"><div class="drawer-header svelte-1ibkqf6"><button class="icon-btn svelte-1ibkqf6" title="Undo"><img src="/icons/icon-undo.svg" alt="Undo" class="svelte-1ibkqf6"/></button> <button class="icon-btn svelte-1ibkqf6" title="Redo"><img src="/icons/icon-redo.svg" alt="Redo" class="svelte-1ibkqf6"/></button> <div class="spacer svelte-1ibkqf6"></div> <button title="Compare"><img src="/icons/icon-compare.svg" alt="Compare" class="svelte-1ibkqf6"/></button></div> <div class="canvas-container svelte-1ibkqf6"><div class="canvas-wrapper svelte-1ibkqf6" role="presentation"><canvas class="svelte-1ibkqf6"></canvas> <!> <!> <!></div></div> <div class="controls-section svelte-1ibkqf6"><div class="button-group svelte-1ibkqf6"><button><img src="/icons/icon-erase.svg" alt="" class="svelte-1ibkqf6"/> Erase</button> <button><img src="/icons/icon-restore.svg" alt="" class="svelte-1ibkqf6"/> Restore</button></div> <div class="control-row svelte-1ibkqf6"><label class="svelte-1ibkqf6">Brush size</label> <div class="control-item svelte-1ibkqf6"><!> <button class="reset-btn svelte-1ibkqf6" title="Reset"><img src="/icons/icon-reset.svg" alt="Reset" class="svelte-1ibkqf6"/></button></div></div> <div class="control-row svelte-1ibkqf6"><label class="svelte-1ibkqf6">Soften edges</label> <div class="control-item svelte-1ibkqf6"><!> <button class="reset-btn svelte-1ibkqf6" title="Reset"><img src="/icons/icon-reset.svg" alt="Reset" class="svelte-1ibkqf6"/></button></div></div> <div class="control-row svelte-1ibkqf6"><label class="svelte-1ibkqf6">Zoom in</label> <div class="control-item svelte-1ibkqf6"><!> <button class="reset-btn svelte-1ibkqf6" title="Reset"><img src="/icons/icon-reset.svg" alt="Reset" class="svelte-1ibkqf6"/></button></div></div> <div class="nudge-buttons svelte-1ibkqf6"><button class="nudge-btn svelte-1ibkqf6">â</button> <button class="nudge-btn svelte-1ibkqf6">â</button> <button class="nudge-btn svelte-1ibkqf6">â</button> <button class="nudge-btn svelte-1ibkqf6">â</button></div> <div class="drawer-footer svelte-1ibkqf6"><button class="btn-cancel svelte-1ibkqf6">Cancel</button> <button class="btn-done svelte-1ibkqf6">Done</button></div></div></div></div>');function Li(o,t){Ne(t,!1);const e=J();let n=b(t,"image",8,""),i=b(t,"originalFullImage",8,""),r=b(t,"onClose",8,()=>{}),d=b(t,"onSave",8,()=>{}),v=J(),c=J(),m,p=J(!0),C=J(20),F=J(50),x=J(1),_=J(0),B=J(0),g=!1,y=[],T=0,L=null,S=J({x:0,y:0,visible:!1}),O=J(!1),Q=J(0),Z=J(0),H=J(!1);Lt(async()=>{const V=await wt(n());va(v,a(v).width=V.naturalWidth),va(v,a(v).height=V.naturalHeight),m=a(v).getContext("2d"),m.drawImage(V,0,0),i()?L=await wt(i()):L=V,A(),U()});function A(){if(a(c)){const V=a(c).getBoundingClientRect();I(Q,V.width),I(Z,V.height)}}function U(){y=y.slice(0,T+1),y.push(a(v).toDataURL()),T=y.length-1}function ve(){T>0&&(T--,xe())}function Se(){T<y.length-1&&(T++,xe())}function xe(){const V=new Image;V.onload=()=>{m.clearRect(0,0,a(v).width,a(v).height),m.drawImage(V,0,0)},V.src=y[T]}function W(V){const me=a(c).getBoundingClientRect(),Me=a(v).width/me.width,it=a(v).height/me.height,St=(V.clientX-me.left)*Me,zt=(V.clientY-me.top)*it;return{x:St,y:zt}}function ne(V){g=!0;const{x:me,y:Me}=W(V);_e(me,Me)}function P(V){const me=a(c).getBoundingClientRect();if(I(S,{x:V.clientX-me.left,y:V.clientY-me.top,visible:!0}),!g)return;const{x:Me,y:it}=W(V);_e(Me,it)}function q(){g&&(g=!1,U())}function ie(){I(S,{...a(S),visible:!1}),g&&(g=!1,U())}function _e(V,me){const Me=a(v).width/a(c).getBoundingClientRect().width,it=a(e)/2*Me,St=a(F)/100,zt=Math.min(it-.001,it*(1-St));m.save();try{if(a(p)){const dt=m.createRadialGradient(V,me,zt,V,me,it);dt.addColorStop(0,"rgba(0,0,0,1)"),dt.addColorStop(1,"rgba(0,0,0,0)"),m.globalCompositeOperation="destination-out",m.fillStyle=dt,m.beginPath(),m.arc(V,me,it,0,Math.PI*2),m.fill()}else{if(!L)return;const dt=document.createElement("canvas");dt.width=a(v).width,dt.height=a(v).height;const _t=dt.getContext("2d"),Ut=_t.createRadialGradient(V,me,zt,V,me,it);Ut.addColorStop(0,"rgba(0,0,0,1)"),Ut.addColorStop(1,"rgba(0,0,0,0)"),_t.globalCompositeOperation="source-over",_t.drawImage(L,0,0,dt.width,dt.height),_t.globalCompositeOperation="destination-in",_t.fillStyle=Ut,_t.beginPath(),_t.arc(V,me,it,0,Math.PI*2),_t.fill(),m.globalCompositeOperation="source-over",m.drawImage(dt,0,0)}}finally{m.restore()}}function Pe(){I(C,20)}function Ie(){I(F,50)}function De(){I(x,1),I(_,0),I(B,0)}function Je(V){switch(V){case"up":I(B,a(B)-10);break;case"down":I(B,a(B)+10);break;case"left":I(_,a(_)-10);break;case"right":I(_,a(_)+10);break}}function Ue(){r()()}function Qe(){const V=a(v).toDataURL("image/png");d()(V)}et(()=>(a(C),a(Q),a(Z)),()=>{I(e,a(C)/100*Math.min(a(Q)||300,a(Z)||300)*.5)}),yt(),We();var Ae=Pi(),ze=f(Ae),Ve=f(ze),Ke=f(Ve),$e=l(Ke,2),Ee=l($e,4);let at;u(Ve);var Le=l(Ve,2),be=f(Le),Ye=f(be);bt(Ye,V=>I(v,V),()=>a(v));var qe=l(Ye,2);{var R=V=>{var me=Bi();$(()=>se(me,"src",i())),D(V,me)};ee(qe,V=>{a(H)&&i()&&V(R)})}var j=l(qe,2);{var te=V=>{var me=Ri();$(()=>Ce(me,`
							left: ${a(S),h(()=>a(S).x)??""}px;
							top: ${a(S),h(()=>a(S).y)??""}px;
							width: ${a(e)??""}px;
							height: ${a(e)??""}px;
						`)),D(V,me)};ee(j,V=>{a(S),a(Q),h(()=>a(S).visible&&a(Q)>0)&&V(te)})}var ue=l(j,2);{var he=V=>{var me=Ei();$(()=>Ce(me,`
						left: ${a(Q)/2}px;
						top: ${a(Z)/2}px;
						width: ${a(e)??""}px;
						height: ${a(e)??""}px;
					`)),D(V,me)};ee(ue,V=>{a(O)&&a(Q)>0&&a(Z)>0&&V(he)})}u(be),bt(be,V=>I(c,V),()=>a(c)),u(Le);var Fe=l(Le,2),ke=f(Fe),ye=f(ke);let z;var oe=l(ye,2);let fe;u(ke);var E=l(ke,2),ae=l(f(E),2),we=f(ae);Ct(we,{min:5,max:100,step:1,get value(){return a(C)},onChange:V=>I(C,V),onInteractionStart:()=>{A(),I(O,!0)},onInteractionEnd:()=>I(O,!1)});var re=l(we,2);u(ae),u(E);var w=l(E,2),M=l(f(w),2),X=f(M);Ct(X,{min:0,max:100,step:1,get value(){return a(F)},onChange:V=>I(F,V)});var Y=l(X,2);u(M),u(w);var k=l(w,2),G=l(f(k),2),K=f(G);Ct(K,{min:1,max:3,step:.1,get value(){return a(x)},onChange:V=>I(x,V)});var le=l(K,2);u(G),u(k);var ce=l(k,2),ge=f(ce),Re=l(ge,2),Te=l(Re,2),nt=l(Te,2);u(ce);var Oe=l(ce,2),je=f(Oe),lt=l(je,2);u(Oe),u(Fe),u(ze),u(Ae),$(()=>{at=de(Ee,1,"icon-btn svelte-1ibkqf6",null,at,{active:a(H)}),Ce(be,`transform: scale(${a(x)??""}) translate(${a(_)??""}px, ${a(B)??""}px)`),z=de(ye,1,"mode-btn svelte-1ibkqf6",null,z,{active:a(p)}),fe=de(oe,1,"mode-btn svelte-1ibkqf6",null,fe,{active:!a(p)})}),s("click",Ke,ve),s("click",$e,Se),s("mousedown",Ee,()=>I(H,!0)),s("mouseup",Ee,()=>I(H,!1)),s("mouseleave",Ee,()=>I(H,!1)),s("touchstart",Ee,()=>I(H,!0)),s("touchend",Ee,()=>I(H,!1)),s("mousedown",be,ne),s("mousemove",be,P),s("mouseup",be,q),s("mouseleave",be,ie),s("click",ye,()=>I(p,!0)),s("click",oe,()=>I(p,!1)),s("click",re,Pe),s("click",Y,Ie),s("click",le,De),s("click",ge,()=>Je("up")),s("click",Re,()=>Je("down")),s("click",Te,()=>Je("left")),s("click",nt,()=>Je("right")),s("click",je,Ue),s("click",lt,Qe),s("click",ze,gt(function(V){Jt.call(this,t,V)})),s("click",Ae,Ue),D(o,Ae),He()}var Mi=N('<button class="processing-btn svelte-1wdmsm1" disabled><span class="spinner svelte-1wdmsm1"></span> </button> <button class="cancel-btn svelte-1wdmsm1">Cancel</button>',1),Di=N('<button class="remove-btn svelte-1wdmsm1"><img src="/icons/icon-ai.svg" alt="" class="btn-icon svelte-1wdmsm1"/> Remove background</button>'),Ai=N('<div class="error-message svelte-1wdmsm1"> </div>'),qi=N('<div class="background-controls svelte-1wdmsm1"><div class="controls-content svelte-1wdmsm1"><!> <button class="erase-btn svelte-1wdmsm1"><img src="/icons/icon-erase.svg" alt="" class="btn-icon svelte-1wdmsm1"/> Erase and restore</button> <!></div> <!></div>');function Ti(o,t){Ne(t,!1);const e=()=>vt(ot,"$aiState",n),[n,i]=Pt(),r=J();let d=J(!1),v=J(""),c=J(null),m=J(!1);async function p(){if(e().originalImage)try{I(d,!0),I(c,null),I(v,"Starting..."),ot.startProcessing("background");const H=await _i(e().originalImage,A=>{I(v,A)});ot.finishProcessing(H)}catch(H){I(c,H.message||"Background removal failed"),ot.cancelProcessing()}finally{I(d,!1),I(v,"")}}function C(){I(d,!1),I(v,""),I(c,null),ot.cancelProcessing()}function F(){I(m,!0)}function x(){I(m,!1)}et(()=>e(),()=>{I(r,e().showComparison&&e().processedImage)}),yt(),We();var _=qi(),B=f(_),g=f(B);{var y=H=>{var A=Mi(),U=Ge(A),ve=l(f(U));u(U);var Se=l(U,2);$(()=>Ze(ve,` ${a(v)||"Processing..."}`)),s("click",Se,C),D(H,A)},T=H=>{var A=Di();s("click",A,p),D(H,A)};ee(g,H=>{a(d)?H(y):H(T,!1)})}var L=l(g,2),S=l(L,2);{var O=H=>{var A=Ai(),U=f(A,!0);u(A),$(()=>Ze(U,a(c))),D(H,A)};ee(S,H=>{a(c)&&H(O)})}u(B);var Q=l(B,2);{var Z=H=>{Li(H,{get image(){return e(),h(()=>e().processedImage)},get originalFullImage(){return e(),h(()=>e().originalImage)},onClose:x,onSave:A=>{ot.finishProcessing(A),I(m,!1)}})};ee(Q,H=>{a(m)&&H(Z)})}u(_),$(()=>L.disabled=!a(r)),s("click",L,F),D(o,_),He(),i()}var Oi=N('<img alt="Working image" class="working-image svelte-17agwu4"/>'),Ni=N('<!> <div class="image-container svelte-17agwu4"><!></div> <!> <!>',1),Hi=N('<div class="ai-tab svelte-17agwu4"><!></div>');function Ui(o,t){Ne(t,!1);const e=()=>vt(ot,"$aiState",r),n=()=>vt(pi,"$hasAiImage",r),i=()=>vt(ya,"$activeAiMenu",r),[r,d]=Pt();let v=J(50);function c(T){I(v,T),ot.setComparisonPosition(T)}const m=[{id:"upscale",label:"Upscale"},{id:"background",label:"Remove background"}];function p(T){ot.setImage(T)}function C(T){ya.set(T)}async function F(){e().currentImage&&await Vt(e().currentImage)}function x(){e().currentImage&&Kt(e().currentImage,"picflam-ai.png")}We();var _=Hi(),B=f(_);{var g=T=>{Da(T,{title:"Remove backgrounds,",subtitle:"upscale images with AI",hint:"Import, drag or paste an image",onImageImport:p})},y=T=>{var L=Ni(),S=Ge(L);oa(S,{canUndo:!1,canRedo:!1,onUndo:()=>{},onRedo:()=>{},onStartAgain:()=>ot.reset(),onCopy:F,onExport:x});var O=l(S,2),Q=f(O);{var Z=xe=>{bi(xe,{get beforeImage(){return e().originalImage},get afterImage(){return e().processedImage},get position(){return a(v)},onChange:c})},H=xe=>{var W=Oi();$(()=>se(W,"src",e().currentImage)),D(xe,W)};ee(Q,xe=>{e().showComparison&&e().processedImage?xe(Z):xe(H,!1)})}u(O);var A=l(O,2);ra(A,{get tabs(){return m},get activeTab(){return i()},onTabChange:C});var U=l(A,2);{var ve=xe=>{Fi(xe,{})},Se=xe=>{var W=ut(),ne=Ge(W);{var P=q=>{Ti(q,{})};ee(ne,q=>{i()==="background"&&q(P)},!0)}D(xe,W)};ee(U,xe=>{i()==="upscale"?xe(ve):xe(Se,!1)})}D(T,L)};ee(B,T=>{n()?T(y,!1):T(g)})}u(_),D(o,_),He(),d()}var Yi=N('<div class="size-controls svelte-1l8e210"><!></div>');function Wi(o,t){Ne(t,!1);let e=b(t,"canvasSize",8,"1/1"),n=b(t,"onSizeChange",8,c=>{});const i=[{id:"9/16",label:"9:16",icon:"icon-vertical"},{id:"1/1",label:"1:1",icon:"icon-square"},{id:"16/9",label:"16:9",icon:"icon-horizontal"}];function r(c){n()(c)}We();var d=Yi(),v=f(d);Aa(v,{get options(){return i},get value(){return e()},onChange:r,showLabels:!0,centered:!0}),u(d),D(o,d),He()}var ji=N("<button></button>"),Xi=N('<button aria-label="Custom color"></button> <input type="color" style="display: none;"/>',1),Gi=N('<div class="color-swatches svelte-x97jji"><!> <!></div>');function Et(o,t){Ne(t,!1);let e=b(t,"colors",24,()=>[]),n=b(t,"value",8,""),i=b(t,"onChange",8,_=>{}),r=b(t,"showRainbow",8,!0),d=J("#5422b0"),v=J();function c(){a(v)&&a(v).click()}function m(_){I(d,_.target.value),i()(a(d))}We();var p=Gi(),C=f(p);ft(C,1,e,mt,(_,B)=>{var g=ji();let y;$(()=>{y=de(g,1,"swatch svelte-x97jji",null,y,{active:n()===a(B),white:a(B)==="#FFFFFF"}),Ce(g,`background-color: ${a(B)??""}; ${n()===a(B)&&a(B)!=="#FFFFFF"?`box-shadow: 0 0 0 3px ${a(B)};`:""}`),se(g,"aria-label",`Select color ${a(B)??""}`)}),s("click",g,()=>i()(a(B))),D(_,g)});var F=l(C,2);{var x=_=>{var B=Xi(),g=Ge(B);let y;var T=l(g,2);ct(T),bt(T,L=>I(v,L),()=>a(v)),$((L,S,O)=>{y=de(g,1,"swatch rainbow svelte-x97jji",null,y,L),Ce(g,`border-color: ${S??""}; ${O??""}`),rt(T,a(d))},[()=>({active:n()&&!e().includes(n())&&n()!=="transparent"}),()=>(Be(n()),Be(e()),a(d),h(()=>n()&&!e().includes(n())&&n()!=="transparent"?a(d):"#999999")),()=>(Be(n()),Be(e()),h(()=>n()&&!e().includes(n())&&n()!=="transparent"?"box-shadow: inset 0 0 0 2px white;":""))]),s("click",g,c),s("input",T,m),D(_,B)};ee(F,_=>{r()&&_(x)})}u(p),D(o,p),He()}const Rt={solids:["#FFFFFF","#000000","#007C1F","#00679D","#B20715"],gradients:["linear-gradient(135deg, #5422b0 0%, #4B0082 100%)","linear-gradient(135deg, #15509B 0%, #20244F 100%)","linear-gradient(135deg, #A8076B 0%, #62045F 100%)","linear-gradient(135deg, #EA5C56 0%, #3C0C40 100%)","linear-gradient(135deg, #0A8F9D 0%, #202B54 100%)","linear-gradient(135deg, #D17A29 0%, #41363C 100%)"]},Ta=["Inter","Roboto Slab","Saira Condensed","Lora","Playfair Display","Special Elite"],At={up:"to top",down:"to bottom",left:"to left",right:"to right"},Qi={canvasSize:"1/1",background:{type:"solid",value:"#FFFFFF",direction:"down",gradientColors:["#5422b0","#4B0082"]},text1:"",text1Font:"Inter",text1Size:5,text1YPosition:5,text1LineSpacing:3,text1Color:"#000000",text1HighlightColor:"transparent",text1IsBold:!0,text1Align:"center",text1QuoteStyle:"none",text1QuoteSize:3,text2:"",text2Font:"Inter",text2Size:2,text2YPosition:8,text2LineSpacing:3,text2Color:"#000000",text2LabelColor:"transparent",text2IsBold:!1,text2Align:"center",overlay:null,overlaySize:50,overlayOpacity:100,overlayX:50,overlayY:50,overlayMask:"none",overlayLayer:"above",overlayBorderWidth:0,overlayBorderColor:"#FFFFFF",overlayNaturalWidth:0,overlayNaturalHeight:0,overlayZoom:100,overlayImageOffsetX:0,overlayImageOffsetY:0};function Zi(o){const t=[JSON.parse(JSON.stringify(o))];let e=0;const{subscribe:n,set:i,update:r}=xt(o);return{subscribe:n,set:d=>{t.splice(e+1),t.push(JSON.parse(JSON.stringify(d))),e=t.length-1,i(d)},update:d=>{r(v=>{const c=d(v);return t.splice(e+1),t.push(JSON.parse(JSON.stringify(c))),e=t.length-1,c})},undo:()=>e>0?(e--,i(JSON.parse(JSON.stringify(t[e]))),!0):!1,redo:()=>e<t.length-1?(e++,i(JSON.parse(JSON.stringify(t[e]))),!0):!1,canUndo:()=>e>0,canRedo:()=>e<t.length-1,reset:()=>{const d=JSON.parse(JSON.stringify(o));t.length=0,t.push(d),e=0,i(d)}}}const Xe=Zi(Qi),ea=xt(!0),ht=xt("none");aa(Xe,o=>o.text1||o.text2||o.overlay||o.background.value!=="#FFFFFF");function Ji(){Xe.reset(),ea.set(!0),ht.set("none")}var Vi=N('<button aria-label="Select gradient"></button>'),Ki=N('<div class="background-controls svelte-18tfgkp"><div class="section svelte-18tfgkp"><div class="color-row svelte-18tfgkp"><!></div></div> <div class="section svelte-18tfgkp"><div class="gradient-row svelte-18tfgkp"></div></div> <div class="section svelte-18tfgkp"><div class="gradient-preview-row svelte-18tfgkp"><button class="gradient-endpoint svelte-18tfgkp" aria-label="Edit start color"></button> <div class="gradient-preview svelte-18tfgkp"></div> <button class="gradient-endpoint svelte-18tfgkp" aria-label="Edit end color"></button></div></div> <div class="section svelte-18tfgkp"><div><button aria-label="Gradient direction up"><img src="/icons/icon-nudge-up.svg" alt="" class="direction-icon svelte-18tfgkp"/></button> <button aria-label="Gradient direction down"><img src="/icons/icon-nudge-down.svg" alt="" class="direction-icon svelte-18tfgkp"/></button> <button aria-label="Gradient direction left"><img src="/icons/icon-nudge-left.svg" alt="" class="direction-icon svelte-18tfgkp"/></button> <button aria-label="Gradient direction right"><img src="/icons/icon-nudge-right.svg" alt="" class="direction-icon svelte-18tfgkp"/></button></div></div></div>');function $i(o,t){Ne(t,!1);const e=J();let n=b(t,"background",24,()=>({type:"solid",value:"#FFFFFF",direction:"down",gradientColors:["#5422b0","#4B0082"]})),i=b(t,"onBackgroundChange",8,P=>{});const r=Rt.gradients.map(P=>{const q=P.match(/#[A-Fa-f0-9]{6}/g);return q?[q[0],q[1]]:["#5422b0","#4B0082"]});function d(P){i()({...n(),type:"solid",value:P})}function v(P){const q=r[P],ie=At[n().direction]||"to bottom";i()({...n(),type:"gradient",value:`linear-gradient(${ie}, ${q[0]} 0%, ${q[1]} 100%)`,gradientColors:q})}function c(P){const q=At[P],ie=n().gradientColors||["#5422b0","#4B0082"];i()({...n(),direction:P,value:`linear-gradient(${q}, ${ie[0]} 0%, ${ie[1]} 100%)`})}function m(P,q){const ie=[...n().gradientColors||["#5422b0","#4B0082"]];ie[P]=q;const _e=At[n().direction]||"to bottom";i()({...n(),type:"gradient",value:`linear-gradient(${_e}, ${ie[0]} 0%, ${ie[1]} 100%)`,gradientColors:ie})}et(()=>(Be(n()),At),()=>{I(e,n().type==="gradient"?`linear-gradient(${At[n().direction]||"to bottom"}, ${n().gradientColors?.[0]||"#5422b0"} 0%, ${n().gradientColors?.[1]||"#4B0082"} 100%)`:`linear-gradient(to bottom, ${r[0][0]} 0%, ${r[0][1]} 100%)`)}),yt(),We();var p=Ki(),C=f(p),F=f(C),x=f(F);{let P=tt(()=>(Be(n()),h(()=>n().type==="solid"?n().value:"")));Et(x,{get colors(){return Be(Rt),h(()=>Rt.solids)},get value(){return a(P)},onChange:d,showRainbow:!0})}u(F),u(C);var _=l(C,2),B=f(_);ft(B,5,()=>r,mt,(P,q,ie)=>{const _e=tt(()=>(Be(n()),a(q),h(()=>n().type==="gradient"&&n().gradientColors?.[0]===a(q)[0]&&n().gradientColors?.[1]===a(q)[1])));var Pe=Vi();let Ie;$(()=>{Ie=de(Pe,1,"gradient-swatch svelte-18tfgkp",null,Ie,{active:a(_e)}),Ce(Pe,`background: linear-gradient(135deg, ${a(q),h(()=>a(q)[0])??""} 0%, ${a(q),h(()=>a(q)[1])??""} 100%); border-color: ${a(q),h(()=>a(q)[0])??""}; ${a(_e)?"box-shadow: inset 0 0 0 2px white;":""}`)}),s("click",Pe,()=>v(ie)),D(P,Pe)}),u(B),u(_);var g=l(_,2),y=f(g),T=f(y),L=l(T,2),S=l(L,2);u(y),u(g);var O=l(g,2),Q=f(O);let Z;var H=f(Q);let A;var U=l(H,2);let ve;var Se=l(U,2);let xe;var W=l(Se,2);let ne;u(Q),u(O),u(p),$(()=>{Ce(T,`background-color: ${Be(n()),h(()=>n().gradientColors?.[0]||"#5422b0")??""};`),Ce(L,`background: ${a(e)??""};`),Ce(S,`background-color: ${Be(n()),h(()=>n().gradientColors?.[1]||"#4B0082")??""};`),Z=de(Q,1,"direction-row svelte-18tfgkp",null,Z,{inactive:n().type!=="gradient"}),A=de(H,1,"direction-btn svelte-18tfgkp",null,A,{active:n().direction==="up"}),ve=de(U,1,"direction-btn svelte-18tfgkp",null,ve,{active:n().direction==="down"}),xe=de(Se,1,"direction-btn svelte-18tfgkp",null,xe,{active:n().direction==="left"}),ne=de(W,1,"direction-btn svelte-18tfgkp",null,ne,{active:n().direction==="right"})}),s("click",T,()=>{const P=document.createElement("input");P.type="color",P.value=n().gradientColors?.[0]||"#5422b0",P.addEventListener("input",q=>m(0,q.target.value)),P.click()}),s("click",S,()=>{const P=document.createElement("input");P.type="color",P.value=n().gradientColors?.[1]||"#4B0082",P.addEventListener("input",q=>m(1,q.target.value)),P.click()}),s("click",H,()=>c("up")),s("click",U,()=>c("down")),s("click",Se,()=>c("left")),s("click",W,()=>c("right")),D(o,p),He()}var eo=N("<button> </button>"),to=N('<div class="font-dropdown-menu svelte-fspusj"></div>'),ao=N('<input type="range" class="inline-slider svelte-fspusj"/>'),no=N('<input type="range" class="inline-slider svelte-fspusj"/>'),io=N('<input type="range" class="inline-slider svelte-fspusj"/>'),oo=N('<button><img alt="" class="style-icon svelte-fspusj"/></button>'),ro=N('<div class="slider-row quote-slider-row svelte-fspusj"><span class="row-label svelte-fspusj">Size</span> <div class="slider-wrapper svelte-fspusj"><input type="range" class="inline-slider svelte-fspusj"/></div> <button class="reset-btn svelte-fspusj" aria-label="Reset quote size"><img src="/icons/icon-reset.svg" alt="" class="reset-icon svelte-fspusj"/></button></div>'),lo=N('<div class="text1-controls svelte-fspusj"><div class="text-input-container svelte-fspusj"><textarea class="text-input svelte-fspusj" placeholder="Add text (with ==highlights==)"></textarea></div> <div class="font-row svelte-fspusj"><span class="row-label svelte-fspusj">Font</span> <div class="font-dropdown-wrapper svelte-fspusj"><button class="font-dropdown-trigger svelte-fspusj"> <span class="dropdown-arrow svelte-fspusj">â¾</span></button> <!></div> <button aria-label="Bold"><img src="/icons/icon-bold.svg" alt="" class="btn-icon svelte-fspusj"/></button> <button class="icon-btn svelte-fspusj"><img alt="" class="btn-icon svelte-fspusj"/></button></div> <div class="slider-tabs svelte-fspusj"><button>Size</button> <button>Position</button> <button>Line spacing</button></div> <div class="slider-row svelte-fspusj"><div class="slider-wrapper svelte-fspusj"><!></div> <button class="reset-btn svelte-fspusj" aria-label="Reset slider"><img src="/icons/icon-reset.svg" alt="" class="reset-icon svelte-fspusj"/></button></div> <div class="color-section svelte-fspusj"><div class="color-mode-tabs svelte-fspusj"><button>Text colour</button> <button>Highlight colour</button></div> <!></div> <div class="quote-row svelte-fspusj"><span class="row-label svelte-fspusj">Quotes</span> <div class="style-row svelte-fspusj"></div></div> <!></div>');function so(o,t){Ne(t,!1);let e=b(t,"text1",8,""),n=b(t,"text1Font",8,"Inter"),i=b(t,"text1Size",8,5),r=b(t,"text1YPosition",8,3),d=b(t,"text1LineSpacing",8,5),v=b(t,"text1Color",8,"#000000"),c=b(t,"text1HighlightColor",8,"transparent"),m=b(t,"text1IsBold",8,!0),p=b(t,"text1Align",8,"center"),C=b(t,"text1QuoteStyle",8,"none"),F=b(t,"text1QuoteSize",8,5),x=b(t,"onChange",8,(k,G)=>{});const _=Rt.solids,B=["#FFD700","#000000","#007C1F","#00679D","#B20715"],g=["left","center","right"],y=[{id:"none",icon:"/icons/icon-none.svg",label:"No quote"},{id:"serif",icon:"/icons/icon-quote-serif.svg",label:"Serif quote"},{id:"slab",icon:"/icons/icon-quote-slab.svg",label:"Slab quote"}],T={text1Size:5,text1YPosition:5,text1LineSpacing:3,text1QuoteSize:3};let L=J("text"),S=J("size"),O=J(!1),Q=J();function Z(k){a(Q)&&!a(Q).contains(k.target)&&I(O,!1)}Lt(()=>{document.addEventListener("click",Z)}),na(()=>{document.removeEventListener("click",Z)});function H(k){x()("text1",k.target.value)}function A(k){x()("text1Font",k),x()("text1IsBold",k==="Inter"),I(O,!1)}function U(){x()("text1IsBold",!m())}function ve(){const G=(g.indexOf(p())+1)%g.length;x()("text1Align",g[G])}function Se(k){x()("text1Color",k)}function xe(k){x()("text1HighlightColor",k===c()?"transparent":k)}function W(k){x()("text1QuoteStyle",k)}function ne(k){I(L,k)}function P(k){x()(k,T[k])}We();var q=lo(),ie=f(q),_e=f(ie);Pa(_e),u(ie);var Pe=l(ie,2),Ie=l(f(Pe),2),De=f(Ie),Je=f(De);Ht(),u(De);var Ue=l(De,2);{var Qe=k=>{var G=to();ft(G,5,()=>Ta,mt,(K,le)=>{var ce=eo();let ge;var Re=f(ce,!0);u(ce),$(()=>{ge=de(ce,1,"font-option svelte-fspusj",null,ge,{selected:n()===a(le)}),Ce(ce,`font-family: '${a(le)??""}'`),Ze(Re,a(le)==="Inter"?"Inter (Default)":a(le))}),s("click",ce,()=>A(a(le))),D(K,ce)}),u(G),D(k,G)};ee(Ue,k=>{a(O)&&k(Qe)})}u(Ie),bt(Ie,k=>I(Q,k),()=>a(Q));var Ae=l(Ie,2);let ze;var Ve=l(Ae,2),Ke=f(Ve);u(Ve),u(Pe);var $e=l(Pe,2),Ee=f($e);let at;var Le=l(Ee,2);let be;var Ye=l(Le,2);let qe;u($e);var R=l($e,2),j=f(R),te=f(j);{var ue=k=>{var G=ao();ct(G),se(G,"min",1),se(G,"max",9),$(()=>rt(G,i())),s("input",G,K=>x()("text1Size",Number(K.target.value))),D(k,G)},he=k=>{var G=ut(),K=Ge(G);{var le=ge=>{var Re=no();ct(Re),se(Re,"min",0),se(Re,"max",10),$(()=>rt(Re,r())),s("input",Re,Te=>x()("text1YPosition",Number(Te.target.value))),D(ge,Re)},ce=ge=>{var Re=ut(),Te=Ge(Re);{var nt=Oe=>{var je=io();ct(je),se(je,"min",1),se(je,"max",10),$(()=>rt(je,d())),s("input",je,lt=>x()("text1LineSpacing",Number(lt.target.value))),D(Oe,je)};ee(Te,Oe=>{a(S)==="linespacing"&&Oe(nt)},!0)}D(ge,Re)};ee(K,ge=>{a(S)==="position"?ge(le):ge(ce,!1)},!0)}D(k,G)};ee(te,k=>{a(S)==="size"?k(ue):k(he,!1)})}u(j);var Fe=l(j,2);u(R);var ke=l(R,2),ye=f(ke),z=f(ye);let oe;var fe=l(z,2);let E;u(ye);var ae=l(ye,2);{var we=k=>{Et(k,{get colors(){return _},get value(){return v()},onChange:Se,showRainbow:!0})},re=k=>{Et(k,{get colors(){return B},get value(){return c()},onChange:xe,showRainbow:!0})};ee(ae,k=>{a(L)==="text"?k(we):k(re,!1)})}u(ke);var w=l(ke,2),M=l(f(w),2);ft(M,5,()=>y,mt,(k,G)=>{var K=oo();let le;var ce=f(K);u(K),$(()=>{le=de(K,1,"style-btn svelte-fspusj",null,le,{active:C()===a(G).id,"is-none":a(G).id==="none"}),se(K,"aria-label",(a(G),h(()=>a(G).label))),se(ce,"src",(a(G),h(()=>a(G).icon)))}),s("click",K,()=>W(a(G).id)),D(k,K)}),u(M),u(w);var X=l(w,2);{var Y=k=>{var G=ro(),K=l(f(G),2),le=f(K);ct(le),se(le,"min",1),se(le,"max",5),u(K);var ce=l(K,2);u(G),$(()=>rt(le,F())),s("input",le,ge=>x()("text1QuoteSize",Number(ge.target.value))),s("click",ce,()=>P("text1QuoteSize")),D(k,G)};ee(X,k=>{C()!=="none"&&k(Y)})}u(q),$(()=>{rt(_e,e()),Ce(De,`font-family: '${n()??""}'`),Ze(Je,`${(n()==="Inter"?"Inter (Default)":n())??""} `),ze=de(Ae,1,"icon-btn svelte-fspusj",null,ze,{active:m()}),se(Ve,"aria-label",`Align ${p()??""}`),se(Ke,"src",`/icons/icon-align-${p()??""}.svg`),at=de(Ee,1,"slider-tab svelte-fspusj",null,at,{active:a(S)==="size"}),be=de(Le,1,"slider-tab svelte-fspusj",null,be,{active:a(S)==="position"}),qe=de(Ye,1,"slider-tab svelte-fspusj",null,qe,{active:a(S)==="linespacing"}),oe=de(z,1,"color-tab svelte-fspusj",null,oe,{active:a(L)==="text"}),E=de(fe,1,"color-tab svelte-fspusj",null,E,{active:a(L)==="highlight"})}),s("input",_e,H),s("click",De,()=>I(O,!a(O))),s("click",Ae,U),s("click",Ve,ve),s("click",Ee,()=>I(S,"size")),s("click",Le,()=>I(S,"position")),s("click",Ye,()=>I(S,"linespacing")),s("click",Fe,()=>{a(S)==="size"?P("text1Size"):a(S)==="position"?P("text1YPosition"):a(S)==="linespacing"&&P("text1LineSpacing")}),s("click",z,()=>ne("text")),s("click",fe,()=>ne("highlight")),D(o,q),He()}var co=N("<button> </button>"),vo=N('<div class="font-dropdown-menu svelte-n6z268"></div>'),uo=N('<input type="range" class="inline-slider svelte-n6z268"/>'),go=N('<input type="range" class="inline-slider svelte-n6z268"/>'),ho=N('<input type="range" class="inline-slider svelte-n6z268"/>'),fo=N('<div class="text2-controls svelte-n6z268"><div class="text-input-container svelte-n6z268"><textarea class="text-input svelte-n6z268" placeholder="Add text (with ==highlights==)"></textarea></div> <div class="font-row svelte-n6z268"><span class="row-label svelte-n6z268">Font</span> <div class="font-dropdown-wrapper svelte-n6z268"><button class="font-dropdown-trigger svelte-n6z268"> <span class="dropdown-arrow svelte-n6z268">â¾</span></button> <!></div> <button aria-label="Bold"><img src="/icons/icon-bold.svg" alt="" class="btn-icon svelte-n6z268"/></button> <button class="icon-btn svelte-n6z268"><img alt="" class="btn-icon svelte-n6z268"/></button></div> <div class="slider-tabs svelte-n6z268"><button>Size</button> <button>Position</button> <button>Line spacing</button></div> <div class="slider-row svelte-n6z268"><div class="slider-wrapper svelte-n6z268"><!></div> <button class="reset-btn svelte-n6z268" aria-label="Reset slider"><img src="/icons/icon-reset.svg" alt="" class="reset-icon svelte-n6z268"/></button></div> <div class="color-section svelte-n6z268"><div class="color-mode-tabs svelte-n6z268"><button>Text colour</button> <button>Highlight colour</button></div> <!></div></div>');function bo(o,t){Ne(t,!1);let e=b(t,"text2",8,""),n=b(t,"text2Font",8,"Inter"),i=b(t,"text2Size",8,3),r=b(t,"text2YPosition",8,8),d=b(t,"text2LineSpacing",8,5),v=b(t,"text2Color",8,"#000000"),c=b(t,"text2LabelColor",8,"transparent"),m=b(t,"text2IsBold",8,!1),p=b(t,"text2Align",8,"center"),C=b(t,"onChange",8,(E,ae)=>{});const F=Rt.solids,x=["#FFD700","#000000","#007C1F","#00679D","#B20715"],_=["left","center","right"],B={text2Size:2,text2YPosition:8,text2LineSpacing:3};let g=J(!1),y=J();function T(E){a(y)&&!a(y).contains(E.target)&&I(g,!1)}Lt(()=>{document.addEventListener("click",T)}),na(()=>{document.removeEventListener("click",T)});function L(E){C()("text2",E.target.value)}function S(E){C()("text2Font",E),C()("text2IsBold",E==="Inter"),I(g,!1)}function O(){C()("text2IsBold",!m())}function Q(){const ae=(_.indexOf(p())+1)%_.length;C()("text2Align",_[ae])}function Z(E){C()("text2Color",E)}function H(E){C()("text2LabelColor",E===c()?"transparent":E)}let A=J("text"),U=J("size");function ve(E){I(A,E)}function Se(E){C()(E,B[E])}We();var xe=fo(),W=f(xe),ne=f(W);Pa(ne),u(W);var P=l(W,2),q=l(f(P),2),ie=f(q),_e=f(ie);Ht(),u(ie);var Pe=l(ie,2);{var Ie=E=>{var ae=vo();ft(ae,5,()=>Ta,mt,(we,re)=>{var w=co();let M;var X=f(w,!0);u(w),$(()=>{M=de(w,1,"font-option svelte-n6z268",null,M,{selected:n()===a(re)}),Ce(w,`font-family: '${a(re)??""}'`),Ze(X,a(re)==="Inter"?"Inter (Default)":a(re))}),s("click",w,()=>S(a(re))),D(we,w)}),u(ae),D(E,ae)};ee(Pe,E=>{a(g)&&E(Ie)})}u(q),bt(q,E=>I(y,E),()=>a(y));var De=l(q,2);let Je;var Ue=l(De,2),Qe=f(Ue);u(Ue),u(P);var Ae=l(P,2),ze=f(Ae);let Ve;var Ke=l(ze,2);let $e;var Ee=l(Ke,2);let at;u(Ae);var Le=l(Ae,2),be=f(Le),Ye=f(be);{var qe=E=>{var ae=uo();ct(ae),se(ae,"min",1),se(ae,"max",10),$(()=>rt(ae,i())),s("input",ae,we=>C()("text2Size",Number(we.target.value))),D(E,ae)},R=E=>{var ae=ut(),we=Ge(ae);{var re=M=>{var X=go();ct(X),se(X,"min",0),se(X,"max",10),$(()=>rt(X,r())),s("input",X,Y=>C()("text2YPosition",Number(Y.target.value))),D(M,X)},w=M=>{var X=ut(),Y=Ge(X);{var k=G=>{var K=ho();ct(K),se(K,"min",1),se(K,"max",10),$(()=>rt(K,d())),s("input",K,le=>C()("text2LineSpacing",Number(le.target.value))),D(G,K)};ee(Y,G=>{a(U)==="linespacing"&&G(k)},!0)}D(M,X)};ee(we,M=>{a(U)==="position"?M(re):M(w,!1)},!0)}D(E,ae)};ee(Ye,E=>{a(U)==="size"?E(qe):E(R,!1)})}u(be);var j=l(be,2);u(Le);var te=l(Le,2),ue=f(te),he=f(ue);let Fe;var ke=l(he,2);let ye;u(ue);var z=l(ue,2);{var oe=E=>{Et(E,{get colors(){return F},get value(){return v()},onChange:Z,showRainbow:!0})},fe=E=>{Et(E,{get colors(){return x},get value(){return c()},onChange:H,showRainbow:!0})};ee(z,E=>{a(A)==="text"?E(oe):E(fe,!1)})}u(te),u(xe),$(()=>{rt(ne,e()),Ce(ie,`font-family: '${n()??""}'`),Ze(_e,`${(n()==="Inter"?"Inter (Default)":n())??""} `),Je=de(De,1,"icon-btn svelte-n6z268",null,Je,{active:m()}),se(Ue,"aria-label",`Align ${p()??""}`),se(Qe,"src",`/icons/icon-align-${p()??""}.svg`),Ve=de(ze,1,"slider-tab svelte-n6z268",null,Ve,{active:a(U)==="size"}),$e=de(Ke,1,"slider-tab svelte-n6z268",null,$e,{active:a(U)==="position"}),at=de(Ee,1,"slider-tab svelte-n6z268",null,at,{active:a(U)==="linespacing"}),Fe=de(he,1,"color-tab svelte-n6z268",null,Fe,{active:a(A)==="text"}),ye=de(ke,1,"color-tab svelte-n6z268",null,ye,{active:a(A)==="highlight"})}),s("input",ne,L),s("click",ie,()=>I(g,!a(g))),s("click",De,O),s("click",Ue,Q),s("click",ze,()=>I(U,"size")),s("click",Ke,()=>I(U,"position")),s("click",Ee,()=>I(U,"linespacing")),s("click",j,()=>{a(U)==="size"?Se("text2Size"):a(U)==="position"?Se("text2YPosition"):a(U)==="linespacing"&&Se("text2LineSpacing")}),s("click",he,()=>ve("text")),s("click",ke,()=>ve("highlight")),D(o,xe),He()}var mo=N('<div class="import-box svelte-qirtgp" role="button" tabindex="0"><label class="import-area svelte-qirtgp"><input type="file" accept="image/*" class="file-input svelte-qirtgp"/> <img src="/icons/icon-upload.svg" alt="" class="upload-icon svelte-qirtgp"/> <span class="import-text svelte-qirtgp">Import, drag or<br/>paste an image</span></label> <button class="paste-btn svelte-qirtgp">Paste</button></div>'),po=N('<div class="slider-row svelte-qirtgp"><span class="row-label svelte-qirtgp">Zoom</span> <div class="slider-wrapper svelte-qirtgp"><input type="range" class="inline-slider svelte-qirtgp"/></div> <button class="reset-btn svelte-qirtgp" aria-label="Reset zoom"><img src="/icons/icon-reset.svg" alt="" class="reset-icon svelte-qirtgp"/></button></div> <div class="nudge-row svelte-qirtgp"><button class="nudge-btn svelte-qirtgp" aria-label="Nudge up"><img src="/icons/icon-nudge-up.svg" alt="" class="nudge-icon svelte-qirtgp"/></button> <button class="nudge-btn svelte-qirtgp" aria-label="Nudge down"><img src="/icons/icon-nudge-down.svg" alt="" class="nudge-icon svelte-qirtgp"/></button> <button class="nudge-btn svelte-qirtgp" aria-label="Nudge left"><img src="/icons/icon-nudge-left.svg" alt="" class="nudge-icon svelte-qirtgp"/></button> <button class="nudge-btn svelte-qirtgp" aria-label="Nudge right"><img src="/icons/icon-nudge-right.svg" alt="" class="nudge-icon svelte-qirtgp"/></button></div>',1),xo=N('<div class="control-row fit-fill-row svelte-qirtgp"><div class="button-group svelte-qirtgp"><span class="row-label svelte-qirtgp">Fit & Fill</span> <button class="icon-btn svelte-qirtgp" title="Fit image to canvas" aria-label="Fit"><img src="/icons/icon-fit.svg" alt="Fit" class="control-icon svelte-qirtgp"/></button> <button class="icon-btn svelte-qirtgp" title="Fill canvas with image" aria-label="Fill"><img src="/icons/icon-fill.svg" alt="Fill" class="control-icon svelte-qirtgp"/></button></div> <div class="button-group right-group svelte-qirtgp"><span class="row-label svelte-qirtgp">Layers</span> <button title="Image on front layer" aria-label="Front"><img src="/icons/icon-layer-above.svg" alt="Front" class="layer-icon svelte-qirtgp"/></button> <button title="Image on back layer" aria-label="Back"><img src="/icons/icon-layer-below.svg" alt="Back" class="layer-icon svelte-qirtgp"/></button></div></div> <div class="slider-row svelte-qirtgp"><span class="row-label svelte-qirtgp">Opacity</span> <div class="slider-wrapper svelte-qirtgp"><input type="range" class="inline-slider svelte-qirtgp"/></div> <button class="reset-btn svelte-qirtgp" aria-label="Reset opacity"><img src="/icons/icon-reset.svg" alt="" class="reset-icon svelte-qirtgp"/></button></div> <div class="slider-row svelte-qirtgp"><span class="row-label svelte-qirtgp">Border</span> <div class="slider-wrapper svelte-qirtgp"><input type="range" class="inline-slider svelte-qirtgp"/></div> <button class="reset-btn svelte-qirtgp" aria-label="Reset border"><img src="/icons/icon-reset.svg" alt="" class="reset-icon svelte-qirtgp"/></button></div> <div class="color-row svelte-qirtgp"><span class="row-label svelte-qirtgp">Colour</span> <div class="color-buttons svelte-qirtgp"><!></div></div> <div class="mask-row svelte-qirtgp"><span class="row-label svelte-qirtgp">Mask</span> <div class="mask-buttons svelte-qirtgp"><button aria-label="No mask"><img src="/icons/icon-none.svg" alt="" class="mask-icon svelte-qirtgp"/></button> <button aria-label="Rounded mask"><img src="/icons/icon-square.svg" alt="" class="mask-icon svelte-qirtgp"/></button> <button aria-label="Circle mask"><div class="circle-icon svelte-qirtgp"></div></button> <button aria-label="Diamond mask"><div class="diamond-icon svelte-qirtgp"></div></button></div></div> <!>',1),wo=N('<div class="overlay-controls svelte-qirtgp"><!></div>');function yo(o,t){Ne(t,!1);let e=b(t,"overlay",8,null);b(t,"overlaySize",8,50);let n=b(t,"overlayOpacity",8,100),i=b(t,"overlayMask",8,"none"),r=b(t,"overlayLayer",8,"above"),d=b(t,"overlayBorderWidth",8,0),v=b(t,"overlayBorderColor",8,"#FFFFFF"),c=b(t,"overlayZoom",8,100),m=b(t,"overlayImageOffsetX",8,0),p=b(t,"overlayImageOffsetY",8,0),C=b(t,"overlayNaturalWidth",8,0),F=b(t,"overlayNaturalHeight",8,0),x=b(t,"getCanvasDimensions",8,()=>({width:300,height:300})),_=b(t,"onChange",8,(W,ne)=>{});const B=Rt.solids,g=[0,1,2,3],y=2;function T(){if(!C()||!F())return 50;const{width:W,height:ne}=x()(),P=C()/F(),q=W/ne;return P>q?100:Math.min(100,ne/W*100)}function L(){if(!C()||!F())return 100;const{width:W,height:ne}=x()(),P=C()/F(),q=P>=1?W:W*P,ie=P>=1?W/P:W;return 100*Math.max(W/q,ne/ie)+.5}function S(W){const ne=W.target.files?.[0];if(ne&&ne.type.startsWith("image/")){const P=new FileReader;P.onload=q=>{_()("overlay",q.target.result)},P.readAsDataURL(ne)}W.target.value=""}function O(W){W.preventDefault();const ne=W.dataTransfer?.files?.[0];if(ne&&ne.type.startsWith("image/")){const P=new FileReader;P.onload=q=>{_()("overlay",q.target.result)},P.readAsDataURL(ne)}}function Q(W){W.preventDefault()}async function Z(){try{const W=await navigator.clipboard.read();for(const ne of W){const P=ne.types.find(q=>q.startsWith("image/"));if(P){const q=await ne.getType(P),ie=new FileReader;ie.onload=_e=>{_()("overlay",_e.target.result)},ie.readAsDataURL(q);return}}}catch(W){console.error("Paste failed:",W)}}function H(W){const ne=g.reduce((P,q)=>Math.abs(q-W)<Math.abs(P-W)?q:P);_()("overlayBorderWidth",ne)}function A(W){let ne=m(),P=p();switch(W){case"up":P=p()-y;break;case"down":P=p()+y;break;case"left":ne=m()-y;break;case"right":ne=m()+y;break}_()("overlayImageOffsetX",ne),_()("overlayImageOffsetY",P)}We();var U=wo(),ve=f(U);{var Se=W=>{var ne=mo(),P=f(ne),q=f(P);Ht(4),u(P);var ie=l(P,2);u(ne),s("change",q,S),s("click",ie,Z),s("drop",ne,O),s("dragover",ne,Q),D(W,ne)},xe=W=>{var ne=xo(),P=Ge(ne),q=f(P),ie=l(f(q),2),_e=l(ie,2);u(q);var Pe=l(q,2),Ie=l(f(Pe),2);let De;var Je=l(Ie,2);let Ue;u(Pe),u(P);var Qe=l(P,2),Ae=l(f(Qe),2),ze=f(Ae);ct(ze),se(ze,"min",0),se(ze,"max",100),u(Ae);var Ve=l(Ae,2);u(Qe);var Ke=l(Qe,2),$e=l(f(Ke),2),Ee=f($e);ct(Ee),se(Ee,"min",0),se(Ee,"max",3),se(Ee,"step",1),u($e);var at=l($e,2);u(Ke);var Le=l(Ke,2),be=l(f(Le),2),Ye=f(be);Et(Ye,{get colors(){return B},get value(){return v()},onChange:E=>_()("overlayBorderColor",E),showRainbow:!0}),u(be),u(Le);var qe=l(Le,2),R=l(f(qe),2),j=f(R);let te;var ue=l(j,2);let he;var Fe=l(ue,2);let ke;var ye=l(Fe,2);let z;u(R),u(qe);var oe=l(qe,2);{var fe=E=>{var ae=po(),we=Ge(ae),re=l(f(we),2),w=f(re);ct(w),se(w,"min",100),se(w,"max",300),u(re);var M=l(re,2);u(we);var X=l(we,2),Y=f(X),k=l(Y,2),G=l(k,2),K=l(G,2);u(X),$(()=>rt(w,c())),s("input",w,le=>_()("overlayZoom",Number(le.target.value))),s("click",M,()=>_()("overlayZoom",100)),s("click",Y,()=>A("up")),s("click",k,()=>A("down")),s("click",G,()=>A("left")),s("click",K,()=>A("right")),D(E,ae)};ee(oe,E=>{i()!=="none"&&E(fe)})}$(()=>{De=de(Ie,1,"layer-btn svelte-qirtgp",null,De,{active:r()==="above"}),Ue=de(Je,1,"layer-btn svelte-qirtgp",null,Ue,{active:r()==="below"}),rt(ze,n()),rt(Ee,d()),te=de(j,1,"mask-btn svelte-qirtgp",null,te,{active:i()==="none"}),he=de(ue,1,"mask-btn svelte-qirtgp",null,he,{active:i()==="rounded"}),ke=de(Fe,1,"mask-btn svelte-qirtgp",null,ke,{active:i()==="circle"}),z=de(ye,1,"mask-btn svelte-qirtgp",null,z,{active:i()==="diamond"})}),s("click",ie,()=>_()("overlaySize",T())),s("click",_e,()=>_()("overlaySize",L())),s("click",Ie,()=>_()("overlayLayer","above")),s("click",Je,()=>_()("overlayLayer","below")),s("input",ze,E=>_()("overlayOpacity",Number(E.target.value))),s("click",Ve,()=>_()("overlayOpacity",100)),s("input",Ee,E=>H(Number(E.target.value))),s("click",at,()=>_()("overlayBorderWidth",0)),s("click",j,()=>_()("overlayMask","none")),s("click",ue,()=>_()("overlayMask","rounded")),s("click",Fe,()=>_()("overlayMask","circle")),s("click",ye,()=>_()("overlayMask","diamond")),D(W,ne)};ee(ve,W=>{e()?W(xe,!1):W(Se)})}u(U),D(o,U),He()}const _o=[{id:1,name:"Quote Card",state:{canvasSize:"1/1",background:{type:"solid",value:"#FFFFFF",direction:"down",gradientColors:["#5422b0","#4B0082"]},text1:"Add your quote here",text1Font:"Playfair Display",text1Size:7,text1YPosition:4,text1LineSpacing:5,text1Color:"#000000",text1HighlightColor:"transparent",text1IsBold:!0,text1Align:"center",text1QuoteStyle:"serif",text1QuoteSize:5,text2:"Attribution",text2Font:"Inter",text2Size:3,text2YPosition:85,text2LineSpacing:5,text2Color:"#555555",text2LabelColor:"transparent",text2IsBold:!1,text2Align:"center",overlay:null,overlaySize:50,overlayOpacity:100,overlayX:50,overlayY:50,overlayMask:"none",overlayLayer:"above",overlayBorderWidth:0,overlayBorderColor:"#FFFFFF",overlayNaturalWidth:0,overlayNaturalHeight:0}},{id:2,name:"News Banner",state:{canvasSize:"16/9",background:{type:"solid",value:"#5422b0",direction:"down",gradientColors:["#5422b0","#4B0082"]},text1:"Headline Goes Here",text1Font:"Saira Condensed",text1Size:8,text1YPosition:3,text1LineSpacing:5,text1Color:"#FFFFFF",text1HighlightColor:"#FFD700",text1IsBold:!0,text1Align:"left",text1QuoteStyle:"none",text1QuoteSize:5,text2:"Publication Name",text2Font:"Inter",text2Size:2,text2YPosition:92,text2LineSpacing:5,text2Color:"#FFFFFF",text2LabelColor:"transparent",text2IsBold:!1,text2Align:"left",overlay:null,overlaySize:50,overlayOpacity:100,overlayX:50,overlayY:50,overlayMask:"none",overlayLayer:"above",overlayBorderWidth:0,overlayBorderColor:"#FFFFFF",overlayNaturalWidth:0,overlayNaturalHeight:0}},{id:3,name:"Simple quote",state:{canvasSize:"1/1",background:{type:"gradient",value:"linear-gradient(to bottom, #5422b0 0%, #4B0082 100%)",direction:"down",gradientColors:["#5422b0","#4B0082"]},text1:`Judge a man by 
his ==questions== rather than by 
his ==answers==`,text1Font:"Inter",text1Size:5,text1YPosition:5,text1LineSpacing:2,text1Color:"#FFFFFF",text1HighlightColor:"#FFD700",text1IsBold:!0,text1Align:"center",text1QuoteStyle:"serif",text1QuoteSize:5,text2:"Voltaire",text2Font:"Roboto Slab",text2Size:2,text2YPosition:8,text2LineSpacing:5,text2Color:"#FFFFFF",text2LabelColor:"transparent",text2IsBold:!1,text2Align:"center",overlay:null,overlaySize:50,overlayOpacity:100,overlayX:50,overlayY:50,overlayMask:"none",overlayLayer:"above",overlayBorderWidth:0,overlayBorderColor:"#FFFFFF",overlayNaturalWidth:0,overlayNaturalHeight:0}},{id:4,name:"template-4",state:{canvasSize:"1/1",background:{type:"gradient",value:"linear-gradient(to bottom, #5422b0 0%, #4B0082 100%)",direction:"down",gradientColors:["#5422b0","#4B0082"]},text1:`Judge a man by 
his ==questions== rather than by 
his ==answers==`,text1Font:"Inter",text1Size:5,text1YPosition:5,text1LineSpacing:2,text1Color:"#FFFFFF",text1HighlightColor:"#FFD700",text1IsBold:!0,text1Align:"center",text1QuoteStyle:"serif",text1QuoteSize:5,text2:"Voltaire",text2Font:"Roboto Slab",text2Size:2,text2YPosition:8,text2LineSpacing:5,text2Color:"#FFFFFF",text2LabelColor:"transparent",text2IsBold:!1,text2Align:"center",overlay:null,overlaySize:50,overlayOpacity:100,overlayX:50,overlayY:50,overlayMask:"none",overlayLayer:"above",overlayBorderWidth:0,overlayBorderColor:"#FFFFFF",overlayNaturalWidth:0,overlayNaturalHeight:0}}],It={templates:_o};var ko=N('<button class="template-card svelte-fxk5n4"><div class="template-placeholder svelte-fxk5n4"> </div></button>'),Co=N('<div class="template-picker svelte-fxk5n4"><p class="picker-title svelte-fxk5n4">Create quotes & cards with<br/>a template or blank canvas</p> <button class="blank-canvas-btn svelte-fxk5n4"><img src="/icons/icon-add.svg" alt="" class="add-icon svelte-fxk5n4"/></button> <div class="template-grid svelte-fxk5n4"></div></div>'),So=N('<div class="canvas-quote svelte-fxk5n4">&#8220;</div>'),Io=N('<div class="text1-flow-container svelte-fxk5n4"><!> <div class="canvas-text text1 svelte-fxk5n4"><!></div></div>'),zo=N('<div class="canvas-text text2 svelte-fxk5n4"><!></div>'),Fo=N('<div role="button" tabindex="0"><div><button class="delete-btn svelte-fxk5n4" aria-label="Delete image"><img src="/icons/icon-close.svg" alt="" class="delete-icon svelte-fxk5n4"/></button> <button class="resize-handle svelte-fxk5n4" aria-label="Resize image"><img src="/icons/icon-resize.svg" alt="" class="resize-icon svelte-fxk5n4"/></button> <div><img alt="Overlay" class="overlay-image svelte-fxk5n4" draggable="false"/></div></div></div>'),Bo=N('<div class="admin-footer svelte-fxk5n4"><button class="save-template-btn svelte-fxk5n4">ð¾ Save as Template</button></div>'),Ro=N('<!> <div class="canvas-container svelte-fxk5n4"><div class="design-canvas svelte-fxk5n4" role="button" tabindex="0"><!> <!> <!></div></div> <!> <div class="controls-panel svelte-fxk5n4"><!></div> <!>',1),Eo=N('<div class="design-tab svelte-fxk5n4"><!></div>');function Po(o,t){Ne(t,!1);const e=()=>vt(Xe,"$slideState",r),n=()=>vt(ea,"$showTemplatePicker",r),i=()=>vt(ht,"$activeDesignMenu",r),[r,d]=Pt(),v=J();let c=J(),m=J(300),p=300,C=300,F,x=!1,_=0,B=0,g=0,y=0,T=!1,L=0,S=0,O=0,Q=0;Lt(()=>{a(c)&&(F=new ResizeObserver(([R])=>{const{width:j,height:te}=R.contentRect;p=j,C=te,I(m,Math.min(j,te))}),F.observe(a(c)))}),na(()=>{F&&F.disconnect()});const Z=[{id:"size",label:"Size"},{id:"background",label:"Background"},{id:"text1",label:"Text 1"},{id:"text2",label:"Text 2"},{id:"image",label:"Image"}];function H(R){if(R==="blank")Xe.reset();else{const j=It.templates.find(te=>te.id===R);j&&Xe.set(JSON.parse(JSON.stringify(j.state)))}ea.set(!1),ht.set("size")}function A(){const R=prompt("Template name:",`template-${It.templates.length+1}`);if(!R)return;let j=0;It.templates.forEach(ye=>{ye.id>j&&(j=ye.id)});const te={id:j+1,name:R,state:JSON.parse(JSON.stringify(e()))};It.templates.push(te);const ue=JSON.stringify(It,null,2),he=new Blob([ue],{type:"application/json"}),Fe=URL.createObjectURL(he),ke=document.createElement("a");ke.href=Fe,ke.download="templates.json",ke.click(),URL.revokeObjectURL(Fe),alert(`Template "${R}" exported. Replace /src/lib/data/templates.json with the downloaded file.`)}function U(R){ht.set(R)}async function ve(){}function Se(){}function xe(R){Xe.update(j=>({...j,canvasSize:R}))}function W(R){Xe.update(j=>({...j,background:R}))}function ne(R,j){Xe.update(te=>({...te,[R]:j}))}function P(R,j){Xe.update(te=>({...te,[R]:j}))}function q(){if(a(c)){const R=a(c).getBoundingClientRect();return{width:R.width,height:R.height}}return{width:p,height:C}}function ie(R,j){if(R==="overlay"&&j){const te=new Image;te.onload=()=>{Xe.update(ue=>({...ue,overlay:j,overlayNaturalWidth:te.naturalWidth,overlayNaturalHeight:te.naturalHeight,overlayX:50,overlayY:50})),ht.set("image")},te.src=j}else R==="overlayLayer"?(Xe.update(te=>({...te,[R]:j})),ht.set("none")):R==="overlayMask"?Xe.update(te=>{const ue={...te,[R]:j};return j==="none"&&(ue.overlayZoom=100,ue.overlayImageOffsetX=0,ue.overlayImageOffsetY=0),ue}):Xe.update(te=>({...te,[R]:j}))}function _e(){Xe.update(R=>({...R,overlay:null,overlayNaturalWidth:0,overlayNaturalHeight:0,overlaySize:50,overlayOpacity:100,overlayX:50,overlayY:50,overlayMask:"none",overlayLayer:"above",overlayBorderWidth:0,overlayBorderColor:"#FFFFFF",overlayZoom:100,overlayImageOffsetX:0,overlayImageOffsetY:0})),ht.set("none")}function Pe(R){if(R.target.closest(".delete-btn")||R.target.closest(".resize-handle")||R.touches&&R.touches.length>1)return;R.preventDefault(),x=!0;const j=R.touches?.[0]||R;_=j.clientX,B=j.clientY,g=e().overlayX,y=e().overlayY,window.addEventListener("mousemove",Ie),window.addEventListener("mouseup",De),window.addEventListener("touchmove",Ie,{passive:!1}),window.addEventListener("touchend",De)}function Ie(R){if(!x)return;R.preventDefault();const j=R.touches?.[0]||R,te=j.clientX-_,ue=j.clientY-B,he=te/p*100,Fe=ue/C*100,ke=Math.max(0,Math.min(100,g+he)),ye=Math.max(0,Math.min(100,y+Fe));Xe.update(z=>({...z,overlayX:ke,overlayY:ye}))}function De(){x=!1,window.removeEventListener("mousemove",Ie),window.removeEventListener("mouseup",De),window.removeEventListener("touchmove",Ie),window.removeEventListener("touchend",De)}function Je(R){R.preventDefault(),R.stopPropagation(),T=!0,L=R.touches?.[0].clientX||R.clientX,S=R.touches?.[0].clientY||R.clientY,O=e().overlaySize,window.addEventListener("mousemove",Ue),window.addEventListener("mouseup",Qe),window.addEventListener("touchmove",Ue,{passive:!1}),window.addEventListener("touchend",Qe)}function Ue(R){if(!T)return;R.preventDefault();const j=R.touches?.[0].clientX||R.clientX,te=R.touches?.[0].clientY||R.clientY,ue=j-L,he=te-S,ke=Math.max(ue,he)/a(m)*100,ye=Math.max(10,Math.min(200,O+ke));Xe.update(z=>({...z,overlaySize:ye}))}function Qe(){T=!1,window.removeEventListener("mousemove",Ue),window.removeEventListener("mouseup",Qe),window.removeEventListener("touchmove",Ue),window.removeEventListener("touchend",Qe)}function Ae(R){if(R.length<2)return 0;const j=R[0].clientX-R[1].clientX,te=R[0].clientY-R[1].clientY;return Math.sqrt(j*j+te*te)}function ze(R){R.touches.length===2&&(R.preventDefault(),Q=Ae(R.touches))}function Ve(R){if(R.touches.length===2&&Q>0){R.preventDefault();const j=Ae(R.touches),ue=(j-Q)/a(m)*50,he=Math.max(10,Math.min(200,e().overlaySize+ue));Xe.update(Fe=>({...Fe,overlaySize:he})),Q=j}}function Ke(R){R.touches.length<2&&(Q=0)}function $e(R){if(R.ctrlKey){R.preventDefault();const j=-R.deltaY*.5,te=Math.max(10,Math.min(200,e().overlaySize+j));Xe.update(ue=>({...ue,overlaySize:te}))}}function Ee(R){const j=R.target;j.closest(".overlay-wrapper")?ht.set("image"):j.closest(".text1-flow-container")?ht.set("text1"):j.closest(".canvas-text.text2")?ht.set("text2"):j.closest(".canvas-quote")&&ht.set("text1")}function at(R){if(!R.overlay||!R.overlayNaturalWidth)return null;const j=R.overlaySize/100*100;if(R.overlayMask==="circle"||R.overlayMask==="diamond")return{width:j,height:j};const te=R.overlayNaturalWidth/R.overlayNaturalHeight;let ue,he;return te>=1?(ue=j,he=j/te):(he=j,ue=j*te),{width:ue,height:he}}et(()=>e(),()=>{}),et(()=>e(),()=>{I(v,at(e()))}),yt(),We();var Le=Eo(),be=f(Le);{var Ye=R=>{var j=Co(),te=l(f(j),2),ue=l(te,2);ft(ue,5,()=>(Be(It),h(()=>It.templates)),he=>he.id,(he,Fe)=>{var ke=ko(),ye=f(ke),z=f(ye,!0);u(ye),u(ke),$(()=>Ze(z,(a(Fe),h(()=>a(Fe).name)))),s("click",ke,()=>H(a(Fe).id)),D(he,ke)}),u(ue),u(j),s("click",te,()=>H("blank")),D(R,j)},qe=R=>{var j=Ro(),te=Ge(j);{let Y=tt(()=>(Be(Xe),h(()=>Xe.canUndo()))),k=tt(()=>(Be(Xe),h(()=>Xe.canRedo())));oa(te,{get canUndo(){return a(Y)},get canRedo(){return a(k)},onUndo:()=>Xe.undo(),onRedo:()=>Xe.redo(),get onStartAgain(){return Ji},onCopy:ve,onExport:Se})}var ue=l(te,2),he=f(ue),Fe=f(he);{var ke=Y=>{const k=tt(()=>(a(m),e(),h(()=>a(m)*.072*e().text1Size/5))),G=tt(()=>(Be(a(k)),e(),h(()=>a(k)*(1+e().text1LineSpacing*.1)))),K=tt(()=>(a(m),e(),h(()=>a(m)*.133*e().text1QuoteSize))),le=tt(()=>(e(),h(()=>e().text1QuoteStyle==="slab"))),ce=tt(()=>a(G)*(a(le)?-.03:.2)),ge=tt(()=>a(K)*(a(le)?.6:.5)),Re=tt(()=>a(ce)-a(ge)),Te=tt(()=>(e(),h(()=>e().text1YPosition*10)));var nt=Io(),Oe=f(nt);{var je=me=>{var Me=So();$(()=>Ce(Me,`
									text-align: ${e(),h(()=>e().text1Align)??""};
									font-family: ${a(le)?'"Alfa Slab One", cursive':'"Playfair Display", serif'};
									font-size: ${a(K)??""}px;
									font-weight: ${a(le)?"normal":"bold"};
									color: ${e(),h(()=>e().text1Color)??""};
									margin-bottom: ${a(Re)??""}px;
								`)),D(me,Me)};ee(Oe,me=>{e(),h(()=>e().text1QuoteStyle!=="none")&&me(je)})}var lt=l(Oe,2),V=f(lt);ha(V,()=>(e(),h(()=>e().text1.replace(/==(.+?)==/g,`<span style="color: ${e().text1HighlightColor};">$1</span>`).replace(/\n/g,"<br>")))),u(lt),u(nt),$(()=>{Ce(nt,`top: ${a(Te)??""}%;`),Ce(lt,`
								font-family: '${e(),h(()=>e().text1Font)??""}';
								font-size: ${e(),h(()=>e().text1Size*.36)??""}em;
								font-weight: ${e(),h(()=>e().text1IsBold?"bold":"normal")??""};
								color: ${e(),h(()=>e().text1Color)??""};
								text-align: ${e(),h(()=>e().text1Align)??""};
								line-height: ${e(),h(()=>1+e().text1LineSpacing*.1)??""};
							`)}),D(Y,nt)};ee(Fe,Y=>{e(),h(()=>e().text1)&&Y(ke)})}var ye=l(Fe,2);{var z=Y=>{var k=zo(),G=f(k);ha(G,()=>(e(),h(()=>e().text2.replace(/==(.+?)==/g,`<span style="color: ${e().text2LabelColor};">$1</span>`).replace(/\n/g,"<br>")))),u(k),$(()=>Ce(k,`
							font-family: '${e(),h(()=>e().text2Font)??""}';
							font-size: ${e(),h(()=>e().text2Size*.5)??""}em;
							font-weight: ${e(),h(()=>e().text2IsBold?"bold":"normal")??""};
							color: ${e(),h(()=>e().text2Color)??""};
							text-align: ${e(),h(()=>e().text2Align)??""};
							top: ${e(),h(()=>e().text2YPosition*10)??""}%;
							line-height: ${e(),h(()=>1+e().text2LineSpacing*.1)??""};
						`)),D(Y,k)};ee(ye,Y=>{e(),h(()=>e().text2)&&Y(z)})}var oe=l(ye,2);{var fe=Y=>{var k=Fo();let G;var K=f(k);let le;var ce=f(K),ge=l(ce,2),Re=l(ge,2);let Te;var nt=f(Re);u(Re),u(K),u(k),$(()=>{G=de(k,1,"overlay-wrapper svelte-fxk5n4",null,G,{active:i()==="image"}),Ce(k,`
							left: ${e(),h(()=>e().overlayX)??""}%;
							top: ${e(),h(()=>e().overlayY)??""}%;
							width: ${a(v),h(()=>a(v).width)??""}%;
							opacity: ${e(),h(()=>e().overlayOpacity/100)??""};
							z-index: ${i(),e(),h(()=>i()==="image"?11:e().overlayLayer==="below"?1:10)??""};
						`),le=de(K,1,"overlay-bounding-box svelte-fxk5n4",null,le,{"mask-none":e().overlayMask==="none","mask-rounded":e().overlayMask==="rounded","mask-circle":e().overlayMask==="circle","mask-diamond":e().overlayMask==="diamond"}),Ce(K,`
								border-width: ${e(),h(()=>e().overlayBorderWidth*2)??""}px;
								border-color: ${e(),h(()=>e().overlayBorderColor)??""};
							`),Te=de(Re,1,"overlay-image-container svelte-fxk5n4",null,Te,{"mask-rounded":e().overlayMask==="rounded","mask-circle":e().overlayMask==="circle","mask-diamond":e().overlayMask==="diamond"}),Ce(Re,`
									overflow: hidden;
									${e(),h(()=>e().overlayMask==="diamond"?`border: ${e().overlayBorderWidth*2}px solid ${e().overlayBorderColor};`:"")??""}
								`),se(nt,"src",(e(),h(()=>e().overlay))),Ce(nt,`
										transform: ${e(),h(()=>e().overlayMask==="diamond"?"rotate(-45deg) scale(1.414)":"")??""} translate(${e(),h(()=>e().overlayImageOffsetX)??""}%, ${e(),h(()=>e().overlayImageOffsetY)??""}%) scale(${e(),h(()=>e().overlayZoom/100)??""});
										transform-origin: center;
									`)}),s("click",ce,_e),s("mousedown",ge,Je),s("touchstart",ge,Je),s("mousedown",k,Pe),s("touchstart",k,ze),s("touchmove",k,Ve),s("touchend",k,Ke),s("wheel",k,$e),D(Y,k)};ee(oe,Y=>{e(),a(v),h(()=>e().overlay&&a(v))&&Y(fe)})}u(he),bt(he,Y=>I(c,Y),()=>a(c)),u(ue);var E=l(ue,2);ra(E,{get tabs(){return Z},get activeTab(){return i()},onTabChange:U});var ae=l(E,2),we=f(ae);{var re=Y=>{yo(Y,{get overlay(){return e(),h(()=>e().overlay)},get overlaySize(){return e(),h(()=>e().overlaySize)},get overlayOpacity(){return e(),h(()=>e().overlayOpacity)},get overlayMask(){return e(),h(()=>e().overlayMask)},get overlayLayer(){return e(),h(()=>e().overlayLayer)},get overlayBorderWidth(){return e(),h(()=>e().overlayBorderWidth)},get overlayBorderColor(){return e(),h(()=>e().overlayBorderColor)},get overlayZoom(){return e(),h(()=>e().overlayZoom)},get overlayImageOffsetX(){return e(),h(()=>e().overlayImageOffsetX)},get overlayImageOffsetY(){return e(),h(()=>e().overlayImageOffsetY)},get overlayNaturalWidth(){return e(),h(()=>e().overlayNaturalWidth)},get overlayNaturalHeight(){return e(),h(()=>e().overlayNaturalHeight)},getCanvasDimensions:q,onChange:ie,onDelete:_e})},w=Y=>{var k=ut(),G=Ge(k);{var K=ce=>{Wi(ce,{get canvasSize(){return e(),h(()=>e().canvasSize)},onSizeChange:xe})},le=ce=>{var ge=ut(),Re=Ge(ge);{var Te=Oe=>{$i(Oe,{get background(){return e(),h(()=>e().background)},onBackgroundChange:W})},nt=Oe=>{var je=ut(),lt=Ge(je);{var V=Me=>{so(Me,{get text1(){return e(),h(()=>e().text1)},get text1Font(){return e(),h(()=>e().text1Font)},get text1Size(){return e(),h(()=>e().text1Size)},get text1YPosition(){return e(),h(()=>e().text1YPosition)},get text1LineSpacing(){return e(),h(()=>e().text1LineSpacing)},get text1Color(){return e(),h(()=>e().text1Color)},get text1HighlightColor(){return e(),h(()=>e().text1HighlightColor)},get text1IsBold(){return e(),h(()=>e().text1IsBold)},get text1Align(){return e(),h(()=>e().text1Align)},get text1QuoteStyle(){return e(),h(()=>e().text1QuoteStyle)},get text1QuoteSize(){return e(),h(()=>e().text1QuoteSize)},onChange:ne})},me=Me=>{var it=ut(),St=Ge(it);{var zt=dt=>{bo(dt,{get text2(){return e(),h(()=>e().text2)},get text2Font(){return e(),h(()=>e().text2Font)},get text2Size(){return e(),h(()=>e().text2Size)},get text2YPosition(){return e(),h(()=>e().text2YPosition)},get text2LineSpacing(){return e(),h(()=>e().text2LineSpacing)},get text2Color(){return e(),h(()=>e().text2Color)},get text2LabelColor(){return e(),h(()=>e().text2LabelColor)},get text2IsBold(){return e(),h(()=>e().text2IsBold)},get text2Align(){return e(),h(()=>e().text2Align)},onChange:P})};ee(St,dt=>{i()==="text2"&&dt(zt)},!0)}D(Me,it)};ee(lt,Me=>{i()==="text1"?Me(V):Me(me,!1)},!0)}D(Oe,je)};ee(Re,Oe=>{i()==="background"?Oe(Te):Oe(nt,!1)},!0)}D(ce,ge)};ee(G,ce=>{i()==="size"?ce(K):ce(le,!1)},!0)}D(Y,k)};ee(we,Y=>{i(),e(),h(()=>i()==="image"||i()==="none"&&e().overlay)?Y(re):Y(w,!1)})}u(ae);var M=l(ae,2);{var X=Y=>{var k=Bo(),G=f(k);u(k),s("click",G,A),D(Y,k)};ee(M,Y=>{h(()=>!1)&&Y(X)})}$(()=>Ce(he,`
					aspect-ratio: ${e(),h(()=>e().canvasSize)??""};
					background: ${e(),h(()=>(e().background.type==="solid",e().background.value))??""};
				`)),s("click",he,Ee),s("keydown",he,Y=>Y.key==="Enter"&&Ee(Y)),D(R,j)};ee(be,R=>{n()?R(Ye):R(qe,!1)})}u(Le),D(o,Le),He(),d()}const Xt=xt("crop");var Lo=N('<!> <main class="main svelte-1uha8ag"><!></main> <!>',1);function Ho(o,t){Ne(t,!1);const e=()=>vt(Xt,"$activeTab",i),n=()=>vt(pe,"$cropState",i),[i,r]=Pt();let d=J(!1),v=null;function c(L){if(e()==="crop"&&n().cropPending&&L!=="crop"){v=L,I(d,!0);return}Xt.set(L)}async function m(){I(d,!1);const L=n();if(L.currentImage&&L.cropPending){const S=await Ma(L.currentImage,L.cropBox,L.imageWidth,L.imageHeight),O=await Nt(S);pe.set({...L,currentImage:S,imageWidth:O.width,imageHeight:O.height,cropBox:{x:0,y:0,width:100,height:100},cropPending:!1,isCropping:!1})}v&&(Xt.set(v),v=null)}function p(){I(d,!1),v=null}We();var C=Lo(),F=Ge(C);wn(F,{get activeTab(){return e()},onTabChange:c});var x=l(F,2),_=f(x);{var B=L=>{hi(L,{})},g=L=>{var S=ut(),O=Ge(S);{var Q=H=>{Ui(H,{})},Z=H=>{var A=ut(),U=Ge(A);{var ve=Se=>{Po(Se,{})};ee(U,Se=>{e()==="design"&&Se(ve)},!0)}D(H,A)};ee(O,H=>{e()==="ai"?H(Q):H(Z,!1)},!0)}D(L,S)};ee(_,L=>{e()==="crop"?L(B):L(g,!1)})}u(x);var y=l(x,2);{var T=L=>{$t(L,{message:"Save changes?",confirmText:"Yes",cancelText:"Cancel",onConfirm:m,onCancel:p})};ee(y,L=>{a(d)&&L(T)})}D(o,C),He(),r()}export{Ho as component};

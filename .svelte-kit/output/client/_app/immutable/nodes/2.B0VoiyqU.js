import{b as la,d as Oa,f as U,a as A,c as xt}from"../chunks/CTT2nEcH.js";import"../chunks/DUHCFzxV.js";import{i as st,x as Rt,al as Ca,F as Nt,C as Yt,j as Gt,M as Ha,g as a,aI as at,aA as Na,O as Ua,a5 as sa,aj as Wt,B as Et,N as Sa,ao as Ya,a2 as ca,ax as Wa,P as Qt,az as ja,am as ta,w as Ia,I as da,at as Q,aO as Xa,aP as Ga,aQ as Qa,aR as wt,ay as za,R as Fa,aS as jt,ah as Ba,aT as Ja,a3 as Za,aU as Ra,L as Ea,aV as Va,t as ae,A as Ka,aW as $a,ap as en,ai as tn,aX as an,aY as nn,aZ as on,a_ as rn,p as qe,n as Ae,s as l,k as g,l as s,aq as I,m as Qe,b as f,a$ as Ge,b0 as kt,e as Be,a4 as St,b1 as va}from"../chunks/Dowq9yQq.js";import{p as b,i as oe,b as ft,s as dt,a as Mt,_ as ln}from"../chunks/CzwPkIKx.js";import{i as Oe}from"../chunks/Dqy9l8l1.js";import{e as d,s as je}from"../chunks/CgNPIS03.js";import{c as sn,o as Dt,d as aa,w as yt,a as na}from"../chunks/C99_Sh4f.js";function Pa(i){st&&Rt(i)!==null&&Ca(i)}let ua=!1;function cn(){ua||(ua=!0,document.addEventListener("reset",i=>{Promise.resolve().then(()=>{if(!i.defaultPrevented)for(const t of i.target.elements)t.__on_r?.()})},{capture:!0}))}function mt(i,t){return t}function dn(i,t,e){for(var n=[],o=t.length,r,v=t.length,u=0;u<o;u++){let k=t[u];Fa(k,()=>{if(r){if(r.pending.delete(k),r.done.add(k),r.pending.size===0){var z=i.outrogroups;Jt(ta(r.done)),z.delete(r),z.size===0&&(i.outrogroups=null)}}else v-=1},!1)}if(v===0){var c=n.length===0&&e!==null;if(c){var p=e,x=p.parentNode;Ca(x),x.append(p),i.items.clear()}Jt(t,!c)}else r={pending:new Set(t),done:new Set},(i.outrogroups??=new Set).add(r)}function Jt(i,t=!0){for(var e=0;e<i.length;e++)Za(i[e],t)}var ga;function bt(i,t,e,n,o,r=null){var v=i,u=new Map,c=(t&Ra)!==0;if(c){var p=i;v=st?Nt(Rt(p)):p.appendChild(Yt())}st&&Gt();var x=null,k=at(()=>{var y=e();return Ia(y)?y:y==null?[]:ta(y)}),z,m=!0;function _(){h.fallback=x,vn(h,z,v,t,n),x!==null&&(z.length===0?(x.f&wt)===0?za(x):(x.f^=wt,Ot(x,null,v)):Fa(x,()=>{x=null}))}var B=Ha(()=>{z=a(k);var y=z.length;let T=!1;if(st){var L=Na(v)===Ua;L!==(y===0)&&(v=sa(),Nt(v),Wt(!1),T=!0)}for(var S=new Set,H=Wa,J=ja(),X=0;X<y;X+=1){st&&Et.nodeType===Sa&&Et.data===Ya&&(v=Et,T=!0,Wt(!1));var O=z[X],q=n(O,X),Y=m?null:u.get(q);Y?(Y.v&&ca(Y.v,O),Y.i&&ca(Y.i,X),J&&H.skipped_effects.delete(Y.e)):(Y=un(u,m?v:ga??=Yt(),O,q,X,o,t,e),m||(Y.e.f|=wt),u.set(q,Y)),S.add(q)}if(y===0&&r&&!x&&(m?x=Qt(()=>r(v)):(x=Qt(()=>r(ga??=Yt())),x.f|=wt)),st&&y>0&&Nt(sa()),!m)if(J){for(const[se,Ce]of u)S.has(se)||H.skipped_effects.add(Ce.e);H.oncommit(_),H.ondiscard(()=>{})}else _();T&&Wt(!0),a(k)}),h={effect:B,items:u,outrogroups:null,fallback:x};m=!1,st&&(v=Et)}function qt(i){for(;i!==null&&(i.f&Ja)===0;)i=i.next;return i}function vn(i,t,e,n,o){var r=(n&Va)!==0,v=t.length,u=i.items,c=qt(i.effect.first),p,x=null,k,z=[],m=[],_,B,h,y;if(r)for(y=0;y<v;y+=1)_=t[y],B=o(_,y),h=u.get(B).e,(h.f&wt)===0&&(h.nodes?.a?.measure(),(k??=new Set).add(h));for(y=0;y<v;y+=1){if(_=t[y],B=o(_,y),h=u.get(B).e,i.outrogroups!==null)for(const Y of i.outrogroups)Y.pending.delete(h),Y.done.delete(h);if((h.f&wt)!==0)if(h.f^=wt,h===c)Ot(h,null,e);else{var T=x?x.next:c;h===i.effect.last&&(i.effect.last=h.prev),h.prev&&(h.prev.next=h.next),h.next&&(h.next.prev=h.prev),Ct(i,x,h),Ct(i,h,T),Ot(h,T,e),x=h,z=[],m=[],c=qt(x.next);continue}if((h.f&jt)!==0&&(za(h),r&&(h.nodes?.a?.unfix(),(k??=new Set).delete(h))),h!==c){if(p!==void 0&&p.has(h)){if(z.length<m.length){var L=m[0],S;x=L.prev;var H=z[0],J=z[z.length-1];for(S=0;S<z.length;S+=1)Ot(z[S],L,e);for(S=0;S<m.length;S+=1)p.delete(m[S]);Ct(i,H.prev,J.next),Ct(i,x,H),Ct(i,J,L),c=L,x=J,y-=1,z=[],m=[]}else p.delete(h),Ot(h,c,e),Ct(i,h.prev,h.next),Ct(i,h,x===null?i.effect.first:x.next),Ct(i,x,h),x=h;continue}for(z=[],m=[];c!==null&&c!==h;)(p??=new Set).add(c),m.push(c),c=qt(c.next);if(c===null)continue}(h.f&wt)===0&&z.push(h),x=h,c=qt(h.next)}if(i.outrogroups!==null){for(const Y of i.outrogroups)Y.pending.size===0&&(Jt(ta(Y.done)),i.outrogroups?.delete(Y));i.outrogroups.size===0&&(i.outrogroups=null)}if(c!==null||p!==void 0){var X=[];if(p!==void 0)for(h of p)(h.f&jt)===0&&X.push(h);for(;c!==null;)(c.f&jt)===0&&c!==i.fallback&&X.push(c),c=qt(c.next);var O=X.length;if(O>0){var q=(n&Ra)!==0&&v===0?e:null;if(r){for(y=0;y<O;y+=1)X[y].nodes?.a?.measure();for(y=0;y<O;y+=1)X[y].nodes?.a?.fix()}dn(i,X,q)}}r&&Ea(()=>{if(k!==void 0)for(h of k)h.nodes?.a?.apply()})}function un(i,t,e,n,o,r,v,u){var c=(v&Ga)!==0?(v&Qa)===0?Q(e,!1,!1):da(e):null,p=(v&Xa)!==0?da(o):null;return{v:c,i:p,e:Qt(()=>(r(t,c??e,p??o,u),()=>{i.delete(n)}))}}function Ot(i,t,e){if(i.nodes)for(var n=i.nodes.start,o=i.nodes.end,r=t&&(t.f&wt)===0?t.nodes.start:e;n!==null;){var v=Ba(n);if(r.before(n),n===o)return;n=v}}function Ct(i,t,e){t===null?i.effect.first=e:t.next=e,e===null?i.effect.last=t:e.prev=t}function ha(i,t,e=!1,n=!1,o=!1){var r=i,v="";ae(()=>{var u=Ka;if(v===(v=t()??"")){st&&Gt();return}if(u.nodes!==null&&($a(u.nodes.start,u.nodes.end),u.nodes=null),v!==""){if(st){Et.data;for(var c=Gt(),p=c;c!==null&&(c.nodeType!==Sa||c.data!=="");)p=c,c=Ba(c);if(c===null)throw en(),tn;la(Et,p),r=Nt(c);return}var x=v+"";e?x=`<svg>${x}</svg>`:n&&(x=`<math>${x}</math>`);var k=Oa(x);if((e||n)&&(k=Rt(k)),la(Rt(k),k.lastChild),e||n)for(;Rt(k);)r.before(Rt(k));else r.before(k)}})}const fa=[...` 	
\r\fÂ \v\uFEFF`];function gn(i,t,e){var n=i==null?"":""+i;if(e){for(var o in e)if(e[o])n=n?n+" "+o:o;else if(n.length)for(var r=o.length,v=0;(v=n.indexOf(o,v))>=0;){var u=v+r;(v===0||fa.includes(n[v-1]))&&(u===n.length||fa.includes(n[u]))?n=(v===0?"":n.substring(0,v))+n.substring(u+1):v=u}}return n===""?null:n}function hn(i,t){return i==null?null:String(i)}function ue(i,t,e,n,o,r){var v=i.__className;if(st||v!==e||v===void 0){var u=gn(e,n,r);(!st||u!==i.getAttribute("class"))&&(u==null?i.removeAttribute("class"):i.className=u),i.__className=e}else if(r&&o!==r)for(var c in r){var p=!!r[c];(o==null||p!==!!o[c])&&i.classList.toggle(c,p)}return r}function Ie(i,t,e,n){var o=i.__style;if(st||o!==t){var r=hn(t);(!st||r!==i.getAttribute("style"))&&(r==null?i.removeAttribute("style"):i.style.cssText=r),i.__style=t}return n}const fn=Symbol("is custom element"),bn=Symbol("is html");function ct(i){if(st){var t=!1,e=()=>{if(!t){if(t=!0,i.hasAttribute("value")){var n=i.value;le(i,"value",null),i.value=n}if(i.hasAttribute("checked")){var o=i.checked;le(i,"checked",null),i.checked=o}}};i.__on_r=e,Ea(e),cn()}}function rt(i,t){var e=ia(i);e.value===(e.value=t??void 0)||i.value===t&&(t!==0||i.nodeName!=="PROGRESS")||(i.value=t??"")}function pn(i,t){var e=ia(i);e.checked!==(e.checked=t??void 0)&&(i.checked=t)}function le(i,t,e,n){var o=ia(i);st&&(o[t]=i.getAttribute(t),t==="src"||t==="srcset"||t==="href"&&i.nodeName==="LINK")||o[t]!==(o[t]=e)&&(t==="loading"&&(i[an]=e),e==null?i.removeAttribute(t):typeof e!="string"&&mn(i).includes(t)?i[t]=e:i.setAttribute(t,e))}function ia(i){return i.__attributes??={[fn]:i.nodeName.includes("-"),[bn]:i.namespaceURI===nn}}var ba=new Map;function mn(i){var t=i.getAttribute("is")||i.nodeName,e=ba.get(t);if(e)return e;ba.set(t,e=[]);for(var n,o=i,r=Element.prototype;r!==o;){n=rn(o);for(var v in n)n[v].set&&e.push(v);o=on(o)}return e}function gt(i){return function(...t){var e=t[0];return e.stopPropagation(),i?.apply(this,t)}}function Zt(i,t){var e=i.$$events?.[t.type],n=Ia(e)?e.slice():e==null?[]:[e];for(var o of n)o.call(this,t)}var xn=U('<header class="header svelte-hv3zzy"><img src="/logos/logo-picflam-logotype.png" alt="PicFlam" class="header-logo svelte-hv3zzy"/> <nav class="header-nav svelte-hv3zzy"><button aria-label="Crop tab"><img src="/icons/icon-crop.svg" alt="" class="nav-icon svelte-hv3zzy"/></button> <button aria-label="AI tab"><img src="/icons/icon-ai.svg" alt="" class="nav-icon svelte-hv3zzy"/></button> <button aria-label="Design tab"><img src="/icons/icon-design.svg" alt="" class="nav-icon svelte-hv3zzy"/></button></nav></header>');function wn(i,t){qe(t,!1);let e=b(t,"activeTab",8,"crop"),n=b(t,"onTabChange",8);Oe();var o=xn(),r=l(g(o),2),v=g(r);let u;var c=l(v,2);let p;var x=l(c,2);let k;s(r),s(o),ae(()=>{u=ue(v,1,"nav-btn svelte-hv3zzy",null,u,{active:e()==="crop"}),p=ue(c,1,"nav-btn svelte-hv3zzy",null,p,{active:e()==="ai"}),k=ue(x,1,"nav-btn svelte-hv3zzy",null,k,{active:e()==="design"})}),d("click",v,()=>n()("crop")),d("click",c,()=>n()("ai")),d("click",x,()=>n()("design")),A(i,o),Ae()}function La(i){return new Promise((t,e)=>{const n=new FileReader;n.onload=o=>t(o.target.result),n.onerror=e,n.readAsDataURL(i)})}function _t(i){return new Promise((t,e)=>{const n=new Image;n.onload=()=>t(n),n.onerror=e,n.src=i})}async function Ut(i){const t=await _t(i);return{width:t.naturalWidth,height:t.naturalHeight}}function pa(i,t=2048){return new Promise(async e=>{const n=await _t(i),{naturalWidth:o,naturalHeight:r}=n;if(o<=t&&r<=t){e(i);return}const v=document.createElement("canvas"),u=v.getContext("2d");let c,p;o>r?(c=t,p=r/o*t):(p=t,c=o/r*t),v.width=c,v.height=p,u.drawImage(n,0,0,c,p),e(v.toDataURL("image/jpeg",.92))})}async function yn(){try{const i=await navigator.clipboard.read();for(const t of i)for(const e of t.types)if(e.startsWith("image/")){const n=await t.getType(e);return await La(n)}return null}catch(i){return console.error("Failed to paste from clipboard:",i),null}}async function Vt(i){try{const e=await(await fetch(i)).blob();return await navigator.clipboard.write([new ClipboardItem({[e.type]:e})]),!0}catch(t){return console.error("Failed to copy to clipboard:",t),!1}}function Kt(i,t="picflam-export.png"){const e=document.createElement("a");e.href=i,e.download=t,document.body.appendChild(e),e.click(),document.body.removeChild(e)}async function Ma(i,t,e,n){const o=await _t(i),r=document.createElement("canvas"),v=r.getContext("2d"),u=t.x/100*e,c=t.y/100*n,p=t.width/100*e,x=t.height/100*n;return r.width=p,r.height=x,v.drawImage(o,u,c,p,x,0,0,p,x),r.toDataURL("image/png")}async function _n(i,t){const e=await _t(i),n=document.createElement("canvas"),o=n.getContext("2d");return n.width=e.naturalHeight,n.height=e.naturalWidth,o.translate(n.width/2,n.height/2),o.rotate(t*Math.PI/180),o.drawImage(e,-e.naturalWidth/2,-e.naturalHeight/2),n.toDataURL("image/png")}async function kn(i,t){const e=await _t(i),n=document.createElement("canvas"),o=n.getContext("2d");return n.width=e.naturalWidth,n.height=e.naturalHeight,o.translate(n.width,0),o.scale(-1,1),o.drawImage(e,0,0),n.toDataURL("image/png")}async function Cn(i,t,e){const n=await _t(i),o=document.createElement("canvas"),r=o.getContext("2d");if(o.width=n.naturalWidth,o.height=n.naturalHeight,t&&t!=="none"&&(r.filter=t),r.drawImage(n,0,0),r.filter="none",e&&Array.isArray(e)&&e.length>0)if(e.some(u=>u.invert)){const c=.5+e.reduce((h,y)=>h+(y.strength||50),0)/e.length/100*9.5,p=document.createElement("canvas");p.width=o.width,p.height=o.height;const x=p.getContext("2d");x.filter=`blur(${c}px)`,t&&t!=="none"&&(x.filter=`blur(${c}px) ${t}`),x.drawImage(n,0,0);const k=document.createElement("canvas");k.width=o.width,k.height=o.height;const z=k.getContext("2d");z.fillStyle="white",z.fillRect(0,0,k.width,k.height);for(const h of e){if(!h.invert)continue;const y=(h.soften||50)/100,T=z.createRadialGradient(h.x,h.y,0,h.x,h.y,h.radius);T.addColorStop(0,"rgba(0,0,0,1)"),T.addColorStop(.5+y*.3,"rgba(0,0,0,0.5)"),T.addColorStop(1,"rgba(0,0,0,0)"),z.fillStyle=T,z.beginPath(),z.arc(h.x,h.y,h.radius,0,Math.PI*2),z.fill()}const m=r.getImageData(0,0,o.width,o.height),_=x.getImageData(0,0,o.width,o.height),B=z.getImageData(0,0,o.width,o.height);for(let h=0;h<m.data.length;h+=4){const y=B.data[h]/255;m.data[h]=m.data[h]*y+_.data[h]*(1-y),m.data[h+1]=m.data[h+1]*y+_.data[h+1]*(1-y),m.data[h+2]=m.data[h+2]*y+_.data[h+2]*(1-y)}r.putImageData(m,0,0)}else for(const u of e){const c=u.strength||50,p=(u.soften||50)/100,x=.5+c/100*9.5,k=document.createElement("canvas");k.width=o.width,k.height=o.height;const z=k.getContext("2d");z.filter=`blur(${x}px)`,t&&t!=="none"&&(z.filter=`blur(${x}px) ${t}`),z.drawImage(n,0,0);const m=document.createElement("canvas");m.width=o.width,m.height=o.height;const _=m.getContext("2d"),B=_.createRadialGradient(u.x,u.y,0,u.x,u.y,u.radius);B.addColorStop(0,"rgba(255,255,255,1)"),B.addColorStop(.5+p*.3,"rgba(255,255,255,0.5)"),B.addColorStop(1,"rgba(255,255,255,0)"),_.fillStyle=B,_.beginPath(),_.arc(u.x,u.y,u.radius,0,Math.PI*2),_.fill();const h=r.getImageData(0,0,o.width,o.height),y=z.getImageData(0,0,o.width,o.height),T=_.getImageData(0,0,o.width,o.height);for(let L=0;L<h.data.length;L+=4){const S=T.data[L]/255;h.data[L]=h.data[L]*(1-S)+y.data[L]*S,h.data[L+1]=h.data[L+1]*(1-S)+y.data[L+1]*S,h.data[L+2]=h.data[L+2]*(1-S)+y.data[L+2]*S}r.putImageData(h,0,0)}return o.toDataURL("image/png")}var Sn=U("<br/> ",1),In=U('<div role="button" tabindex="0"><p class="import-title svelte-f1bndr"> <!></p> <img src="/icons/icon-upload.svg" alt="" class="import-icon svelte-f1bndr"/> <p class="import-hint svelte-f1bndr"> </p> <button class="btn-paste svelte-f1bndr">Paste</button> <input type="file" accept="image/*" class="sr-only"/></div>');function Da(i,t){qe(t,!1);let e=b(t,"title",8,"Import an image"),n=b(t,"subtitle",8,""),o=b(t,"hint",8,"Import, drag or paste an image"),r=b(t,"onImageImport",8,q=>{}),v=Q(!1),u=Q();async function c(q){if(!q||!q.type.startsWith("image/"))return;const Y=await La(q),se=await pa(Y,2048);r()(se)}function p(q){const Y=q.target.files?.[0];Y&&c(Y)}function x(q){q.preventDefault(),I(v,!1);const Y=q.dataTransfer?.files?.[0];Y&&c(Y)}function k(q){q.preventDefault(),I(v,!0)}function z(){I(v,!1)}async function m(){const q=await yn();if(q){const Y=await pa(q,2048);r()(Y)}}function _(){a(u)?.click()}Oe();var B=In();let h;var y=g(B),T=g(y,!0),L=l(T);{var S=q=>{var Y=Sn(),se=l(Qe(Y),1,!0);ae(()=>je(se,n())),A(q,Y)};oe(L,q=>{n()&&q(S)})}s(y);var H=l(y,4),J=g(H,!0);s(H);var X=l(H,2),O=l(X,2);ft(O,q=>I(u,q),()=>a(u)),s(B),ae(()=>{h=ue(B,1,"import-area svelte-f1bndr",null,h,{dragging:a(v)}),je(T,e()),je(J,o())}),d("click",X,gt(m)),d("change",O,p),d("click",B,_),d("drop",B,x),d("dragover",B,k),d("dragleave",B,z),d("keypress",B,q=>q.key==="Enter"&&_()),A(i,B),Ae()}var zn=U('<div class="action-bar svelte-96zw02"><div class="action-group svelte-96zw02"><button class="action-btn svelte-96zw02" aria-label="Undo"><img src="/icons/icon-undo.svg" alt="" class="action-icon svelte-96zw02"/></button> <button class="action-btn svelte-96zw02" aria-label="Redo"><img src="/icons/icon-redo.svg" alt="" class="action-icon svelte-96zw02"/></button></div> <div class="action-group svelte-96zw02"><button class="action-btn svelte-96zw02" aria-label="Start again"><img src="/icons/icon-startagain.svg" alt="" class="action-icon svelte-96zw02"/></button> <button class="action-btn svelte-96zw02" aria-label="Copy to clipboard"><img src="/icons/icon-copy.svg" alt="" class="action-icon svelte-96zw02"/></button> <button class="action-btn svelte-96zw02" aria-label="Export"><img src="/icons/icon-export.svg" alt="" class="action-icon svelte-96zw02"/></button></div></div>');function oa(i,t){let e=b(t,"canUndo",8,!1),n=b(t,"canRedo",8,!1),o=b(t,"onUndo",8,()=>{}),r=b(t,"onRedo",8,()=>{}),v=b(t,"onStartAgain",8,()=>{}),u=b(t,"onCopy",8,()=>{}),c=b(t,"onExport",8,()=>{});var p=zn(),x=g(p),k=g(x),z=l(k,2);s(x);var m=l(x,2),_=g(m),B=l(_,2),h=l(B,2);s(m),s(p),ae(()=>{k.disabled=!e(),z.disabled=!n()}),d("click",k,function(...y){o()?.apply(this,y)}),d("click",z,function(...y){r()?.apply(this,y)}),d("click",_,function(...y){v()?.apply(this,y)}),d("click",B,function(...y){u()?.apply(this,y)}),d("click",h,function(...y){c()?.apply(this,y)}),A(i,p)}var Fn=U("<button> </button>"),Bn=U('<div class="sub-menu-tabs svelte-tv6tw8"></div>');function ra(i,t){qe(t,!1);let e=b(t,"tabs",24,()=>[]),n=b(t,"activeTab",8,""),o=b(t,"onTabChange",8,v=>{});Oe();var r=Bn();bt(r,5,e,mt,(v,u)=>{var c=Fn();let p;var x=g(c,!0);s(c),ae(()=>{p=ue(c,1,"sub-menu-tab svelte-tv6tw8",null,p,{active:n()===a(u).id}),je(x,(a(u),f(()=>a(u).label)))}),d("click",c,()=>o()(a(u).id)),A(v,c)}),s(r),A(i,r),Ae()}var Rn=U('<div class="modal-overlay svelte-qik81a" role="dialog" aria-modal="true" tabindex="-1"><div class="modal svelte-qik81a" role="document"><p class="modal-message svelte-qik81a"><span class="modal-message-first svelte-qik81a">Start again?</span><br/><span class="modal-message-second svelte-qik81a">Your changes will be lost.</span></p> <div class="modal-actions svelte-qik81a"><button class="btn-text svelte-qik81a"> </button> <button class="btn-text btn-confirm svelte-qik81a"> </button></div></div></div>');function $t(i,t){qe(t,!1),b(t,"message",8,"");let e=b(t,"confirmText",8,"Yes"),n=b(t,"cancelText",8,"Cancel"),o=b(t,"onConfirm",8,()=>{}),r=b(t,"onCancel",8,()=>{});Oe();var v=Rn(),u=g(v),c=l(g(u),2),p=g(c),x=g(p,!0);s(p);var k=l(p,2),z=g(k,!0);s(k),s(c),s(u),s(v),ae(()=>{je(x,n()),je(z,e())}),d("click",p,function(...m){r()?.apply(this,m)}),d("click",k,function(...m){o()?.apply(this,m)}),d("click",u,gt(function(m){Zt.call(this,t,m)})),d("keydown",u,gt(function(m){Zt.call(this,t,m)})),d("click",v,function(...m){r()?.apply(this,m)}),d("keydown",v,m=>m.key==="Escape"&&r()()),A(i,v),Ae()}var En=U('<canvas class="blur-canvas svelte-pjowa5"></canvas>'),Pn=U('<div class="blur-brush-indicator svelte-pjowa5"></div>'),Ln=U('<div class="blur-brush-preview svelte-pjowa5"></div>'),Mn=U('<div class="crop-overlay svelte-pjowa5"><div class="overlay-top svelte-pjowa5"></div> <div class="overlay-bottom svelte-pjowa5"></div> <div class="overlay-left svelte-pjowa5"></div> <div class="overlay-right svelte-pjowa5"></div> <div class="crop-box svelte-pjowa5" role="button" aria-label="Drag to move crop area" tabindex="0"><div class="crop-border svelte-pjowa5"></div> <div class="corner-handle top-left svelte-pjowa5" role="button" aria-label="Resize top-left corner" tabindex="0"></div> <div class="corner-handle top-right svelte-pjowa5" role="button" aria-label="Resize top-right corner" tabindex="0"></div> <div class="corner-handle bottom-left svelte-pjowa5" role="button" aria-label="Resize bottom-left corner" tabindex="0"></div> <div class="corner-handle bottom-right svelte-pjowa5" role="button" aria-label="Resize bottom-right corner" tabindex="0"></div></div></div>'),Dn=U('<div class="crop-canvas svelte-pjowa5" role="application" aria-label="Image crop canvas"><div class="image-wrapper svelte-pjowa5"><img alt="Crop preview" class="canvas-image svelte-pjowa5" draggable="false"/> <!></div> <!> <!> <!></div>');function qn(i,t){qe(t,!1);const e=Q(),n=Q(),o=Q(),r=Q();let v=b(t,"imageSrc",8,""),u=b(t,"cropBox",24,()=>({x:10,y:10,width:80,height:80})),c=b(t,"isCropping",8,!1),p=b(t,"scale",8,1),x=b(t,"offsetX",8,0),k=b(t,"offsetY",8,0),z=b(t,"imageWidth",8,0),m=b(t,"imageHeight",8,0),_=b(t,"editFilters",8,""),B=b(t,"blurEnabled",8,!1),h=b(t,"blurBrushSize",8,50),y=b(t,"blurStrength",8,50),T=b(t,"blurSoften",8,50),L=b(t,"blurInvert",8,!1),S=b(t,"blurMask",24,()=>[]),H=b(t,"showBrushPreview",8,!1);const J=sn();let X=Q(),O=Q(),q=Q({width:0,height:0}),Y=!1,se=null,Ce=0,me=0,N=null,ee=0,E=1,D=!1,ie=Q({x:0,y:0,visible:!1}),Se=Q(null),Re=Q("");async function ze(){I(Re,v());const C=new Image;C.crossOrigin="anonymous",C.onload=()=>{I(Se,C)},C.src=v()}function nt(C){const R=document.createElement("canvas");R.width=a(Se).naturalWidth,R.height=a(Se).naturalHeight;const ne=R.getContext("2d");return ne.filter=`blur(${C}px)`,ne.drawImage(a(Se),0,0),R}function Ee(){if(!a(O)||!a(Se)||!S())return;const C=a(O).getContext("2d"),R=a(O).width,ne=a(O).height;if(C.clearRect(0,0,R,ne),S().length===0)return;const K=R/z(),ce=ne/m();if(S().some(te=>te.invert)){const te=S().reduce((V,re)=>V+(re.strength||50),0)/S().length;S().reduce((V,re)=>V+(re.soften||50),0)/S().length;const w=.5+te/100*9.5,M=nt(w);C.drawImage(M,0,0,R,ne),C.globalCompositeOperation="destination-out";for(const V of S()){if(!V.invert)continue;const re=V.x*K,$=V.y*ce,P=V.radius*Math.min(K,ce),W=(V.soften||50)/100,de=Math.max(0,.3-W*.3),ve=.3+(1-W)*.4,ge=C.createRadialGradient(re,$,0,re,$,P);ge.addColorStop(de,"rgba(0,0,0,1)"),ge.addColorStop(ve,`rgba(0,0,0,${.5+W*.3})`),ge.addColorStop(1,"rgba(0,0,0,0)"),C.fillStyle=ge,C.beginPath(),C.arc(re,$,P,0,Math.PI*2),C.fill()}C.globalCompositeOperation="source-over"}else for(const te of S()){const w=te.x*K,M=te.y*ce,V=te.radius*Math.min(K,ce),re=te.strength||50,$=(te.soften||50)/100,P=.5+re/100*9.5,W=nt(P);C.save();const de=Math.max(0,.2-$*.2),ve=.2+(1-$)*.5,ge=C.createRadialGradient(w,M,0,w,M,V);ge.addColorStop(de,"rgba(255,255,255,1)"),ge.addColorStop(ve,`rgba(255,255,255,${.4+$*.3})`),ge.addColorStop(1,"rgba(255,255,255,0)"),C.beginPath(),C.arc(w,M,V,0,Math.PI*2),C.clip(),C.drawImage(W,0,0,R,ne),C.restore()}}Dt(()=>(Xe(),window.addEventListener("resize",Xe),()=>window.removeEventListener("resize",Xe)));function Xe(){if(a(X)){const C=a(X).getBoundingClientRect();I(q,{width:C.width,height:C.height})}}function He(C){return C.touches&&C.touches.length>0?{x:C.touches[0].clientX,y:C.touches[0].clientY}:{x:C.clientX,y:C.clientY}}function Me(C){if(C.touches&&C.touches.length>=2){const R=C.touches[0].clientX-C.touches[1].clientX,ne=C.touches[0].clientY-C.touches[1].clientY;return Math.sqrt(R*R+ne*ne)}return 0}function _e(C,R="move"){if(!c())return;if(C.touches&&C.touches.length>=2){ee=Me(C),E=p(),se="pinch";return}C.preventDefault(),Y=!0,se=R;const ne=He(C);Ce=ne.x,me=ne.y,N={...u()}}function Je(C){if(!c())return;if(se==="pinch"&&C.touches&&C.touches.length>=2){const we=Me(C),te=E*(we/ee);J("scaleChange",{scale:Math.max(.5,Math.min(3,te))});return}if(!Y||!N)return;C.preventDefault();const R=He(C),ne=(R.x-Ce)/a(e)*100,K=(R.y-me)/a(n)*100;let ce={...N};if(se==="move")ce.x=Math.max(0,Math.min(100-N.width,N.x+ne)),ce.y=Math.max(0,Math.min(100-N.height,N.y+K));else if(se.includes("corner")){if(se.includes("left")){const te=Math.max(0,N.x+ne),w=N.width-(te-N.x);w>=10&&(ce.x=te,ce.width=w)}if(se.includes("right")){const te=Math.min(100-N.x,N.width+ne);te>=10&&(ce.width=te)}if(se.includes("top")){const te=Math.max(0,N.y+K),w=N.height-(te-N.y);w>=10&&(ce.y=te,ce.height=w)}if(se.includes("bottom")){const te=Math.min(100-N.y,N.height+K);te>=10&&(ce.height=te)}}J("cropChange",{cropBox:ce})}function Ne(){Y=!1,se=null,N=null,D&&(D=!1)}function Ue(C){B()&&(C.preventDefault(),D=!0,Pe(C))}function Fe(C){if(!B())return;const R=a(X).getBoundingClientRect(),ne=He(C);I(ie,{x:ne.x-R.left,y:ne.y-R.top,visible:!0}),D&&Pe(C)}function it(){I(ie,{...a(ie),visible:!1}),D&&(D=!1)}function Pe(C){const R=a(X).getBoundingClientRect(),ne=He(C),K=(ne.x-R.left)/a(e)*z(),ce=(ne.y-R.top)/a(n)*m(),we=h()/100*Math.min(z(),m())*.15;J("blurPaint",{point:{x:K,y:ce,radius:we,strength:y(),soften:T(),invert:L()}})}Ge(()=>a(q),()=>{I(e,a(q).width)}),Ge(()=>(Be(m()),Be(z()),a(e)),()=>{I(n,m()&&z()?a(e)*m()/z():0)}),Ge(()=>(Be(h()),a(e),a(n)),()=>{I(o,h()/100*Math.min(a(e),a(n))*.3)}),Ge(()=>(Be(v()),a(O),a(Re)),()=>{v()&&a(O)&&v()!==a(Re)&&ze()}),Ge(()=>(Be(S()),a(O),a(Se)),()=>{S()&&Array.isArray(S())&&S().length>0&&a(O)&&a(Se)&&Ee()}),Ge(()=>(Be(u()),a(e),a(n)),()=>{I(r,{x:u().x/100*a(e),y:u().y/100*a(n),width:u().width/100*a(e),height:u().height/100*a(n)})}),kt(),Oe();var he=Dn(),xe=g(he),Ye=g(xe),Ze=l(Ye,2);{var Ve=C=>{var R=En();ft(R,ne=>I(O,ne),()=>a(O)),ae(()=>{le(R,"width",a(e)),le(R,"height",a(n)),Ie(R,`filter: ${_()??""};`)}),A(C,R)};oe(Ze,C=>{B()&&a(e)>0&&a(n)>0&&C(Ve)})}s(xe);var F=l(xe,2);{var j=C=>{var R=Pn();ae(()=>Ie(R,`
				left: ${a(ie),f(()=>a(ie).x)??""}px;
				top: ${a(ie),f(()=>a(ie).y)??""}px;
				width: ${a(o)??""}px;
				height: ${a(o)??""}px;
			`)),A(C,R)};oe(F,C=>{Be(B()),a(ie),f(()=>B()&&a(ie).visible)&&C(j)})}var Z=l(F,2);{var be=C=>{var R=Ln();ae(()=>Ie(R,`
				left: ${a(e)/2}px;
				top: ${a(n)/2}px;
				width: ${a(o)??""}px;
				height: ${a(o)??""}px;
			`)),A(C,R)};oe(Z,C=>{H()&&a(e)>0&&a(n)>0&&C(be)})}var fe=l(Z,2);{var ke=C=>{var R=Mn(),ne=g(R),K=l(ne,2),ce=l(K,2),we=l(ce,2),te=l(we,2),w=l(g(te),2),M=l(w,2),V=l(M,2),re=l(V,2);s(te),s(R),ae(()=>{Ie(ne,`height: ${a(r),f(()=>a(r).y)??""}px;`),Ie(K,`top: ${a(r),f(()=>a(r).y+a(r).height)??""}px; height: ${a(n),a(r),f(()=>a(n)-a(r).y-a(r).height)??""}px;`),Ie(ce,`top: ${a(r),f(()=>a(r).y)??""}px; height: ${a(r),f(()=>a(r).height)??""}px; width: ${a(r),f(()=>a(r).x)??""}px;`),Ie(we,`top: ${a(r),f(()=>a(r).y)??""}px; height: ${a(r),f(()=>a(r).height)??""}px; left: ${a(r),f(()=>a(r).x+a(r).width)??""}px; width: ${a(e),a(r),f(()=>a(e)-a(r).x-a(r).width)??""}px;`),Ie(te,`left: ${a(r),f(()=>a(r).x)??""}px; top: ${a(r),f(()=>a(r).y)??""}px; width: ${a(r),f(()=>a(r).width)??""}px; height: ${a(r),f(()=>a(r).height)??""}px;`)}),d("mousedown",w,gt($=>_e($,"corner-top-left"))),d("touchstart",w,gt($=>_e($,"corner-top-left"))),d("mousedown",M,gt($=>_e($,"corner-top-right"))),d("touchstart",M,gt($=>_e($,"corner-top-right"))),d("mousedown",V,gt($=>_e($,"corner-bottom-left"))),d("touchstart",V,gt($=>_e($,"corner-bottom-left"))),d("mousedown",re,gt($=>_e($,"corner-bottom-right"))),d("touchstart",re,gt($=>_e($,"corner-bottom-right"))),d("mousedown",te,$=>_e($,"move")),d("touchstart",te,$=>_e($,"move")),A(C,R)};oe(fe,C=>{c()&&a(n)>0&&C(ke)})}s(he),ft(he,C=>I(X,C),()=>a(X)),ae(()=>{Ie(xe,`transform: scale(${p()??""}) translate(${x()??""}px, ${k()??""}px);`),le(Ye,"src",v()),Ie(Ye,`filter: ${_()??""};`)}),d("mousemove",he,function(...C){(B()?Fe:Je)?.apply(this,C)}),d("mouseup",he,Ne),d("mouseleave",he,function(...C){(B()?it:Ne)?.apply(this,C)}),d("touchmove",he,function(...C){(B()?Fe:Je)?.apply(this,C)}),d("touchend",he,Ne),d("mousedown",he,function(...C){(B()?Ue:null)?.apply(this,C)}),d("touchstart",he,function(...C){(B()?Ue:null)?.apply(this,C)}),A(i,he),Ae()}var An=U('<img alt="" class="toggle-icon svelte-1gdqxne"/>'),Tn=U('<span class="toggle-label svelte-1gdqxne"> </span>'),On=U("<div><button><!></button> <!></div>"),Hn=U("<div></div>");function qa(i,t){qe(t,!1);let e=b(t,"options",24,()=>[]),n=b(t,"value",8,""),o=b(t,"onChange",8,p=>{}),r=b(t,"showLabels",8,!0),v=b(t,"centered",8,!1);Oe();var u=Hn();let c;bt(u,5,e,mt,(p,x)=>{var k=On();let z;var m=g(k);let _;var B=g(m);{var h=L=>{var S=An();ae(()=>le(S,"src",`/icons/${a(x),f(()=>a(x).icon)??""}.svg`)),A(L,S)};oe(B,L=>{a(x),f(()=>a(x).icon)&&L(h)})}s(m);var y=l(m,2);{var T=L=>{var S=Tn(),H=g(S,!0);s(S),ae(()=>je(H,(a(x),f(()=>a(x).label)))),A(L,S)};oe(y,L=>{Be(r()),a(x),f(()=>r()&&a(x).label)&&L(T)})}s(k),ae(()=>{z=ue(k,1,"toggle-item svelte-1gdqxne",null,z,{active:n()===a(x).id}),_=ue(m,1,"toggle-btn svelte-1gdqxne",null,_,{active:n()===a(x).id}),le(m,"aria-label",(a(x),f(()=>a(x).label)))}),d("click",m,()=>o()(a(x).id)),A(p,k)}),s(u),ae(()=>c=ue(u,1,"toggle-group svelte-1gdqxne",null,c,{centered:v()})),A(i,u),Ae()}var Nn=U('<label class="input-label svelte-1r47u3b"> <input class="input svelte-1r47u3b"/></label>'),Un=U('<input class="input svelte-1r47u3b"/>'),Yn=U('<div class="input-field svelte-1r47u3b"><!></div>');function ma(i,t){qe(t,!1);let e=b(t,"label",8,""),n=b(t,"value",12,""),o=b(t,"type",8,"text"),r=b(t,"placeholder",8,""),v=b(t,"disabled",8,!1),u=b(t,"onChange",8,m=>{});function c(m){n(m.target.value),u()(n())}Oe();var p=Yn(),x=g(p);{var k=m=>{var _=Nn(),B=g(_),h=l(B);ct(h),s(_),ae(()=>{je(B,`${e()??""} `),le(h,"type",o()),rt(h,n()),le(h,"placeholder",r()),h.disabled=v()}),d("input",h,c),A(m,_)},z=m=>{var _=Un();ct(_),ae(()=>{le(_,"type",o()),rt(_,n()),le(_,"placeholder",r()),_.disabled=v()}),d("input",_,c),A(m,_)};oe(x,m=>{e()?m(k):m(z,!1)})}s(p),A(i,p),Ae()}var Wn=U('<span class="slider-value svelte-jchife"> </span>'),jn=U('<div class="slider-header svelte-jchife"><span class="slider-label svelte-jchife"> </span> <!></div>'),Xn=U('<div class="slider-container svelte-jchife"><!> <input type="range" class="slider svelte-jchife"/></div>');function It(i,t){qe(t,!1);let e=b(t,"label",8,""),n=b(t,"min",8,0),o=b(t,"max",8,100),r=b(t,"value",8,50),v=b(t,"step",8,1),u=b(t,"showValue",8,!1),c=b(t,"onChange",8,T=>{}),p=b(t,"onInteractionStart",8,()=>{}),x=b(t,"onInteractionEnd",8,()=>{});function k(T){const L=Number(T.target.value);c()(L)}function z(){p()()}function m(){x()()}Oe();var _=Xn(),B=g(_);{var h=T=>{var L=jn(),S=g(L),H=g(S,!0);s(S);var J=l(S,2);{var X=O=>{var q=Wn(),Y=g(q,!0);s(q),ae(()=>je(Y,r())),A(O,q)};oe(J,O=>{u()&&O(X)})}s(L),ae(()=>je(H,e())),A(T,L)};oe(B,T=>{e()&&T(h)})}var y=l(B,2);ct(y),s(_),ae(()=>{le(y,"min",n()),le(y,"max",o()),le(y,"step",v()),rt(y,r())}),d("input",y,k),d("mousedown",y,z),d("touchstart",y,z),d("mouseup",y,m),d("touchend",y,m),A(i,_),Ae()}var Gn=U('<div class="apply-row svelte-17iy3mz"><button class="btn-apply svelte-17iy3mz">Apply</button></div>'),Qn=U('<div class="crop-controls svelte-17iy3mz"><!> <div class="dimensions-row svelte-17iy3mz"><div class="dimension-input svelte-17iy3mz"><!></div> <button class="icon-btn svelte-17iy3mz"><img alt="" class="icon-btn-img svelte-17iy3mz"/></button> <div class="dimension-input svelte-17iy3mz"><!></div> <button class="icon-btn svelte-17iy3mz" aria-label="Flip horizontal"><img src="/icons/icon-flip-horizontal.svg" alt="" class="icon-btn-img svelte-17iy3mz"/></button> <button class="icon-btn svelte-17iy3mz" aria-label="Rotate"><img src="/icons/icon-rotate.svg" alt="" class="icon-btn-img svelte-17iy3mz"/></button></div> <!> <!></div>');function Jn(i,t){qe(t,!1);let e=b(t,"aspectRatio",8,"9:16"),n=b(t,"cropWidth",8,1080),o=b(t,"cropHeight",8,1920),r=b(t,"ratioLocked",8,!0),v=b(t,"scale",8,100),u=b(t,"cropPending",8,!1),c=b(t,"onRatioChange",8,E=>{}),p=b(t,"onDimensionsChange",8,({width:E,height:D})=>{}),x=b(t,"onLockToggle",8,()=>{}),k=b(t,"onFlip",8,()=>{}),z=b(t,"onRotate",8,()=>{}),m=b(t,"onScaleChange",8,E=>{}),_=b(t,"onApply",8,()=>{});const B=[{id:"9:16",label:"9:16",icon:"icon-vertical"},{id:"1:1",label:"1:1",icon:"icon-square"},{id:"16:9",label:"16:9",icon:"icon-horizontal"},{id:"custom",label:"Custom",icon:"icon-custom"}];function h(E){const D=parseInt(E)||0;p()({width:D,height:o()})}function y(E){const D=parseInt(E)||0;p()({width:n(),height:D})}Oe();var T=Qn(),L=g(T);qa(L,{get options(){return B},get value(){return e()},get onChange(){return c()},showLabels:!0,centered:!0});var S=l(L,2),H=g(S),J=g(H);{let E=at(()=>(Be(n()),f(()=>n().toString())));ma(J,{label:"Width",type:"number",get value(){return a(E)},onChange:h})}s(H);var X=l(H,2),O=g(X);s(X);var q=l(X,2),Y=g(q);{let E=at(()=>(Be(o()),f(()=>o().toString())));ma(Y,{label:"Height",type:"number",get value(){return a(E)},onChange:y})}s(q);var se=l(q,2),Ce=l(se,2);s(S);var me=l(S,2);It(me,{label:"Scale",min:50,max:200,get value(){return v()},step:1,showValue:!0,get onChange(){return m()}});var N=l(me,2);{var ee=E=>{var D=Gn(),ie=g(D);s(D),d("click",ie,function(...Se){_()?.apply(this,Se)}),A(E,D)};oe(N,E=>{u()&&E(ee)})}s(T),ae(()=>{le(X,"aria-label",r()?"Unlock aspect ratio":"Lock aspect ratio"),le(O,"src",`/icons/${r()?"icon-lock":"icon-unlock"}.svg`)}),d("click",X,function(...E){x()?.apply(this,E)}),d("click",se,function(...E){k()?.apply(this,E)}),d("click",Ce,function(...E){z()?.apply(this,E)}),A(i,T),Ae()}var Zn=U("<button> </button>"),Vn=U("<button> </button>"),Kn=U('<div class="blur-controls svelte-1e1k0ax"><div class="blur-control-row svelte-1e1k0ax"><!> <label class="invert-checkbox svelte-1e1k0ax"><input type="checkbox" class="svelte-1e1k0ax"/> <span class="checkbox-label svelte-1e1k0ax">Invert</span></label></div> <div class="slider-row svelte-1e1k0ax"><div class="slider-track svelte-1e1k0ax"><!></div> <button class="reset-btn svelte-1e1k0ax" aria-label="Reset"><img src="/icons/icon-reset.svg" alt="" class="reset-icon svelte-1e1k0ax"/></button></div> <div class="zoom-row svelte-1e1k0ax"><span class="zoom-label svelte-1e1k0ax">Zoom in</span> <div class="zoom-slider-row svelte-1e1k0ax"><div class="slider-track svelte-1e1k0ax"><!></div> <button class="reset-btn svelte-1e1k0ax" aria-label="Reset zoom"><img src="/icons/icon-reset.svg" alt="" class="reset-icon svelte-1e1k0ax"/></button></div></div> <div class="nudge-row svelte-1e1k0ax"><button class="nudge-btn svelte-1e1k0ax" aria-label="Nudge up"><img src="/icons/icon-nudge-up.svg" alt="" class="svelte-1e1k0ax"/></button> <button class="nudge-btn svelte-1e1k0ax" aria-label="Nudge down"><img src="/icons/icon-nudge-down.svg" alt="" class="svelte-1e1k0ax"/></button> <button class="nudge-btn svelte-1e1k0ax" aria-label="Nudge left"><img src="/icons/icon-nudge-left.svg" alt="" class="svelte-1e1k0ax"/></button> <button class="nudge-btn svelte-1e1k0ax" aria-label="Nudge right"><img src="/icons/icon-nudge-right.svg" alt="" class="svelte-1e1k0ax"/></button></div></div>'),$n=U('<div class="edit-controls svelte-1e1k0ax"><div class="enhancement-row svelte-1e1k0ax"></div> <div class="slider-row svelte-1e1k0ax"><div class="slider-track svelte-1e1k0ax"><!></div> <button class="reset-btn svelte-1e1k0ax" aria-label="Reset"><img src="/icons/icon-reset.svg" alt="" class="reset-icon svelte-1e1k0ax"/></button></div> <div class="blur-section svelte-1e1k0ax"><div class="blur-header svelte-1e1k0ax"><button class="chevron-btn svelte-1e1k0ax"><img alt=""/></button> <span class="blur-label svelte-1e1k0ax">Blur</span> <button><span class="toggle-thumb svelte-1e1k0ax"></span></button></div> <!></div></div>');function ei(i,t){qe(t,!1);const e=Q(),n=Q(),o=Q(),r=Q(),v=Q(),u=Q();let c=b(t,"brightness",8,0),p=b(t,"shadows",8,0),x=b(t,"contrast",8,0),k=b(t,"hdr",8,0),z=b(t,"blurBrushSize",8,50),m=b(t,"blurStrength",8,50),_=b(t,"blurSoften",8,50),B=b(t,"blurInvert",8,!1),h=b(t,"zoomLevel",8,1),y=b(t,"blurEnabled",8,!1),T=b(t,"onBrightnessChange",8,K=>{}),L=b(t,"onShadowsChange",8,K=>{}),S=b(t,"onContrastChange",8,K=>{}),H=b(t,"onHdrChange",8,K=>{}),J=b(t,"onBlurBrushSizeChange",8,K=>{}),X=b(t,"onBlurStrengthChange",8,K=>{}),O=b(t,"onBlurSoftenChange",8,K=>{}),q=b(t,"onBlurInvertChange",8,K=>{}),Y=b(t,"onZoomChange",8,K=>{}),se=b(t,"onNudge",8,K=>{}),Ce=b(t,"onResetZoom",8,()=>{}),me=b(t,"onBlurToggle",8,K=>{}),N=b(t,"onBrushPreviewChange",8,K=>{}),ee=b(t,"onEditEnd",8,()=>{}),E=Q("brightness"),D=Q(y()),ie=Q("brushSize");const Se=[{id:"brightness",label:"Brightness"},{id:"shadows",label:"Shadows"},{id:"contrast",label:"Contrast"},{id:"hdr",label:"HDR"}],Re=[{id:"brushSize",label:"Brush size"},{id:"strength",label:"Strength"},{id:"soften",label:"Soften edges"}];function ze(K){switch(a(E)){case"brightness":T()(K);break;case"shadows":L()(K);break;case"contrast":S()(K);break;case"hdr":H()(K);break}}function nt(){ze(0)}function Ee(K){switch(a(ie)){case"brushSize":J()(K);break;case"strength":X()(K);break;case"soften":O()(K);break}}function Xe(){Ee(50)}function He(){const K=!y();me()(K),I(D,K)}function Me(){y()&&I(D,!a(D))}function _e(){q()(!B())}function Je(K){I(E,K),I(D,!1)}function Ne(K){I(ie,K)}function Ue(){ee()()}function Fe(){a(ie)==="brushSize"&&N()(!0)}function it(){N()(!1),ee()()}Ge(()=>(a(E),Be(c()),Be(p()),Be(x()),Be(k())),()=>{I(e,(()=>{switch(a(E)){case"brightness":return c();case"shadows":return p();case"contrast":return x();case"hdr":return k();default:return 0}})())}),Ge(()=>a(E),()=>{I(n,a(E)==="hdr"?0:-100)}),Ge(()=>{},()=>{I(o,100)}),Ge(()=>(a(ie),Be(z()),Be(m()),Be(_())),()=>{I(r,(()=>{switch(a(ie)){case"brushSize":return z();case"strength":return m();case"soften":return _();default:return 50}})())}),Ge(()=>{},()=>{I(v,1)}),Ge(()=>{},()=>{I(u,100)}),kt(),Oe();var Pe=$n(),he=g(Pe);bt(he,5,()=>Se,mt,(K,ce)=>{var we=Zn();let te;var w=g(we,!0);s(we),ae(()=>{te=ue(we,1,"enhancement-btn svelte-1e1k0ax",null,te,{active:a(E)===a(ce).id}),je(w,(a(ce),f(()=>a(ce).label)))}),d("click",we,()=>Je(a(ce).id)),A(K,we)}),s(he);var xe=l(he,2),Ye=g(xe),Ze=g(Ye);It(Ze,{get min(){return a(n)},get max(){return a(o)},get value(){return a(e)},step:1,onChange:ze,onInteractionEnd:Ue}),s(Ye);var Ve=l(Ye,2);s(xe);var F=l(xe,2),j=g(F),Z=g(j),be=g(Z);let fe;s(Z);var ke=l(Z,4);let C;s(j);var R=l(j,2);{var ne=K=>{var ce=Kn(),we=g(ce),te=g(we);bt(te,1,()=>Re,mt,(G,ye)=>{var Te=Vn();let $e;var vt=g(Te,!0);s(Te),ae(()=>{$e=ue(Te,1,"blur-control-btn svelte-1e1k0ax",null,$e,{active:a(ie)===a(ye).id}),je(vt,(a(ye),f(()=>a(ye).label)))}),d("click",Te,()=>Ne(a(ye).id)),A(G,Te)});var w=l(te,2),M=g(w);ct(M),St(2),s(w),s(we);var V=l(we,2),re=g(V),$=g(re);It($,{get min(){return a(v)},get max(){return a(u)},get value(){return a(r)},step:1,onChange:Ee,onInteractionStart:Fe,onInteractionEnd:it}),s(re);var P=l(re,2);s(V);var W=l(V,2),de=l(g(W),2),ve=g(de),ge=g(ve);It(ge,{min:1,max:3,step:.1,get value(){return h()},get onChange(){return Y()}}),s(ve);var Le=l(ve,2);s(de),s(W);var De=l(W,2),lt=g(De),Ke=l(lt,2),et=l(Ke,2),tt=l(et,2);s(De),s(ce),ae(()=>pn(M,B())),d("change",M,_e),d("click",P,Xe),d("click",Le,function(...G){Ce()?.apply(this,G)}),d("click",lt,()=>se()("up")),d("click",Ke,()=>se()("down")),d("click",et,()=>se()("left")),d("click",tt,()=>se()("right")),A(K,ce)};oe(R,K=>{a(D)&&y()&&K(ne)})}s(F),s(Pe),ae(()=>{Z.disabled=!y(),le(Z,"aria-label",a(D)?"Collapse":"Expand"),le(be,"src",`/icons/${a(D)?"icon-collapse":"icon-expand"}.svg`),fe=ue(be,1,"chevron-icon svelte-1e1k0ax",null,fe,{disabled:!y()}),C=ue(ke,1,"toggle-switch svelte-1e1k0ax",null,C,{active:y()}),le(ke,"aria-label",y()?"Disable blur":"Enable blur")}),d("click",Ve,nt),d("click",Z,Me),d("click",ke,He),A(i,Pe),Ae()}var ti=U('<button><div class="filter-preview svelte-183y0dt"></div> <span> </span></button>'),ai=U('<div class="filter-grid svelte-183y0dt"></div>');function ni(i,t){qe(t,!1);let e=b(t,"filters",24,()=>[]),n=b(t,"value",8,"original"),o=b(t,"imageUrl",8,""),r=b(t,"onChange",8,u=>{});Oe();var v=ai();bt(v,5,e,mt,(u,c)=>{var p=ti();let x;var k=g(p),z=l(k,2);let m;var _=g(z,!0);s(z),s(p),ae(()=>{x=ue(p,1,"filter-card svelte-183y0dt",null,x,{active:n()===a(c).id}),Ie(k,`
					background-image: url(${o()??""});
					filter: ${a(c),f(()=>a(c).css||"none")??""};
				`),m=ue(z,1,"filter-label svelte-183y0dt",null,m,{active:n()===a(c).id}),je(_,(a(c),f(()=>a(c).label)))}),d("click",p,()=>r()(a(c).id)),A(u,p)}),s(v),A(i,v),Ae()}var ii=U('<div class="filter-controls svelte-1274k9v"><!> <div><div class="slider-track svelte-1274k9v"><!></div> <button class="reset-btn svelte-1274k9v" aria-label="Reset filter"><img src="/icons/icon-reset.svg" alt="" class="reset-icon svelte-1274k9v"/></button></div></div>');function oi(i,t){qe(t,!1);const e=Q();let n=b(t,"imageUrl",8,""),o=b(t,"activeFilter",8,"original"),r=b(t,"filterStrength",8,50),v=b(t,"onFilterChange",8,y=>{}),u=b(t,"onStrengthChange",8,y=>{}),c=b(t,"onReset",8,()=>{});const p=[{id:"original",label:"Original",css:"none"},{id:"greyscale",label:"Greyscale",css:"grayscale(100%)"},{id:"sepia",label:"Sepia",css:"sepia(100%)"},{id:"sunset",label:"Sunset",css:"sepia(30%) saturate(140%) brightness(110%) hue-rotate(-10deg)"},{id:"azure",label:"Azure",css:"saturate(120%) brightness(105%) hue-rotate(180deg)"},{id:"teal",label:"Teal",css:"saturate(130%) hue-rotate(140deg)"}];Ge(()=>Be(o()),()=>{I(e,o()==="original")}),kt();var x=ii(),k=g(x);ni(k,{get filters(){return p},get value(){return o()},get imageUrl(){return n()},get onChange(){return v()}});var z=l(k,2);let m;var _=g(z),B=g(_);{let y=at(()=>a(e)?()=>{}:u());It(B,{label:"Strength",min:0,max:100,get value(){return r()},get onChange(){return a(y)}})}s(_);var h=l(_,2);s(z),s(x),ae(()=>m=ue(z,1,"slider-row svelte-1274k9v",null,m,{disabled:a(e)})),d("click",h,function(...y){c()?.apply(this,y)}),A(i,x),Ae()}const xa=[{id:"original",label:"Original",css:"none"},{id:"greyscale",label:"Greyscale",css:"grayscale(100%)"},{id:"sepia",label:"Sepia",css:"sepia(100%)"},{id:"sunset",label:"Sunset",css:"sepia(30%) saturate(140%) brightness(110%) hue-rotate(-10deg)"},{id:"azure",label:"Azure",css:"saturate(120%) brightness(105%) hue-rotate(180deg)"},{id:"teal",label:"Teal",css:"saturate(130%) hue-rotate(140deg)"}];function ri(i){const t=[i];let e=0,n=0;const o=yt({canUndo:!1,canRedo:!1}),{subscribe:r,set:v,update:u}=yt(i);function c(){o.set({canUndo:e>n,canRedo:e<t.length-1})}return{subscribe:r,undoState:o,set:p=>{t.splice(e+1),t.push(p),e=t.length-1,v(p),c()},update:p=>{u(x=>{const k=p(x);return t.splice(e+1),t.push(k),e=t.length-1,c(),k})},silentUpdate:p=>{u(p)},setBaseState:()=>{n=e,c()},undo:()=>{e>n&&(e--,v(t[e]),c())},redo:()=>{e<t.length-1&&(e++,v(t[e]),c())},canUndo:()=>e>n,canRedo:()=>e<t.length-1,reset:()=>{t.length=0,t.push(i),e=0,n=0,v(i),c()}}}const li={originalImage:null,currentImage:null,aspectRatio:"custom",width:0,height:0,ratioLocked:!1,scale:1,offsetX:0,offsetY:0,brightness:0,contrast:0,shadows:0,hdr:0,activeFilter:"original",filterStrength:50,cropBox:{x:0,y:0,width:0,height:0},isCropping:!1,cropPending:!1,imageWidth:0,imageHeight:0,blurEnabled:!1,blurBrushSize:50,blurStrength:50,blurSoften:50,blurInvert:!1,blurMask:null,showBrushPreview:!1,zoomLevel:1,zoomOffsetX:0,zoomOffsetY:0},pe=ri(li),Ht=yt("none"),si=aa(pe,i=>i.currentImage!==null);function ci(){pe.reset(),Ht.set("none")}var di=U('<div class="controls-panel svelte-c9tnuw"><!></div>'),vi=U('<div class="controls-panel svelte-c9tnuw"><!></div>'),ui=U("<!> <!> <!> <!>",1),gi=U('<div class="crop-tab svelte-c9tnuw"><!> <!> <!></div>');function hi(i,t){qe(t,!1);const e=()=>dt(pe,"$cropState",v),n=()=>dt(Ht,"$activeSubMenu",v),o=()=>dt(si,"$hasImage",v),r=()=>dt(k,"$undoState",v),[v,u]=Mt(),c=Q(),p=Q(),x=Q(),k=pe.undoState,z=[{id:"crop",label:"Crop"},{id:"edit",label:"Edit"},{id:"filter",label:"Filter"}];let m=Q(null),_=null;async function B(w){const M=await Ut(w);pe.set({...e(),originalImage:w,currentImage:w,imageWidth:M.width,imageHeight:M.height,width:M.width,height:M.height,cropBox:{x:0,y:0,width:100,height:100},isCropping:!0,cropPending:!1,aspectRatio:"custom",ratioLocked:!1}),pe.setBaseState(),Ht.set("crop")}function h(w){if(e().cropPending&&n()==="crop"&&w!=="crop"){_=()=>{Ht.set(w),pe.silentUpdate(M=>({...M,isCropping:!1}))},I(m,"save");return}w==="crop"?pe.silentUpdate(M=>({...M,isCropping:!0})):pe.silentUpdate(M=>({...M,isCropping:!1})),Ht.set(n()===w?"none":w)}async function y(){return await Cn(e().currentImage,a(x),e().blurMask)}async function T(){if(e().cropPending){_=async()=>{const w=await y();await Vt(w)},I(m,"save");return}if(e().currentImage){const w=await y();await Vt(w)}}async function L(){if(e().cropPending){_=async()=>{const w=await y();Kt(w,"picflam-export.png")},I(m,"save");return}if(e().currentImage){const w=await y();Kt(w,"picflam-export.png")}}function S(){I(m,"startAgain")}function H(){pe.undo()}function J(){pe.redo()}async function X(){I(m,null),await se(),_&&(await _(),_=null)}function O(){I(m,null),_=null}function q(){I(m,null),ci()}function Y(){I(m,null)}async function se(){const w=e();if(!w.currentImage||!w.cropPending)return;const M=await Ma(w.currentImage,w.cropBox,w.imageWidth,w.imageHeight),V=await Ut(M);pe.set({...w,currentImage:M,imageWidth:V.width,imageHeight:V.height,width:V.width,height:V.height,cropBox:{x:0,y:0,width:100,height:100},cropPending:!1})}function Ce(w){if(w==="custom"){pe.silentUpdate(P=>({...P,aspectRatio:"custom",cropBox:{x:0,y:0,width:100,height:100},ratioLocked:!1,cropPending:!1}));return}const V={"9:16":9/16,"1:1":1,"16:9":16/9}[w],re=e().imageWidth/e().imageHeight;let $;if(w==="9:16"){const W=V/re*100;if(W<=100)$={x:(100-W)/2,y:0,width:W,height:100};else{const de=re/V*100;$={x:0,y:(100-de)/2,width:100,height:de}}}else if(w==="16:9"){const W=re/V*100;if(W<=100)$={x:0,y:(100-W)/2,width:100,height:W};else{const de=V/re*100;$={x:(100-de)/2,y:0,width:de,height:100}}}else if(w==="1:1")if(re>1){const P=100/re;$={x:(100-P)/2,y:0,width:P,height:100}}else{const P=100*re;$={x:0,y:(100-P)/2,width:100,height:P}}pe.silentUpdate(P=>({...P,aspectRatio:w,cropBox:$,cropPending:!0,isCropping:!0,ratioLocked:!0}))}function me({width:w,height:M}){const V=e().imageWidth,re=e().imageHeight,$=Math.min(Math.max(1,w),V),P=Math.min(Math.max(1,M),re),W=$/V*100,de=P/re*100;let ve;if(e().ratioLocked){const ge=a(c)/a(p);if(w!==a(c)){const De=$/ge/re*100;ve={x:(100-W)/2,y:(100-Math.min(100,De))/2,width:W,height:Math.min(100,De)}}else{const De=P*ge/V*100;ve={x:(100-Math.min(100,De))/2,y:(100-de)/2,width:Math.min(100,De),height:de}}}else ve={x:(100-W)/2,y:(100-de)/2,width:W,height:de};pe.silentUpdate(ge=>({...ge,cropBox:ve,cropPending:!0}))}function N(){pe.silentUpdate(w=>({...w,ratioLocked:!w.ratioLocked}))}async function ee(){const w=await kn(e().currentImage);pe.set({...e(),currentImage:w})}async function E(){const w=await _n(e().currentImage,90),M=await Ut(w);pe.set({...e(),currentImage:w,imageWidth:M.width,imageHeight:M.height,cropBox:{x:0,y:0,width:100,height:100},cropPending:!1})}function D(w){pe.silentUpdate(M=>({...M,scale:w/100}))}function ie(w){const M=w.detail.cropBox;if(e().ratioLocked&&e().aspectRatio!=="custom"){const re={"9:16":.5625,"1:1":1,"16:9":1.7777777777777777}[e().aspectRatio];e().imageWidth/e().imageHeight;const $=M.width*e().imageWidth/(M.height*e().imageHeight);if(Math.abs($-re)>.01){const de=M.width/100*e().imageWidth/re/e().imageHeight*100;M.height=Math.min(100,de),M.y+M.height>100&&(M.y=100-M.height)}}pe.silentUpdate(V=>({...V,cropBox:M,cropPending:!0}))}function Se(){se()}let Re=null;function ze(){Re===null&&(Re={...e()})}function nt(){Re!==null&&(pe.set(e()),Re=null)}function Ee(w){ze(),pe.silentUpdate(M=>({...M,brightness:w}))}function Xe(w){ze(),pe.silentUpdate(M=>({...M,shadows:w}))}function He(w){ze(),pe.silentUpdate(M=>({...M,contrast:w}))}function Me(w){ze(),pe.silentUpdate(M=>({...M,hdr:w}))}function _e(w){pe.set({...e(),blurEnabled:w})}function Je(w){ze(),pe.silentUpdate(M=>({...M,blurBrushSize:w}))}function Ne(w){ze(),pe.silentUpdate(M=>({...M,blurStrength:w}))}function Ue(w){ze(),pe.silentUpdate(M=>({...M,blurSoften:w}))}function Fe(w){pe.set({...e(),blurInvert:w})}function it(w){pe.silentUpdate(M=>({...M,showBrushPreview:w}))}function Pe(){nt()}let he=null,xe=[],Ye=null;function Ze(w){const M=w.detail.point;Ye===null&&(Ye=e().blurMask?[...e().blurMask]:[]),xe.push(M),pe.silentUpdate(V=>({...V,blurMask:[...V.blurMask||[],M]})),he&&clearTimeout(he),he=setTimeout(()=>{if(xe.length>0){const V=[...Ye,...xe];pe.set({...e(),blurMask:V}),xe=[],Ye=null}he=null},300)}function Ve(w){pe.silentUpdate(M=>({...M,zoomLevel:w}))}function F(w){pe.silentUpdate(V=>{let{zoomOffsetX:re,zoomOffsetY:$}=V;switch(w){case"up":$-=20;break;case"down":$+=20;break;case"left":re-=20;break;case"right":re+=20;break}return{...V,zoomOffsetX:re,zoomOffsetY:$}})}function j(){pe.silentUpdate(w=>({...w,zoomLevel:1,zoomOffsetX:0,zoomOffsetY:0}))}function Z(w){pe.silentUpdate(M=>({...M,activeFilter:w}))}function be(w){ze(),pe.silentUpdate(M=>({...M,filterStrength:w}))}function fe(){pe.set({...e(),activeFilter:"original",filterStrength:50})}Ge(()=>e(),()=>{I(c,Math.round(e().imageWidth*e().cropBox.width/100))}),Ge(()=>e(),()=>{I(p,Math.round(e().imageHeight*e().cropBox.height/100))}),Ge(()=>(e(),xa),()=>{I(x,(()=>{let w=[];if(e().brightness!==0&&w.push(`brightness(${1+e().brightness/100})`),e().contrast!==0&&w.push(`contrast(${1+e().contrast/100})`),e().shadows!==0){const M=1+e().shadows/200;w.push(`brightness(${M})`)}if(e().hdr!==0){const M=1+e().hdr/100*.3,V=1+e().hdr/100*.2;w.push(`saturate(${M}) contrast(${V})`)}if(e().activeFilter!=="original"){const M=xa.find(V=>V.id===e().activeFilter);if(M&&M.css!=="none"){const V=e().filterStrength/100,re=M.css.replace(/(\d+)%/g,($,P)=>`${Math.round(parseInt(P)*V)}%`);w.push(re)}}return w.length>0?w.join(" "):"none"})())}),kt(),Oe();var ke=gi(),C=g(ke);{var R=w=>{Da(w,{title:"Crop, edit and add",subtitle:"filters to photos",hint:"Import, drag or paste an image",onImageImport:B})},ne=w=>{var M=ui(),V=Qe(M);oa(V,{get canUndo(){return r(),f(()=>r().canUndo)},get canRedo(){return r(),f(()=>r().canRedo)},onUndo:H,onRedo:J,onStartAgain:S,onCopy:T,onExport:L});var re=l(V,2);{let ve=at(()=>(n(),e(),f(()=>n()==="edit"?e().zoomLevel:e().scale))),ge=at(()=>(n(),e(),f(()=>n()==="edit"?e().zoomOffsetX:e().offsetX))),Le=at(()=>(n(),e(),f(()=>n()==="edit"?e().zoomOffsetY:e().offsetY))),De=at(()=>(e(),f(()=>e().blurMask||[])));qn(re,{get imageSrc(){return e(),f(()=>e().currentImage)},get cropBox(){return e(),f(()=>e().cropBox)},get isCropping(){return e(),f(()=>e().isCropping)},get scale(){return a(ve)},get offsetX(){return a(ge)},get offsetY(){return a(Le)},get imageWidth(){return e(),f(()=>e().imageWidth)},get imageHeight(){return e(),f(()=>e().imageHeight)},get editFilters(){return a(x)},get blurEnabled(){return e(),f(()=>e().blurEnabled)},get blurBrushSize(){return e(),f(()=>e().blurBrushSize)},get blurStrength(){return e(),f(()=>e().blurStrength)},get blurSoften(){return e(),f(()=>e().blurSoften)},get blurInvert(){return e(),f(()=>e().blurInvert)},get blurMask(){return a(De)},get showBrushPreview(){return e(),f(()=>e().showBrushPreview)},$$events:{cropChange:ie,blurPaint:Ze}})}var $=l(re,2);ra($,{get tabs(){return z},get activeTab(){return n()},onTabChange:h});var P=l($,2);{var W=ve=>{{let ge=at(()=>(e(),f(()=>Math.round(e().scale*100))));Jn(ve,{get aspectRatio(){return e(),f(()=>e().aspectRatio)},get cropWidth(){return a(c)},get cropHeight(){return a(p)},get ratioLocked(){return e(),f(()=>e().ratioLocked)},get scale(){return a(ge)},get cropPending(){return e(),f(()=>e().cropPending)},onRatioChange:Ce,onDimensionsChange:me,onLockToggle:N,onFlip:ee,onRotate:E,onScaleChange:D,onApply:Se})}},de=ve=>{var ge=xt(),Le=Qe(ge);{var De=Ke=>{var et=di(),tt=g(et);ei(tt,{get brightness(){return e(),f(()=>e().brightness)},get shadows(){return e(),f(()=>e().shadows)},get contrast(){return e(),f(()=>e().contrast)},get hdr(){return e(),f(()=>e().hdr)},get blurEnabled(){return e(),f(()=>e().blurEnabled)},get blurBrushSize(){return e(),f(()=>e().blurBrushSize)},get blurStrength(){return e(),f(()=>e().blurStrength)},get blurSoften(){return e(),f(()=>e().blurSoften)},get blurInvert(){return e(),f(()=>e().blurInvert)},get zoomLevel(){return e(),f(()=>e().zoomLevel)},onBrightnessChange:Ee,onShadowsChange:Xe,onContrastChange:He,onHdrChange:Me,onBlurToggle:_e,onBlurBrushSizeChange:Je,onBlurStrengthChange:Ne,onBlurSoftenChange:Ue,onBlurInvertChange:Fe,onZoomChange:Ve,onNudge:F,onResetZoom:j,onBrushPreviewChange:it,onEditEnd:Pe}),s(et),A(Ke,et)},lt=Ke=>{var et=xt(),tt=Qe(et);{var G=ye=>{var Te=vi(),$e=g(Te);oi($e,{get imageUrl(){return e(),f(()=>e().currentImage)},get activeFilter(){return e(),f(()=>e().activeFilter)},get filterStrength(){return e(),f(()=>e().filterStrength)},onFilterChange:Z,onStrengthChange:be,onReset:fe}),s(Te),A(ye,Te)};oe(tt,ye=>{n()==="filter"&&ye(G)},!0)}A(Ke,et)};oe(Le,Ke=>{n()==="edit"?Ke(De):Ke(lt,!1)},!0)}A(ve,ge)};oe(P,ve=>{n()==="crop"?ve(W):ve(de,!1)})}A(w,M)};oe(C,w=>{o()?w(ne,!1):w(R)})}var K=l(C,2);{var ce=w=>{$t(w,{message:"Save changes?",confirmText:"Yes",cancelText:"Cancel",onConfirm:X,onCancel:O})};oe(K,w=>{a(m)==="save"&&w(ce)})}var we=l(K,2);{var te=w=>{$t(w,{message:"Start again? Your changes will be lost.",confirmText:"Yes",cancelText:"Cancel",onConfirm:q,onCancel:Y})};oe(we,w=>{a(m)==="startAgain"&&w(te)})}s(ke),A(i,ke),Ae(),u()}var fi=U('<div class="before-after-container svelte-1i0ztfp" role="slider" aria-label="Before and after comparison" tabindex="0"><div class="before-image svelte-1i0ztfp"><img alt="Before" class="svelte-1i0ztfp"/></div> <div class="after-image svelte-1i0ztfp"><img alt="After" class="svelte-1i0ztfp"/></div> <div class="slider-handle svelte-1i0ztfp" role="presentation"><div class="slider-line svelte-1i0ztfp"></div> <div class="slider-thumb svelte-1i0ztfp"><img src="/icons/icon-ai-slider.svg" alt="" class="slider-icon svelte-1i0ztfp"/></div></div></div>');function bi(i,t){qe(t,!1);let e=b(t,"beforeImage",8,""),n=b(t,"afterImage",8,""),o=b(t,"position",12,50),r=b(t,"onChange",8,()=>{}),v=Q(),u=!1;Dt(()=>(window.addEventListener("mousemove",x),window.addEventListener("touchmove",k,{passive:!1}),window.addEventListener("mouseup",z),window.addEventListener("touchend",z),()=>{window.removeEventListener("mousemove",x),window.removeEventListener("touchmove",k),window.removeEventListener("mouseup",z),window.removeEventListener("touchend",z)}));function c(){u=!0}function p(H){H.touches.length===1&&(u=!0)}function x(H){!u||!a(v)||m(H.clientX)}function k(H){!u||!a(v)||H.touches.length!==1||(H.preventDefault(),m(H.touches[0].clientX))}function z(){u=!1}function m(H){const J=a(v).getBoundingClientRect(),X=Math.max(0,Math.min(100,(H-J.left)/J.width*100));o(X),r()(X)}function _(H){if(!a(v))return;const J=a(v).getBoundingClientRect(),X=(H.clientX-J.left)/J.width*100;o(Math.max(0,Math.min(100,X))),r()(o())}Oe();var B=fi(),h=g(B),y=g(h);s(h);var T=l(h,2),L=g(T);s(T);var S=l(T,2);s(B),ft(B,H=>I(v,H),()=>a(v)),ae(()=>{le(y,"src",e()),Ie(T,`clip-path: inset(0 ${100-o()}% 0 0)`),le(L,"src",n()),Ie(S,`left: ${o()??""}%`)}),d("mousedown",S,c),d("touchstart",S,p),d("click",B,_),A(i,B),Ae()}const wa={originalImage:null,currentImage:null,processedImage:null,isProcessing:!1,processingType:null,upscaleFactor:1,showComparison:!1,comparisonPosition:50};function pi(){const{subscribe:i,set:t,update:e}=yt(wa);return{subscribe:i,setImage:n=>e(o=>({...o,originalImage:n,currentImage:n,processedImage:null})),startProcessing:n=>e(o=>({...o,isProcessing:!0,processingType:n})),finishProcessing:n=>e(o=>({...o,isProcessing:!1,processingType:null,processedImage:n,currentImage:n,showComparison:!0})),cancelProcessing:()=>e(n=>({...n,isProcessing:!1,processingType:null})),setUpscaleFactor:n=>e(o=>({...o,upscaleFactor:n})),setComparisonPosition:n=>e(o=>({...o,comparisonPosition:n})),reset:()=>t(wa)}}const ot=pi(),ya=yt("enhance"),mi=aa(ot,i=>i.currentImage!==null);let At=null;async function xi(i,t=4,e){e?.("Invoking AI ...");const n=await fetch("/api/face-enhance",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({image:i,scale:t,faceEnhance:.5})}),o=await n.json();if(!n.ok)throw new Error(o.error||`API error: ${n.status}`);if(o.status==="succeeded"&&o.output)return e?.("Final checks ..."),await Aa(o.output);if(o.status==="processing"||o.status==="starting")return e?.("Processing with CodeFormer..."),await wi(o.pollUrl,e);throw new Error("Unexpected response")}async function wi(i,t,e=60){for(let n=0;n<e;n++){await new Promise(v=>setTimeout(v,2e3));const o=await fetch(`/api/upscale?pollUrl=${encodeURIComponent(i)}`),r=await o.json();if(!o.ok)throw new Error(r.error||`Polling error: ${o.status}`);if(r.status==="succeeded"&&r.output)return t?.("Final checks ..."),await Aa(r.output);if(r.status==="failed")throw new Error(r.error||"Upscaling failed");t?.(`Processing in cloud (${(n+1)*2}s)...`)}throw new Error("Timeout waiting for result")}async function Aa(i){const e=await(await fetch(i)).blob();return new Promise((n,o)=>{const r=new FileReader;r.onload=()=>n(r.result),r.onerror=o,r.readAsDataURL(e)})}async function yi(i){if(At)return At;console.log("[AI] Loading RMBG background removal model...");const{pipeline:t,env:e}=await ln(async()=>{const{pipeline:n,env:o}=await import("../chunks/bLAnV4ll.js");return{pipeline:n,env:o}},[],import.meta.url);e.allowLocalModels=!1;try{At=await t("image-segmentation","briaai/RMBG-1.4",{device:"webgpu",dtype:"fp32"}),console.log("[AI] RMBG model ready (WebGPU)")}catch(n){console.log("[AI] WebGPU not available, falling back to WASM...",n.message),At=await t("image-segmentation","briaai/RMBG-1.4",{dtype:"q8"}),console.log("[AI] RMBG model ready (WASM)")}return At}async function _i(i,t){try{console.log("[AI] Starting background removal..."),t?.("Starting engine ...");const e=await yi(t);t?.("Processing ...");const n=await e(i);if(console.log("[AI] Segmentation result:",n),!n||n.length===0)throw new Error("No segmentation result returned");const o=n[0];if(console.log("[AI] Segment keys:",Object.keys(o)),o.mask&&o.mask.toDataURL)return console.log("[AI] Background removal complete (RawImage mask)"),await _a(i,o.mask);if(o.mask&&o.mask.data)return console.log("[AI] Background removal complete (data mask)"),await _a(i,o.mask);if(typeof o=="string"&&o.startsWith("data:"))return console.log("[AI] Background removal complete (direct output)"),o;throw console.log("[AI] Segment structure:",JSON.stringify(o,null,2).substring(0,500)),new Error("Unexpected segmentation result format")}catch(e){throw console.error("[AI] Background removal failed:",e),new Error("Background removal failed: "+e.message)}}async function _a(i,t){return new Promise((e,n)=>{const o=new Image;o.onload=async()=>{try{const r=document.createElement("canvas");r.width=o.width,r.height=o.height;const v=r.getContext("2d");v.drawImage(o,0,0);const u=v.getImageData(0,0,r.width,r.height),c=u.data;let p,x,k;if(t.toDataURL){const m=document.createElement("canvas");m.width=t.width,m.height=t.height;const _=m.getContext("2d"),B=new Image;B.onload=()=>{_.drawImage(B,0,0);const h=_.getImageData(0,0,t.width,t.height);ka(c,h.data,r.width,r.height,t.width,t.height,!0),v.putImageData(u,0,0),e(r.toDataURL("image/png"))},B.onerror=n,B.src=t.toDataURL();return}else p=t.data,x=t.width,k=t.height;const z=p.length===x*k*4;ka(c,p,r.width,r.height,x,k,z),v.putImageData(u,0,0),e(r.toDataURL("image/png"))}catch(r){n(r)}},o.onerror=n,o.src=i})}function ka(i,t,e,n,o,r,v){const u=o/e,c=r/n;for(let p=0;p<n;p++)for(let x=0;x<e;x++){const k=Math.floor(x*u),z=Math.floor(p*c);let m;if(v){const B=(z*o+k)*4;m=t[B]}else{const B=z*o+k;m=t[B]||0}const _=(p*e+x)*4;i[_+3]=m}}var ki=U('<button class="processing-btn svelte-1rgvkgu" disabled><span class="spinner svelte-1rgvkgu"></span> </button> <button class="cancel-btn svelte-1rgvkgu">Cancel</button>',1),Ci=U('<div class="size-display svelte-1rgvkgu"> </div>'),Si=U('<button class="upscale-btn svelte-1rgvkgu"><img src="/icons/icon-ai.svg" alt="" class="btn-icon svelte-1rgvkgu"/> Upscale image</button> <!>',1),Ii=U('<div class="error-message svelte-1rgvkgu"> </div>'),zi=U('<div class="upscale-controls svelte-1rgvkgu"><div class="controls-content svelte-1rgvkgu"><!> <!></div></div>');function Fi(i,t){qe(t,!1);const e=()=>dt(ot,"$aiState",n),[n,o]=Mt(),r=4;let v=Q(!1),u=Q(""),c=Q(null),p=Q(null);async function x(){try{const S=await _t(e().originalImage),H=Math.round(S.naturalWidth*r),J=Math.round(S.naturalHeight*r);I(p,`${H} x ${J}`)}catch(S){console.error("Failed to get image dimensions:",S)}}async function k(){if(e().originalImage)try{I(v,!0),I(c,null),I(u,"Starting..."),ot.startProcessing("upscale");const S=await xi(e().originalImage,r,H=>{I(u,H)});ot.finishProcessing(S)}catch(S){I(c,S.message||"Upscaling failed"),ot.cancelProcessing()}finally{I(v,!1),I(u,"")}}function z(){I(v,!1),I(u,""),I(c,null),ot.cancelProcessing()}Ge(()=>e(),()=>{e().originalImage&&x()}),kt(),Oe();var m=zi(),_=g(m),B=g(_);{var h=S=>{var H=ki(),J=Qe(H),X=l(g(J));s(J);var O=l(J,2);ae(()=>je(X,` ${a(u)||"Processing..."}`)),d("click",O,z),A(S,H)},y=S=>{var H=Si(),J=Qe(H),X=l(J,2);{var O=q=>{var Y=Ci(),se=g(Y);s(Y),ae(()=>je(se,`Output: ${a(p)??""}`)),A(q,Y)};oe(X,q=>{a(p)&&q(O)})}d("click",J,k),A(S,H)};oe(B,S=>{a(v)?S(h):S(y,!1)})}var T=l(B,2);{var L=S=>{var H=Ii(),J=g(H,!0);s(H),ae(()=>je(J,a(c))),A(S,H)};oe(T,S=>{a(c)&&S(L)})}s(_),s(m),A(i,m),Ae(),o()}var Bi=U('<img alt="Original" class="compare-overlay svelte-1ibkqf6"/>'),Ri=U('<div class="brush-indicator svelte-1ibkqf6"></div>'),Ei=U('<div class="brush-preview svelte-1ibkqf6"></div>'),Pi=U('<div class="drawer-overlay svelte-1ibkqf6" role="presentation"><div class="drawer svelte-1ibkqf6" role="dialog"><div class="drawer-header svelte-1ibkqf6"><button class="icon-btn svelte-1ibkqf6" title="Undo"><img src="/icons/icon-undo.svg" alt="Undo" class="svelte-1ibkqf6"/></button> <button class="icon-btn svelte-1ibkqf6" title="Redo"><img src="/icons/icon-redo.svg" alt="Redo" class="svelte-1ibkqf6"/></button> <div class="spacer svelte-1ibkqf6"></div> <button title="Compare"><img src="/icons/icon-compare.svg" alt="Compare" class="svelte-1ibkqf6"/></button></div> <div class="canvas-container svelte-1ibkqf6"><div class="canvas-wrapper svelte-1ibkqf6" role="presentation"><canvas class="svelte-1ibkqf6"></canvas> <!> <!> <!></div></div> <div class="controls-section svelte-1ibkqf6"><div class="button-group svelte-1ibkqf6"><button><img src="/icons/icon-erase.svg" alt="" class="svelte-1ibkqf6"/> Erase</button> <button><img src="/icons/icon-restore.svg" alt="" class="svelte-1ibkqf6"/> Restore</button></div> <div class="control-row svelte-1ibkqf6"><label class="svelte-1ibkqf6">Brush size</label> <div class="control-item svelte-1ibkqf6"><!> <button class="reset-btn svelte-1ibkqf6" title="Reset"><img src="/icons/icon-reset.svg" alt="Reset" class="svelte-1ibkqf6"/></button></div></div> <div class="control-row svelte-1ibkqf6"><label class="svelte-1ibkqf6">Soften edges</label> <div class="control-item svelte-1ibkqf6"><!> <button class="reset-btn svelte-1ibkqf6" title="Reset"><img src="/icons/icon-reset.svg" alt="Reset" class="svelte-1ibkqf6"/></button></div></div> <div class="control-row svelte-1ibkqf6"><label class="svelte-1ibkqf6">Zoom in</label> <div class="control-item svelte-1ibkqf6"><!> <button class="reset-btn svelte-1ibkqf6" title="Reset"><img src="/icons/icon-reset.svg" alt="Reset" class="svelte-1ibkqf6"/></button></div></div> <div class="nudge-buttons svelte-1ibkqf6"><button class="nudge-btn svelte-1ibkqf6">â</button> <button class="nudge-btn svelte-1ibkqf6">â</button> <button class="nudge-btn svelte-1ibkqf6">â</button> <button class="nudge-btn svelte-1ibkqf6">â</button></div> <div class="drawer-footer svelte-1ibkqf6"><button class="btn-cancel svelte-1ibkqf6">Cancel</button> <button class="btn-done svelte-1ibkqf6">Done</button></div></div></div></div>');function Li(i,t){qe(t,!1);const e=Q();let n=b(t,"image",8,""),o=b(t,"originalFullImage",8,""),r=b(t,"onClose",8,()=>{}),v=b(t,"onSave",8,()=>{}),u=Q(),c=Q(),p,x=Q(!0),k=Q(20),z=Q(50),m=Q(1),_=Q(0),B=Q(0),h=!1,y=[],T=0,L=null,S=Q({x:0,y:0,visible:!1}),H=Q(!1),J=Q(0),X=Q(0),O=Q(!1);Dt(async()=>{const G=await _t(n());va(u,a(u).width=G.naturalWidth),va(u,a(u).height=G.naturalHeight),p=a(u).getContext("2d"),p.drawImage(G,0,0),o()?L=await _t(o()):L=G,q(),Y()});function q(){if(a(c)){const G=a(c).getBoundingClientRect();I(J,G.width),I(X,G.height)}}function Y(){y=y.slice(0,T+1),y.push(a(u).toDataURL()),T=y.length-1}function se(){T>0&&(T--,me())}function Ce(){T<y.length-1&&(T++,me())}function me(){const G=new Image;G.onload=()=>{p.clearRect(0,0,a(u).width,a(u).height),p.drawImage(G,0,0)},G.src=y[T]}function N(G){const ye=a(c).getBoundingClientRect(),Te=a(u).width/ye.width,$e=a(u).height/ye.height,vt=(G.clientX-ye.left)*Te,zt=(G.clientY-ye.top)*$e;return{x:vt,y:zt}}function ee(G){h=!0;const{x:ye,y:Te}=N(G);Se(ye,Te)}function E(G){const ye=a(c).getBoundingClientRect();if(I(S,{x:G.clientX-ye.left,y:G.clientY-ye.top,visible:!0}),!h)return;const{x:Te,y:$e}=N(G);Se(Te,$e)}function D(){h&&(h=!1,Y())}function ie(){I(S,{...a(S),visible:!1}),h&&(h=!1,Y())}function Se(G,ye){const Te=a(u).width/a(c).getBoundingClientRect().width,$e=a(e)/2*Te,vt=a(z)/100,zt=Math.min($e-.001,$e*(1-vt));p.save();try{if(a(x)){const ut=p.createRadialGradient(G,ye,zt,G,ye,$e);ut.addColorStop(0,"rgba(0,0,0,1)"),ut.addColorStop(1,"rgba(0,0,0,0)"),p.globalCompositeOperation="destination-out",p.fillStyle=ut,p.beginPath(),p.arc(G,ye,$e,0,Math.PI*2),p.fill()}else{if(!L)return;const ut=document.createElement("canvas");ut.width=a(u).width,ut.height=a(u).height;const pt=ut.getContext("2d"),Ft=pt.createRadialGradient(G,ye,zt,G,ye,$e);Ft.addColorStop(0,"rgba(0,0,0,1)"),Ft.addColorStop(1,"rgba(0,0,0,0)"),pt.globalCompositeOperation="source-over",pt.drawImage(L,0,0,ut.width,ut.height),pt.globalCompositeOperation="destination-in",pt.fillStyle=Ft,pt.beginPath(),pt.arc(G,ye,$e,0,Math.PI*2),pt.fill(),p.globalCompositeOperation="source-over",p.drawImage(ut,0,0)}}finally{p.restore()}}function Re(){I(k,20)}function ze(){I(z,50)}function nt(){I(m,1),I(_,0),I(B,0)}function Ee(G){switch(G){case"up":I(B,a(B)-10);break;case"down":I(B,a(B)+10);break;case"left":I(_,a(_)-10);break;case"right":I(_,a(_)+10);break}}function Xe(){r()()}function He(){const G=a(u).toDataURL("image/png");v()(G)}Ge(()=>(a(k),a(J),a(X)),()=>{I(e,a(k)/100*Math.min(a(J)||300,a(X)||300)*.5)}),kt(),Oe();var Me=Pi(),_e=g(Me),Je=g(_e),Ne=g(Je),Ue=l(Ne,2),Fe=l(Ue,4);let it;s(Je);var Pe=l(Je,2),he=g(Pe),xe=g(he);ft(xe,G=>I(u,G),()=>a(u));var Ye=l(xe,2);{var Ze=G=>{var ye=Bi();ae(()=>le(ye,"src",o())),A(G,ye)};oe(Ye,G=>{a(O)&&o()&&G(Ze)})}var Ve=l(Ye,2);{var F=G=>{var ye=Ri();ae(()=>Ie(ye,`
							left: ${a(S),f(()=>a(S).x)??""}px;
							top: ${a(S),f(()=>a(S).y)??""}px;
							width: ${a(e)??""}px;
							height: ${a(e)??""}px;
						`)),A(G,ye)};oe(Ve,G=>{a(S),a(J),f(()=>a(S).visible&&a(J)>0)&&G(F)})}var j=l(Ve,2);{var Z=G=>{var ye=Ei();ae(()=>Ie(ye,`
						left: ${a(J)/2}px;
						top: ${a(X)/2}px;
						width: ${a(e)??""}px;
						height: ${a(e)??""}px;
					`)),A(G,ye)};oe(j,G=>{a(H)&&a(J)>0&&a(X)>0&&G(Z)})}s(he),ft(he,G=>I(c,G),()=>a(c)),s(Pe);var be=l(Pe,2),fe=g(be),ke=g(fe);let C;var R=l(ke,2);let ne;s(fe);var K=l(fe,2),ce=l(g(K),2),we=g(ce);It(we,{min:5,max:100,step:1,get value(){return a(k)},onChange:G=>I(k,G),onInteractionStart:()=>{q(),I(H,!0)},onInteractionEnd:()=>I(H,!1)});var te=l(we,2);s(ce),s(K);var w=l(K,2),M=l(g(w),2),V=g(M);It(V,{min:0,max:100,step:1,get value(){return a(z)},onChange:G=>I(z,G)});var re=l(V,2);s(M),s(w);var $=l(w,2),P=l(g($),2),W=g(P);It(W,{min:1,max:3,step:.1,get value(){return a(m)},onChange:G=>I(m,G)});var de=l(W,2);s(P),s($);var ve=l($,2),ge=g(ve),Le=l(ge,2),De=l(Le,2),lt=l(De,2);s(ve);var Ke=l(ve,2),et=g(Ke),tt=l(et,2);s(Ke),s(be),s(_e),s(Me),ae(()=>{it=ue(Fe,1,"icon-btn svelte-1ibkqf6",null,it,{active:a(O)}),Ie(he,`transform: scale(${a(m)??""}) translate(${a(_)??""}px, ${a(B)??""}px)`),C=ue(ke,1,"mode-btn svelte-1ibkqf6",null,C,{active:a(x)}),ne=ue(R,1,"mode-btn svelte-1ibkqf6",null,ne,{active:!a(x)})}),d("click",Ne,se),d("click",Ue,Ce),d("mousedown",Fe,()=>I(O,!0)),d("mouseup",Fe,()=>I(O,!1)),d("mouseleave",Fe,()=>I(O,!1)),d("touchstart",Fe,()=>I(O,!0)),d("touchend",Fe,()=>I(O,!1)),d("mousedown",he,ee),d("mousemove",he,E),d("mouseup",he,D),d("mouseleave",he,ie),d("click",ke,()=>I(x,!0)),d("click",R,()=>I(x,!1)),d("click",te,Re),d("click",re,ze),d("click",de,nt),d("click",ge,()=>Ee("up")),d("click",Le,()=>Ee("down")),d("click",De,()=>Ee("left")),d("click",lt,()=>Ee("right")),d("click",et,Xe),d("click",tt,He),d("click",_e,gt(function(G){Zt.call(this,t,G)})),d("click",Me,Xe),A(i,Me),Ae()}var Mi=U('<button class="processing-btn svelte-1wdmsm1" disabled><span class="spinner svelte-1wdmsm1"></span> </button> <button class="cancel-btn svelte-1wdmsm1">Cancel</button>',1),Di=U('<button class="remove-btn svelte-1wdmsm1"><img src="/icons/icon-ai.svg" alt="" class="btn-icon svelte-1wdmsm1"/> Remove background</button>'),qi=U('<div class="error-message svelte-1wdmsm1"> </div>'),Ai=U('<div class="background-controls svelte-1wdmsm1"><div class="controls-content svelte-1wdmsm1"><!> <button class="erase-btn svelte-1wdmsm1"><img src="/icons/icon-erase.svg" alt="" class="btn-icon svelte-1wdmsm1"/> Erase and restore</button> <!></div> <!></div>');function Ti(i,t){qe(t,!1);const e=()=>dt(ot,"$aiState",n),[n,o]=Mt(),r=Q();let v=Q(!1),u=Q(""),c=Q(null),p=Q(!1);async function x(){if(e().originalImage)try{I(v,!0),I(c,null),I(u,"Starting..."),ot.startProcessing("background");const O=await _i(e().originalImage,q=>{I(u,q)});ot.finishProcessing(O)}catch(O){I(c,O.message||"Background removal failed"),ot.cancelProcessing()}finally{I(v,!1),I(u,"")}}function k(){I(v,!1),I(u,""),I(c,null),ot.cancelProcessing()}function z(){I(p,!0)}function m(){I(p,!1)}Ge(()=>e(),()=>{I(r,e().showComparison&&e().processedImage)}),kt(),Oe();var _=Ai(),B=g(_),h=g(B);{var y=O=>{var q=Mi(),Y=Qe(q),se=l(g(Y));s(Y);var Ce=l(Y,2);ae(()=>je(se,` ${a(u)||"Processing..."}`)),d("click",Ce,k),A(O,q)},T=O=>{var q=Di();d("click",q,x),A(O,q)};oe(h,O=>{a(v)?O(y):O(T,!1)})}var L=l(h,2),S=l(L,2);{var H=O=>{var q=qi(),Y=g(q,!0);s(q),ae(()=>je(Y,a(c))),A(O,q)};oe(S,O=>{a(c)&&O(H)})}s(B);var J=l(B,2);{var X=O=>{Li(O,{get image(){return e(),f(()=>e().processedImage)},get originalFullImage(){return e(),f(()=>e().originalImage)},onClose:m,onSave:q=>{ot.finishProcessing(q),I(p,!1)}})};oe(J,O=>{a(p)&&O(X)})}s(_),ae(()=>L.disabled=!a(r)),d("click",L,z),A(i,_),Ae(),o()}var Oi=U('<img alt="Working image" class="working-image svelte-17agwu4"/>'),Hi=U('<!> <div class="image-container svelte-17agwu4"><!></div> <!> <!>',1),Ni=U('<div class="ai-tab svelte-17agwu4"><!></div>');function Ui(i,t){qe(t,!1);const e=()=>dt(ot,"$aiState",r),n=()=>dt(mi,"$hasAiImage",r),o=()=>dt(ya,"$activeAiMenu",r),[r,v]=Mt();let u=Q(50);function c(T){I(u,T),ot.setComparisonPosition(T)}const p=[{id:"upscale",label:"Upscale"},{id:"background",label:"Remove background"}];function x(T){ot.setImage(T)}function k(T){ya.set(T)}async function z(){e().currentImage&&await Vt(e().currentImage)}function m(){e().currentImage&&Kt(e().currentImage,"picflam-ai.png")}Oe();var _=Ni(),B=g(_);{var h=T=>{Da(T,{title:"Remove backgrounds,",subtitle:"upscale images with AI",hint:"Import, drag or paste an image",onImageImport:x})},y=T=>{var L=Hi(),S=Qe(L);oa(S,{canUndo:!1,canRedo:!1,onUndo:()=>{},onRedo:()=>{},onStartAgain:()=>ot.reset(),onCopy:z,onExport:m});var H=l(S,2),J=g(H);{var X=me=>{bi(me,{get beforeImage(){return e().originalImage},get afterImage(){return e().processedImage},get position(){return a(u)},onChange:c})},O=me=>{var N=Oi();ae(()=>le(N,"src",e().currentImage)),A(me,N)};oe(J,me=>{e().showComparison&&e().processedImage?me(X):me(O,!1)})}s(H);var q=l(H,2);ra(q,{get tabs(){return p},get activeTab(){return o()},onTabChange:k});var Y=l(q,2);{var se=me=>{Fi(me,{})},Ce=me=>{var N=xt(),ee=Qe(N);{var E=D=>{Ti(D,{})};oe(ee,D=>{o()==="background"&&D(E)},!0)}A(me,N)};oe(Y,me=>{o()==="upscale"?me(se):me(Ce,!1)})}A(T,L)};oe(B,T=>{n()?T(y,!1):T(h)})}s(_),A(i,_),Ae(),v()}var Yi=U('<div class="size-controls svelte-1l8e210"><!></div>');function Wi(i,t){qe(t,!1);let e=b(t,"canvasSize",8,"1/1"),n=b(t,"onSizeChange",8,c=>{});const o=[{id:"9/16",label:"9:16",icon:"icon-vertical"},{id:"1/1",label:"1:1",icon:"icon-square"},{id:"16/9",label:"16:9",icon:"icon-horizontal"}];function r(c){n()(c)}Oe();var v=Yi(),u=g(v);qa(u,{get options(){return o},get value(){return e()},onChange:r,showLabels:!0,centered:!0}),s(v),A(i,v),Ae()}var ji=U("<button></button>"),Xi=U('<button aria-label="Custom color"></button> <input type="color" style="display: none;"/>',1),Gi=U('<div class="color-swatches svelte-x97jji"><!> <!></div>');function Lt(i,t){qe(t,!1);let e=b(t,"colors",24,()=>[]),n=b(t,"value",8,""),o=b(t,"onChange",8,_=>{}),r=b(t,"showRainbow",8,!0),v=Q("#5422b0"),u=Q();function c(){a(u)&&a(u).click()}function p(_){I(v,_.target.value),o()(a(v))}Oe();var x=Gi(),k=g(x);bt(k,1,e,mt,(_,B)=>{var h=ji();let y;ae(()=>{y=ue(h,1,"swatch svelte-x97jji",null,y,{active:n()===a(B),white:a(B)==="#FFFFFF"}),Ie(h,`background-color: ${a(B)??""}; ${n()===a(B)&&a(B)!=="#FFFFFF"?`box-shadow: 0 0 0 3px ${a(B)};`:""}`),le(h,"aria-label",`Select color ${a(B)??""}`)}),d("click",h,()=>o()(a(B))),A(_,h)});var z=l(k,2);{var m=_=>{var B=Xi(),h=Qe(B);let y;var T=l(h,2);ct(T),ft(T,L=>I(u,L),()=>a(u)),ae((L,S,H)=>{y=ue(h,1,"swatch rainbow svelte-x97jji",null,y,L),Ie(h,`border-color: ${S??""}; ${H??""}`),rt(T,a(v))},[()=>({active:n()&&!e().includes(n())&&n()!=="transparent"}),()=>(Be(n()),Be(e()),a(v),f(()=>n()&&!e().includes(n())&&n()!=="transparent"?a(v):"#999999")),()=>(Be(n()),Be(e()),f(()=>n()&&!e().includes(n())&&n()!=="transparent"?"box-shadow: inset 0 0 0 2px white;":""))]),d("click",h,c),d("input",T,p),A(_,B)};oe(z,_=>{r()&&_(m)})}s(x),A(i,x),Ae()}const Pt={solids:["#FFFFFF","#000000","#007C1F","#00679D","#B20715"],gradients:["linear-gradient(135deg, #5422b0 0%, #4B0082 100%)","linear-gradient(135deg, #15509B 0%, #20244F 100%)","linear-gradient(135deg, #A8076B 0%, #62045F 100%)","linear-gradient(135deg, #EA5C56 0%, #3C0C40 100%)","linear-gradient(135deg, #0A8F9D 0%, #202B54 100%)","linear-gradient(135deg, #D17A29 0%, #41363C 100%)"]},Ta=["Inter","Roboto Slab","Saira Condensed","Lora","Playfair Display","Special Elite"],Tt={up:"to top",down:"to bottom",left:"to left",right:"to right"},Qi={canvasSize:"1/1",background:{type:"solid",value:"#FFFFFF",direction:"down",gradientColors:["#5422b0","#4B0082"]},text1:"",text1Font:"Inter",text1Size:5,text1YPosition:3,text1LineSpacing:5,text1Color:"#000000",text1HighlightColor:"transparent",text1IsBold:!0,text1Align:"center",text1QuoteStyle:"none",text1QuoteSize:5,text2:"",text2Font:"Inter",text2Size:3,text2YPosition:8,text2LineSpacing:5,text2Color:"#000000",text2LabelColor:"transparent",text2IsBold:!1,text2Align:"center",overlay:null,overlaySize:50,overlayOpacity:100,overlayX:50,overlayY:50,overlayMask:"none",overlayLayer:"above",overlayBorderWidth:0,overlayBorderColor:"#FFFFFF",overlayNaturalWidth:0,overlayNaturalHeight:0,overlayZoom:100,overlayImageOffsetX:0,overlayImageOffsetY:0};function Ji(i){const t=[JSON.parse(JSON.stringify(i))];let e=0;const{subscribe:n,set:o,update:r}=yt(i);return{subscribe:n,set:v=>{t.splice(e+1),t.push(JSON.parse(JSON.stringify(v))),e=t.length-1,o(v)},update:v=>{r(u=>{const c=v(u);return t.splice(e+1),t.push(JSON.parse(JSON.stringify(c))),e=t.length-1,c})},undo:()=>e>0?(e--,o(JSON.parse(JSON.stringify(t[e]))),!0):!1,redo:()=>e<t.length-1?(e++,o(JSON.parse(JSON.stringify(t[e]))),!0):!1,canUndo:()=>e>0,canRedo:()=>e<t.length-1,reset:()=>{const v=JSON.parse(JSON.stringify(i));t.length=0,t.push(v),e=0,o(v)}}}const We=Ji(Qi),ea=yt(!0),ht=yt("none");aa(We,i=>i.text1||i.text2||i.overlay||i.background.value!=="#FFFFFF");function Zi(){We.reset(),ea.set(!0),ht.set("none")}var Vi=U('<button aria-label="Select gradient"></button>'),Ki=U('<div class="background-controls svelte-18tfgkp"><div class="section svelte-18tfgkp"><div class="color-row svelte-18tfgkp"><!></div></div> <div class="section svelte-18tfgkp"><div class="gradient-row svelte-18tfgkp"></div></div> <div class="section svelte-18tfgkp"><div class="gradient-preview-row svelte-18tfgkp"><button class="gradient-endpoint svelte-18tfgkp" aria-label="Edit start color"></button> <div class="gradient-preview svelte-18tfgkp"></div> <button class="gradient-endpoint svelte-18tfgkp" aria-label="Edit end color"></button></div></div> <div class="section svelte-18tfgkp"><div><button aria-label="Gradient direction up"><img src="/icons/icon-nudge-up.svg" alt="" class="direction-icon svelte-18tfgkp"/></button> <button aria-label="Gradient direction down"><img src="/icons/icon-nudge-down.svg" alt="" class="direction-icon svelte-18tfgkp"/></button> <button aria-label="Gradient direction left"><img src="/icons/icon-nudge-left.svg" alt="" class="direction-icon svelte-18tfgkp"/></button> <button aria-label="Gradient direction right"><img src="/icons/icon-nudge-right.svg" alt="" class="direction-icon svelte-18tfgkp"/></button></div></div></div>');function $i(i,t){qe(t,!1);const e=Q();let n=b(t,"background",24,()=>({type:"solid",value:"#FFFFFF",direction:"down",gradientColors:["#5422b0","#4B0082"]})),o=b(t,"onBackgroundChange",8,E=>{});const r=Pt.gradients.map(E=>{const D=E.match(/#[A-Fa-f0-9]{6}/g);return D?[D[0],D[1]]:["#5422b0","#4B0082"]});function v(E){o()({...n(),type:"solid",value:E})}function u(E){const D=r[E],ie=Tt[n().direction]||"to bottom";o()({...n(),type:"gradient",value:`linear-gradient(${ie}, ${D[0]} 0%, ${D[1]} 100%)`,gradientColors:D})}function c(E){const D=Tt[E],ie=n().gradientColors||["#5422b0","#4B0082"];o()({...n(),direction:E,value:`linear-gradient(${D}, ${ie[0]} 0%, ${ie[1]} 100%)`})}function p(E,D){const ie=[...n().gradientColors||["#5422b0","#4B0082"]];ie[E]=D;const Se=Tt[n().direction]||"to bottom";o()({...n(),type:"gradient",value:`linear-gradient(${Se}, ${ie[0]} 0%, ${ie[1]} 100%)`,gradientColors:ie})}Ge(()=>(Be(n()),Tt),()=>{I(e,n().type==="gradient"?`linear-gradient(${Tt[n().direction]||"to bottom"}, ${n().gradientColors?.[0]||"#5422b0"} 0%, ${n().gradientColors?.[1]||"#4B0082"} 100%)`:`linear-gradient(to bottom, ${r[0][0]} 0%, ${r[0][1]} 100%)`)}),kt(),Oe();var x=Ki(),k=g(x),z=g(k),m=g(z);{let E=at(()=>(Be(n()),f(()=>n().type==="solid"?n().value:"")));Lt(m,{get colors(){return Be(Pt),f(()=>Pt.solids)},get value(){return a(E)},onChange:v,showRainbow:!0})}s(z),s(k);var _=l(k,2),B=g(_);bt(B,5,()=>r,mt,(E,D,ie)=>{const Se=at(()=>(Be(n()),a(D),f(()=>n().type==="gradient"&&n().gradientColors?.[0]===a(D)[0]&&n().gradientColors?.[1]===a(D)[1])));var Re=Vi();let ze;ae(()=>{ze=ue(Re,1,"gradient-swatch svelte-18tfgkp",null,ze,{active:a(Se)}),Ie(Re,`background: linear-gradient(135deg, ${a(D),f(()=>a(D)[0])??""} 0%, ${a(D),f(()=>a(D)[1])??""} 100%); border-color: ${a(D),f(()=>a(D)[0])??""}; ${a(Se)?"box-shadow: inset 0 0 0 2px white;":""}`)}),d("click",Re,()=>u(ie)),A(E,Re)}),s(B),s(_);var h=l(_,2),y=g(h),T=g(y),L=l(T,2),S=l(L,2);s(y),s(h);var H=l(h,2),J=g(H);let X;var O=g(J);let q;var Y=l(O,2);let se;var Ce=l(Y,2);let me;var N=l(Ce,2);let ee;s(J),s(H),s(x),ae(()=>{Ie(T,`background-color: ${Be(n()),f(()=>n().gradientColors?.[0]||"#5422b0")??""};`),Ie(L,`background: ${a(e)??""};`),Ie(S,`background-color: ${Be(n()),f(()=>n().gradientColors?.[1]||"#4B0082")??""};`),X=ue(J,1,"direction-row svelte-18tfgkp",null,X,{inactive:n().type!=="gradient"}),q=ue(O,1,"direction-btn svelte-18tfgkp",null,q,{active:n().direction==="up"}),se=ue(Y,1,"direction-btn svelte-18tfgkp",null,se,{active:n().direction==="down"}),me=ue(Ce,1,"direction-btn svelte-18tfgkp",null,me,{active:n().direction==="left"}),ee=ue(N,1,"direction-btn svelte-18tfgkp",null,ee,{active:n().direction==="right"})}),d("click",T,()=>{const E=document.createElement("input");E.type="color",E.value=n().gradientColors?.[0]||"#5422b0",E.addEventListener("input",D=>p(0,D.target.value)),E.click()}),d("click",S,()=>{const E=document.createElement("input");E.type="color",E.value=n().gradientColors?.[1]||"#4B0082",E.addEventListener("input",D=>p(1,D.target.value)),E.click()}),d("click",O,()=>c("up")),d("click",Y,()=>c("down")),d("click",Ce,()=>c("left")),d("click",N,()=>c("right")),A(i,x),Ae()}var eo=U("<button> </button>"),to=U('<div class="font-dropdown-menu svelte-fspusj"></div>'),ao=U('<button><img alt="" class="style-icon svelte-fspusj"/></button>'),no=U('<div class="text1-controls svelte-fspusj"><div class="text-input-container svelte-fspusj"><textarea class="text-input svelte-fspusj" placeholder="Add text (with ==highlights==)"></textarea></div> <div class="font-row svelte-fspusj"><span class="row-label svelte-fspusj">Font</span> <div class="font-dropdown-wrapper svelte-fspusj"><button class="font-dropdown-trigger svelte-fspusj"> <span class="dropdown-arrow svelte-fspusj">â¾</span></button> <!></div> <button aria-label="Bold"><img src="/icons/icon-bold.svg" alt="" class="btn-icon svelte-fspusj"/></button> <button class="icon-btn svelte-fspusj"><img alt="" class="btn-icon svelte-fspusj"/></button></div> <div class="slider-row svelte-fspusj"><span class="row-label svelte-fspusj">Size</span> <div class="slider-wrapper svelte-fspusj"><input type="range" class="inline-slider svelte-fspusj"/></div> <button class="reset-btn svelte-fspusj" aria-label="Reset size"><img src="/icons/icon-reset.svg" alt="" class="reset-icon svelte-fspusj"/></button></div> <div class="slider-row svelte-fspusj"><span class="row-label svelte-fspusj">Position</span> <div class="slider-wrapper svelte-fspusj"><input type="range" class="inline-slider svelte-fspusj"/></div> <button class="reset-btn svelte-fspusj" aria-label="Reset position"><img src="/icons/icon-reset.svg" alt="" class="reset-icon svelte-fspusj"/></button></div> <div class="slider-row svelte-fspusj"><span class="row-label svelte-fspusj">Line spacing</span> <div class="slider-wrapper svelte-fspusj"><input type="range" class="inline-slider svelte-fspusj"/></div> <button class="reset-btn svelte-fspusj" aria-label="Reset line spacing"><img src="/icons/icon-reset.svg" alt="" class="reset-icon svelte-fspusj"/></button></div> <div class="quote-section svelte-fspusj"><span class="section-label svelte-fspusj">Quotes</span> <div class="style-row svelte-fspusj"></div> <div><span class="row-label svelte-fspusj">Size</span> <div class="slider-wrapper svelte-fspusj"><input type="range" class="inline-slider svelte-fspusj"/></div> <button class="reset-btn svelte-fspusj" aria-label="Reset quote size"><img src="/icons/icon-reset.svg" alt="" class="reset-icon svelte-fspusj"/></button></div></div> <div class="color-section svelte-fspusj"><div class="color-mode-tabs svelte-fspusj"><button>Text colour</button> <button>Highlight colour</button></div> <!></div></div>');function io(i,t){qe(t,!1);let e=b(t,"text1",8,""),n=b(t,"text1Font",8,"Inter"),o=b(t,"text1Size",8,5),r=b(t,"text1YPosition",8,3),v=b(t,"text1LineSpacing",8,5),u=b(t,"text1Color",8,"#000000"),c=b(t,"text1HighlightColor",8,"transparent"),p=b(t,"text1IsBold",8,!0),x=b(t,"text1Align",8,"center"),k=b(t,"text1QuoteStyle",8,"none"),z=b(t,"text1QuoteSize",8,5),m=b(t,"onChange",8,(P,W)=>{});const _=Pt.solids,B=["#FFD700","#000000","#007C1F","#00679D","#B20715"],h=["left","center","right"],y=[{id:"none",icon:"/icons/icon-none.svg",label:"No quote"},{id:"serif",icon:"/icons/icon-quote-serif.svg",label:"Serif quote"},{id:"slab",icon:"/icons/icon-quote-slab.svg",label:"Slab quote"}],T={text1Size:5,text1YPosition:3,text1LineSpacing:5,text1QuoteSize:5};let L=Q("text"),S=Q(!1),H=Q();function J(P){a(H)&&!a(H).contains(P.target)&&I(S,!1)}Dt(()=>{document.addEventListener("click",J)}),na(()=>{document.removeEventListener("click",J)});function X(P){m()("text1",P.target.value)}function O(P){m()("text1Font",P),I(S,!1)}function q(){m()("text1IsBold",!p())}function Y(){const W=(h.indexOf(x())+1)%h.length;m()("text1Align",h[W])}function se(P){m()("text1Color",P)}function Ce(P){m()("text1HighlightColor",P===c()?"transparent":P)}function me(P){m()("text1QuoteStyle",P)}function N(P){I(L,P)}function ee(P){m()(P,T[P])}Oe();var E=no(),D=g(E),ie=g(D);Pa(ie),s(D);var Se=l(D,2),Re=l(g(Se),2),ze=g(Re),nt=g(ze);St(),s(ze);var Ee=l(ze,2);{var Xe=P=>{var W=to();bt(W,5,()=>Ta,mt,(de,ve)=>{var ge=eo();let Le;var De=g(ge,!0);s(ge),ae(()=>{Le=ue(ge,1,"font-option svelte-fspusj",null,Le,{selected:n()===a(ve)}),Ie(ge,`font-family: '${a(ve)??""}'`),je(De,a(ve)==="Inter"?"Inter (Default)":a(ve))}),d("click",ge,()=>O(a(ve))),A(de,ge)}),s(W),A(P,W)};oe(Ee,P=>{a(S)&&P(Xe)})}s(Re),ft(Re,P=>I(H,P),()=>a(H));var He=l(Re,2);let Me;var _e=l(He,2),Je=g(_e);s(_e),s(Se);var Ne=l(Se,2),Ue=l(g(Ne),2),Fe=g(Ue);ct(Fe),le(Fe,"min",1),le(Fe,"max",10),s(Ue);var it=l(Ue,2);s(Ne);var Pe=l(Ne,2),he=l(g(Pe),2),xe=g(he);ct(xe),le(xe,"min",0),le(xe,"max",10),s(he);var Ye=l(he,2);s(Pe);var Ze=l(Pe,2),Ve=l(g(Ze),2),F=g(Ve);ct(F),le(F,"min",1),le(F,"max",10),s(Ve);var j=l(Ve,2);s(Ze);var Z=l(Ze,2),be=l(g(Z),2);bt(be,5,()=>y,mt,(P,W)=>{var de=ao();let ve;var ge=g(de);s(de),ae(()=>{ve=ue(de,1,"style-btn svelte-fspusj",null,ve,{active:k()===a(W).id,"is-none":a(W).id==="none"}),le(de,"aria-label",(a(W),f(()=>a(W).label))),le(ge,"src",(a(W),f(()=>a(W).icon)))}),d("click",de,()=>me(a(W).id)),A(P,de)}),s(be);var fe=l(be,2);let ke;var C=l(g(fe),2),R=g(C);ct(R),le(R,"min",1),le(R,"max",10),s(C);var ne=l(C,2);s(fe),s(Z);var K=l(Z,2),ce=g(K),we=g(ce);let te;var w=l(we,2);let M;s(ce);var V=l(ce,2);{var re=P=>{Lt(P,{get colors(){return _},get value(){return u()},onChange:se,showRainbow:!0})},$=P=>{Lt(P,{get colors(){return B},get value(){return c()},onChange:Ce,showRainbow:!0})};oe(V,P=>{a(L)==="text"?P(re):P($,!1)})}s(K),s(E),ae(()=>{rt(ie,e()),Ie(ze,`font-family: '${n()??""}'`),je(nt,`${(n()==="Inter"?"Inter (Default)":n())??""} `),Me=ue(He,1,"icon-btn svelte-fspusj",null,Me,{active:p()}),le(_e,"aria-label",`Align ${x()??""}`),le(Je,"src",`/icons/icon-align-${x()??""}.svg`),rt(Fe,o()),rt(xe,r()),rt(F,v()),ke=ue(fe,1,"slider-row quote-slider-row svelte-fspusj",null,ke,{disabled:k()==="none"}),rt(R,z()),R.disabled=k()==="none",ne.disabled=k()==="none",te=ue(we,1,"color-tab svelte-fspusj",null,te,{active:a(L)==="text"}),M=ue(w,1,"color-tab svelte-fspusj",null,M,{active:a(L)==="highlight"})}),d("input",ie,X),d("click",ze,()=>I(S,!a(S))),d("click",He,q),d("click",_e,Y),d("input",Fe,P=>m()("text1Size",Number(P.target.value))),d("click",it,()=>ee("text1Size")),d("input",xe,P=>m()("text1YPosition",Number(P.target.value))),d("click",Ye,()=>ee("text1YPosition")),d("input",F,P=>m()("text1LineSpacing",Number(P.target.value))),d("click",j,()=>ee("text1LineSpacing")),d("input",R,P=>k()!=="none"&&m()("text1QuoteSize",Number(P.target.value))),d("click",ne,()=>ee("text1QuoteSize")),d("click",we,()=>N("text")),d("click",w,()=>N("highlight")),A(i,E),Ae()}var oo=U("<button> </button>"),ro=U('<div class="font-dropdown-menu svelte-n6z268"></div>'),lo=U('<div class="text2-controls svelte-n6z268"><div class="text-input-container svelte-n6z268"><textarea class="text-input svelte-n6z268" placeholder="Add text (with ==highlights==)"></textarea></div> <div class="font-row svelte-n6z268"><span class="row-label svelte-n6z268">Font</span> <div class="font-dropdown-wrapper svelte-n6z268"><button class="font-dropdown-trigger svelte-n6z268"> <span class="dropdown-arrow svelte-n6z268">â¾</span></button> <!></div> <button aria-label="Bold"><img src="/icons/icon-bold.svg" alt="" class="btn-icon svelte-n6z268"/></button> <button class="icon-btn svelte-n6z268"><img alt="" class="btn-icon svelte-n6z268"/></button></div> <div class="slider-row svelte-n6z268"><span class="row-label svelte-n6z268">Size</span> <div class="slider-wrapper svelte-n6z268"><input type="range" class="inline-slider svelte-n6z268"/></div> <button class="reset-btn svelte-n6z268" aria-label="Reset size"><img src="/icons/icon-reset.svg" alt="" class="reset-icon svelte-n6z268"/></button></div> <div class="slider-row svelte-n6z268"><span class="row-label svelte-n6z268">Position</span> <div class="slider-wrapper svelte-n6z268"><input type="range" class="inline-slider svelte-n6z268"/></div> <button class="reset-btn svelte-n6z268" aria-label="Reset position"><img src="/icons/icon-reset.svg" alt="" class="reset-icon svelte-n6z268"/></button></div> <div class="slider-row svelte-n6z268"><span class="row-label svelte-n6z268">Line spacing</span> <div class="slider-wrapper svelte-n6z268"><input type="range" class="inline-slider svelte-n6z268"/></div> <button class="reset-btn svelte-n6z268" aria-label="Reset line spacing"><img src="/icons/icon-reset.svg" alt="" class="reset-icon svelte-n6z268"/></button></div> <div class="color-section svelte-n6z268"><div class="color-mode-tabs svelte-n6z268"><button>Text colour</button> <button>Highlight colour</button></div> <!></div></div>');function so(i,t){qe(t,!1);let e=b(t,"text2",8,""),n=b(t,"text2Font",8,"Inter"),o=b(t,"text2Size",8,3),r=b(t,"text2YPosition",8,8),v=b(t,"text2LineSpacing",8,5),u=b(t,"text2Color",8,"#000000"),c=b(t,"text2LabelColor",8,"transparent"),p=b(t,"text2IsBold",8,!1),x=b(t,"text2Align",8,"center"),k=b(t,"onChange",8,(R,ne)=>{});const z=Pt.solids,m=["#FFD700","#000000","#007C1F","#00679D","#B20715"],_=["left","center","right"],B={text2Size:3,text2YPosition:8,text2LineSpacing:5};let h=Q(!1),y=Q();function T(R){a(y)&&!a(y).contains(R.target)&&I(h,!1)}Dt(()=>{document.addEventListener("click",T)}),na(()=>{document.removeEventListener("click",T)});function L(R){k()("text2",R.target.value)}function S(R){k()("text2Font",R),I(h,!1)}function H(){k()("text2IsBold",!p())}function J(){const ne=(_.indexOf(x())+1)%_.length;k()("text2Align",_[ne])}function X(R){k()("text2Color",R)}function O(R){k()("text2LabelColor",R===c()?"transparent":R)}let q=Q("text");function Y(R){I(q,R)}function se(R){k()(R,B[R])}Oe();var Ce=lo(),me=g(Ce),N=g(me);Pa(N),s(me);var ee=l(me,2),E=l(g(ee),2),D=g(E),ie=g(D);St(),s(D);var Se=l(D,2);{var Re=R=>{var ne=ro();bt(ne,5,()=>Ta,mt,(K,ce)=>{var we=oo();let te;var w=g(we,!0);s(we),ae(()=>{te=ue(we,1,"font-option svelte-n6z268",null,te,{selected:n()===a(ce)}),Ie(we,`font-family: '${a(ce)??""}'`),je(w,a(ce)==="Inter"?"Inter (Default)":a(ce))}),d("click",we,()=>S(a(ce))),A(K,we)}),s(ne),A(R,ne)};oe(Se,R=>{a(h)&&R(Re)})}s(E),ft(E,R=>I(y,R),()=>a(y));var ze=l(E,2);let nt;var Ee=l(ze,2),Xe=g(Ee);s(Ee),s(ee);var He=l(ee,2),Me=l(g(He),2),_e=g(Me);ct(_e),le(_e,"min",1),le(_e,"max",10),s(Me);var Je=l(Me,2);s(He);var Ne=l(He,2),Ue=l(g(Ne),2),Fe=g(Ue);ct(Fe),le(Fe,"min",0),le(Fe,"max",10),s(Ue);var it=l(Ue,2);s(Ne);var Pe=l(Ne,2),he=l(g(Pe),2),xe=g(he);ct(xe),le(xe,"min",1),le(xe,"max",10),s(he);var Ye=l(he,2);s(Pe);var Ze=l(Pe,2),Ve=g(Ze),F=g(Ve);let j;var Z=l(F,2);let be;s(Ve);var fe=l(Ve,2);{var ke=R=>{Lt(R,{get colors(){return z},get value(){return u()},onChange:X,showRainbow:!0})},C=R=>{Lt(R,{get colors(){return m},get value(){return c()},onChange:O,showRainbow:!0})};oe(fe,R=>{a(q)==="text"?R(ke):R(C,!1)})}s(Ze),s(Ce),ae(()=>{rt(N,e()),Ie(D,`font-family: '${n()??""}'`),je(ie,`${(n()==="Inter"?"Inter (Default)":n())??""} `),nt=ue(ze,1,"icon-btn svelte-n6z268",null,nt,{active:p()}),le(Ee,"aria-label",`Align ${x()??""}`),le(Xe,"src",`/icons/icon-align-${x()??""}.svg`),rt(_e,o()),rt(Fe,r()),rt(xe,v()),j=ue(F,1,"color-tab svelte-n6z268",null,j,{active:a(q)==="text"}),be=ue(Z,1,"color-tab svelte-n6z268",null,be,{active:a(q)==="highlight"})}),d("input",N,L),d("click",D,()=>I(h,!a(h))),d("click",ze,H),d("click",Ee,J),d("input",_e,R=>k()("text2Size",Number(R.target.value))),d("click",Je,()=>se("text2Size")),d("input",Fe,R=>k()("text2YPosition",Number(R.target.value))),d("click",it,()=>se("text2YPosition")),d("input",xe,R=>k()("text2LineSpacing",Number(R.target.value))),d("click",Ye,()=>se("text2LineSpacing")),d("click",F,()=>Y("text")),d("click",Z,()=>Y("highlight")),A(i,Ce),Ae()}var co=U('<div class="import-box svelte-qirtgp" role="button" tabindex="0"><label class="import-area svelte-qirtgp"><input type="file" accept="image/*" class="file-input svelte-qirtgp"/> <img src="/icons/icon-upload.svg" alt="" class="upload-icon svelte-qirtgp"/> <span class="import-text svelte-qirtgp">Import, drag or<br/>paste an image</span></label> <button class="paste-btn svelte-qirtgp">Paste</button></div>'),vo=U('<div class="slider-row svelte-qirtgp"><span class="row-label svelte-qirtgp">Zoom</span> <div class="slider-wrapper svelte-qirtgp"><input type="range" class="inline-slider svelte-qirtgp"/></div> <button class="reset-btn svelte-qirtgp" aria-label="Reset zoom"><img src="/icons/icon-reset.svg" alt="" class="reset-icon svelte-qirtgp"/></button></div> <div class="nudge-row svelte-qirtgp"><button class="nudge-btn svelte-qirtgp" aria-label="Nudge up"><img src="/icons/icon-nudge-up.svg" alt="" class="nudge-icon svelte-qirtgp"/></button> <button class="nudge-btn svelte-qirtgp" aria-label="Nudge down"><img src="/icons/icon-nudge-down.svg" alt="" class="nudge-icon svelte-qirtgp"/></button> <button class="nudge-btn svelte-qirtgp" aria-label="Nudge left"><img src="/icons/icon-nudge-left.svg" alt="" class="nudge-icon svelte-qirtgp"/></button> <button class="nudge-btn svelte-qirtgp" aria-label="Nudge right"><img src="/icons/icon-nudge-right.svg" alt="" class="nudge-icon svelte-qirtgp"/></button></div>',1),uo=U('<div class="control-row fit-fill-row svelte-qirtgp"><div class="button-group svelte-qirtgp"><div class="button-with-label svelte-qirtgp"><button class="icon-btn svelte-qirtgp" title="Fit image to canvas" aria-label="Fit"><img src="/icons/icon-fit.svg" alt="Fit" class="control-icon svelte-qirtgp"/></button> <span class="label-below svelte-qirtgp">Fit</span></div> <div class="button-with-label svelte-qirtgp"><button class="icon-btn svelte-qirtgp" title="Fill canvas with image" aria-label="Fill"><img src="/icons/icon-fill.svg" alt="Fill" class="control-icon svelte-qirtgp"/></button> <span class="label-below svelte-qirtgp">Fill</span></div></div> <div class="button-group right-group svelte-qirtgp"><div class="button-with-label svelte-qirtgp"><button title="Image on front layer" aria-label="Front"><img src="/icons/icon-layer-above.svg" alt="Front" class="layer-icon svelte-qirtgp"/></button> <span class="label-below svelte-qirtgp">Front</span></div> <div class="button-with-label svelte-qirtgp"><button title="Image on back layer" aria-label="Back"><img src="/icons/icon-layer-below.svg" alt="Back" class="layer-icon svelte-qirtgp"/></button> <span class="label-below svelte-qirtgp">Back</span></div></div></div> <div class="slider-row svelte-qirtgp"><span class="row-label svelte-qirtgp">Opacity</span> <div class="slider-wrapper svelte-qirtgp"><input type="range" class="inline-slider svelte-qirtgp"/></div> <button class="reset-btn svelte-qirtgp" aria-label="Reset opacity"><img src="/icons/icon-reset.svg" alt="" class="reset-icon svelte-qirtgp"/></button></div> <div class="slider-row svelte-qirtgp"><span class="row-label svelte-qirtgp">Border</span> <div class="slider-wrapper svelte-qirtgp"><input type="range" class="inline-slider svelte-qirtgp"/></div> <button class="reset-btn svelte-qirtgp" aria-label="Reset border"><img src="/icons/icon-reset.svg" alt="" class="reset-icon svelte-qirtgp"/></button></div> <div class="color-section svelte-qirtgp"><span class="section-label svelte-qirtgp">Colour</span> <!></div> <div class="mask-row svelte-qirtgp"><span class="row-label svelte-qirtgp">Mask</span> <div class="mask-buttons svelte-qirtgp"><button aria-label="No mask"><img src="/icons/icon-none.svg" alt="" class="mask-icon svelte-qirtgp"/></button> <button aria-label="Rounded mask"><img src="/icons/icon-square.svg" alt="" class="mask-icon svelte-qirtgp"/></button> <button aria-label="Circle mask"><div class="circle-icon svelte-qirtgp"></div></button> <button aria-label="Diamond mask"><div class="diamond-icon svelte-qirtgp"></div></button></div></div> <!>',1),go=U('<div class="overlay-controls svelte-qirtgp"><!></div>');function ho(i,t){qe(t,!1);let e=b(t,"overlay",8,null);b(t,"overlaySize",8,50);let n=b(t,"overlayOpacity",8,100),o=b(t,"overlayMask",8,"none"),r=b(t,"overlayLayer",8,"above"),v=b(t,"overlayBorderWidth",8,0),u=b(t,"overlayBorderColor",8,"#FFFFFF"),c=b(t,"overlayZoom",8,100),p=b(t,"overlayImageOffsetX",8,0),x=b(t,"overlayImageOffsetY",8,0),k=b(t,"overlayNaturalWidth",8,0),z=b(t,"overlayNaturalHeight",8,0),m=b(t,"getCanvasDimensions",8,()=>({width:300,height:300})),_=b(t,"onChange",8,(N,ee)=>{});const B=Pt.solids,h=[0,1,2,3],y=2;function T(){if(!k()||!z())return 50;const{width:N,height:ee}=m()(),E=k()/z(),D=N/ee;return E>D?100:Math.min(100,ee/N*100)}function L(){if(!k()||!z())return 100;const{width:N,height:ee}=m()(),E=k()/z(),D=E>=1?N:N*E,ie=E>=1?N/E:N;return 100*Math.max(N/D,ee/ie)+.5}function S(N){const ee=N.target.files?.[0];if(ee&&ee.type.startsWith("image/")){const E=new FileReader;E.onload=D=>{_()("overlay",D.target.result)},E.readAsDataURL(ee)}N.target.value=""}function H(N){N.preventDefault();const ee=N.dataTransfer?.files?.[0];if(ee&&ee.type.startsWith("image/")){const E=new FileReader;E.onload=D=>{_()("overlay",D.target.result)},E.readAsDataURL(ee)}}function J(N){N.preventDefault()}async function X(){try{const N=await navigator.clipboard.read();for(const ee of N){const E=ee.types.find(D=>D.startsWith("image/"));if(E){const D=await ee.getType(E),ie=new FileReader;ie.onload=Se=>{_()("overlay",Se.target.result)},ie.readAsDataURL(D);return}}}catch(N){console.error("Paste failed:",N)}}function O(N){const ee=h.reduce((E,D)=>Math.abs(D-N)<Math.abs(E-N)?D:E);_()("overlayBorderWidth",ee)}function q(N){let ee=p(),E=x();switch(N){case"up":E=Math.max(-50,x()-y);break;case"down":E=Math.min(50,x()+y);break;case"left":ee=Math.max(-50,p()-y);break;case"right":ee=Math.min(50,p()+y);break}_()("overlayImageOffsetX",ee),_()("overlayImageOffsetY",E)}Oe();var Y=go(),se=g(Y);{var Ce=N=>{var ee=co(),E=g(ee),D=g(E);St(4),s(E);var ie=l(E,2);s(ee),d("change",D,S),d("click",ie,X),d("drop",ee,H),d("dragover",ee,J),A(N,ee)},me=N=>{var ee=uo(),E=Qe(ee),D=g(E),ie=g(D),Se=g(ie);St(2),s(ie);var Re=l(ie,2),ze=g(Re);St(2),s(Re),s(D);var nt=l(D,2),Ee=g(nt),Xe=g(Ee);let He;St(2),s(Ee);var Me=l(Ee,2),_e=g(Me);let Je;St(2),s(Me),s(nt),s(E);var Ne=l(E,2),Ue=l(g(Ne),2),Fe=g(Ue);ct(Fe),le(Fe,"min",0),le(Fe,"max",100),s(Ue);var it=l(Ue,2);s(Ne);var Pe=l(Ne,2),he=l(g(Pe),2),xe=g(he);ct(xe),le(xe,"min",0),le(xe,"max",3),le(xe,"step",1),s(he);var Ye=l(he,2);s(Pe);var Ze=l(Pe,2),Ve=l(g(Ze),2);Lt(Ve,{get colors(){return B},get value(){return u()},onChange:te=>_()("overlayBorderColor",te),showRainbow:!0}),s(Ze);var F=l(Ze,2),j=l(g(F),2),Z=g(j);let be;var fe=l(Z,2);let ke;var C=l(fe,2);let R;var ne=l(C,2);let K;s(j),s(F);var ce=l(F,2);{var we=te=>{var w=vo(),M=Qe(w),V=l(g(M),2),re=g(V);ct(re),le(re,"min",100),le(re,"max",300),s(V);var $=l(V,2);s(M);var P=l(M,2),W=g(P),de=l(W,2),ve=l(de,2),ge=l(ve,2);s(P),ae(()=>rt(re,c())),d("input",re,Le=>_()("overlayZoom",Number(Le.target.value))),d("click",$,()=>_()("overlayZoom",100)),d("click",W,()=>q("up")),d("click",de,()=>q("down")),d("click",ve,()=>q("left")),d("click",ge,()=>q("right")),A(te,w)};oe(ce,te=>{o()!=="none"&&te(we)})}ae(()=>{He=ue(Xe,1,"layer-btn svelte-qirtgp",null,He,{active:r()==="above"}),Je=ue(_e,1,"layer-btn svelte-qirtgp",null,Je,{active:r()==="below"}),rt(Fe,n()),rt(xe,v()),be=ue(Z,1,"mask-btn svelte-qirtgp",null,be,{active:o()==="none"}),ke=ue(fe,1,"mask-btn svelte-qirtgp",null,ke,{active:o()==="rounded"}),R=ue(C,1,"mask-btn svelte-qirtgp",null,R,{active:o()==="circle"}),K=ue(ne,1,"mask-btn svelte-qirtgp",null,K,{active:o()==="diamond"})}),d("click",Se,()=>_()("overlaySize",T())),d("click",ze,()=>_()("overlaySize",L())),d("click",Xe,()=>_()("overlayLayer","above")),d("click",_e,()=>_()("overlayLayer","below")),d("input",Fe,te=>_()("overlayOpacity",Number(te.target.value))),d("click",it,()=>_()("overlayOpacity",100)),d("input",xe,te=>O(Number(te.target.value))),d("click",Ye,()=>_()("overlayBorderWidth",0)),d("click",Z,()=>_()("overlayMask","none")),d("click",fe,()=>_()("overlayMask","rounded")),d("click",C,()=>_()("overlayMask","circle")),d("click",ne,()=>_()("overlayMask","diamond")),A(N,ee)};oe(se,N=>{e()?N(me,!1):N(Ce)})}s(Y),A(i,Y),Ae()}const fo=[{id:1,name:"Quote Card",state:{canvasSize:"1/1",background:{type:"solid",value:"#FFFFFF",direction:"down",gradientColors:["#5422b0","#4B0082"]},text1:"Add your quote here",text1Font:"Playfair Display",text1Size:7,text1YPosition:4,text1LineSpacing:5,text1Color:"#000000",text1HighlightColor:"transparent",text1IsBold:!0,text1Align:"center",text1QuoteStyle:"serif",text1QuoteSize:5,text2:"Attribution",text2Font:"Inter",text2Size:3,text2YPosition:85,text2LineSpacing:5,text2Color:"#555555",text2LabelColor:"transparent",text2IsBold:!1,text2Align:"center",overlay:null,overlaySize:50,overlayOpacity:100,overlayX:50,overlayY:50,overlayMask:"none",overlayLayer:"above",overlayBorderWidth:0,overlayBorderColor:"#FFFFFF",overlayNaturalWidth:0,overlayNaturalHeight:0}},{id:2,name:"News Banner",state:{canvasSize:"16/9",background:{type:"solid",value:"#5422b0",direction:"down",gradientColors:["#5422b0","#4B0082"]},text1:"Headline Goes Here",text1Font:"Saira Condensed",text1Size:8,text1YPosition:3,text1LineSpacing:5,text1Color:"#FFFFFF",text1HighlightColor:"#FFD700",text1IsBold:!0,text1Align:"left",text1QuoteStyle:"none",text1QuoteSize:5,text2:"Publication Name",text2Font:"Inter",text2Size:2,text2YPosition:92,text2LineSpacing:5,text2Color:"#FFFFFF",text2LabelColor:"transparent",text2IsBold:!1,text2Align:"left",overlay:null,overlaySize:50,overlayOpacity:100,overlayX:50,overlayY:50,overlayMask:"none",overlayLayer:"above",overlayBorderWidth:0,overlayBorderColor:"#FFFFFF",overlayNaturalWidth:0,overlayNaturalHeight:0}},{id:3,name:"Simple quote",state:{canvasSize:"1/1",background:{type:"gradient",value:"linear-gradient(to bottom, #5422b0 0%, #4B0082 100%)",direction:"down",gradientColors:["#5422b0","#4B0082"]},text1:`Judge a man by 
his ==questions== rather than by 
his ==answers==`,text1Font:"Inter",text1Size:5,text1YPosition:5,text1LineSpacing:2,text1Color:"#FFFFFF",text1HighlightColor:"#FFD700",text1IsBold:!0,text1Align:"center",text1QuoteStyle:"serif",text1QuoteSize:5,text2:"Voltaire",text2Font:"Roboto Slab",text2Size:2,text2YPosition:8,text2LineSpacing:5,text2Color:"#FFFFFF",text2LabelColor:"transparent",text2IsBold:!1,text2Align:"center",overlay:null,overlaySize:50,overlayOpacity:100,overlayX:50,overlayY:50,overlayMask:"none",overlayLayer:"above",overlayBorderWidth:0,overlayBorderColor:"#FFFFFF",overlayNaturalWidth:0,overlayNaturalHeight:0}},{id:4,name:"template-4",state:{canvasSize:"1/1",background:{type:"gradient",value:"linear-gradient(to bottom, #5422b0 0%, #4B0082 100%)",direction:"down",gradientColors:["#5422b0","#4B0082"]},text1:`Judge a man by 
his ==questions== rather than by 
his ==answers==`,text1Font:"Inter",text1Size:5,text1YPosition:5,text1LineSpacing:2,text1Color:"#FFFFFF",text1HighlightColor:"#FFD700",text1IsBold:!0,text1Align:"center",text1QuoteStyle:"serif",text1QuoteSize:5,text2:"Voltaire",text2Font:"Roboto Slab",text2Size:2,text2YPosition:8,text2LineSpacing:5,text2Color:"#FFFFFF",text2LabelColor:"transparent",text2IsBold:!1,text2Align:"center",overlay:null,overlaySize:50,overlayOpacity:100,overlayX:50,overlayY:50,overlayMask:"none",overlayLayer:"above",overlayBorderWidth:0,overlayBorderColor:"#FFFFFF",overlayNaturalWidth:0,overlayNaturalHeight:0}}],Bt={templates:fo};var bo=U('<button class="template-card svelte-fxk5n4"><div class="template-placeholder svelte-fxk5n4"> </div></button>'),po=U('<div class="template-picker svelte-fxk5n4"><p class="picker-title svelte-fxk5n4">Create quotes & cards with<br/>a template or blank canvas</p> <button class="blank-canvas-btn svelte-fxk5n4"><img src="/icons/icon-add.svg" alt="" class="add-icon svelte-fxk5n4"/></button> <div class="template-grid svelte-fxk5n4"></div></div>'),mo=U('<div class="canvas-quote svelte-fxk5n4">&#8220;</div>'),xo=U('<!> <div class="text1-wrapper svelte-fxk5n4"><div class="canvas-text text1 svelte-fxk5n4"><!></div></div>',1),wo=U('<div class="canvas-text text2 svelte-fxk5n4"><!></div>'),yo=U(`<div role="button" tabindex="0"><div><button class="delete-btn svelte-fxk5n4" aria-label="Delete image"><img src="/icons/icon-close.svg" alt="" class="delete-icon svelte-fxk5n4"/></button> <button class="resize-handle svelte-fxk5n4" aria-label="Resize image"><img src="/icons/icon-resize.svg" alt="" class="resize-icon svelte-fxk5n4"/></button> <div style="
									overflow: hidden;
								"><img alt="Overlay" class="overlay-image svelte-fxk5n4" draggable="false"/></div></div></div>`),_o=U('<div class="admin-footer svelte-fxk5n4"><button class="save-template-btn svelte-fxk5n4">ð¾ Save as Template</button></div>'),ko=U('<!> <div class="canvas-container svelte-fxk5n4"><div class="design-canvas svelte-fxk5n4" role="button" tabindex="0"><!> <!> <!></div></div> <!> <div class="controls-panel svelte-fxk5n4"><!></div> <!>',1),Co=U('<div class="design-tab svelte-fxk5n4"><!></div>');function So(i,t){qe(t,!1);const e=()=>dt(We,"$slideState",r),n=()=>dt(ht,"$activeDesignMenu",r),o=()=>dt(ea,"$showTemplatePicker",r),[r,v]=Mt(),u=Q();let c=Q(),p=Q(300),x=300,k=Q(300),z,m=Q(),_=Q(0),B=!1,h=0,y=0,T=0,L=0,S=!1,H=0,J=0,X=0,O=0;Dt(()=>{a(c)&&(z=new ResizeObserver(([F])=>{const{width:j,height:Z}=F.contentRect;x=j,I(k,Z),I(p,Math.min(j,Z))}),z.observe(a(c)))}),na(()=>{z&&z.disconnect()});const q=[{id:"size",label:"Size"},{id:"background",label:"Background"},{id:"text1",label:"Text 1"},{id:"text2",label:"Text 2"},{id:"image",label:"Image"}];function Y(F){if(F==="blank")We.reset();else{const j=Bt.templates.find(Z=>Z.id===F);j&&We.set(JSON.parse(JSON.stringify(j.state)))}ea.set(!1)}function se(){const F=prompt("Template name:",`template-${Bt.templates.length+1}`);if(!F)return;let j=0;Bt.templates.forEach(R=>{R.id>j&&(j=R.id)});const Z={id:j+1,name:F,state:JSON.parse(JSON.stringify(e()))};Bt.templates.push(Z);const be=JSON.stringify(Bt,null,2),fe=new Blob([be],{type:"application/json"}),ke=URL.createObjectURL(fe),C=document.createElement("a");C.href=ke,C.download="templates.json",C.click(),URL.revokeObjectURL(ke),alert(`Template "${F}" exported. Replace /src/lib/data/templates.json with the downloaded file.`)}function Ce(F){ht.set(n()===F?"none":F)}async function me(){}function N(){}function ee(F){We.update(j=>({...j,canvasSize:F}))}function E(F){We.update(j=>({...j,background:F}))}function D(F,j){We.update(Z=>({...Z,[F]:j}))}function ie(F,j){We.update(Z=>({...Z,[F]:j}))}function Se(){if(a(c)){const F=a(c).getBoundingClientRect();return{width:F.width,height:F.height}}return{width:x,height:a(k)}}function Re(F,j){if(F==="overlay"&&j){const Z=new Image;Z.onload=()=>{We.update(be=>({...be,overlay:j,overlayNaturalWidth:Z.naturalWidth,overlayNaturalHeight:Z.naturalHeight,overlayX:50,overlayY:50})),ht.set("image")},Z.src=j}else F==="overlayLayer"?(We.update(Z=>({...Z,[F]:j})),ht.set("none")):We.update(Z=>({...Z,[F]:j}))}function ze(){We.update(F=>({...F,overlay:null,overlayNaturalWidth:0,overlayNaturalHeight:0})),ht.set("none")}function nt(F){if(F.target.closest(".delete-btn")||F.target.closest(".resize-handle")||F.touches&&F.touches.length>1)return;F.preventDefault(),B=!0;const j=F.touches?.[0]||F;h=j.clientX,y=j.clientY,T=e().overlayX,L=e().overlayY,window.addEventListener("mousemove",Ee),window.addEventListener("mouseup",Xe),window.addEventListener("touchmove",Ee,{passive:!1}),window.addEventListener("touchend",Xe)}function Ee(F){if(!B)return;F.preventDefault();const j=F.touches?.[0]||F,Z=j.clientX-h,be=j.clientY-y,fe=Z/x*100,ke=be/a(k)*100,C=Math.max(0,Math.min(100,T+fe)),R=Math.max(0,Math.min(100,L+ke));We.update(ne=>({...ne,overlayX:C,overlayY:R}))}function Xe(){B=!1,window.removeEventListener("mousemove",Ee),window.removeEventListener("mouseup",Xe),window.removeEventListener("touchmove",Ee),window.removeEventListener("touchend",Xe)}function He(F){F.preventDefault(),F.stopPropagation(),S=!0,H=F.touches?.[0].clientX||F.clientX,J=F.touches?.[0].clientY||F.clientY,X=e().overlaySize,window.addEventListener("mousemove",Me),window.addEventListener("mouseup",_e),window.addEventListener("touchmove",Me,{passive:!1}),window.addEventListener("touchend",_e)}function Me(F){if(!S)return;F.preventDefault();const j=F.touches?.[0].clientX||F.clientX,Z=F.touches?.[0].clientY||F.clientY,be=j-H,fe=Z-J,C=Math.max(be,fe)/a(p)*100,R=Math.max(10,Math.min(200,X+C));We.update(ne=>({...ne,overlaySize:R}))}function _e(){S=!1,window.removeEventListener("mousemove",Me),window.removeEventListener("mouseup",_e),window.removeEventListener("touchmove",Me),window.removeEventListener("touchend",_e)}function Je(F){if(F.length<2)return 0;const j=F[0].clientX-F[1].clientX,Z=F[0].clientY-F[1].clientY;return Math.sqrt(j*j+Z*Z)}function Ne(F){F.touches.length===2&&(F.preventDefault(),O=Je(F.touches))}function Ue(F){if(F.touches.length===2&&O>0){F.preventDefault();const j=Je(F.touches),be=(j-O)/a(p)*50,fe=Math.max(10,Math.min(200,e().overlaySize+be));We.update(ke=>({...ke,overlaySize:fe})),O=j}}function Fe(F){F.touches.length<2&&(O=0)}function it(F){if(F.ctrlKey){F.preventDefault();const j=-F.deltaY*.5,Z=Math.max(10,Math.min(200,e().overlaySize+j));We.update(be=>({...be,overlaySize:Z}))}}function Pe(F){const j=F.target;j.closest(".overlay-wrapper")?ht.set("image"):j.closest(".text1-wrapper")?ht.set("text1"):j.closest(".canvas-text.text2")?ht.set("text2"):j.closest(".canvas-quote")?ht.set("text1"):ht.set("none")}function he(F){if(!F.overlay||!F.overlayNaturalWidth)return null;const j=F.overlayNaturalWidth/F.overlayNaturalHeight,Z=F.overlaySize/100*100;let be,fe;return j>=1?(be=Z,fe=Z/j):(fe=Z,be=Z*j),{width:be,height:fe}}Ge(()=>(a(m),e()),()=>{a(m)&&e().text1&&setTimeout(()=>{I(_,a(m).offsetHeight||0)},0)}),Ge(()=>e(),()=>{I(u,he(e()))}),kt(),Oe();var xe=Co(),Ye=g(xe);{var Ze=F=>{var j=po(),Z=l(g(j),2),be=l(Z,2);bt(be,5,()=>(Be(Bt),f(()=>Bt.templates)),fe=>fe.id,(fe,ke)=>{var C=bo(),R=g(C),ne=g(R,!0);s(R),s(C),ae(()=>je(ne,(a(ke),f(()=>a(ke).name)))),d("click",C,()=>Y(a(ke).id)),A(fe,C)}),s(be),s(j),d("click",Z,()=>Y("blank")),A(F,j)},Ve=F=>{var j=ko(),Z=Qe(j);{let P=at(()=>(Be(We),f(()=>We.canUndo()))),W=at(()=>(Be(We),f(()=>We.canRedo())));oa(Z,{get canUndo(){return a(P)},get canRedo(){return a(W)},onUndo:()=>We.undo(),onRedo:()=>We.redo(),get onStartAgain(){return Zi},onCopy:me,onExport:N})}var be=l(Z,2),fe=g(be),ke=g(fe);{var C=P=>{const W=at(()=>(a(p),e(),f(()=>a(p)*.1*e().text1Size/5))),de=at(()=>(Be(a(W)),e(),f(()=>a(W)*(1+e().text1LineSpacing*.1)))),ve=at(()=>(Be(a(de)),e(),f(()=>a(de)*(e().text1QuoteStyle==="slab"?-.25:.1)))),ge=at(()=>(e(),f(()=>e().text1YPosition*10))),Le=at(()=>a(_)/a(k)*100),De=at(()=>a(ge)-a(Le)/2-a(ve)/a(k)*100);var lt=xo(),Ke=Qe(lt);{var et=Te=>{var $e=mo();ae(()=>Ie($e,`
								top: ${a(De)??""}%;
								text-align: ${e(),f(()=>e().text1Align)??""};
								font-family: ${e(),f(()=>e().text1QuoteStyle==="serif"?'"Playfair Display", serif':'"Alfa Slab One", cursive')??""};
								font-size: ${a(p),e(),f(()=>a(p)*.08*e().text1QuoteSize)??""}px;
								font-weight: ${e(),f(()=>e().text1QuoteStyle==="serif"?"bold":"normal")??""};
								color: ${e(),f(()=>e().text1Color)??""};
							`)),A(Te,$e)};oe(Ke,Te=>{e(),f(()=>e().text1QuoteStyle!=="none")&&Te(et)})}var tt=l(Ke,2),G=g(tt),ye=g(G);ha(ye,()=>(e(),f(()=>e().text1.replace(/==(.+?)==/g,`<span style="color: ${e().text1HighlightColor};">$1</span>`).replace(/\n/g,"<br>")))),s(G),s(tt),ft(tt,Te=>I(m,Te),()=>a(m)),ae(()=>{Ie(tt,`top: ${a(ge)??""}%;`),Ie(G,`
								font-family: '${e(),f(()=>e().text1Font)??""}';
								font-size: ${e(),f(()=>e().text1Size*.5)??""}em;
								font-weight: ${e(),f(()=>e().text1IsBold?"bold":"normal")??""};
								color: ${e(),f(()=>e().text1Color)??""};
								text-align: ${e(),f(()=>e().text1Align)??""};
								line-height: ${e(),f(()=>1+e().text1LineSpacing*.1)??""};
							`)}),A(P,lt)};oe(ke,P=>{e(),f(()=>e().text1)&&P(C)})}var R=l(ke,2);{var ne=P=>{var W=wo(),de=g(W);ha(de,()=>(e(),f(()=>e().text2.replace(/==(.+?)==/g,`<span style="color: ${e().text2LabelColor};">$1</span>`).replace(/\n/g,"<br>")))),s(W),ae(()=>Ie(W,`
							font-family: '${e(),f(()=>e().text2Font)??""}';
							font-size: ${e(),f(()=>e().text2Size*.5)??""}em;
							font-weight: ${e(),f(()=>e().text2IsBold?"bold":"normal")??""};
							color: ${e(),f(()=>e().text2Color)??""};
							text-align: ${e(),f(()=>e().text2Align)??""};
							top: ${e(),f(()=>e().text2YPosition*10)??""}%;
							line-height: ${e(),f(()=>1+e().text2LineSpacing*.1)??""};
						`)),A(P,W)};oe(R,P=>{e(),f(()=>e().text2)&&P(ne)})}var K=l(R,2);{var ce=P=>{var W=yo();let de;var ve=g(W);let ge;var Le=g(ve),De=l(Le,2),lt=l(De,2);let Ke;var et=g(lt);s(lt),s(ve),s(W),ae(()=>{de=ue(W,1,"overlay-wrapper svelte-fxk5n4",null,de,{active:n()==="image"}),Ie(W,`
							left: ${e(),f(()=>e().overlayX)??""}%;
							top: ${e(),f(()=>e().overlayY)??""}%;
							width: ${a(u),f(()=>a(u).width)??""}%;
							opacity: ${e(),f(()=>e().overlayOpacity/100)??""};
							z-index: ${n(),e(),f(()=>n()==="image"?11:e().overlayLayer==="below"?1:10)??""};
						`),ge=ue(ve,1,"overlay-bounding-box svelte-fxk5n4",null,ge,{"mask-none":e().overlayMask==="none","mask-rounded":e().overlayMask==="rounded","mask-circle":e().overlayMask==="circle","mask-diamond":e().overlayMask==="diamond"}),Ie(ve,`
								border-width: ${e(),f(()=>e().overlayBorderWidth*2)??""}px;
								border-color: ${e(),f(()=>e().overlayBorderColor)??""};
							`),Ke=ue(lt,1,"overlay-image-container svelte-fxk5n4",null,Ke,{"mask-rounded":e().overlayMask==="rounded","mask-circle":e().overlayMask==="circle","mask-diamond":e().overlayMask==="diamond"}),le(et,"src",(e(),f(()=>e().overlay))),Ie(et,`
										transform: translate(${e(),f(()=>e().overlayImageOffsetX)??""}%, ${e(),f(()=>e().overlayImageOffsetY)??""}%) scale(${e(),f(()=>e().overlayZoom/100)??""});
										transform-origin: center;
									`)}),d("click",Le,ze),d("mousedown",De,He),d("touchstart",De,He),d("mousedown",W,nt),d("touchstart",W,Ne),d("touchmove",W,Ue),d("touchend",W,Fe),d("wheel",W,it),A(P,W)};oe(K,P=>{e(),a(u),f(()=>e().overlay&&a(u))&&P(ce)})}s(fe),ft(fe,P=>I(c,P),()=>a(c)),s(be);var we=l(be,2);ra(we,{get tabs(){return q},get activeTab(){return n()},onTabChange:Ce});var te=l(we,2),w=g(te);{var M=P=>{ho(P,{get overlay(){return e(),f(()=>e().overlay)},get overlaySize(){return e(),f(()=>e().overlaySize)},get overlayOpacity(){return e(),f(()=>e().overlayOpacity)},get overlayMask(){return e(),f(()=>e().overlayMask)},get overlayLayer(){return e(),f(()=>e().overlayLayer)},get overlayBorderWidth(){return e(),f(()=>e().overlayBorderWidth)},get overlayBorderColor(){return e(),f(()=>e().overlayBorderColor)},get overlayZoom(){return e(),f(()=>e().overlayZoom)},get overlayImageOffsetX(){return e(),f(()=>e().overlayImageOffsetX)},get overlayImageOffsetY(){return e(),f(()=>e().overlayImageOffsetY)},get overlayNaturalWidth(){return e(),f(()=>e().overlayNaturalWidth)},get overlayNaturalHeight(){return e(),f(()=>e().overlayNaturalHeight)},getCanvasDimensions:Se,onChange:Re,onDelete:ze})},V=P=>{var W=xt(),de=Qe(W);{var ve=Le=>{Wi(Le,{get canvasSize(){return e(),f(()=>e().canvasSize)},onSizeChange:ee})},ge=Le=>{var De=xt(),lt=Qe(De);{var Ke=tt=>{$i(tt,{get background(){return e(),f(()=>e().background)},onBackgroundChange:E})},et=tt=>{var G=xt(),ye=Qe(G);{var Te=vt=>{io(vt,{get text1(){return e(),f(()=>e().text1)},get text1Font(){return e(),f(()=>e().text1Font)},get text1Size(){return e(),f(()=>e().text1Size)},get text1YPosition(){return e(),f(()=>e().text1YPosition)},get text1LineSpacing(){return e(),f(()=>e().text1LineSpacing)},get text1Color(){return e(),f(()=>e().text1Color)},get text1HighlightColor(){return e(),f(()=>e().text1HighlightColor)},get text1IsBold(){return e(),f(()=>e().text1IsBold)},get text1Align(){return e(),f(()=>e().text1Align)},get text1QuoteStyle(){return e(),f(()=>e().text1QuoteStyle)},get text1QuoteSize(){return e(),f(()=>e().text1QuoteSize)},onChange:D})},$e=vt=>{var zt=xt(),ut=Qe(zt);{var pt=Ft=>{so(Ft,{get text2(){return e(),f(()=>e().text2)},get text2Font(){return e(),f(()=>e().text2Font)},get text2Size(){return e(),f(()=>e().text2Size)},get text2YPosition(){return e(),f(()=>e().text2YPosition)},get text2LineSpacing(){return e(),f(()=>e().text2LineSpacing)},get text2Color(){return e(),f(()=>e().text2Color)},get text2LabelColor(){return e(),f(()=>e().text2LabelColor)},get text2IsBold(){return e(),f(()=>e().text2IsBold)},get text2Align(){return e(),f(()=>e().text2Align)},onChange:ie})};oe(ut,Ft=>{n()==="text2"&&Ft(pt)},!0)}A(vt,zt)};oe(ye,vt=>{n()==="text1"?vt(Te):vt($e,!1)},!0)}A(tt,G)};oe(lt,tt=>{n()==="background"?tt(Ke):tt(et,!1)},!0)}A(Le,De)};oe(de,Le=>{n()==="size"?Le(ve):Le(ge,!1)},!0)}A(P,W)};oe(w,P=>{n(),e(),f(()=>n()==="image"||n()==="none"&&e().overlay)?P(M):P(V,!1)})}s(te);var re=l(te,2);{var $=P=>{var W=_o(),de=g(W);s(W),d("click",de,se),A(P,W)};oe(re,P=>{f(()=>!1)&&P($)})}ae(()=>Ie(fe,`
					aspect-ratio: ${e(),f(()=>e().canvasSize)??""};
					background: ${e(),f(()=>(e().background.type==="solid",e().background.value))??""};
				`)),d("click",fe,Pe),d("keydown",fe,P=>P.key==="Enter"&&Pe(P)),A(F,j)};oe(Ye,F=>{o()?F(Ze):F(Ve,!1)})}s(xe),A(i,xe),Ae(),v()}const Xt=yt("crop");var Io=U('<!> <main class="main svelte-1uha8ag"><!></main> <!>',1);function Mo(i,t){qe(t,!1);const e=()=>dt(Xt,"$activeTab",o),n=()=>dt(pe,"$cropState",o),[o,r]=Mt();let v=Q(!1),u=null;function c(L){if(e()==="crop"&&n().cropPending&&L!=="crop"){u=L,I(v,!0);return}Xt.set(L)}async function p(){I(v,!1);const L=n();if(L.currentImage&&L.cropPending){const S=await Ma(L.currentImage,L.cropBox,L.imageWidth,L.imageHeight),H=await Ut(S);pe.set({...L,currentImage:S,imageWidth:H.width,imageHeight:H.height,cropBox:{x:0,y:0,width:100,height:100},cropPending:!1,isCropping:!1})}u&&(Xt.set(u),u=null)}function x(){I(v,!1),u=null}Oe();var k=Io(),z=Qe(k);wn(z,{get activeTab(){return e()},onTabChange:c});var m=l(z,2),_=g(m);{var B=L=>{hi(L,{})},h=L=>{var S=xt(),H=Qe(S);{var J=O=>{Ui(O,{})},X=O=>{var q=xt(),Y=Qe(q);{var se=Ce=>{So(Ce,{})};oe(Y,Ce=>{e()==="design"&&Ce(se)},!0)}A(O,q)};oe(H,O=>{e()==="ai"?O(J):O(X,!1)},!0)}A(L,S)};oe(_,L=>{e()==="crop"?L(B):L(h,!1)})}s(m);var y=l(m,2);{var T=L=>{$t(L,{message:"Save changes?",confirmText:"Yes",cancelText:"Cancel",onConfirm:p,onCancel:x})};oe(y,L=>{a(v)&&L(T)})}A(i,k),Ae(),r()}export{Mo as component};

import{f as L,a as A,c as nt}from"../chunks/fofpT_Z8.js";import"../chunks/B0wnF16V.js";import{F as Bt,i as Xe,x as _a,C as Et,j as xa,M as ka,g as a,aI as Ke,aA as Ca,O as ya,a5 as Vt,aj as Pt,B as St,N as Sa,ao as Ia,a2 as Zt,ax as Ra,P as At,az as za,am as Nt,w as da,I as Qt,at as O,aO as Ba,aP as Ea,aQ as Pa,aR as lt,ay as ua,R as va,aS as Mt,ah as Ma,aT as Ta,al as Aa,a3 as Ua,aU as ga,L as ha,aV as Da,aW as La,aX as Ha,aY as Fa,aZ as qa,p as xe,t as K,n as ke,s as w,k as C,l as _,aq as S,b as U,a_ as Se,a$ as mt,e as Be,a4 as zt,m as Ee,b0 as Kt}from"../chunks/DKVK_XYJ.js";import{p as m,b as bt,i as Z,s as We,a as _t,_ as Wa}from"../chunks/BJ6IQwyK.js";import{i as Re}from"../chunks/D8EnKHUR.js";import{e as y,s as Ie}from"../chunks/CuybRmit.js";import{c as Oa,o as Yt,d as jt,w as ct}from"../chunks/umaFkCoN.js";let $t=!1;function Na(){$t||($t=!0,document.addEventListener("reset",n=>{Promise.resolve().then(()=>{if(!n.defaultPrevented)for(const t of n.target.elements)t.__on_r?.()})},{capture:!0}))}function pt(n,t){return t}function Ya(n,t,e){for(var i=[],o=t.length,r,c=t.length,d=0;d<o;d++){let I=t[d];va(I,()=>{if(r){if(r.pending.delete(I),r.done.add(I),r.pending.size===0){var p=n.outrogroups;Ut(Nt(r.done)),p.delete(r),p.size===0&&(n.outrogroups=null)}}else c-=1},!1)}if(c===0){var l=i.length===0&&e!==null;if(l){var u=e,h=u.parentNode;Aa(h),h.append(u),n.items.clear()}Ut(t,!l)}else r={pending:new Set(t),done:new Set},(n.outrogroups??=new Set).add(r)}function Ut(n,t=!0){for(var e=0;e<n.length;e++)Ua(n[e],t)}var ea;function wt(n,t,e,i,o,r=null){var c=n,d=new Map,l=(t&ga)!==0;if(l){var u=n;c=Xe?Bt(_a(u)):u.appendChild(Et())}Xe&&xa();var h=null,I=Ke(()=>{var g=e();return da(g)?g:g==null?[]:Nt(g)}),p,f=!0;function b(){s.fallback=h,ja(s,p,c,t,i),h!==null&&(p.length===0?(h.f&lt)===0?ua(h):(h.f^=lt,Ct(h,null,c)):va(h,()=>{h=null}))}var B=ka(()=>{p=a(I);var g=p.length;let P=!1;if(Xe){var E=Ca(c)===ya;E!==(g===0)&&(c=Vt(),Bt(c),Pt(!1),P=!0)}for(var M=new Set,H=Ra,R=za(),x=0;x<g;x+=1){Xe&&St.nodeType===Sa&&St.data===Ia&&(c=St,P=!0,Pt(!1));var T=p[x],Y=i(T,x),N=f?null:d.get(Y);N?(N.v&&Zt(N.v,T),N.i&&Zt(N.i,x),R&&H.skipped_effects.delete(N.e)):(N=Xa(d,f?c:ea??=Et(),T,Y,x,o,t,e),f||(N.e.f|=lt),d.set(Y,N)),M.add(Y)}if(g===0&&r&&!h&&(f?h=At(()=>r(c)):(h=At(()=>r(ea??=Et())),h.f|=lt)),Xe&&g>0&&Bt(Vt()),!f)if(R){for(const[Q,he]of d)M.has(Q)||H.skipped_effects.add(he.e);H.oncommit(b),H.ondiscard(()=>{})}else b();P&&Pt(!0),a(I)}),s={effect:B,items:d,outrogroups:null,fallback:h};f=!1,Xe&&(c=St)}function xt(n){for(;n!==null&&(n.f&Ta)===0;)n=n.next;return n}function ja(n,t,e,i,o){var r=(i&Da)!==0,c=t.length,d=n.items,l=xt(n.effect.first),u,h=null,I,p=[],f=[],b,B,s,g;if(r)for(g=0;g<c;g+=1)b=t[g],B=o(b,g),s=d.get(B).e,(s.f&lt)===0&&(s.nodes?.a?.measure(),(I??=new Set).add(s));for(g=0;g<c;g+=1){if(b=t[g],B=o(b,g),s=d.get(B).e,n.outrogroups!==null)for(const N of n.outrogroups)N.pending.delete(s),N.done.delete(s);if((s.f&lt)!==0)if(s.f^=lt,s===l)Ct(s,null,e);else{var P=h?h.next:l;s===n.effect.last&&(n.effect.last=s.prev),s.prev&&(s.prev.next=s.next),s.next&&(s.next.prev=s.prev),gt(n,h,s),gt(n,s,P),Ct(s,P,e),h=s,p=[],f=[],l=xt(h.next);continue}if((s.f&Mt)!==0&&(ua(s),r&&(s.nodes?.a?.unfix(),(I??=new Set).delete(s))),s!==l){if(u!==void 0&&u.has(s)){if(p.length<f.length){var E=f[0],M;h=E.prev;var H=p[0],R=p[p.length-1];for(M=0;M<p.length;M+=1)Ct(p[M],E,e);for(M=0;M<f.length;M+=1)u.delete(f[M]);gt(n,H.prev,R.next),gt(n,h,H),gt(n,R,E),l=E,h=R,g-=1,p=[],f=[]}else u.delete(s),Ct(s,l,e),gt(n,s.prev,s.next),gt(n,s,h===null?n.effect.first:h.next),gt(n,h,s),h=s;continue}for(p=[],f=[];l!==null&&l!==s;)(u??=new Set).add(l),f.push(l),l=xt(l.next);if(l===null)continue}(s.f&lt)===0&&p.push(s),h=s,l=xt(s.next)}if(n.outrogroups!==null){for(const N of n.outrogroups)N.pending.size===0&&(Ut(Nt(N.done)),n.outrogroups?.delete(N));n.outrogroups.size===0&&(n.outrogroups=null)}if(l!==null||u!==void 0){var x=[];if(u!==void 0)for(s of u)(s.f&Mt)===0&&x.push(s);for(;l!==null;)(l.f&Mt)===0&&l!==n.fallback&&x.push(l),l=xt(l.next);var T=x.length;if(T>0){var Y=(i&ga)!==0&&c===0?e:null;if(r){for(g=0;g<T;g+=1)x[g].nodes?.a?.measure();for(g=0;g<T;g+=1)x[g].nodes?.a?.fix()}Ya(n,x,Y)}}r&&ha(()=>{if(I!==void 0)for(s of I)s.nodes?.a?.apply()})}function Xa(n,t,e,i,o,r,c,d){var l=(c&Ea)!==0?(c&Pa)===0?O(e,!1,!1):Qt(e):null,u=(c&Ba)!==0?Qt(o):null;return{v:l,i:u,e:At(()=>(r(t,l??e,u??o,d),()=>{n.delete(i)}))}}function Ct(n,t,e){if(n.nodes)for(var i=n.nodes.start,o=n.nodes.end,r=t&&(t.f&lt)===0?t.nodes.start:e;i!==null;){var c=Ma(i);if(r.before(i),i===o)return;i=c}}function gt(n,t,e){t===null?n.effect.first=e:t.next=e,e===null?n.effect.last=t:e.prev=t}const ta=[...` 	
\r\fÂ \v\uFEFF`];function Ga(n,t,e){var i=n==null?"":""+n;if(e){for(var o in e)if(e[o])i=i?i+" "+o:o;else if(i.length)for(var r=o.length,c=0;(c=i.indexOf(o,c))>=0;){var d=c+r;(c===0||ta.includes(i[c-1]))&&(d===i.length||ta.includes(i[d]))?i=(c===0?"":i.substring(0,c))+i.substring(d+1):c=d}}return i===""?null:i}function Ja(n,t){return n==null?null:String(n)}function Le(n,t,e,i,o,r){var c=n.__className;if(Xe||c!==e||c===void 0){var d=Ga(e,i,r);(!Xe||d!==n.getAttribute("class"))&&(d==null?n.removeAttribute("class"):n.className=d),n.__className=e}else if(r&&o!==r)for(var l in r){var u=!!r[l];(o==null||u!==!!o[l])&&n.classList.toggle(l,u)}return r}function Ue(n,t,e,i){var o=n.__style;if(Xe||o!==t){var r=Ja(t);(!Xe||r!==n.getAttribute("style"))&&(r==null?n.removeAttribute("style"):n.style.cssText=r),n.__style=t}return i}const Va=Symbol("is custom element"),Za=Symbol("is html");function Rt(n){if(Xe){var t=!1,e=()=>{if(!t){if(t=!0,n.hasAttribute("value")){var i=n.value;ge(n,"value",null),n.value=i}if(n.hasAttribute("checked")){var o=n.checked;ge(n,"checked",null),n.checked=o}}};n.__on_r=e,ha(e),Na()}}function Dt(n,t){var e=Xt(n);e.value===(e.value=t??void 0)||n.value===t&&(t!==0||n.nodeName!=="PROGRESS")||(n.value=t??"")}function Qa(n,t){var e=Xt(n);e.checked!==(e.checked=t??void 0)&&(n.checked=t)}function ge(n,t,e,i){var o=Xt(n);Xe&&(o[t]=n.getAttribute(t),t==="src"||t==="srcset"||t==="href"&&n.nodeName==="LINK")||o[t]!==(o[t]=e)&&(t==="loading"&&(n[La]=e),e==null?n.removeAttribute(t):typeof e!="string"&&Ka(n).includes(t)?n[t]=e:n.setAttribute(t,e))}function Xt(n){return n.__attributes??={[Va]:n.nodeName.includes("-"),[Za]:n.namespaceURI===Ha}}var aa=new Map;function Ka(n){var t=n.getAttribute("is")||n.nodeName,e=aa.get(t);if(e)return e;aa.set(t,e=[]);for(var i,o=n,r=Element.prototype;r!==o;){i=qa(o);for(var c in i)i[c].set&&e.push(c);o=Fa(o)}return e}function je(n){return function(...t){var e=t[0];return e.stopPropagation(),n?.apply(this,t)}}function Lt(n,t){var e=n.$$events?.[t.type],i=da(e)?e.slice():e==null?[]:[e];for(var o of i)o.call(this,t)}var $a=L('<header class="header svelte-hv3zzy"><img src="/logos/logo-picflam-logotype.png" alt="PicFlam" class="header-logo svelte-hv3zzy"/> <nav class="header-nav svelte-hv3zzy"><button aria-label="Crop tab"><img src="/icons/icon-crop.svg" alt="" class="nav-icon svelte-hv3zzy"/></button> <button aria-label="AI tab"><img src="/icons/icon-ai.svg" alt="" class="nav-icon svelte-hv3zzy"/></button> <button aria-label="Design tab"><img src="/icons/icon-design.svg" alt="" class="nav-icon svelte-hv3zzy"/></button></nav></header>');function en(n,t){xe(t,!1);let e=m(t,"activeTab",8,"crop"),i=m(t,"onTabChange",8);Re();var o=$a(),r=w(C(o),2),c=C(r);let d;var l=w(c,2);let u;var h=w(l,2);let I;_(r),_(o),K(()=>{d=Le(c,1,"nav-btn svelte-hv3zzy",null,d,{active:e()==="crop"}),u=Le(l,1,"nav-btn svelte-hv3zzy",null,u,{active:e()==="ai"}),I=Le(h,1,"nav-btn svelte-hv3zzy",null,I,{active:e()==="design"})}),y("click",c,()=>i()("crop")),y("click",l,()=>i()("ai")),y("click",h,()=>i()("design")),A(n,o),ke()}function fa(n){return new Promise((t,e)=>{const i=new FileReader;i.onload=o=>t(o.target.result),i.onerror=e,i.readAsDataURL(n)})}function dt(n){return new Promise((t,e)=>{const i=new Image;i.onload=()=>t(i),i.onerror=e,i.src=n})}async function It(n){const t=await dt(n);return{width:t.naturalWidth,height:t.naturalHeight}}function na(n,t=2048){return new Promise(async e=>{const i=await dt(n),{naturalWidth:o,naturalHeight:r}=i;if(o<=t&&r<=t){e(n);return}const c=document.createElement("canvas"),d=c.getContext("2d");let l,u;o>r?(l=t,u=r/o*t):(u=t,l=o/r*t),c.width=l,c.height=u,d.drawImage(i,0,0,l,u),e(c.toDataURL("image/jpeg",.92))})}async function tn(){try{const n=await navigator.clipboard.read();for(const t of n)for(const e of t.types)if(e.startsWith("image/")){const i=await t.getType(e);return await fa(i)}return null}catch(n){return console.error("Failed to paste from clipboard:",n),null}}async function Ht(n){try{const e=await(await fetch(n)).blob();return await navigator.clipboard.write([new ClipboardItem({[e.type]:e})]),!0}catch(t){return console.error("Failed to copy to clipboard:",t),!1}}function Ft(n,t="picflam-export.png"){const e=document.createElement("a");e.href=n,e.download=t,document.body.appendChild(e),e.click(),document.body.removeChild(e)}async function ma(n,t,e,i){const o=await dt(n),r=document.createElement("canvas"),c=r.getContext("2d"),d=t.x/100*e,l=t.y/100*i,u=t.width/100*e,h=t.height/100*i;return r.width=u,r.height=h,c.drawImage(o,d,l,u,h,0,0,u,h),r.toDataURL("image/png")}async function an(n,t){const e=await dt(n),i=document.createElement("canvas"),o=i.getContext("2d");return i.width=e.naturalHeight,i.height=e.naturalWidth,o.translate(i.width/2,i.height/2),o.rotate(t*Math.PI/180),o.drawImage(e,-e.naturalWidth/2,-e.naturalHeight/2),i.toDataURL("image/png")}async function nn(n,t){const e=await dt(n),i=document.createElement("canvas"),o=i.getContext("2d");return i.width=e.naturalWidth,i.height=e.naturalHeight,o.translate(i.width,0),o.scale(-1,1),o.drawImage(e,0,0),i.toDataURL("image/png")}async function on(n,t,e){const i=await dt(n),o=document.createElement("canvas"),r=o.getContext("2d");if(o.width=i.naturalWidth,o.height=i.naturalHeight,t&&t!=="none"&&(r.filter=t),r.drawImage(i,0,0),r.filter="none",e&&Array.isArray(e)&&e.length>0)if(e.some(d=>d.invert)){const l=.5+e.reduce((s,g)=>s+(g.strength||50),0)/e.length/100*9.5,u=document.createElement("canvas");u.width=o.width,u.height=o.height;const h=u.getContext("2d");h.filter=`blur(${l}px)`,t&&t!=="none"&&(h.filter=`blur(${l}px) ${t}`),h.drawImage(i,0,0);const I=document.createElement("canvas");I.width=o.width,I.height=o.height;const p=I.getContext("2d");p.fillStyle="white",p.fillRect(0,0,I.width,I.height);for(const s of e){if(!s.invert)continue;const g=(s.soften||50)/100,P=p.createRadialGradient(s.x,s.y,0,s.x,s.y,s.radius);P.addColorStop(0,"rgba(0,0,0,1)"),P.addColorStop(.5+g*.3,"rgba(0,0,0,0.5)"),P.addColorStop(1,"rgba(0,0,0,0)"),p.fillStyle=P,p.beginPath(),p.arc(s.x,s.y,s.radius,0,Math.PI*2),p.fill()}const f=r.getImageData(0,0,o.width,o.height),b=h.getImageData(0,0,o.width,o.height),B=p.getImageData(0,0,o.width,o.height);for(let s=0;s<f.data.length;s+=4){const g=B.data[s]/255;f.data[s]=f.data[s]*g+b.data[s]*(1-g),f.data[s+1]=f.data[s+1]*g+b.data[s+1]*(1-g),f.data[s+2]=f.data[s+2]*g+b.data[s+2]*(1-g)}r.putImageData(f,0,0)}else for(const d of e){const l=d.strength||50,u=(d.soften||50)/100,h=.5+l/100*9.5,I=document.createElement("canvas");I.width=o.width,I.height=o.height;const p=I.getContext("2d");p.filter=`blur(${h}px)`,t&&t!=="none"&&(p.filter=`blur(${h}px) ${t}`),p.drawImage(i,0,0);const f=document.createElement("canvas");f.width=o.width,f.height=o.height;const b=f.getContext("2d"),B=b.createRadialGradient(d.x,d.y,0,d.x,d.y,d.radius);B.addColorStop(0,"rgba(255,255,255,1)"),B.addColorStop(.5+u*.3,"rgba(255,255,255,0.5)"),B.addColorStop(1,"rgba(255,255,255,0)"),b.fillStyle=B,b.beginPath(),b.arc(d.x,d.y,d.radius,0,Math.PI*2),b.fill();const s=r.getImageData(0,0,o.width,o.height),g=p.getImageData(0,0,o.width,o.height),P=b.getImageData(0,0,o.width,o.height);for(let E=0;E<s.data.length;E+=4){const M=P.data[E]/255;s.data[E]=s.data[E]*(1-M)+g.data[E]*M,s.data[E+1]=s.data[E+1]*(1-M)+g.data[E+1]*M,s.data[E+2]=s.data[E+2]*(1-M)+g.data[E+2]*M}r.putImageData(s,0,0)}return o.toDataURL("image/png")}var rn=L('<div role="button" tabindex="0"><p class="import-title svelte-f1bndr"> </p> <img src="/icons/icon-upload.svg" alt="" class="import-icon svelte-f1bndr"/> <p class="import-hint svelte-f1bndr"> </p> <button class="btn-paste svelte-f1bndr">Paste</button> <input type="file" accept="image/*" class="sr-only"/></div>');function ba(n,t){xe(t,!1);let e=m(t,"title",8,"Import an image"),i=m(t,"hint",8,"Import, drag or paste an image"),o=m(t,"onImageImport",8,R=>{}),r=O(!1),c=O();async function d(R){if(!R||!R.type.startsWith("image/"))return;const x=await fa(R),T=await na(x,2048);o()(T)}function l(R){const x=R.target.files?.[0];x&&d(x)}function u(R){R.preventDefault(),S(r,!1);const x=R.dataTransfer?.files?.[0];x&&d(x)}function h(R){R.preventDefault(),S(r,!0)}function I(){S(r,!1)}async function p(){const R=await tn();if(R){const x=await na(R,2048);o()(x)}}function f(){a(c)?.click()}Re();var b=rn();let B;var s=C(b),g=C(s,!0);_(s);var P=w(s,4),E=C(P,!0);_(P);var M=w(P,2),H=w(M,2);bt(H,R=>S(c,R),()=>a(c)),_(b),K(()=>{B=Le(b,1,"import-area svelte-f1bndr",null,B,{dragging:a(r)}),Ie(g,e()),Ie(E,i())}),y("click",M,je(p)),y("change",H,l),y("click",b,f),y("drop",b,u),y("dragover",b,h),y("dragleave",b,I),y("keypress",b,R=>R.key==="Enter"&&f()),A(n,b),ke()}var sn=L('<div class="action-bar svelte-96zw02"><div class="action-group svelte-96zw02"><button class="action-btn svelte-96zw02" aria-label="Undo"><img src="/icons/icon-undo.svg" alt="" class="action-icon svelte-96zw02"/></button> <button class="action-btn svelte-96zw02" aria-label="Redo"><img src="/icons/icon-redo.svg" alt="" class="action-icon svelte-96zw02"/></button></div> <div class="action-group svelte-96zw02"><button class="action-btn svelte-96zw02" aria-label="Start again"><img src="/icons/icon-startagain.svg" alt="" class="action-icon svelte-96zw02"/></button> <button class="action-btn svelte-96zw02" aria-label="Copy to clipboard"><img src="/icons/icon-copy.svg" alt="" class="action-icon svelte-96zw02"/></button> <button class="action-btn svelte-96zw02" aria-label="Export"><img src="/icons/icon-export.svg" alt="" class="action-icon svelte-96zw02"/></button></div></div>');function Gt(n,t){let e=m(t,"canUndo",8,!1),i=m(t,"canRedo",8,!1),o=m(t,"onUndo",8,()=>{}),r=m(t,"onRedo",8,()=>{}),c=m(t,"onStartAgain",8,()=>{}),d=m(t,"onCopy",8,()=>{}),l=m(t,"onExport",8,()=>{});var u=sn(),h=C(u),I=C(h),p=w(I,2);_(h);var f=w(h,2),b=C(f),B=w(b,2),s=w(B,2);_(f),_(u),K(()=>{I.disabled=!e(),p.disabled=!i()}),y("click",I,function(...g){o()?.apply(this,g)}),y("click",p,function(...g){r()?.apply(this,g)}),y("click",b,function(...g){c()?.apply(this,g)}),y("click",B,function(...g){d()?.apply(this,g)}),y("click",s,function(...g){l()?.apply(this,g)}),A(n,u)}var ln=L("<button> </button>"),cn=L('<div class="sub-menu-tabs svelte-tv6tw8"></div>');function Jt(n,t){xe(t,!1);let e=m(t,"tabs",24,()=>[]),i=m(t,"activeTab",8,""),o=m(t,"onTabChange",8,c=>{});Re();var r=cn();wt(r,5,e,pt,(c,d)=>{var l=ln();let u;var h=C(l,!0);_(l),K(()=>{u=Le(l,1,"sub-menu-tab svelte-tv6tw8",null,u,{active:i()===a(d).id}),Ie(h,(a(d),U(()=>a(d).label)))}),y("click",l,()=>o()(a(d).id)),A(c,l)}),_(r),A(n,r),ke()}var dn=L('<div class="modal-overlay svelte-qik81a" role="dialog" aria-modal="true" tabindex="-1"><div class="modal svelte-qik81a" role="document"><p class="modal-message svelte-qik81a"> </p> <div class="modal-actions svelte-qik81a"><button class="btn-text svelte-qik81a"> </button> <button class="btn-text btn-confirm svelte-qik81a"> </button></div></div></div>');function qt(n,t){xe(t,!1);let e=m(t,"message",8,""),i=m(t,"confirmText",8,"Yes"),o=m(t,"cancelText",8,"Cancel"),r=m(t,"onConfirm",8,()=>{}),c=m(t,"onCancel",8,()=>{});Re();var d=dn(),l=C(d),u=C(l),h=C(u,!0);_(u);var I=w(u,2),p=C(I),f=C(p,!0);_(p);var b=w(p,2),B=C(b,!0);_(b),_(I),_(l),_(d),K(()=>{Ie(h,e()),Ie(f,o()),Ie(B,i())}),y("click",p,function(...s){c()?.apply(this,s)}),y("click",b,function(...s){r()?.apply(this,s)}),y("click",l,je(function(s){Lt.call(this,t,s)})),y("keydown",l,je(function(s){Lt.call(this,t,s)})),y("click",d,function(...s){c()?.apply(this,s)}),y("keydown",d,s=>s.key==="Escape"&&c()()),A(n,d),ke()}var un=L('<canvas class="blur-canvas svelte-pjowa5"></canvas>'),vn=L('<div class="blur-brush-indicator svelte-pjowa5"></div>'),gn=L('<div class="blur-brush-preview svelte-pjowa5"></div>'),hn=L('<div class="crop-overlay svelte-pjowa5"><div class="overlay-top svelte-pjowa5"></div> <div class="overlay-bottom svelte-pjowa5"></div> <div class="overlay-left svelte-pjowa5"></div> <div class="overlay-right svelte-pjowa5"></div> <div class="crop-box svelte-pjowa5" role="button" aria-label="Drag to move crop area" tabindex="0"><div class="crop-border svelte-pjowa5"></div> <div class="corner-handle top-left svelte-pjowa5" role="button" aria-label="Resize top-left corner" tabindex="0"></div> <div class="corner-handle top-right svelte-pjowa5" role="button" aria-label="Resize top-right corner" tabindex="0"></div> <div class="corner-handle bottom-left svelte-pjowa5" role="button" aria-label="Resize bottom-left corner" tabindex="0"></div> <div class="corner-handle bottom-right svelte-pjowa5" role="button" aria-label="Resize bottom-right corner" tabindex="0"></div></div></div>'),fn=L('<div class="crop-canvas svelte-pjowa5" role="application" aria-label="Image crop canvas"><div class="image-wrapper svelte-pjowa5"><img alt="Crop preview" class="canvas-image svelte-pjowa5" draggable="false"/> <!></div> <!> <!> <!></div>');function mn(n,t){xe(t,!1);const e=O(),i=O(),o=O(),r=O();let c=m(t,"imageSrc",8,""),d=m(t,"cropBox",24,()=>({x:10,y:10,width:80,height:80})),l=m(t,"isCropping",8,!1),u=m(t,"scale",8,1),h=m(t,"offsetX",8,0),I=m(t,"offsetY",8,0),p=m(t,"imageWidth",8,0),f=m(t,"imageHeight",8,0),b=m(t,"editFilters",8,""),B=m(t,"blurEnabled",8,!1),s=m(t,"blurBrushSize",8,50),g=m(t,"blurStrength",8,50),P=m(t,"blurSoften",8,50),E=m(t,"blurInvert",8,!1),M=m(t,"blurMask",24,()=>[]),H=m(t,"showBrushPreview",8,!1);const R=Oa();let x=O(),T=O(),Y=O({width:0,height:0}),N=!1,Q=null,he=0,ie=0,ee=null,fe=0,J=1,te=!1,le=O({x:0,y:0,visible:!1}),Pe=O(null),Ce=O("");async function me(){S(Ce,c());const k=new Image;k.crossOrigin="anonymous",k.onload=()=>{S(Pe,k)},k.src=c()}function Oe(k){const j=document.createElement("canvas");j.width=a(Pe).naturalWidth,j.height=a(Pe).naturalHeight;const $=j.getContext("2d");return $.filter=`blur(${k}px)`,$.drawImage(a(Pe),0,0),j}function Ge(){if(!a(T)||!a(Pe)||!M())return;const k=a(T).getContext("2d"),j=a(T).width,$=a(T).height;if(k.clearRect(0,0,j,$),M().length===0)return;const q=j/p(),ae=$/f();if(M().some(G=>G.invert)){const G=M().reduce((F,X)=>F+(X.strength||50),0)/M().length;M().reduce((F,X)=>F+(X.soften||50),0)/M().length;const v=.5+G/100*9.5,z=Oe(v);k.drawImage(z,0,0,j,$),k.globalCompositeOperation="destination-out";for(const F of M()){if(!F.invert)continue;const X=F.x*q,W=F.y*ae,ne=F.radius*Math.min(q,ae),oe=(F.soften||50)/100,ue=Math.max(0,.3-oe*.3),de=.3+(1-oe)*.4,ce=k.createRadialGradient(X,W,0,X,W,ne);ce.addColorStop(ue,"rgba(0,0,0,1)"),ce.addColorStop(de,`rgba(0,0,0,${.5+oe*.3})`),ce.addColorStop(1,"rgba(0,0,0,0)"),k.fillStyle=ce,k.beginPath(),k.arc(X,W,ne,0,Math.PI*2),k.fill()}k.globalCompositeOperation="source-over"}else for(const G of M()){const v=G.x*q,z=G.y*ae,F=G.radius*Math.min(q,ae),X=G.strength||50,W=(G.soften||50)/100,ne=.5+X/100*9.5,oe=Oe(ne);k.save();const ue=Math.max(0,.2-W*.2),de=.2+(1-W)*.5,ce=k.createRadialGradient(v,z,0,v,z,F);ce.addColorStop(ue,"rgba(255,255,255,1)"),ce.addColorStop(de,`rgba(255,255,255,${.4+W*.3})`),ce.addColorStop(1,"rgba(255,255,255,0)"),k.beginPath(),k.arc(v,z,F,0,Math.PI*2),k.clip(),k.drawImage(oe,0,0,j,$),k.restore()}}Yt(()=>(Je(),window.addEventListener("resize",Je),()=>window.removeEventListener("resize",Je)));function Je(){if(a(x)){const k=a(x).getBoundingClientRect();S(Y,{width:k.width,height:k.height})}}function be(k){return k.touches&&k.touches.length>0?{x:k.touches[0].clientX,y:k.touches[0].clientY}:{x:k.clientX,y:k.clientY}}function He(k){if(k.touches&&k.touches.length>=2){const j=k.touches[0].clientX-k.touches[1].clientX,$=k.touches[0].clientY-k.touches[1].clientY;return Math.sqrt(j*j+$*$)}return 0}function pe(k,j="move"){if(!l())return;if(k.touches&&k.touches.length>=2){fe=He(k),J=u(),Q="pinch";return}k.preventDefault(),N=!0,Q=j;const $=be(k);he=$.x,ie=$.y,ee={...d()}}function Ve(k){if(!l())return;if(Q==="pinch"&&k.touches&&k.touches.length>=2){const ve=He(k),G=J*(ve/fe);R("scaleChange",{scale:Math.max(.5,Math.min(3,G))});return}if(!N||!ee)return;k.preventDefault();const j=be(k),$=(j.x-he)/a(e)*100,q=(j.y-ie)/a(i)*100;let ae={...ee};if(Q==="move")ae.x=Math.max(0,Math.min(100-ee.width,ee.x+$)),ae.y=Math.max(0,Math.min(100-ee.height,ee.y+q));else if(Q.includes("corner")){if(Q.includes("left")){const G=ee.x+$,v=ee.width-$;v>=10&&G>=0&&(ae.x=G,ae.width=v)}if(Q.includes("right")){const G=ee.width+$;G>=10&&ee.x+G<=100&&(ae.width=G)}if(Q.includes("top")){const G=ee.y+q,v=ee.height-q;v>=10&&G>=0&&(ae.y=G,ae.height=v)}if(Q.includes("bottom")){const G=ee.height+q;G>=10&&ee.y+G<=100&&(ae.height=G)}}R("cropChange",{cropBox:ae})}function Ze(){N=!1,Q=null,ee=null,te&&(te=!1)}function Me(k){B()&&(k.preventDefault(),te=!0,Ne(k))}function we(k){if(!B())return;const j=a(x).getBoundingClientRect(),$=be(k);S(le,{x:$.x-j.left,y:$.y-j.top,visible:!0}),te&&Ne(k)}function $e(){S(le,{...a(le),visible:!1}),te&&(te=!1)}function Ne(k){const j=a(x).getBoundingClientRect(),$=be(k),q=($.x-j.left)/a(e)*p(),ae=($.y-j.top)/a(i)*f(),ve=s()/100*Math.min(p(),f())*.15;R("blurPaint",{point:{x:q,y:ae,radius:ve,strength:g(),soften:P(),invert:E()}})}Se(()=>a(Y),()=>{S(e,a(Y).width)}),Se(()=>(Be(f()),Be(p()),a(e)),()=>{S(i,f()&&p()?a(e)*f()/p():0)}),Se(()=>(Be(s()),a(e),a(i)),()=>{S(o,s()/100*Math.min(a(e),a(i))*.3)}),Se(()=>(Be(c()),a(T),a(Ce)),()=>{c()&&a(T)&&c()!==a(Ce)&&me()}),Se(()=>(Be(M()),a(T),a(Pe)),()=>{M()&&Array.isArray(M())&&M().length>0&&a(T)&&a(Pe)&&Ge()}),Se(()=>(Be(d()),a(e),a(i)),()=>{S(r,{x:d().x/100*a(e),y:d().y/100*a(i),width:d().width/100*a(e),height:d().height/100*a(i)})}),mt(),Re();var se=fn(),Te=C(se),Fe=C(Te),ut=w(Fe,2);{var it=k=>{var j=un();bt(j,$=>S(T,$),()=>a(T)),K(()=>{ge(j,"width",a(e)),ge(j,"height",a(i)),Ue(j,`filter: ${b()??""};`)}),A(k,j)};Z(ut,k=>{B()&&a(e)>0&&a(i)>0&&k(it)})}_(Te);var Qe=w(Te,2);{var et=k=>{var j=vn();K(()=>Ue(j,`
				left: ${a(le),U(()=>a(le).x)??""}px;
				top: ${a(le),U(()=>a(le).y)??""}px;
				width: ${a(o)??""}px;
				height: ${a(o)??""}px;
			`)),A(k,j)};Z(Qe,k=>{Be(B()),a(le),U(()=>B()&&a(le).visible)&&k(et)})}var qe=w(Qe,2);{var ot=k=>{var j=gn();K(()=>Ue(j,`
				left: ${a(e)/2}px;
				top: ${a(i)/2}px;
				width: ${a(o)??""}px;
				height: ${a(o)??""}px;
			`)),A(k,j)};Z(qe,k=>{H()&&a(e)>0&&a(i)>0&&k(ot)})}var tt=w(qe,2);{var Ye=k=>{var j=hn(),$=C(j),q=w($,2),ae=w(q,2),ve=w(ae,2),G=w(ve,2),v=w(C(G),2),z=w(v,2),F=w(z,2),X=w(F,2);_(G),_(j),K(()=>{Ue($,`height: ${a(r),U(()=>a(r).y)??""}px;`),Ue(q,`top: ${a(r),U(()=>a(r).y+a(r).height)??""}px; height: ${a(i),a(r),U(()=>a(i)-a(r).y-a(r).height)??""}px;`),Ue(ae,`top: ${a(r),U(()=>a(r).y)??""}px; height: ${a(r),U(()=>a(r).height)??""}px; width: ${a(r),U(()=>a(r).x)??""}px;`),Ue(ve,`top: ${a(r),U(()=>a(r).y)??""}px; height: ${a(r),U(()=>a(r).height)??""}px; left: ${a(r),U(()=>a(r).x+a(r).width)??""}px; width: ${a(e),a(r),U(()=>a(e)-a(r).x-a(r).width)??""}px;`),Ue(G,`left: ${a(r),U(()=>a(r).x)??""}px; top: ${a(r),U(()=>a(r).y)??""}px; width: ${a(r),U(()=>a(r).width)??""}px; height: ${a(r),U(()=>a(r).height)??""}px;`)}),y("mousedown",v,je(W=>pe(W,"corner-top-left"))),y("touchstart",v,je(W=>pe(W,"corner-top-left"))),y("mousedown",z,je(W=>pe(W,"corner-top-right"))),y("touchstart",z,je(W=>pe(W,"corner-top-right"))),y("mousedown",F,je(W=>pe(W,"corner-bottom-left"))),y("touchstart",F,je(W=>pe(W,"corner-bottom-left"))),y("mousedown",X,je(W=>pe(W,"corner-bottom-right"))),y("touchstart",X,je(W=>pe(W,"corner-bottom-right"))),y("mousedown",G,W=>pe(W,"move")),y("touchstart",G,W=>pe(W,"move")),A(k,j)};Z(tt,k=>{l()&&a(i)>0&&k(Ye)})}_(se),bt(se,k=>S(x,k),()=>a(x)),K(()=>{Ue(Te,`transform: scale(${u()??""}) translate(${h()??""}px, ${I()??""}px);`),ge(Fe,"src",c()),Ue(Fe,`filter: ${b()??""};`)}),y("mousemove",se,function(...k){(B()?we:Ve)?.apply(this,k)}),y("mouseup",se,Ze),y("mouseleave",se,function(...k){(B()?$e:Ze)?.apply(this,k)}),y("touchmove",se,function(...k){(B()?we:Ve)?.apply(this,k)}),y("touchend",se,Ze),y("mousedown",se,function(...k){(B()?Me:null)?.apply(this,k)}),y("touchstart",se,function(...k){(B()?Me:null)?.apply(this,k)}),A(n,se),ke()}var bn=L('<img alt="" class="toggle-icon svelte-1gdqxne"/>'),pn=L('<span class="toggle-label svelte-1gdqxne"> </span>'),wn=L("<div><button><!></button> <!></div>"),_n=L('<div class="toggle-group svelte-1gdqxne"></div>');function xn(n,t){xe(t,!1);let e=m(t,"options",24,()=>[]),i=m(t,"value",8,""),o=m(t,"onChange",8,d=>{}),r=m(t,"showLabels",8,!0);Re();var c=_n();wt(c,5,e,pt,(d,l)=>{var u=wn();let h;var I=C(u);let p;var f=C(I);{var b=g=>{var P=bn();K(()=>ge(P,"src",`/icons/${a(l),U(()=>a(l).icon)??""}.svg`)),A(g,P)};Z(f,g=>{a(l),U(()=>a(l).icon)&&g(b)})}_(I);var B=w(I,2);{var s=g=>{var P=pn(),E=C(P,!0);_(P),K(()=>Ie(E,(a(l),U(()=>a(l).label)))),A(g,P)};Z(B,g=>{Be(r()),a(l),U(()=>r()&&a(l).label)&&g(s)})}_(u),K(()=>{h=Le(u,1,"toggle-item svelte-1gdqxne",null,h,{active:i()===a(l).id}),p=Le(I,1,"toggle-btn svelte-1gdqxne",null,p,{active:i()===a(l).id}),ge(I,"aria-label",(a(l),U(()=>a(l).label)))}),y("click",I,()=>o()(a(l).id)),A(d,u)}),_(c),A(n,c),ke()}var kn=L('<label class="input-label svelte-1r47u3b"> <input class="input svelte-1r47u3b"/></label>'),Cn=L('<input class="input svelte-1r47u3b"/>'),yn=L('<div class="input-field svelte-1r47u3b"><!></div>');function ia(n,t){xe(t,!1);let e=m(t,"label",8,""),i=m(t,"value",12,""),o=m(t,"type",8,"text"),r=m(t,"placeholder",8,""),c=m(t,"disabled",8,!1),d=m(t,"onChange",8,f=>{});function l(f){i(f.target.value),d()(i())}Re();var u=yn(),h=C(u);{var I=f=>{var b=kn(),B=C(b),s=w(B);Rt(s),_(b),K(()=>{Ie(B,`${e()??""} `),ge(s,"type",o()),Dt(s,i()),ge(s,"placeholder",r()),s.disabled=c()}),y("input",s,l),A(f,b)},p=f=>{var b=Cn();Rt(b),K(()=>{ge(b,"type",o()),Dt(b,i()),ge(b,"placeholder",r()),b.disabled=c()}),y("input",b,l),A(f,b)};Z(h,f=>{e()?f(I):f(p,!1)})}_(u),A(n,u),ke()}var Sn=L('<span class="slider-value svelte-jchife"> </span>'),In=L('<div class="slider-header svelte-jchife"><span class="slider-label svelte-jchife"> </span> <!></div>'),Rn=L('<div class="slider-container svelte-jchife"><!> <input type="range" class="slider svelte-jchife"/></div>');function ft(n,t){xe(t,!1);let e=m(t,"label",8,""),i=m(t,"min",8,0),o=m(t,"max",8,100),r=m(t,"value",8,50),c=m(t,"step",8,1),d=m(t,"showValue",8,!1),l=m(t,"onChange",8,P=>{}),u=m(t,"onInteractionStart",8,()=>{}),h=m(t,"onInteractionEnd",8,()=>{});function I(P){const E=Number(P.target.value);l()(E)}function p(){u()()}function f(){h()()}Re();var b=Rn(),B=C(b);{var s=P=>{var E=In(),M=C(E),H=C(M,!0);_(M);var R=w(M,2);{var x=T=>{var Y=Sn(),N=C(Y,!0);_(Y),K(()=>Ie(N,r())),A(T,Y)};Z(R,T=>{d()&&T(x)})}_(E),K(()=>Ie(H,e())),A(P,E)};Z(B,P=>{e()&&P(s)})}var g=w(B,2);Rt(g),_(b),K(()=>{ge(g,"min",i()),ge(g,"max",o()),ge(g,"step",c()),Dt(g,r())}),y("input",g,I),y("mousedown",g,p),y("touchstart",g,p),y("mouseup",g,f),y("touchend",g,f),A(n,b),ke()}var zn=L('<div class="apply-row svelte-17iy3mz"><button class="btn-apply svelte-17iy3mz">Apply</button></div>'),Bn=L('<div class="crop-controls svelte-17iy3mz"><!> <div class="dimensions-row svelte-17iy3mz"><div class="dimension-input svelte-17iy3mz"><!></div> <button class="icon-btn svelte-17iy3mz"><img alt="" class="icon-btn-img svelte-17iy3mz"/></button> <div class="dimension-input svelte-17iy3mz"><!></div> <button class="icon-btn svelte-17iy3mz" aria-label="Flip horizontal"><img src="/icons/icon-flip-horizontal.svg" alt="" class="icon-btn-img svelte-17iy3mz"/></button> <button class="icon-btn svelte-17iy3mz" aria-label="Rotate"><img src="/icons/icon-rotate.svg" alt="" class="icon-btn-img svelte-17iy3mz"/></button></div> <!> <!></div>');function En(n,t){xe(t,!1);let e=m(t,"aspectRatio",8,"9:16"),i=m(t,"cropWidth",8,1080),o=m(t,"cropHeight",8,1920),r=m(t,"ratioLocked",8,!0),c=m(t,"scale",8,100),d=m(t,"cropPending",8,!1),l=m(t,"onRatioChange",8,J=>{}),u=m(t,"onDimensionsChange",8,({width:J,height:te})=>{}),h=m(t,"onLockToggle",8,()=>{}),I=m(t,"onFlip",8,()=>{}),p=m(t,"onRotate",8,()=>{}),f=m(t,"onScaleChange",8,J=>{}),b=m(t,"onApply",8,()=>{});const B=[{id:"9:16",label:"9:16",icon:"icon-vertical"},{id:"1:1",label:"1:1",icon:"icon-square"},{id:"16:9",label:"16:9",icon:"icon-horizontal"},{id:"custom",label:"Custom",icon:"icon-custom"}];function s(J){const te=parseInt(J)||0;u()({width:te,height:o()})}function g(J){const te=parseInt(J)||0;u()({width:i(),height:te})}Re();var P=Bn(),E=C(P);xn(E,{get options(){return B},get value(){return e()},get onChange(){return l()},showLabels:!0});var M=w(E,2),H=C(M),R=C(H);{let J=Ke(()=>(Be(i()),U(()=>i().toString())));ia(R,{label:"Width",type:"number",get value(){return a(J)},onChange:s})}_(H);var x=w(H,2),T=C(x);_(x);var Y=w(x,2),N=C(Y);{let J=Ke(()=>(Be(o()),U(()=>o().toString())));ia(N,{label:"Height",type:"number",get value(){return a(J)},onChange:g})}_(Y);var Q=w(Y,2),he=w(Q,2);_(M);var ie=w(M,2);ft(ie,{label:"Scale",min:50,max:200,get value(){return c()},step:1,showValue:!0,get onChange(){return f()}});var ee=w(ie,2);{var fe=J=>{var te=zn(),le=C(te);_(te),y("click",le,function(...Pe){b()?.apply(this,Pe)}),A(J,te)};Z(ee,J=>{d()&&J(fe)})}_(P),K(()=>{ge(x,"aria-label",r()?"Unlock aspect ratio":"Lock aspect ratio"),ge(T,"src",`/icons/${r()?"icon-lock":"icon-unlock"}.svg`)}),y("click",x,function(...J){h()?.apply(this,J)}),y("click",Q,function(...J){I()?.apply(this,J)}),y("click",he,function(...J){p()?.apply(this,J)}),A(n,P),ke()}var Pn=L("<button> </button>"),Mn=L("<button> </button>"),Tn=L('<div class="blur-controls svelte-1e1k0ax"><div class="blur-control-row svelte-1e1k0ax"><!> <label class="invert-checkbox svelte-1e1k0ax"><input type="checkbox" class="svelte-1e1k0ax"/> <span class="checkbox-label svelte-1e1k0ax">Invert</span></label></div> <div class="slider-row svelte-1e1k0ax"><div class="slider-track svelte-1e1k0ax"><!></div> <button class="reset-btn svelte-1e1k0ax" aria-label="Reset"><img src="/icons/icon-reset.svg" alt="" class="reset-icon svelte-1e1k0ax"/></button></div> <div class="zoom-row svelte-1e1k0ax"><span class="zoom-label svelte-1e1k0ax">Zoom in</span> <div class="zoom-slider-row svelte-1e1k0ax"><div class="slider-track svelte-1e1k0ax"><!></div> <button class="reset-btn svelte-1e1k0ax" aria-label="Reset zoom"><img src="/icons/icon-reset.svg" alt="" class="reset-icon svelte-1e1k0ax"/></button></div></div> <div class="nudge-row svelte-1e1k0ax"><button class="nudge-btn svelte-1e1k0ax" aria-label="Nudge up"><img src="/icons/icon-nudge-up.svg" alt="" class="svelte-1e1k0ax"/></button> <button class="nudge-btn svelte-1e1k0ax" aria-label="Nudge down"><img src="/icons/icon-nudge-down.svg" alt="" class="svelte-1e1k0ax"/></button> <button class="nudge-btn svelte-1e1k0ax" aria-label="Nudge left"><img src="/icons/icon-nudge-left.svg" alt="" class="svelte-1e1k0ax"/></button> <button class="nudge-btn svelte-1e1k0ax" aria-label="Nudge right"><img src="/icons/icon-nudge-right.svg" alt="" class="svelte-1e1k0ax"/></button></div></div>'),An=L('<div class="edit-controls svelte-1e1k0ax"><div class="enhancement-row svelte-1e1k0ax"></div> <div class="slider-row svelte-1e1k0ax"><div class="slider-track svelte-1e1k0ax"><!></div> <button class="reset-btn svelte-1e1k0ax" aria-label="Reset"><img src="/icons/icon-reset.svg" alt="" class="reset-icon svelte-1e1k0ax"/></button></div> <div class="blur-section svelte-1e1k0ax"><div class="blur-header svelte-1e1k0ax"><button class="chevron-btn svelte-1e1k0ax"><img alt=""/></button> <span class="blur-label svelte-1e1k0ax">Blur</span> <button><span class="toggle-thumb svelte-1e1k0ax"></span></button></div> <!></div></div>');function Un(n,t){xe(t,!1);const e=O(),i=O(),o=O(),r=O(),c=O(),d=O();let l=m(t,"brightness",8,0),u=m(t,"shadows",8,0),h=m(t,"contrast",8,0),I=m(t,"hdr",8,0),p=m(t,"blurBrushSize",8,50),f=m(t,"blurStrength",8,50),b=m(t,"blurSoften",8,50),B=m(t,"blurInvert",8,!1),s=m(t,"zoomLevel",8,1),g=m(t,"blurEnabled",8,!1),P=m(t,"onBrightnessChange",8,q=>{}),E=m(t,"onShadowsChange",8,q=>{}),M=m(t,"onContrastChange",8,q=>{}),H=m(t,"onHdrChange",8,q=>{}),R=m(t,"onBlurBrushSizeChange",8,q=>{}),x=m(t,"onBlurStrengthChange",8,q=>{}),T=m(t,"onBlurSoftenChange",8,q=>{}),Y=m(t,"onBlurInvertChange",8,q=>{}),N=m(t,"onZoomChange",8,q=>{}),Q=m(t,"onNudge",8,q=>{}),he=m(t,"onResetZoom",8,()=>{}),ie=m(t,"onBlurToggle",8,q=>{}),ee=m(t,"onBrushPreviewChange",8,q=>{}),fe=m(t,"onEditEnd",8,()=>{}),J=O("brightness"),te=O(g()),le=O("brushSize");const Pe=[{id:"brightness",label:"Brightness"},{id:"shadows",label:"Shadows"},{id:"contrast",label:"Contrast"},{id:"hdr",label:"HDR"}],Ce=[{id:"brushSize",label:"Brush size"},{id:"strength",label:"Strength"},{id:"soften",label:"Soften edges"}];function me(q){switch(a(J)){case"brightness":P()(q);break;case"shadows":E()(q);break;case"contrast":M()(q);break;case"hdr":H()(q);break}}function Oe(){me(0)}function Ge(q){switch(a(le)){case"brushSize":R()(q);break;case"strength":x()(q);break;case"soften":T()(q);break}}function Je(){Ge(50)}function be(){const q=!g();ie()(q),S(te,q)}function He(){g()&&S(te,!a(te))}function pe(){Y()(!B())}function Ve(q){S(J,q),S(te,!1)}function Ze(q){S(le,q)}function Me(){fe()()}function we(){a(le)==="brushSize"&&ee()(!0)}function $e(){ee()(!1),fe()()}Se(()=>(a(J),Be(l()),Be(u()),Be(h()),Be(I())),()=>{S(e,(()=>{switch(a(J)){case"brightness":return l();case"shadows":return u();case"contrast":return h();case"hdr":return I();default:return 0}})())}),Se(()=>a(J),()=>{S(i,a(J)==="hdr"?0:-100)}),Se(()=>{},()=>{S(o,100)}),Se(()=>(a(le),Be(p()),Be(f()),Be(b())),()=>{S(r,(()=>{switch(a(le)){case"brushSize":return p();case"strength":return f();case"soften":return b();default:return 50}})())}),Se(()=>{},()=>{S(c,1)}),Se(()=>{},()=>{S(d,100)}),mt(),Re();var Ne=An(),se=C(Ne);wt(se,5,()=>Pe,pt,(q,ae)=>{var ve=Pn();let G;var v=C(ve,!0);_(ve),K(()=>{G=Le(ve,1,"enhancement-btn svelte-1e1k0ax",null,G,{active:a(J)===a(ae).id}),Ie(v,(a(ae),U(()=>a(ae).label)))}),y("click",ve,()=>Ve(a(ae).id)),A(q,ve)}),_(se);var Te=w(se,2),Fe=C(Te),ut=C(Fe);ft(ut,{get min(){return a(i)},get max(){return a(o)},get value(){return a(e)},step:1,onChange:me,onInteractionEnd:Me}),_(Fe);var it=w(Fe,2);_(Te);var Qe=w(Te,2),et=C(Qe),qe=C(et),ot=C(qe);let tt;_(qe);var Ye=w(qe,4);let k;_(et);var j=w(et,2);{var $=q=>{var ae=Tn(),ve=C(ae),G=C(ve);wt(G,1,()=>Ce,pt,(at,ye)=>{var ze=Mn();let vt;var wa=C(ze,!0);_(ze),K(()=>{vt=Le(ze,1,"blur-control-btn svelte-1e1k0ax",null,vt,{active:a(le)===a(ye).id}),Ie(wa,(a(ye),U(()=>a(ye).label)))}),y("click",ze,()=>Ze(a(ye).id)),A(at,ze)});var v=w(G,2),z=C(v);Rt(z),zt(2),_(v),_(ve);var F=w(ve,2),X=C(F),W=C(X);ft(W,{get min(){return a(c)},get max(){return a(d)},get value(){return a(r)},step:1,onChange:Ge,onInteractionStart:we,onInteractionEnd:$e}),_(X);var ne=w(X,2);_(F);var oe=w(F,2),ue=w(C(oe),2),de=C(ue),ce=C(de);ft(ce,{min:1,max:3,step:.1,get value(){return s()},get onChange(){return N()}}),_(de);var rt=w(de,2);_(ue),_(oe);var D=w(oe,2),re=C(D),Ae=w(re,2),_e=w(Ae,2),st=w(_e,2);_(D),_(ae),K(()=>Qa(z,B())),y("change",z,pe),y("click",ne,Je),y("click",rt,function(...at){he()?.apply(this,at)}),y("click",re,()=>Q()("up")),y("click",Ae,()=>Q()("down")),y("click",_e,()=>Q()("left")),y("click",st,()=>Q()("right")),A(q,ae)};Z(j,q=>{a(te)&&g()&&q($)})}_(Qe),_(Ne),K(()=>{qe.disabled=!g(),ge(qe,"aria-label",a(te)?"Collapse":"Expand"),ge(ot,"src",`/icons/${a(te)?"icon-collapse":"icon-expand"}.svg`),tt=Le(ot,1,"chevron-icon svelte-1e1k0ax",null,tt,{disabled:!g()}),k=Le(Ye,1,"toggle-switch svelte-1e1k0ax",null,k,{active:g()}),ge(Ye,"aria-label",g()?"Disable blur":"Enable blur")}),y("click",it,Oe),y("click",qe,He),y("click",Ye,be),A(n,Ne),ke()}var Dn=L('<button><div class="filter-preview svelte-183y0dt"></div> <span> </span></button>'),Ln=L('<div class="filter-grid svelte-183y0dt"></div>');function Hn(n,t){xe(t,!1);let e=m(t,"filters",24,()=>[]),i=m(t,"value",8,"original"),o=m(t,"imageUrl",8,""),r=m(t,"onChange",8,d=>{});Re();var c=Ln();wt(c,5,e,pt,(d,l)=>{var u=Dn();let h;var I=C(u),p=w(I,2);let f;var b=C(p,!0);_(p),_(u),K(()=>{h=Le(u,1,"filter-card svelte-183y0dt",null,h,{active:i()===a(l).id}),Ue(I,`
					background-image: url(${o()??""});
					filter: ${a(l),U(()=>a(l).css||"none")??""};
				`),f=Le(p,1,"filter-label svelte-183y0dt",null,f,{active:i()===a(l).id}),Ie(b,(a(l),U(()=>a(l).label)))}),y("click",u,()=>r()(a(l).id)),A(d,u)}),_(c),A(n,c),ke()}var Fn=L('<div class="filter-controls svelte-1274k9v"><!> <div><div class="slider-track svelte-1274k9v"><!></div> <button class="reset-btn svelte-1274k9v" aria-label="Reset filter"><img src="/icons/icon-reset.svg" alt="" class="reset-icon svelte-1274k9v"/></button></div></div>');function qn(n,t){xe(t,!1);const e=O();let i=m(t,"imageUrl",8,""),o=m(t,"activeFilter",8,"original"),r=m(t,"filterStrength",8,50),c=m(t,"onFilterChange",8,g=>{}),d=m(t,"onStrengthChange",8,g=>{}),l=m(t,"onReset",8,()=>{});const u=[{id:"original",label:"Original",css:"none"},{id:"greyscale",label:"Greyscale",css:"grayscale(100%)"},{id:"sepia",label:"Sepia",css:"sepia(100%)"},{id:"sunset",label:"Sunset",css:"sepia(30%) saturate(140%) brightness(110%) hue-rotate(-10deg)"},{id:"azure",label:"Azure",css:"saturate(120%) brightness(105%) hue-rotate(180deg)"},{id:"teal",label:"Teal",css:"saturate(130%) hue-rotate(140deg)"}];Se(()=>Be(o()),()=>{S(e,o()==="original")}),mt();var h=Fn(),I=C(h);Hn(I,{get filters(){return u},get value(){return o()},get imageUrl(){return i()},get onChange(){return c()}});var p=w(I,2);let f;var b=C(p),B=C(b);{let g=Ke(()=>a(e)?()=>{}:d());ft(B,{label:"Strength",min:0,max:100,get value(){return r()},get onChange(){return a(g)}})}_(b);var s=w(b,2);_(p),_(h),K(()=>f=Le(p,1,"slider-row svelte-1274k9v",null,f,{disabled:a(e)})),y("click",s,function(...g){l()?.apply(this,g)}),A(n,h),ke()}const oa=[{id:"original",label:"Original",css:"none"},{id:"greyscale",label:"Greyscale",css:"grayscale(100%)"},{id:"sepia",label:"Sepia",css:"sepia(100%)"},{id:"sunset",label:"Sunset",css:"sepia(30%) saturate(140%) brightness(110%) hue-rotate(-10deg)"},{id:"azure",label:"Azure",css:"saturate(120%) brightness(105%) hue-rotate(180deg)"},{id:"teal",label:"Teal",css:"saturate(130%) hue-rotate(140deg)"}];function Wn(n){const t=[n];let e=0,i=0;const o=ct({canUndo:!1,canRedo:!1}),{subscribe:r,set:c,update:d}=ct(n);function l(){o.set({canUndo:e>i,canRedo:e<t.length-1})}return{subscribe:r,undoState:o,set:u=>{t.splice(e+1),t.push(u),e=t.length-1,c(u),l()},update:u=>{d(h=>{const I=u(h);return t.splice(e+1),t.push(I),e=t.length-1,l(),I})},silentUpdate:u=>{d(u)},setBaseState:()=>{i=e,l()},undo:()=>{e>i&&(e--,c(t[e]),l())},redo:()=>{e<t.length-1&&(e++,c(t[e]),l())},canUndo:()=>e>i,canRedo:()=>e<t.length-1,reset:()=>{t.length=0,t.push(n),e=0,i=0,c(n),l()}}}const On={originalImage:null,currentImage:null,aspectRatio:"custom",width:0,height:0,ratioLocked:!1,scale:1,offsetX:0,offsetY:0,brightness:0,contrast:0,shadows:0,hdr:0,activeFilter:"original",filterStrength:50,cropBox:{x:0,y:0,width:0,height:0},isCropping:!1,cropPending:!1,imageWidth:0,imageHeight:0,blurEnabled:!1,blurBrushSize:50,blurStrength:50,blurSoften:50,blurInvert:!1,blurMask:null,showBrushPreview:!1,zoomLevel:1,zoomOffsetX:0,zoomOffsetY:0},V=Wn(On),yt=ct("none"),Nn=jt(V,n=>n.currentImage!==null);function Yn(){V.reset(),yt.set("none")}var jn=L('<div class="controls-panel svelte-c9tnuw"><!></div>'),Xn=L('<div class="controls-panel svelte-c9tnuw"><!></div>'),Gn=L("<!> <!> <!> <!>",1),Jn=L('<div class="crop-tab svelte-c9tnuw"><!> <!> <!></div>');function Vn(n,t){xe(t,!1);const e=()=>We(V,"$cropState",c),i=()=>We(yt,"$activeSubMenu",c),o=()=>We(Nn,"$hasImage",c),r=()=>We(I,"$undoState",c),[c,d]=_t(),l=O(),u=O(),h=O(),I=V.undoState,p=[{id:"crop",label:"Crop"},{id:"edit",label:"Edit"},{id:"filter",label:"Filter"}];let f=O(null),b=null;async function B(v){const z=await It(v);V.set({...e(),originalImage:v,currentImage:v,imageWidth:z.width,imageHeight:z.height,width:z.width,height:z.height,cropBox:{x:0,y:0,width:100,height:100},isCropping:!0,cropPending:!1,aspectRatio:"custom",ratioLocked:!1}),V.setBaseState(),yt.set("crop")}function s(v){if(e().cropPending&&i()==="crop"&&v!=="crop"){b=()=>{yt.set(v),V.silentUpdate(z=>({...z,isCropping:!1}))},S(f,"save");return}v==="crop"?V.silentUpdate(z=>({...z,isCropping:!0})):V.silentUpdate(z=>({...z,isCropping:!1})),yt.set(i()===v?"none":v)}async function g(){return await on(e().currentImage,a(h),e().blurMask)}async function P(){if(e().cropPending){b=async()=>{const v=await g();await Ht(v)},S(f,"save");return}if(e().currentImage){const v=await g();await Ht(v)}}async function E(){if(e().cropPending){b=async()=>{const v=await g();Ft(v,"picflam-export.png")},S(f,"save");return}if(e().currentImage){const v=await g();Ft(v,"picflam-export.png")}}function M(){S(f,"startAgain")}function H(){V.undo()}function R(){V.redo()}async function x(){S(f,null),await Q(),b&&(await b(),b=null)}function T(){S(f,null),b=null}function Y(){S(f,null),Yn()}function N(){S(f,null)}async function Q(){const v=e();if(!v.currentImage||!v.cropPending)return;const z=await ma(v.currentImage,v.cropBox,v.imageWidth,v.imageHeight),F=await It(z);V.set({...v,currentImage:z,imageWidth:F.width,imageHeight:F.height,width:F.width,height:F.height,cropBox:{x:0,y:0,width:100,height:100},cropPending:!1})}function he(v){if(v==="custom"){V.silentUpdate(ne=>({...ne,aspectRatio:"custom",cropBox:{x:0,y:0,width:100,height:100},ratioLocked:!1,cropPending:!1}));return}const F={"9:16":9/16,"1:1":1,"16:9":16/9}[v],X=e().imageWidth/e().imageHeight;let W;if(v==="9:16"){const oe=F/X*100;if(oe<=100)W={x:(100-oe)/2,y:0,width:oe,height:100};else{const ue=X/F*100;W={x:0,y:(100-ue)/2,width:100,height:ue}}}else if(v==="16:9"){const oe=X/F*100;if(oe<=100)W={x:0,y:(100-oe)/2,width:100,height:oe};else{const ue=F/X*100;W={x:(100-ue)/2,y:0,width:ue,height:100}}}else if(v==="1:1")if(X>1){const ne=100/X;W={x:(100-ne)/2,y:0,width:ne,height:100}}else{const ne=100*X;W={x:0,y:(100-ne)/2,width:100,height:ne}}V.silentUpdate(ne=>({...ne,aspectRatio:v,cropBox:W,cropPending:!0,isCropping:!0,ratioLocked:!0}))}function ie({width:v,height:z}){const F=e().imageWidth,X=e().imageHeight,W=Math.min(Math.max(1,v),F),ne=Math.min(Math.max(1,z),X),oe=W/F*100,ue=ne/X*100;let de;if(e().ratioLocked){const ce=a(l)/a(u);if(v!==a(l)){const D=W/ce/X*100;de={x:(100-oe)/2,y:(100-Math.min(100,D))/2,width:oe,height:Math.min(100,D)}}else{const D=ne*ce/F*100;de={x:(100-Math.min(100,D))/2,y:(100-ue)/2,width:Math.min(100,D),height:ue}}}else de={x:(100-oe)/2,y:(100-ue)/2,width:oe,height:ue};V.silentUpdate(ce=>({...ce,cropBox:de,cropPending:!0}))}function ee(){V.silentUpdate(v=>({...v,ratioLocked:!v.ratioLocked}))}async function fe(){const v=await nn(e().currentImage);V.set({...e(),currentImage:v})}async function J(){const v=await an(e().currentImage,90),z=await It(v);V.set({...e(),currentImage:v,imageWidth:z.width,imageHeight:z.height,cropBox:{x:0,y:0,width:100,height:100},cropPending:!1})}function te(v){V.silentUpdate(z=>({...z,scale:v/100}))}function le(v){const z=v.detail.cropBox;if(e().ratioLocked&&e().aspectRatio!=="custom"){const X={"9:16":.5625,"1:1":1,"16:9":1.7777777777777777}[e().aspectRatio];e().imageWidth/e().imageHeight;const W=z.width*e().imageWidth/(z.height*e().imageHeight);if(Math.abs(W-X)>.01){const ue=z.width/100*e().imageWidth/X/e().imageHeight*100;z.height=Math.min(100,ue),z.y+z.height>100&&(z.y=100-z.height)}}V.silentUpdate(F=>({...F,cropBox:z,cropPending:!0}))}function Pe(){Q()}let Ce=null;function me(){Ce===null&&(Ce={...e()})}function Oe(){Ce!==null&&(V.set(e()),Ce=null)}function Ge(v){me(),V.silentUpdate(z=>({...z,brightness:v}))}function Je(v){me(),V.silentUpdate(z=>({...z,shadows:v}))}function be(v){me(),V.silentUpdate(z=>({...z,contrast:v}))}function He(v){me(),V.silentUpdate(z=>({...z,hdr:v}))}function pe(v){V.set({...e(),blurEnabled:v})}function Ve(v){me(),V.silentUpdate(z=>({...z,blurBrushSize:v}))}function Ze(v){me(),V.silentUpdate(z=>({...z,blurStrength:v}))}function Me(v){me(),V.silentUpdate(z=>({...z,blurSoften:v}))}function we(v){V.set({...e(),blurInvert:v})}function $e(v){V.silentUpdate(z=>({...z,showBrushPreview:v}))}function Ne(){Oe()}let se=null,Te=[],Fe=null;function ut(v){const z=v.detail.point;Fe===null&&(Fe=e().blurMask?[...e().blurMask]:[]),Te.push(z),V.silentUpdate(F=>({...F,blurMask:[...F.blurMask||[],z]})),se&&clearTimeout(se),se=setTimeout(()=>{if(Te.length>0){const F=[...Fe,...Te];V.set({...e(),blurMask:F}),Te=[],Fe=null}se=null},300)}function it(v){V.silentUpdate(z=>({...z,zoomLevel:v}))}function Qe(v){V.silentUpdate(F=>{let{zoomOffsetX:X,zoomOffsetY:W}=F;switch(v){case"up":W-=20;break;case"down":W+=20;break;case"left":X-=20;break;case"right":X+=20;break}return{...F,zoomOffsetX:X,zoomOffsetY:W}})}function et(){V.silentUpdate(v=>({...v,zoomLevel:1,zoomOffsetX:0,zoomOffsetY:0}))}function qe(v){V.silentUpdate(z=>({...z,activeFilter:v}))}function ot(v){me(),V.silentUpdate(z=>({...z,filterStrength:v}))}function tt(){V.set({...e(),activeFilter:"original",filterStrength:50})}Se(()=>e(),()=>{S(l,Math.round(e().imageWidth*e().cropBox.width/100))}),Se(()=>e(),()=>{S(u,Math.round(e().imageHeight*e().cropBox.height/100))}),Se(()=>(e(),oa),()=>{S(h,(()=>{let v=[];if(e().brightness!==0&&v.push(`brightness(${1+e().brightness/100})`),e().contrast!==0&&v.push(`contrast(${1+e().contrast/100})`),e().shadows!==0){const z=1+e().shadows/200;v.push(`brightness(${z})`)}if(e().hdr!==0){const z=1+e().hdr/100*.3,F=1+e().hdr/100*.2;v.push(`saturate(${z}) contrast(${F})`)}if(e().activeFilter!=="original"){const z=oa.find(F=>F.id===e().activeFilter);if(z&&z.css!=="none"){const F=e().filterStrength/100,X=z.css.replace(/(\d+)%/g,(W,ne)=>`${Math.round(parseInt(ne)*F)}%`);v.push(X)}}return v.length>0?v.join(" "):"none"})())}),mt(),Re();var Ye=Jn(),k=C(Ye);{var j=v=>{ba(v,{title:"Crop, edit and add filters to photos",hint:"Import, drag or paste an image",onImageImport:B})},$=v=>{var z=Gn(),F=Ee(z);Gt(F,{get canUndo(){return r(),U(()=>r().canUndo)},get canRedo(){return r(),U(()=>r().canRedo)},onUndo:H,onRedo:R,onStartAgain:M,onCopy:P,onExport:E});var X=w(F,2);{let de=Ke(()=>(i(),e(),U(()=>i()==="edit"?e().zoomLevel:e().scale))),ce=Ke(()=>(i(),e(),U(()=>i()==="edit"?e().zoomOffsetX:e().offsetX))),rt=Ke(()=>(i(),e(),U(()=>i()==="edit"?e().zoomOffsetY:e().offsetY))),D=Ke(()=>(e(),U(()=>e().blurMask||[])));mn(X,{get imageSrc(){return e(),U(()=>e().currentImage)},get cropBox(){return e(),U(()=>e().cropBox)},get isCropping(){return e(),U(()=>e().isCropping)},get scale(){return a(de)},get offsetX(){return a(ce)},get offsetY(){return a(rt)},get imageWidth(){return e(),U(()=>e().imageWidth)},get imageHeight(){return e(),U(()=>e().imageHeight)},get editFilters(){return a(h)},get blurEnabled(){return e(),U(()=>e().blurEnabled)},get blurBrushSize(){return e(),U(()=>e().blurBrushSize)},get blurStrength(){return e(),U(()=>e().blurStrength)},get blurSoften(){return e(),U(()=>e().blurSoften)},get blurInvert(){return e(),U(()=>e().blurInvert)},get blurMask(){return a(D)},get showBrushPreview(){return e(),U(()=>e().showBrushPreview)},$$events:{cropChange:le,blurPaint:ut}})}var W=w(X,2);Jt(W,{get tabs(){return p},get activeTab(){return i()},onTabChange:s});var ne=w(W,2);{var oe=de=>{{let ce=Ke(()=>(e(),U(()=>Math.round(e().scale*100))));En(de,{get aspectRatio(){return e(),U(()=>e().aspectRatio)},get cropWidth(){return a(l)},get cropHeight(){return a(u)},get ratioLocked(){return e(),U(()=>e().ratioLocked)},get scale(){return a(ce)},get cropPending(){return e(),U(()=>e().cropPending)},onRatioChange:he,onDimensionsChange:ie,onLockToggle:ee,onFlip:fe,onRotate:J,onScaleChange:te,onApply:Pe})}},ue=de=>{var ce=nt(),rt=Ee(ce);{var D=Ae=>{var _e=jn(),st=C(_e);Un(st,{get brightness(){return e(),U(()=>e().brightness)},get shadows(){return e(),U(()=>e().shadows)},get contrast(){return e(),U(()=>e().contrast)},get hdr(){return e(),U(()=>e().hdr)},get blurEnabled(){return e(),U(()=>e().blurEnabled)},get blurBrushSize(){return e(),U(()=>e().blurBrushSize)},get blurStrength(){return e(),U(()=>e().blurStrength)},get blurSoften(){return e(),U(()=>e().blurSoften)},get blurInvert(){return e(),U(()=>e().blurInvert)},get zoomLevel(){return e(),U(()=>e().zoomLevel)},onBrightnessChange:Ge,onShadowsChange:Je,onContrastChange:be,onHdrChange:He,onBlurToggle:pe,onBlurBrushSizeChange:Ve,onBlurStrengthChange:Ze,onBlurSoftenChange:Me,onBlurInvertChange:we,onZoomChange:it,onNudge:Qe,onResetZoom:et,onBrushPreviewChange:$e,onEditEnd:Ne}),_(_e),A(Ae,_e)},re=Ae=>{var _e=nt(),st=Ee(_e);{var at=ye=>{var ze=Xn(),vt=C(ze);qn(vt,{get imageUrl(){return e(),U(()=>e().currentImage)},get activeFilter(){return e(),U(()=>e().activeFilter)},get filterStrength(){return e(),U(()=>e().filterStrength)},onFilterChange:qe,onStrengthChange:ot,onReset:tt}),_(ze),A(ye,ze)};Z(st,ye=>{i()==="filter"&&ye(at)},!0)}A(Ae,_e)};Z(rt,Ae=>{i()==="edit"?Ae(D):Ae(re,!1)},!0)}A(de,ce)};Z(ne,de=>{i()==="crop"?de(oe):de(ue,!1)})}A(v,z)};Z(k,v=>{o()?v($,!1):v(j)})}var q=w(k,2);{var ae=v=>{qt(v,{message:"Save changes?",confirmText:"Yes",cancelText:"Cancel",onConfirm:x,onCancel:T})};Z(q,v=>{a(f)==="save"&&v(ae)})}var ve=w(q,2);{var G=v=>{qt(v,{message:"Start again? Your changes will be lost.",confirmText:"Yes",cancelText:"Cancel",onConfirm:Y,onCancel:N})};Z(ve,v=>{a(f)==="startAgain"&&v(G)})}_(Ye),A(n,Ye),ke(),d()}var Zn=L('<div class="before-after-container svelte-1i0ztfp" role="slider" aria-label="Before and after comparison" tabindex="0"><div class="before-image svelte-1i0ztfp"><img alt="Before" class="svelte-1i0ztfp"/></div> <div class="after-image svelte-1i0ztfp"><img alt="After" class="svelte-1i0ztfp"/></div> <div class="slider-handle svelte-1i0ztfp" role="presentation"><div class="slider-line svelte-1i0ztfp"></div> <div class="slider-thumb svelte-1i0ztfp"><img src="/icons/icon-ai-slider.svg" alt="" class="slider-icon svelte-1i0ztfp"/></div></div></div>');function Qn(n,t){xe(t,!1);let e=m(t,"beforeImage",8,""),i=m(t,"afterImage",8,""),o=m(t,"position",12,50),r=m(t,"onChange",8,()=>{}),c=O(),d=!1;Yt(()=>(window.addEventListener("mousemove",h),window.addEventListener("touchmove",I,{passive:!1}),window.addEventListener("mouseup",p),window.addEventListener("touchend",p),()=>{window.removeEventListener("mousemove",h),window.removeEventListener("touchmove",I),window.removeEventListener("mouseup",p),window.removeEventListener("touchend",p)}));function l(){d=!0}function u(H){H.touches.length===1&&(d=!0)}function h(H){!d||!a(c)||f(H.clientX)}function I(H){!d||!a(c)||H.touches.length!==1||(H.preventDefault(),f(H.touches[0].clientX))}function p(){d=!1}function f(H){const R=a(c).getBoundingClientRect(),x=Math.max(0,Math.min(100,(H-R.left)/R.width*100));o(x),r()(x)}function b(H){if(!a(c))return;const R=a(c).getBoundingClientRect(),x=(H.clientX-R.left)/R.width*100;o(Math.max(0,Math.min(100,x))),r()(o())}Re();var B=Zn(),s=C(B),g=C(s);_(s);var P=w(s,2),E=C(P);_(P);var M=w(P,2);_(B),bt(B,H=>S(c,H),()=>a(c)),K(()=>{ge(g,"src",e()),Ue(P,`clip-path: inset(0 ${100-o()}% 0 0)`),ge(E,"src",i()),Ue(M,`left: ${o()??""}%`)}),y("mousedown",M,l),y("touchstart",M,u),y("click",B,b),A(n,B),ke()}const ra={originalImage:null,currentImage:null,processedImage:null,isProcessing:!1,processingType:null,upscaleFactor:1,showComparison:!1,comparisonPosition:50};function Kn(){const{subscribe:n,set:t,update:e}=ct(ra);return{subscribe:n,setImage:i=>e(o=>({...o,originalImage:i,currentImage:i,processedImage:null})),startProcessing:i=>e(o=>({...o,isProcessing:!0,processingType:i})),finishProcessing:i=>e(o=>({...o,isProcessing:!1,processingType:null,processedImage:i,currentImage:i,showComparison:!0})),cancelProcessing:()=>e(i=>({...i,isProcessing:!1,processingType:null})),setUpscaleFactor:i=>e(o=>({...o,upscaleFactor:i})),setComparisonPosition:i=>e(o=>({...o,comparisonPosition:i})),reset:()=>t(ra)}}const De=Kn(),sa=ct("enhance"),$n=jt(De,n=>n.currentImage!==null);let kt=null;async function ei(n,t=4,e){e?.("Uploading image...");const i=await fetch("/api/face-enhance",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({image:n,scale:t,faceEnhance:.5})}),o=await i.json();if(!i.ok)throw new Error(o.error||`API error: ${i.status}`);if(o.status==="succeeded"&&o.output)return e?.("Downloading result..."),await pa(o.output);if(o.status==="processing"||o.status==="starting")return e?.("Processing with CodeFormer..."),await ti(o.pollUrl,e);throw new Error("Unexpected response")}async function ti(n,t,e=60){for(let i=0;i<e;i++){await new Promise(c=>setTimeout(c,2e3));const o=await fetch(`/api/upscale?pollUrl=${encodeURIComponent(n)}`),r=await o.json();if(!o.ok)throw new Error(r.error||`Polling error: ${o.status}`);if(r.status==="succeeded"&&r.output)return t?.("Downloading result..."),await pa(r.output);if(r.status==="failed")throw new Error(r.error||"Upscaling failed");t?.(`Processing in cloud (${(i+1)*2}s)...`)}throw new Error("Timeout waiting for result")}async function pa(n){const e=await(await fetch(n)).blob();return new Promise((i,o)=>{const r=new FileReader;r.onload=()=>i(r.result),r.onerror=o,r.readAsDataURL(e)})}async function ai(n){if(kt)return kt;console.log("[AI] Loading RMBG background removal model..."),n?.("Downloading model (first time only)...");const{pipeline:t,env:e}=await Wa(async()=>{const{pipeline:i,env:o}=await import("../chunks/bLAnV4ll.js");return{pipeline:i,env:o}},[],import.meta.url);e.allowLocalModels=!1;try{kt=await t("image-segmentation","briaai/RMBG-1.4",{device:"webgpu",dtype:"fp32"}),console.log("[AI] RMBG model ready (WebGPU)")}catch(i){console.log("[AI] WebGPU not available, falling back to WASM...",i.message),kt=await t("image-segmentation","briaai/RMBG-1.4",{dtype:"q8"}),console.log("[AI] RMBG model ready (WASM)")}return kt}async function ni(n,t){try{console.log("[AI] Starting background removal...");const e=await ai(t);t?.("Processing image...");const i=await e(n);if(console.log("[AI] Segmentation result:",i),!i||i.length===0)throw new Error("No segmentation result returned");const o=i[0];if(console.log("[AI] Segment keys:",Object.keys(o)),o.mask&&o.mask.toDataURL)return console.log("[AI] Background removal complete (RawImage mask)"),await la(n,o.mask);if(o.mask&&o.mask.data)return console.log("[AI] Background removal complete (data mask)"),await la(n,o.mask);if(typeof o=="string"&&o.startsWith("data:"))return console.log("[AI] Background removal complete (direct output)"),o;throw console.log("[AI] Segment structure:",JSON.stringify(o,null,2).substring(0,500)),new Error("Unexpected segmentation result format")}catch(e){throw console.error("[AI] Background removal failed:",e),new Error("Background removal failed: "+e.message)}}async function la(n,t){return new Promise((e,i)=>{const o=new Image;o.onload=async()=>{try{const r=document.createElement("canvas");r.width=o.width,r.height=o.height;const c=r.getContext("2d");c.drawImage(o,0,0);const d=c.getImageData(0,0,r.width,r.height),l=d.data;let u,h,I;if(t.toDataURL){const f=document.createElement("canvas");f.width=t.width,f.height=t.height;const b=f.getContext("2d"),B=new Image;B.onload=()=>{b.drawImage(B,0,0);const s=b.getImageData(0,0,t.width,t.height);ca(l,s.data,r.width,r.height,t.width,t.height,!0),c.putImageData(d,0,0),e(r.toDataURL("image/png"))},B.onerror=i,B.src=t.toDataURL();return}else u=t.data,h=t.width,I=t.height;const p=u.length===h*I*4;ca(l,u,r.width,r.height,h,I,p),c.putImageData(d,0,0),e(r.toDataURL("image/png"))}catch(r){i(r)}},o.onerror=i,o.src=n})}function ca(n,t,e,i,o,r,c){const d=o/e,l=r/i;for(let u=0;u<i;u++)for(let h=0;h<e;h++){const I=Math.floor(h*d),p=Math.floor(u*l);let f;if(c){const B=(p*o+I)*4;f=t[B]}else{const B=p*o+I;f=t[B]||0}const b=(u*e+h)*4;n[b+3]=f}}var ii=L('<div class="size-display svelte-1rgvkgu"> </div>'),oi=L('<button class="processing-btn svelte-1rgvkgu" disabled><span class="spinner svelte-1rgvkgu"></span> </button> <button class="cancel-btn svelte-1rgvkgu">Cancel</button>',1),ri=L('<button class="upscale-btn svelte-1rgvkgu"><img src="/icons/icon-ai.svg" alt="" class="btn-icon svelte-1rgvkgu"/> Upscale image</button> <p class="hint svelte-1rgvkgu">Upscales, sharpens and enhances images</p>',1),si=L('<div class="error-message svelte-1rgvkgu"> </div>'),li=L('<div class="upscale-controls svelte-1rgvkgu"><div class="controls-content svelte-1rgvkgu"><!> <!> <!></div></div>');function ci(n,t){xe(t,!1);const e=()=>We(De,"$aiState",i),[i,o]=_t(),r=4;let c=O(!1),d=O(""),l=O(null),u=O(null);async function h(){try{const R=await dt(e().originalImage),x=Math.round(R.naturalWidth*r),T=Math.round(R.naturalHeight*r);S(u,`${x} x ${T}`)}catch(R){console.error("Failed to get image dimensions:",R)}}async function I(){if(e().originalImage)try{S(c,!0),S(l,null),S(d,"Starting..."),De.startProcessing("upscale");const R=await ei(e().originalImage,r,x=>{S(d,x)});De.finishProcessing(R)}catch(R){S(l,R.message||"Upscaling failed"),De.cancelProcessing()}finally{S(c,!1),S(d,"")}}function p(){S(c,!1),S(d,""),S(l,null),De.cancelProcessing()}Se(()=>e(),()=>{e().originalImage&&h()}),mt(),Re();var f=li(),b=C(f),B=C(b);{var s=R=>{var x=ii(),T=C(x);_(x),K(()=>Ie(T,`Output: ${a(u)??""}`)),A(R,x)};Z(B,R=>{a(u)&&R(s)})}var g=w(B,2);{var P=R=>{var x=oi(),T=Ee(x),Y=w(C(T));_(T);var N=w(T,2);K(()=>Ie(Y,` ${a(d)||"Processing..."}`)),y("click",N,p),A(R,x)},E=R=>{var x=ri(),T=Ee(x);zt(2),y("click",T,I),A(R,x)};Z(g,R=>{a(c)?R(P):R(E,!1)})}var M=w(g,2);{var H=R=>{var x=si(),T=C(x,!0);_(x),K(()=>Ie(T,a(l))),A(R,x)};Z(M,R=>{a(l)&&R(H)})}_(b),_(f),A(n,f),ke(),o()}var di=L('<div class="brush-indicator svelte-1ibkqf6"></div>'),ui=L('<div class="brush-preview svelte-1ibkqf6"></div>'),vi=L('<div class="drawer-overlay svelte-1ibkqf6" role="presentation"><div class="drawer svelte-1ibkqf6" role="dialog"><div class="drawer-header svelte-1ibkqf6"><button class="icon-btn svelte-1ibkqf6" title="Undo"><img src="/icons/icon-undo.svg" alt="Undo" class="svelte-1ibkqf6"/></button> <button class="icon-btn svelte-1ibkqf6" title="Redo"><img src="/icons/icon-redo.svg" alt="Redo" class="svelte-1ibkqf6"/></button> <div class="spacer svelte-1ibkqf6"></div> <button class="icon-btn svelte-1ibkqf6" title="Compare"><img src="/icons/icon-compare.svg" alt="Compare" class="svelte-1ibkqf6"/></button></div> <div class="canvas-container svelte-1ibkqf6"><div class="canvas-wrapper svelte-1ibkqf6" role="presentation"><canvas class="svelte-1ibkqf6"></canvas> <!> <!></div></div> <div class="controls-section svelte-1ibkqf6"><div class="button-group svelte-1ibkqf6"><button><img src="/icons/icon-erase.svg" alt="" class="svelte-1ibkqf6"/> Erase</button> <button><img src="/icons/icon-restore.svg" alt="" class="svelte-1ibkqf6"/> Restore</button></div> <div class="control-row svelte-1ibkqf6"><label class="svelte-1ibkqf6">Brush size</label> <div class="control-item svelte-1ibkqf6"><!> <button class="reset-btn svelte-1ibkqf6" title="Reset"><img src="/icons/icon-reset.svg" alt="Reset" class="svelte-1ibkqf6"/></button></div></div> <div class="control-row svelte-1ibkqf6"><label class="svelte-1ibkqf6">Soften edges</label> <div class="control-item svelte-1ibkqf6"><!> <button class="reset-btn svelte-1ibkqf6" title="Reset"><img src="/icons/icon-reset.svg" alt="Reset" class="svelte-1ibkqf6"/></button></div></div> <div class="control-row svelte-1ibkqf6"><label class="svelte-1ibkqf6">Zoom in</label> <div class="control-item svelte-1ibkqf6"><!> <button class="reset-btn svelte-1ibkqf6" title="Reset"><img src="/icons/icon-reset.svg" alt="Reset" class="svelte-1ibkqf6"/></button></div></div> <div class="nudge-buttons svelte-1ibkqf6"><button class="nudge-btn svelte-1ibkqf6">â</button> <button class="nudge-btn svelte-1ibkqf6">â</button> <button class="nudge-btn svelte-1ibkqf6">â</button> <button class="nudge-btn svelte-1ibkqf6">â</button></div> <div class="drawer-footer svelte-1ibkqf6"><button class="btn-cancel svelte-1ibkqf6">Cancel</button> <button class="btn-done svelte-1ibkqf6">Done</button></div></div></div></div>');function gi(n,t){xe(t,!1);const e=O();let i=m(t,"image",8,""),o=m(t,"originalFullImage",8,""),r=m(t,"onClose",8,()=>{}),c=m(t,"onSave",8,()=>{}),d=O(),l=O(),u,h=O(!0),I=O(20),p=O(50),f=O(1),b=O(0),B=O(0),s=!1,g=[],P=0,E=null,M=O({x:0,y:0,visible:!1}),H=O(!1),R=O(0),x=O(0);Yt(async()=>{const D=await dt(i());Kt(d,a(d).width=D.naturalWidth),Kt(d,a(d).height=D.naturalHeight),u=a(d).getContext("2d"),u.drawImage(D,0,0),o()?E=await dt(o()):E=D,T(),Y()});function T(){if(a(l)){const D=a(l).getBoundingClientRect();S(R,D.width),S(x,D.height)}}function Y(){g=g.slice(0,P+1),g.push(a(d).toDataURL()),P=g.length-1}function N(){P>0&&(P--,he())}function Q(){P<g.length-1&&(P++,he())}function he(){const D=new Image;D.onload=()=>{u.clearRect(0,0,a(d).width,a(d).height),u.drawImage(D,0,0)},D.src=g[P]}function ie(D){const re=a(l).getBoundingClientRect(),Ae=a(d).width/re.width,_e=a(d).height/re.height,st=(D.clientX-re.left)*Ae,at=(D.clientY-re.top)*_e;return{x:st,y:at}}function ee(D){s=!0;const{x:re,y:Ae}=ie(D);le(re,Ae)}function fe(D){const re=a(l).getBoundingClientRect();if(S(M,{x:D.clientX-re.left,y:D.clientY-re.top,visible:!0}),!s)return;const{x:Ae,y:_e}=ie(D);le(Ae,_e)}function J(){s&&(s=!1,Y())}function te(){S(M,{...a(M),visible:!1}),s&&(s=!1,Y())}function le(D,re){const Ae=a(d).width/a(l).getBoundingClientRect().width,_e=a(e)/2*Ae,st=a(p)/100,at=Math.min(_e-.001,_e*(1-st));u.save();try{if(a(h)){const ye=u.createRadialGradient(D,re,at,D,re,_e);ye.addColorStop(0,"rgba(0,0,0,1)"),ye.addColorStop(1,"rgba(0,0,0,0)"),u.globalCompositeOperation="destination-out",u.fillStyle=ye,u.beginPath(),u.arc(D,re,_e,0,Math.PI*2),u.fill()}else{if(!E)return;const ye=document.createElement("canvas");ye.width=a(d).width,ye.height=a(d).height;const ze=ye.getContext("2d"),vt=ze.createRadialGradient(D,re,at,D,re,_e);vt.addColorStop(0,"rgba(0,0,0,1)"),vt.addColorStop(1,"rgba(0,0,0,0)"),ze.globalCompositeOperation="source-over",ze.drawImage(E,0,0,ye.width,ye.height),ze.globalCompositeOperation="destination-in",ze.fillStyle=vt,ze.beginPath(),ze.arc(D,re,_e,0,Math.PI*2),ze.fill(),u.globalCompositeOperation="source-over",u.drawImage(ye,0,0)}}finally{u.restore()}}function Pe(){S(I,20)}function Ce(){S(p,50)}function me(){S(f,1),S(b,0),S(B,0)}function Oe(D){switch(D){case"up":S(B,a(B)-10);break;case"down":S(B,a(B)+10);break;case"left":S(b,a(b)-10);break;case"right":S(b,a(b)+10);break}}function Ge(){r()()}function Je(){const D=a(d).toDataURL("image/png");c()(D)}Se(()=>(a(I),a(R),a(x)),()=>{S(e,a(I)/100*Math.min(a(R)||300,a(x)||300)*.5)}),mt(),Re();var be=vi(),He=C(be),pe=C(He),Ve=C(pe),Ze=w(Ve,2);zt(4),_(pe);var Me=w(pe,2),we=C(Me),$e=C(we);bt($e,D=>S(d,D),()=>a(d));var Ne=w($e,2);{var se=D=>{var re=di();K(()=>Ue(re,`
							left: ${a(M),U(()=>a(M).x)??""}px;
							top: ${a(M),U(()=>a(M).y)??""}px;
							width: ${a(e)??""}px;
							height: ${a(e)??""}px;
						`)),A(D,re)};Z(Ne,D=>{a(M),a(R),U(()=>a(M).visible&&a(R)>0)&&D(se)})}var Te=w(Ne,2);{var Fe=D=>{var re=ui();K(()=>Ue(re,`
						left: ${a(R)/2}px;
						top: ${a(x)/2}px;
						width: ${a(e)??""}px;
						height: ${a(e)??""}px;
					`)),A(D,re)};Z(Te,D=>{a(H)&&a(R)>0&&a(x)>0&&D(Fe)})}_(we),bt(we,D=>S(l,D),()=>a(l)),_(Me);var ut=w(Me,2),it=C(ut),Qe=C(it);let et;var qe=w(Qe,2);let ot;_(it);var tt=w(it,2),Ye=w(C(tt),2),k=C(Ye);ft(k,{min:5,max:100,step:1,get value(){return a(I)},onChange:D=>S(I,D),onInteractionStart:()=>{T(),S(H,!0)},onInteractionEnd:()=>S(H,!1)});var j=w(k,2);_(Ye),_(tt);var $=w(tt,2),q=w(C($),2),ae=C(q);ft(ae,{min:0,max:100,step:1,get value(){return a(p)},onChange:D=>S(p,D)});var ve=w(ae,2);_(q),_($);var G=w($,2),v=w(C(G),2),z=C(v);ft(z,{min:1,max:3,step:.1,get value(){return a(f)},onChange:D=>S(f,D)});var F=w(z,2);_(v),_(G);var X=w(G,2),W=C(X),ne=w(W,2),oe=w(ne,2),ue=w(oe,2);_(X);var de=w(X,2),ce=C(de),rt=w(ce,2);_(de),_(ut),_(He),_(be),K(()=>{Ue(we,`transform: scale(${a(f)??""}) translate(${a(b)??""}px, ${a(B)??""}px)`),et=Le(Qe,1,"mode-btn svelte-1ibkqf6",null,et,{active:a(h)}),ot=Le(qe,1,"mode-btn svelte-1ibkqf6",null,ot,{active:!a(h)})}),y("click",Ve,N),y("click",Ze,Q),y("mousedown",we,ee),y("mousemove",we,fe),y("mouseup",we,J),y("mouseleave",we,te),y("click",Qe,()=>S(h,!0)),y("click",qe,()=>S(h,!1)),y("click",j,Pe),y("click",ve,Ce),y("click",F,me),y("click",W,()=>Oe("up")),y("click",ne,()=>Oe("down")),y("click",oe,()=>Oe("left")),y("click",ue,()=>Oe("right")),y("click",ce,Ge),y("click",rt,Je),y("click",He,je(function(D){Lt.call(this,t,D)})),y("click",be,Ge),A(n,be),ke()}var hi=L('<button class="processing-btn svelte-1wdmsm1" disabled><span class="spinner svelte-1wdmsm1"></span> </button> <button class="cancel-btn svelte-1wdmsm1">Cancel</button>',1),fi=L('<button class="remove-btn svelte-1wdmsm1"><img src="/icons/icon-ai.svg" alt="" class="btn-icon svelte-1wdmsm1"/> Remove background</button> <p class="hint svelte-1wdmsm1">Remove image background with AI</p> <button class="erase-btn svelte-1wdmsm1"><img src="/icons/icon-erase.svg" alt="" class="btn-icon svelte-1wdmsm1"/> Erase and restore</button> <p class="hint svelte-1wdmsm1">Manually clean up background</p>',1),mi=L('<div class="error-message svelte-1wdmsm1"> </div>'),bi=L('<div class="background-controls svelte-1wdmsm1"><div class="controls-content svelte-1wdmsm1"><!> <!></div> <!></div>');function pi(n,t){xe(t,!1);const e=()=>We(De,"$aiState",i),[i,o]=_t(),r=O();let c=O(!1),d=O(""),l=O(null),u=O(!1);async function h(){if(e().originalImage)try{S(c,!0),S(l,null),S(d,"Starting..."),De.startProcessing("background");const x=await ni(e().originalImage,T=>{S(d,T)});De.finishProcessing(x)}catch(x){S(l,x.message||"Background removal failed"),De.cancelProcessing()}finally{S(c,!1),S(d,"")}}function I(){S(c,!1),S(d,""),S(l,null),De.cancelProcessing()}function p(){S(u,!0)}function f(){S(u,!1)}Se(()=>e(),()=>{S(r,e().showComparison&&e().processedImage)}),mt(),Re();var b=bi(),B=C(b),s=C(B);{var g=x=>{var T=hi(),Y=Ee(T),N=w(C(Y));_(Y);var Q=w(Y,2);K(()=>Ie(N,` ${a(d)||"Processing..."}`)),y("click",Q,I),A(x,T)},P=x=>{var T=fi(),Y=Ee(T),N=w(Y,4);zt(2),K(()=>N.disabled=!a(r)),y("click",Y,h),y("click",N,p),A(x,T)};Z(s,x=>{a(c)?x(g):x(P,!1)})}var E=w(s,2);{var M=x=>{var T=mi(),Y=C(T,!0);_(T),K(()=>Ie(Y,a(l))),A(x,T)};Z(E,x=>{a(l)&&x(M)})}_(B);var H=w(B,2);{var R=x=>{gi(x,{get image(){return e(),U(()=>e().processedImage)},get originalFullImage(){return e(),U(()=>e().originalImage)},onClose:f,onSave:T=>{De.finishProcessing(T),S(u,!1)}})};Z(H,x=>{a(u)&&x(R)})}_(b),A(n,b),ke(),o()}var wi=L('<img alt="Working image" class="working-image svelte-17agwu4"/>'),_i=L('<!> <div class="image-container svelte-17agwu4"><!></div> <!> <!>',1),xi=L('<div class="ai-tab svelte-17agwu4"><!></div>');function ki(n,t){xe(t,!1);const e=()=>We(De,"$aiState",r),i=()=>We($n,"$hasAiImage",r),o=()=>We(sa,"$activeAiMenu",r),[r,c]=_t();let d=O(50);function l(P){S(d,P),De.setComparisonPosition(P)}const u=[{id:"upscale",label:"Upscale"},{id:"background",label:"Remove background"}];function h(P){De.setImage(P)}function I(P){sa.set(P)}async function p(){e().currentImage&&await Ht(e().currentImage)}function f(){e().currentImage&&Ft(e().currentImage,"picflam-ai.png")}Re();var b=xi(),B=C(b);{var s=P=>{ba(P,{title:"Upscale and remove backgrounds using AI power",hint:"Import, drag or paste an image",onImageImport:h})},g=P=>{var E=_i(),M=Ee(E);Gt(M,{canUndo:!1,canRedo:!1,onUndo:()=>{},onRedo:()=>{},onStartAgain:()=>De.reset(),onCopy:p,onExport:f});var H=w(M,2),R=C(H);{var x=ie=>{Qn(ie,{get beforeImage(){return e().originalImage},get afterImage(){return e().processedImage},get position(){return a(d)},onChange:l})},T=ie=>{var ee=wi();K(()=>ge(ee,"src",e().currentImage)),A(ie,ee)};Z(R,ie=>{e().showComparison&&e().processedImage?ie(x):ie(T,!1)})}_(H);var Y=w(H,2);Jt(Y,{get tabs(){return u},get activeTab(){return o()},onTabChange:I});var N=w(Y,2);{var Q=ie=>{ci(ie,{})},he=ie=>{var ee=nt(),fe=Ee(ee);{var J=te=>{pi(te,{})};Z(fe,te=>{o()==="background"&&te(J)},!0)}A(ie,ee)};Z(N,ie=>{o()==="upscale"?ie(Q):ie(he,!1)})}A(P,E)};Z(B,P=>{i()?P(g,!1):P(s)})}_(b),A(n,b),ke(),c()}const Ci={canvasSize:"1/1",background:{type:"solid",value:"#FFFFFF"},text1:"",text1Font:"Inter",text1Size:5,text1YPosition:3,text1LineSpacing:5,text1Color:"#000000",text1HighlightColor:"transparent",text1IsBold:!0,text1Align:"center",text1QuoteStyle:"none",text1QuoteSize:5,text2:"",text2Font:"Inter",text2Size:3,text2YPosition:8,text2LineSpacing:5,text2Color:"#000000",text2LabelColor:"transparent",text2IsBold:!1,text2Align:"center",overlay:null,overlayScale:1,overlayOpacity:1,overlayX:0,overlayY:0,overlayMask:"none",overlayWrap:!1,overlayBorderWidth:0,overlayBorderColor:"#FFFFFF"};function yi(n){const t=[JSON.parse(JSON.stringify(n))];let e=0;const{subscribe:i,set:o,update:r}=ct(n);return{subscribe:i,set:c=>{t.splice(e+1),t.push(JSON.parse(JSON.stringify(c))),e=t.length-1,o(c)},update:c=>{r(d=>{const l=c(d);return t.splice(e+1),t.push(JSON.parse(JSON.stringify(l))),e=t.length-1,l})},undo:()=>e>0?(e--,o(JSON.parse(JSON.stringify(t[e]))),!0):!1,redo:()=>e<t.length-1?(e++,o(JSON.parse(JSON.stringify(t[e]))),!0):!1,canUndo:()=>e>0,canRedo:()=>e<t.length-1,reset:()=>{const c=JSON.parse(JSON.stringify(n));t.length=0,t.push(c),e=0,o(c)}}}const ht=yi(Ci),Wt=ct(!0),Ot=ct("none");jt(ht,n=>n.text1||n.text2||n.overlay||n.background.value!=="#FFFFFF");function Si(){ht.reset(),Wt.set(!0),Ot.set("none")}var Ii=L('<button class="template-card svelte-fxk5n4"><div class="template-placeholder svelte-fxk5n4"> </div></button>'),Ri=L('<div class="template-picker svelte-fxk5n4"><p class="picker-title svelte-fxk5n4">Create quotes and cards. Start with a template or blank canvas</p> <button class="blank-canvas-btn svelte-fxk5n4"><img src="/icons/icon-add.svg" alt="" class="add-icon svelte-fxk5n4"/></button> <div class="template-grid svelte-fxk5n4"></div></div>'),zi=L('<p class="placeholder svelte-fxk5n4">Size controls coming in Phase 5</p>'),Bi=L('<p class="placeholder svelte-fxk5n4">Background controls coming in Phase 5</p>'),Ei=L('<p class="placeholder svelte-fxk5n4">Text 1 controls coming in Phase 5</p>'),Pi=L('<p class="placeholder svelte-fxk5n4">Text 2 controls coming in Phase 5</p>'),Mi=L('<p class="placeholder svelte-fxk5n4">Quote controls coming in Phase 5</p>'),Ti=L('<p class="placeholder svelte-fxk5n4">Overlay controls coming in Phase 5</p>'),Ai=L('<!> <div class="canvas-container svelte-fxk5n4"><div class="design-canvas svelte-fxk5n4"></div></div> <!> <div class="controls-panel svelte-fxk5n4"><!></div>',1),Ui=L('<div class="design-tab svelte-fxk5n4"><!></div>');function Di(n,t){xe(t,!1);const e=()=>We(Ot,"$activeDesignMenu",r),i=()=>We(Wt,"$showTemplatePicker",r),o=()=>We(ht,"$slideState",r),[r,c]=_t(),d=[{id:"size",label:"Size"},{id:"background",label:"Background"},{id:"text1",label:"Text 1"},{id:"text2",label:"Text 2"},{id:"quote",label:"Quote"},{id:"overlay",label:"Overlay"}];function l(s){s==="blank"&&ht.reset(),Wt.set(!1)}function u(s){Ot.set(e()===s?"none":s)}async function h(){}function I(){}Re();var p=Ui(),f=C(p);{var b=s=>{var g=Ri(),P=w(C(g),2),E=w(P,2);wt(E,4,()=>[1,2,3,4,5,6],pt,(M,H)=>{var R=Ii(),x=C(R),T=C(x);_(x),_(R),K(()=>Ie(T,`Template ${H??""}`)),y("click",R,()=>l(`template-${H}`)),A(M,R)}),_(E),_(g),y("click",P,()=>l("blank")),A(s,g)},B=s=>{var g=Ai(),P=Ee(g);{let N=Ke(()=>ht.canUndo()),Q=Ke(()=>ht.canRedo());Gt(P,{get canUndo(){return a(N)},get canRedo(){return a(Q)},onUndo:()=>ht.undo(),onRedo:()=>ht.redo(),get onStartAgain(){return Si},onCopy:h,onExport:I})}var E=w(P,2),M=C(E);_(E);var H=w(E,2);Jt(H,{get tabs(){return d},get activeTab(){return e()},onTabChange:u});var R=w(H,2),x=C(R);{var T=N=>{var Q=zi();A(N,Q)},Y=N=>{var Q=nt(),he=Ee(Q);{var ie=fe=>{var J=Bi();A(fe,J)},ee=fe=>{var J=nt(),te=Ee(J);{var le=Ce=>{var me=Ei();A(Ce,me)},Pe=Ce=>{var me=nt(),Oe=Ee(me);{var Ge=be=>{var He=Pi();A(be,He)},Je=be=>{var He=nt(),pe=Ee(He);{var Ve=Me=>{var we=Mi();A(Me,we)},Ze=Me=>{var we=nt(),$e=Ee(we);{var Ne=se=>{var Te=Ti();A(se,Te)};Z($e,se=>{e()==="overlay"&&se(Ne)},!0)}A(Me,we)};Z(pe,Me=>{e()==="quote"?Me(Ve):Me(Ze,!1)},!0)}A(be,He)};Z(Oe,be=>{e()==="text2"?be(Ge):be(Je,!1)},!0)}A(Ce,me)};Z(te,Ce=>{e()==="text1"?Ce(le):Ce(Pe,!1)},!0)}A(fe,J)};Z(he,fe=>{e()==="background"?fe(ie):fe(ee,!1)},!0)}A(N,Q)};Z(x,N=>{e()==="size"?N(T):N(Y,!1)})}_(R),K(()=>Ue(M,`
					aspect-ratio: ${o().canvasSize??""};
					background: ${o().background.type==="solid",o().background.value??""};
				`)),A(s,g)};Z(f,s=>{i()?s(b):s(B,!1)})}_(p),A(n,p),ke(),c()}const Tt=ct("crop");var Li=L('<!> <main class="main svelte-1uha8ag"><!></main> <!>',1);function ji(n,t){xe(t,!1);const e=()=>We(Tt,"$activeTab",o),i=()=>We(V,"$cropState",o),[o,r]=_t();let c=O(!1),d=null;function l(E){if(e()==="crop"&&i().cropPending&&E!=="crop"){d=E,S(c,!0);return}Tt.set(E)}async function u(){S(c,!1);const E=i();if(E.currentImage&&E.cropPending){const M=await ma(E.currentImage,E.cropBox,E.imageWidth,E.imageHeight),H=await It(M);V.set({...E,currentImage:M,imageWidth:H.width,imageHeight:H.height,cropBox:{x:0,y:0,width:100,height:100},cropPending:!1,isCropping:!1})}d&&(Tt.set(d),d=null)}function h(){S(c,!1),d=null}Re();var I=Li(),p=Ee(I);en(p,{get activeTab(){return e()},onTabChange:l});var f=w(p,2),b=C(f);{var B=E=>{Vn(E,{})},s=E=>{var M=nt(),H=Ee(M);{var R=T=>{ki(T,{})},x=T=>{var Y=nt(),N=Ee(Y);{var Q=he=>{Di(he,{})};Z(N,he=>{e()==="design"&&he(Q)},!0)}A(T,Y)};Z(H,T=>{e()==="ai"?T(R):T(x,!1)},!0)}A(E,M)};Z(b,E=>{e()==="crop"?E(B):E(s,!1)})}_(f);var g=w(f,2);{var P=E=>{qt(E,{message:"Save changes?",confirmText:"Yes",cancelText:"Cancel",onConfirm:u,onCancel:h})};Z(g,E=>{a(c)&&E(P)})}A(n,I),ke(),r()}export{ji as component};

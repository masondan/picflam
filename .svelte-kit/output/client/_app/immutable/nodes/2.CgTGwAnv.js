import{f as T,a as P,c as Ve}from"../chunks/fofpT_Z8.js";import"../chunks/B0wnF16V.js";import{F as At,i as Ye,x as Ma,C as Bt,j as Pa,M as za,g as a,aI as Je,aA as Aa,O as Ba,a5 as ea,aj as Tt,B as Mt,N as Ta,ao as Da,a2 as ta,ax as Ua,P as Lt,az as La,am as Xt,w as ma,I as aa,at as Y,aO as Ha,aP as Fa,aQ as Oa,aR as at,ay as ba,R as pa,aS as Dt,ah as Na,aT as Wa,al as qa,a3 as ja,aU as wa,L as xa,aV as Ya,aW as Xa,aX as Ga,aY as Va,aZ as Ja,p as ye,t as te,n as Se,s as p,k,l as w,aq as y,b as H,a_ as ze,a$ as It,e as Me,a4 as ft,m as Ce,b0 as na}from"../chunks/DKVK_XYJ.js";import{p as x,b as St,i as Q,s as He,a as gt,_ as Gt}from"../chunks/BJ6IQwyK.js";import{i as Re}from"../chunks/D8EnKHUR.js";import{e as C,s as he}from"../chunks/CuybRmit.js";import{c as Za,o as Vt,d as Jt,w as nt}from"../chunks/umaFkCoN.js";let oa=!1;function Qa(){oa||(oa=!0,document.addEventListener("reset",n=>{Promise.resolve().then(()=>{if(!n.defaultPrevented)for(const t of n.target.elements)t.__on_r?.()})},{capture:!0}))}function mt(n,t){return t}function Ka(n,t,e){for(var o=[],i=t.length,s,r=t.length,u=0;u<i;u++){let b=t[u];pa(b,()=>{if(s){if(s.pending.delete(b),s.done.add(b),s.pending.size===0){var h=n.outrogroups;Ht(Xt(s.done)),h.delete(s),h.size===0&&(n.outrogroups=null)}}else r-=1},!1)}if(r===0){var c=o.length===0&&e!==null;if(c){var g=e,v=g.parentNode;qa(v),v.append(g),n.items.clear()}Ht(t,!c)}else s={pending:new Set(t),done:new Set},(n.outrogroups??=new Set).add(s)}function Ht(n,t=!0){for(var e=0;e<n.length;e++)ja(n[e],t)}var sa;function bt(n,t,e,o,i,s=null){var r=n,u=new Map,c=(t&wa)!==0;if(c){var g=n;r=Ye?At(Ma(g)):g.appendChild(Bt())}Ye&&Pa();var v=null,b=Je(()=>{var d=e();return ma(d)?d:d==null?[]:Xt(d)}),h,m=!0;function _(){l.fallback=v,$a(l,h,r,t,o),v!==null&&(h.length===0?(v.f&at)===0?ba(v):(v.f^=at,Ct(v,null,r)):pa(v,()=>{v=null}))}var I=za(()=>{h=a(b);var d=h.length;let z=!1;if(Ye){var R=Aa(r)===Ba;R!==(d===0)&&(r=ea(),At(r),Tt(!1),z=!0)}for(var A=new Set,W=Ua,U=La(),E=0;E<d;E+=1){Ye&&Mt.nodeType===Ta&&Mt.data===Da&&(r=Mt,z=!0,Tt(!1));var B=h[E],j=o(B,E),F=m?null:u.get(j);F?(F.v&&ta(F.v,B),F.i&&ta(F.i,E),U&&W.skipped_effects.delete(F.e)):(F=en(u,m?r:sa??=Bt(),B,j,E,i,t,e),m||(F.e.f|=at),u.set(j,F)),A.add(j)}if(d===0&&s&&!v&&(m?v=Lt(()=>s(r)):(v=Lt(()=>s(sa??=Bt())),v.f|=at)),Ye&&d>0&&At(ea()),!m)if(U){for(const[q,G]of u)A.has(q)||W.skipped_effects.add(G.e);W.oncommit(_),W.ondiscard(()=>{})}else _();z&&Tt(!0),a(b)}),l={effect:I,items:u,outrogroups:null,fallback:v};m=!1,Ye&&(r=Mt)}function xt(n){for(;n!==null&&(n.f&Wa)===0;)n=n.next;return n}function $a(n,t,e,o,i){var s=(o&Ya)!==0,r=t.length,u=n.items,c=xt(n.effect.first),g,v=null,b,h=[],m=[],_,I,l,d;if(s)for(d=0;d<r;d+=1)_=t[d],I=i(_,d),l=u.get(I).e,(l.f&at)===0&&(l.nodes?.a?.measure(),(b??=new Set).add(l));for(d=0;d<r;d+=1){if(_=t[d],I=i(_,d),l=u.get(I).e,n.outrogroups!==null)for(const F of n.outrogroups)F.pending.delete(l),F.done.delete(l);if((l.f&at)!==0)if(l.f^=at,l===c)Ct(l,null,e);else{var z=v?v.next:c;l===n.effect.last&&(n.effect.last=l.prev),l.prev&&(l.prev.next=l.next),l.next&&(l.next.prev=l.prev),rt(n,v,l),rt(n,l,z),Ct(l,z,e),v=l,h=[],m=[],c=xt(v.next);continue}if((l.f&Dt)!==0&&(ba(l),s&&(l.nodes?.a?.unfix(),(b??=new Set).delete(l))),l!==c){if(g!==void 0&&g.has(l)){if(h.length<m.length){var R=m[0],A;v=R.prev;var W=h[0],U=h[h.length-1];for(A=0;A<h.length;A+=1)Ct(h[A],R,e);for(A=0;A<m.length;A+=1)g.delete(m[A]);rt(n,W.prev,U.next),rt(n,v,W),rt(n,U,R),c=R,v=U,d-=1,h=[],m=[]}else g.delete(l),Ct(l,c,e),rt(n,l.prev,l.next),rt(n,l,v===null?n.effect.first:v.next),rt(n,v,l),v=l;continue}for(h=[],m=[];c!==null&&c!==l;)(g??=new Set).add(c),m.push(c),c=xt(c.next);if(c===null)continue}(l.f&at)===0&&h.push(l),v=l,c=xt(l.next)}if(n.outrogroups!==null){for(const F of n.outrogroups)F.pending.size===0&&(Ht(Xt(F.done)),n.outrogroups?.delete(F));n.outrogroups.size===0&&(n.outrogroups=null)}if(c!==null||g!==void 0){var E=[];if(g!==void 0)for(l of g)(l.f&Dt)===0&&E.push(l);for(;c!==null;)(c.f&Dt)===0&&c!==n.fallback&&E.push(c),c=xt(c.next);var B=E.length;if(B>0){var j=(o&wa)!==0&&r===0?e:null;if(s){for(d=0;d<B;d+=1)E[d].nodes?.a?.measure();for(d=0;d<B;d+=1)E[d].nodes?.a?.fix()}Ka(n,E,j)}}s&&xa(()=>{if(b!==void 0)for(l of b)l.nodes?.a?.apply()})}function en(n,t,e,o,i,s,r,u){var c=(r&Fa)!==0?(r&Oa)===0?Y(e,!1,!1):aa(e):null,g=(r&Ha)!==0?aa(i):null;return{v:c,i:g,e:Lt(()=>(s(t,c??e,g??i,u),()=>{n.delete(o)}))}}function Ct(n,t,e){if(n.nodes)for(var o=n.nodes.start,i=n.nodes.end,s=t&&(t.f&at)===0?t.nodes.start:e;o!==null;){var r=Na(o);if(s.before(o),o===i)return;o=r}}function rt(n,t,e){t===null?n.effect.first=e:t.next=e,e===null?n.effect.last=t:e.prev=t}const ia=[...` 	
\r\fÂ \v\uFEFF`];function tn(n,t,e){var o=n==null?"":""+n;if(e){for(var i in e)if(e[i])o=o?o+" "+i:i;else if(o.length)for(var s=i.length,r=0;(r=o.indexOf(i,r))>=0;){var u=r+s;(r===0||ia.includes(o[r-1]))&&(u===o.length||ia.includes(o[u]))?o=(r===0?"":o.substring(0,r))+o.substring(u+1):r=u}}return o===""?null:o}function an(n,t){return n==null?null:String(n)}function Pe(n,t,e,o,i,s){var r=n.__className;if(Ye||r!==e||r===void 0){var u=tn(e,o,s);(!Ye||u!==n.getAttribute("class"))&&(u==null?n.removeAttribute("class"):n.className=u),n.__className=e}else if(s&&i!==s)for(var c in s){var g=!!s[c];(i==null||g!==!!i[c])&&n.classList.toggle(c,g)}return s}function Le(n,t,e,o){var i=n.__style;if(Ye||i!==t){var s=an(t);(!Ye||s!==n.getAttribute("style"))&&(s==null?n.removeAttribute("style"):n.style.cssText=s),n.__style=t}return o}const nn=Symbol("is custom element"),on=Symbol("is html");function zt(n){if(Ye){var t=!1,e=()=>{if(!t){if(t=!0,n.hasAttribute("value")){var o=n.value;we(n,"value",null),n.value=o}if(n.hasAttribute("checked")){var i=n.checked;we(n,"checked",null),n.checked=i}}};n.__on_r=e,xa(e),Qa()}}function Ft(n,t){var e=Zt(n);e.value===(e.value=t??void 0)||n.value===t&&(t!==0||n.nodeName!=="PROGRESS")||(n.value=t??"")}function sn(n,t){var e=Zt(n);e.checked!==(e.checked=t??void 0)&&(n.checked=t)}function we(n,t,e,o){var i=Zt(n);Ye&&(i[t]=n.getAttribute(t),t==="src"||t==="srcset"||t==="href"&&n.nodeName==="LINK")||i[t]!==(i[t]=e)&&(t==="loading"&&(n[Xa]=e),e==null?n.removeAttribute(t):typeof e!="string"&&rn(n).includes(t)?n[t]=e:n.setAttribute(t,e))}function Zt(n){return n.__attributes??={[nn]:n.nodeName.includes("-"),[on]:n.namespaceURI===Ga}}var ra=new Map;function rn(n){var t=n.getAttribute("is")||n.nodeName,e=ra.get(t);if(e)return e;ra.set(t,e=[]);for(var o,i=n,s=Element.prototype;s!==i;){o=Ja(i);for(var r in o)o[r].set&&e.push(r);i=Va(i)}return e}function je(n){return function(...t){var e=t[0];return e.stopPropagation(),n?.apply(this,t)}}function Ot(n,t){var e=n.$$events?.[t.type],o=ma(e)?e.slice():e==null?[]:[e];for(var i of o)i.call(this,t)}var ln=T('<header class="header svelte-hv3zzy"><img src="/logos/logo-picflam-logotype.png" alt="PicFlam" class="header-logo svelte-hv3zzy"/> <nav class="header-nav svelte-hv3zzy"><button aria-label="Crop tab"><img src="/icons/icon-crop.svg" alt="" class="nav-icon svelte-hv3zzy"/></button> <button aria-label="AI tab"><img src="/icons/icon-ai.svg" alt="" class="nav-icon svelte-hv3zzy"/></button> <button aria-label="Design tab"><img src="/icons/icon-design.svg" alt="" class="nav-icon svelte-hv3zzy"/></button></nav></header>');function cn(n,t){ye(t,!1);let e=x(t,"activeTab",8,"crop"),o=x(t,"onTabChange",8);Re();var i=ln(),s=p(k(i),2),r=k(s);let u;var c=p(r,2);let g;var v=p(c,2);let b;w(s),w(i),te(()=>{u=Pe(r,1,"nav-btn svelte-hv3zzy",null,u,{active:e()==="crop"}),g=Pe(c,1,"nav-btn svelte-hv3zzy",null,g,{active:e()==="ai"}),b=Pe(v,1,"nav-btn svelte-hv3zzy",null,b,{active:e()==="design"})}),C("click",r,()=>o()("crop")),C("click",c,()=>o()("ai")),C("click",v,()=>o()("design")),P(n,i),Se()}function _a(n){return new Promise((t,e)=>{const o=new FileReader;o.onload=i=>t(i.target.result),o.onerror=e,o.readAsDataURL(n)})}function ut(n){return new Promise((t,e)=>{const o=new Image;o.onload=()=>t(o),o.onerror=e,o.src=n})}async function Pt(n){const t=await ut(n);return{width:t.naturalWidth,height:t.naturalHeight}}function la(n,t=2048){return new Promise(async e=>{const o=await ut(n),{naturalWidth:i,naturalHeight:s}=o;if(i<=t&&s<=t){e(n);return}const r=document.createElement("canvas"),u=r.getContext("2d");let c,g;i>s?(c=t,g=s/i*t):(g=t,c=i/s*t),r.width=c,r.height=g,u.drawImage(o,0,0,c,g),e(r.toDataURL("image/jpeg",.92))})}async function un(){try{const n=await navigator.clipboard.read();for(const t of n)for(const e of t.types)if(e.startsWith("image/")){const o=await t.getType(e);return await _a(o)}return null}catch(n){return console.error("Failed to paste from clipboard:",n),null}}async function Nt(n){try{const e=await(await fetch(n)).blob();return await navigator.clipboard.write([new ClipboardItem({[e.type]:e})]),!0}catch(t){return console.error("Failed to copy to clipboard:",t),!1}}function Wt(n,t="picflam-export.png"){const e=document.createElement("a");e.href=n,e.download=t,document.body.appendChild(e),e.click(),document.body.removeChild(e)}async function ka(n,t,e,o){const i=await ut(n),s=document.createElement("canvas"),r=s.getContext("2d"),u=t.x/100*e,c=t.y/100*o,g=t.width/100*e,v=t.height/100*o;return s.width=g,s.height=v,r.drawImage(i,u,c,g,v,0,0,g,v),s.toDataURL("image/png")}async function dn(n,t){const e=await ut(n),o=document.createElement("canvas"),i=o.getContext("2d");return o.width=e.naturalHeight,o.height=e.naturalWidth,i.translate(o.width/2,o.height/2),i.rotate(t*Math.PI/180),i.drawImage(e,-e.naturalWidth/2,-e.naturalHeight/2),o.toDataURL("image/png")}async function vn(n,t){const e=await ut(n),o=document.createElement("canvas"),i=o.getContext("2d");return o.width=e.naturalWidth,o.height=e.naturalHeight,i.translate(o.width,0),i.scale(-1,1),i.drawImage(e,0,0),o.toDataURL("image/png")}async function gn(n,t,e){const o=await ut(n),i=document.createElement("canvas"),s=i.getContext("2d");if(i.width=o.naturalWidth,i.height=o.naturalHeight,t&&t!=="none"&&(s.filter=t),s.drawImage(o,0,0),s.filter="none",e&&Array.isArray(e)&&e.length>0)if(e.some(u=>u.invert)){const c=.5+e.reduce((l,d)=>l+(d.strength||50),0)/e.length/100*9.5,g=document.createElement("canvas");g.width=i.width,g.height=i.height;const v=g.getContext("2d");v.filter=`blur(${c}px)`,t&&t!=="none"&&(v.filter=`blur(${c}px) ${t}`),v.drawImage(o,0,0);const b=document.createElement("canvas");b.width=i.width,b.height=i.height;const h=b.getContext("2d");h.fillStyle="white",h.fillRect(0,0,b.width,b.height);for(const l of e){if(!l.invert)continue;const d=(l.soften||50)/100,z=h.createRadialGradient(l.x,l.y,0,l.x,l.y,l.radius);z.addColorStop(0,"rgba(0,0,0,1)"),z.addColorStop(.5+d*.3,"rgba(0,0,0,0.5)"),z.addColorStop(1,"rgba(0,0,0,0)"),h.fillStyle=z,h.beginPath(),h.arc(l.x,l.y,l.radius,0,Math.PI*2),h.fill()}const m=s.getImageData(0,0,i.width,i.height),_=v.getImageData(0,0,i.width,i.height),I=h.getImageData(0,0,i.width,i.height);for(let l=0;l<m.data.length;l+=4){const d=I.data[l]/255;m.data[l]=m.data[l]*d+_.data[l]*(1-d),m.data[l+1]=m.data[l+1]*d+_.data[l+1]*(1-d),m.data[l+2]=m.data[l+2]*d+_.data[l+2]*(1-d)}s.putImageData(m,0,0)}else for(const u of e){const c=u.strength||50,g=(u.soften||50)/100,v=.5+c/100*9.5,b=document.createElement("canvas");b.width=i.width,b.height=i.height;const h=b.getContext("2d");h.filter=`blur(${v}px)`,t&&t!=="none"&&(h.filter=`blur(${v}px) ${t}`),h.drawImage(o,0,0);const m=document.createElement("canvas");m.width=i.width,m.height=i.height;const _=m.getContext("2d"),I=_.createRadialGradient(u.x,u.y,0,u.x,u.y,u.radius);I.addColorStop(0,"rgba(255,255,255,1)"),I.addColorStop(.5+g*.3,"rgba(255,255,255,0.5)"),I.addColorStop(1,"rgba(255,255,255,0)"),_.fillStyle=I,_.beginPath(),_.arc(u.x,u.y,u.radius,0,Math.PI*2),_.fill();const l=s.getImageData(0,0,i.width,i.height),d=h.getImageData(0,0,i.width,i.height),z=_.getImageData(0,0,i.width,i.height);for(let R=0;R<l.data.length;R+=4){const A=z.data[R]/255;l.data[R]=l.data[R]*(1-A)+d.data[R]*A,l.data[R+1]=l.data[R+1]*(1-A)+d.data[R+1]*A,l.data[R+2]=l.data[R+2]*(1-A)+d.data[R+2]*A}s.putImageData(l,0,0)}return i.toDataURL("image/png")}var hn=T('<div role="button" tabindex="0"><p class="import-title svelte-f1bndr"> </p> <img src="/icons/icon-upload.svg" alt="" class="import-icon svelte-f1bndr"/> <p class="import-hint svelte-f1bndr"> </p> <button class="btn-paste svelte-f1bndr">Paste</button> <input type="file" accept="image/*" class="sr-only"/></div>');function Ca(n,t){ye(t,!1);let e=x(t,"title",8,"Import an image"),o=x(t,"hint",8,"Import, drag or paste an image"),i=x(t,"onImageImport",8,U=>{}),s=Y(!1),r=Y();async function u(U){if(!U||!U.type.startsWith("image/"))return;const E=await _a(U),B=await la(E,2048);i()(B)}function c(U){const E=U.target.files?.[0];E&&u(E)}function g(U){U.preventDefault(),y(s,!1);const E=U.dataTransfer?.files?.[0];E&&u(E)}function v(U){U.preventDefault(),y(s,!0)}function b(){y(s,!1)}async function h(){const U=await un();if(U){const E=await la(U,2048);i()(E)}}function m(){a(r)?.click()}Re();var _=hn();let I;var l=k(_),d=k(l,!0);w(l);var z=p(l,4),R=k(z,!0);w(z);var A=p(z,2),W=p(A,2);St(W,U=>y(r,U),()=>a(r)),w(_),te(()=>{I=Pe(_,1,"import-area svelte-f1bndr",null,I,{dragging:a(s)}),he(d,e()),he(R,o())}),C("click",A,je(h)),C("change",W,c),C("click",_,m),C("drop",_,g),C("dragover",_,v),C("dragleave",_,b),C("keypress",_,U=>U.key==="Enter"&&m()),P(n,_),Se()}var fn=T('<div class="action-bar svelte-96zw02"><div class="action-group svelte-96zw02"><button class="action-btn svelte-96zw02" aria-label="Undo"><img src="/icons/icon-undo.svg" alt="" class="action-icon svelte-96zw02"/></button> <button class="action-btn svelte-96zw02" aria-label="Redo"><img src="/icons/icon-redo.svg" alt="" class="action-icon svelte-96zw02"/></button></div> <div class="action-group svelte-96zw02"><button class="action-btn svelte-96zw02" aria-label="Start again"><img src="/icons/icon-startagain.svg" alt="" class="action-icon svelte-96zw02"/></button> <button class="action-btn svelte-96zw02" aria-label="Copy to clipboard"><img src="/icons/icon-copy.svg" alt="" class="action-icon svelte-96zw02"/></button> <button class="action-btn svelte-96zw02" aria-label="Export"><img src="/icons/icon-export.svg" alt="" class="action-icon svelte-96zw02"/></button></div></div>');function Qt(n,t){let e=x(t,"canUndo",8,!1),o=x(t,"canRedo",8,!1),i=x(t,"onUndo",8,()=>{}),s=x(t,"onRedo",8,()=>{}),r=x(t,"onStartAgain",8,()=>{}),u=x(t,"onCopy",8,()=>{}),c=x(t,"onExport",8,()=>{});var g=fn(),v=k(g),b=k(v),h=p(b,2);w(v);var m=p(v,2),_=k(m),I=p(_,2),l=p(I,2);w(m),w(g),te(()=>{b.disabled=!e(),h.disabled=!o()}),C("click",b,function(...d){i()?.apply(this,d)}),C("click",h,function(...d){s()?.apply(this,d)}),C("click",_,function(...d){r()?.apply(this,d)}),C("click",I,function(...d){u()?.apply(this,d)}),C("click",l,function(...d){c()?.apply(this,d)}),P(n,g)}var mn=T("<button> </button>"),bn=T('<div class="sub-menu-tabs svelte-tv6tw8"></div>');function Kt(n,t){ye(t,!1);let e=x(t,"tabs",24,()=>[]),o=x(t,"activeTab",8,""),i=x(t,"onTabChange",8,r=>{});Re();var s=bn();bt(s,5,e,mt,(r,u)=>{var c=mn();let g;var v=k(c,!0);w(c),te(()=>{g=Pe(c,1,"sub-menu-tab svelte-tv6tw8",null,g,{active:o()===a(u).id}),he(v,(a(u),H(()=>a(u).label)))}),C("click",c,()=>i()(a(u).id)),P(r,c)}),w(s),P(n,s),Se()}var pn=T('<div class="modal-overlay svelte-qik81a" role="dialog" aria-modal="true" tabindex="-1"><div class="modal svelte-qik81a" role="document"><p class="modal-message svelte-qik81a"> </p> <div class="modal-actions svelte-qik81a"><button class="btn-text svelte-qik81a"> </button> <button class="btn-text btn-confirm svelte-qik81a"> </button></div></div></div>');function qt(n,t){ye(t,!1);let e=x(t,"message",8,""),o=x(t,"confirmText",8,"Yes"),i=x(t,"cancelText",8,"Cancel"),s=x(t,"onConfirm",8,()=>{}),r=x(t,"onCancel",8,()=>{});Re();var u=pn(),c=k(u),g=k(c),v=k(g,!0);w(g);var b=p(g,2),h=k(b),m=k(h,!0);w(h);var _=p(h,2),I=k(_,!0);w(_),w(b),w(c),w(u),te(()=>{he(v,e()),he(m,i()),he(I,o())}),C("click",h,function(...l){r()?.apply(this,l)}),C("click",_,function(...l){s()?.apply(this,l)}),C("click",c,je(function(l){Ot.call(this,t,l)})),C("keydown",c,je(function(l){Ot.call(this,t,l)})),C("click",u,function(...l){r()?.apply(this,l)}),C("keydown",u,l=>l.key==="Escape"&&r()()),P(n,u),Se()}var wn=T('<canvas class="blur-canvas svelte-pjowa5"></canvas>'),xn=T('<div class="blur-brush-indicator svelte-pjowa5"></div>'),_n=T('<div class="blur-brush-preview svelte-pjowa5"></div>'),kn=T('<div class="crop-overlay svelte-pjowa5"><div class="overlay-top svelte-pjowa5"></div> <div class="overlay-bottom svelte-pjowa5"></div> <div class="overlay-left svelte-pjowa5"></div> <div class="overlay-right svelte-pjowa5"></div> <div class="crop-box svelte-pjowa5" role="button" aria-label="Drag to move crop area" tabindex="0"><div class="crop-border svelte-pjowa5"></div> <div class="corner-handle top-left svelte-pjowa5" role="button" aria-label="Resize top-left corner" tabindex="0"></div> <div class="corner-handle top-right svelte-pjowa5" role="button" aria-label="Resize top-right corner" tabindex="0"></div> <div class="corner-handle bottom-left svelte-pjowa5" role="button" aria-label="Resize bottom-left corner" tabindex="0"></div> <div class="corner-handle bottom-right svelte-pjowa5" role="button" aria-label="Resize bottom-right corner" tabindex="0"></div></div></div>'),Cn=T('<div class="crop-canvas svelte-pjowa5" role="application" aria-label="Image crop canvas"><div class="image-wrapper svelte-pjowa5"><img alt="Crop preview" class="canvas-image svelte-pjowa5" draggable="false"/> <!></div> <!> <!> <!></div>');function yn(n,t){ye(t,!1);const e=Y(),o=Y(),i=Y(),s=Y();let r=x(t,"imageSrc",8,""),u=x(t,"cropBox",24,()=>({x:10,y:10,width:80,height:80})),c=x(t,"isCropping",8,!1),g=x(t,"scale",8,1),v=x(t,"offsetX",8,0),b=x(t,"offsetY",8,0),h=x(t,"imageWidth",8,0),m=x(t,"imageHeight",8,0),_=x(t,"editFilters",8,""),I=x(t,"blurEnabled",8,!1),l=x(t,"blurBrushSize",8,50),d=x(t,"blurStrength",8,50),z=x(t,"blurSoften",8,50),R=x(t,"blurInvert",8,!1),A=x(t,"blurMask",24,()=>[]),W=x(t,"showBrushPreview",8,!1);const U=Za();let E=Y(),B=Y(),j=Y({width:0,height:0}),F=!1,q=null,G=0,ie=0,D=null,V=0,O=1,K=!1,ae=Y({x:0,y:0,visible:!1}),re=Y(null),ce=Y("");async function ne(){y(ce,r());const S=new Image;S.crossOrigin="anonymous",S.onload=()=>{y(re,S)},S.src=r()}function le(S){const Z=document.createElement("canvas");Z.width=a(re).naturalWidth,Z.height=a(re).naturalHeight;const L=Z.getContext("2d");return L.filter=`blur(${S}px)`,L.drawImage(a(re),0,0),Z}function ve(){if(!a(B)||!a(re)||!A())return;const S=a(B).getContext("2d"),Z=a(B).width,L=a(B).height;if(S.clearRect(0,0,Z,L),A().length===0)return;const N=Z/h(),$=L/m();if(A().some(se=>se.invert)){const se=A().reduce((X,oe)=>X+(oe.strength||50),0)/A().length;A().reduce((X,oe)=>X+(oe.soften||50),0)/A().length;const f=.5+se/100*9.5,M=le(f);S.drawImage(M,0,0,Z,L),S.globalCompositeOperation="destination-out";for(const X of A()){if(!X.invert)continue;const oe=X.x*N,J=X.y*$,de=X.radius*Math.min(N,$),ge=(X.soften||50)/100,xe=Math.max(0,.3-ge*.3),_e=.3+(1-ge)*.4,pe=S.createRadialGradient(oe,J,0,oe,J,de);pe.addColorStop(xe,"rgba(0,0,0,1)"),pe.addColorStop(_e,`rgba(0,0,0,${.5+ge*.3})`),pe.addColorStop(1,"rgba(0,0,0,0)"),S.fillStyle=pe,S.beginPath(),S.arc(oe,J,de,0,Math.PI*2),S.fill()}S.globalCompositeOperation="source-over"}else for(const se of A()){const f=se.x*N,M=se.y*$,X=se.radius*Math.min(N,$),oe=se.strength||50,J=(se.soften||50)/100,de=.5+oe/100*9.5,ge=le(de);S.save();const xe=Math.max(0,.2-J*.2),_e=.2+(1-J)*.5,pe=S.createRadialGradient(f,M,0,f,M,X);pe.addColorStop(xe,"rgba(255,255,255,1)"),pe.addColorStop(_e,`rgba(255,255,255,${.4+J*.3})`),pe.addColorStop(1,"rgba(255,255,255,0)"),S.beginPath(),S.arc(f,M,X,0,Math.PI*2),S.clip(),S.drawImage(ge,0,0,Z,L),S.restore()}}Vt(()=>(Ae(),window.addEventListener("resize",Ae),()=>window.removeEventListener("resize",Ae)));function Ae(){if(a(E)){const S=a(E).getBoundingClientRect();y(j,{width:S.width,height:S.height})}}function me(S){return S.touches&&S.touches.length>0?{x:S.touches[0].clientX,y:S.touches[0].clientY}:{x:S.clientX,y:S.clientY}}function Be(S){if(S.touches&&S.touches.length>=2){const Z=S.touches[0].clientX-S.touches[1].clientX,L=S.touches[0].clientY-S.touches[1].clientY;return Math.sqrt(Z*Z+L*L)}return 0}function Ie(S,Z="move"){if(!c())return;if(S.touches&&S.touches.length>=2){V=Be(S),O=g(),q="pinch";return}S.preventDefault(),F=!0,q=Z;const L=me(S);G=L.x,ie=L.y,D={...u()}}function Xe(S){if(!c())return;if(q==="pinch"&&S.touches&&S.touches.length>=2){const fe=Be(S),se=O*(fe/V);U("scaleChange",{scale:Math.max(.5,Math.min(3,se))});return}if(!F||!D)return;S.preventDefault();const Z=me(S),L=(Z.x-G)/a(e)*100,N=(Z.y-ie)/a(o)*100;let $={...D};if(q==="move")$.x=Math.max(0,Math.min(100-D.width,D.x+L)),$.y=Math.max(0,Math.min(100-D.height,D.y+N));else if(q.includes("corner")){if(q.includes("left")){const se=D.x+L,f=D.width-L;f>=10&&se>=0&&($.x=se,$.width=f)}if(q.includes("right")){const se=D.width+L;se>=10&&D.x+se<=100&&($.width=se)}if(q.includes("top")){const se=D.y+N,f=D.height-N;f>=10&&se>=0&&($.y=se,$.height=f)}if(q.includes("bottom")){const se=D.height+N;se>=10&&D.y+se<=100&&($.height=se)}}U("cropChange",{cropBox:$})}function Ne(){F=!1,q=null,D=null,K&&(K=!1)}function Te(S){I()&&(S.preventDefault(),K=!0,Oe(S))}function De(S){if(!I())return;const Z=a(E).getBoundingClientRect(),L=me(S);y(ae,{x:L.x-Z.left,y:L.y-Z.top,visible:!0}),K&&Oe(S)}function Ze(){y(ae,{...a(ae),visible:!1}),K&&(K=!1)}function Oe(S){const Z=a(E).getBoundingClientRect(),L=me(S),N=(L.x-Z.left)/a(e)*h(),$=(L.y-Z.top)/a(o)*m(),fe=l()/100*Math.min(h(),m())*.15;U("blurPaint",{point:{x:N,y:$,radius:fe,strength:d(),soften:z(),invert:R()}})}ze(()=>a(j),()=>{y(e,a(j).width)}),ze(()=>(Me(m()),Me(h()),a(e)),()=>{y(o,m()&&h()?a(e)*m()/h():0)}),ze(()=>(Me(l()),a(e),a(o)),()=>{y(i,l()/100*Math.min(a(e),a(o))*.3)}),ze(()=>(Me(r()),a(B),a(ce)),()=>{r()&&a(B)&&r()!==a(ce)&&ne()}),ze(()=>(Me(A()),a(B),a(re)),()=>{A()&&Array.isArray(A())&&A().length>0&&a(B)&&a(re)&&ve()}),ze(()=>(Me(u()),a(e),a(o)),()=>{y(s,{x:u().x/100*a(e),y:u().y/100*a(o),width:u().width/100*a(e),height:u().height/100*a(o)})}),It(),Re();var ue=Cn(),Ee=k(ue),Ue=k(Ee),ot=p(Ue,2);{var dt=S=>{var Z=wn();St(Z,L=>y(B,L),()=>a(B)),te(()=>{we(Z,"width",a(e)),we(Z,"height",a(o)),Le(Z,`filter: ${_()??""};`)}),P(S,Z)};Q(ot,S=>{I()&&a(e)>0&&a(o)>0&&S(dt)})}w(Ee);var Ge=p(Ee,2);{var Qe=S=>{var Z=xn();te(()=>Le(Z,`
				left: ${a(ae),H(()=>a(ae).x)??""}px;
				top: ${a(ae),H(()=>a(ae).y)??""}px;
				width: ${a(i)??""}px;
				height: ${a(i)??""}px;
			`)),P(S,Z)};Q(Ge,S=>{Me(I()),a(ae),H(()=>I()&&a(ae).visible)&&S(Qe)})}var Fe=p(Ge,2);{var Ke=S=>{var Z=_n();te(()=>Le(Z,`
				left: ${a(e)/2}px;
				top: ${a(o)/2}px;
				width: ${a(i)??""}px;
				height: ${a(i)??""}px;
			`)),P(S,Z)};Q(Fe,S=>{W()&&a(e)>0&&a(o)>0&&S(Ke)})}var st=p(Fe,2);{var We=S=>{var Z=kn(),L=k(Z),N=p(L,2),$=p(N,2),fe=p($,2),se=p(fe,2),f=p(k(se),2),M=p(f,2),X=p(M,2),oe=p(X,2);w(se),w(Z),te(()=>{Le(L,`height: ${a(s),H(()=>a(s).y)??""}px;`),Le(N,`top: ${a(s),H(()=>a(s).y+a(s).height)??""}px; height: ${a(o),a(s),H(()=>a(o)-a(s).y-a(s).height)??""}px;`),Le($,`top: ${a(s),H(()=>a(s).y)??""}px; height: ${a(s),H(()=>a(s).height)??""}px; width: ${a(s),H(()=>a(s).x)??""}px;`),Le(fe,`top: ${a(s),H(()=>a(s).y)??""}px; height: ${a(s),H(()=>a(s).height)??""}px; left: ${a(s),H(()=>a(s).x+a(s).width)??""}px; width: ${a(e),a(s),H(()=>a(e)-a(s).x-a(s).width)??""}px;`),Le(se,`left: ${a(s),H(()=>a(s).x)??""}px; top: ${a(s),H(()=>a(s).y)??""}px; width: ${a(s),H(()=>a(s).width)??""}px; height: ${a(s),H(()=>a(s).height)??""}px;`)}),C("mousedown",f,je(J=>Ie(J,"corner-top-left"))),C("touchstart",f,je(J=>Ie(J,"corner-top-left"))),C("mousedown",M,je(J=>Ie(J,"corner-top-right"))),C("touchstart",M,je(J=>Ie(J,"corner-top-right"))),C("mousedown",X,je(J=>Ie(J,"corner-bottom-left"))),C("touchstart",X,je(J=>Ie(J,"corner-bottom-left"))),C("mousedown",oe,je(J=>Ie(J,"corner-bottom-right"))),C("touchstart",oe,je(J=>Ie(J,"corner-bottom-right"))),C("mousedown",se,J=>Ie(J,"move")),C("touchstart",se,J=>Ie(J,"move")),P(S,Z)};Q(st,S=>{c()&&a(o)>0&&S(We)})}w(ue),St(ue,S=>y(E,S),()=>a(E)),te(()=>{Le(Ee,`transform: scale(${g()??""}) translate(${v()??""}px, ${b()??""}px);`),we(Ue,"src",r()),Le(Ue,`filter: ${_()??""};`)}),C("mousemove",ue,function(...S){(I()?De:Xe)?.apply(this,S)}),C("mouseup",ue,Ne),C("mouseleave",ue,function(...S){(I()?Ze:Ne)?.apply(this,S)}),C("touchmove",ue,function(...S){(I()?De:Xe)?.apply(this,S)}),C("touchend",ue,Ne),C("mousedown",ue,function(...S){(I()?Te:null)?.apply(this,S)}),C("touchstart",ue,function(...S){(I()?Te:null)?.apply(this,S)}),P(n,ue),Se()}var Sn=T('<img alt="" class="toggle-icon svelte-1gdqxne"/>'),In=T('<span class="toggle-label svelte-1gdqxne"> </span>'),Rn=T("<div><button><!></button> <!></div>"),En=T('<div class="toggle-group svelte-1gdqxne"></div>');function Mn(n,t){ye(t,!1);let e=x(t,"options",24,()=>[]),o=x(t,"value",8,""),i=x(t,"onChange",8,u=>{}),s=x(t,"showLabels",8,!0);Re();var r=En();bt(r,5,e,mt,(u,c)=>{var g=Rn();let v;var b=k(g);let h;var m=k(b);{var _=d=>{var z=Sn();te(()=>we(z,"src",`/icons/${a(c),H(()=>a(c).icon)??""}.svg`)),P(d,z)};Q(m,d=>{a(c),H(()=>a(c).icon)&&d(_)})}w(b);var I=p(b,2);{var l=d=>{var z=In(),R=k(z,!0);w(z),te(()=>he(R,(a(c),H(()=>a(c).label)))),P(d,z)};Q(I,d=>{Me(s()),a(c),H(()=>s()&&a(c).label)&&d(l)})}w(g),te(()=>{v=Pe(g,1,"toggle-item svelte-1gdqxne",null,v,{active:o()===a(c).id}),h=Pe(b,1,"toggle-btn svelte-1gdqxne",null,h,{active:o()===a(c).id}),we(b,"aria-label",(a(c),H(()=>a(c).label)))}),C("click",b,()=>i()(a(c).id)),P(u,g)}),w(r),P(n,r),Se()}var Pn=T('<label class="input-label svelte-1r47u3b"> <input class="input svelte-1r47u3b"/></label>'),zn=T('<input class="input svelte-1r47u3b"/>'),An=T('<div class="input-field svelte-1r47u3b"><!></div>');function ca(n,t){ye(t,!1);let e=x(t,"label",8,""),o=x(t,"value",12,""),i=x(t,"type",8,"text"),s=x(t,"placeholder",8,""),r=x(t,"disabled",8,!1),u=x(t,"onChange",8,m=>{});function c(m){o(m.target.value),u()(o())}Re();var g=An(),v=k(g);{var b=m=>{var _=Pn(),I=k(_),l=p(I);zt(l),w(_),te(()=>{he(I,`${e()??""} `),we(l,"type",i()),Ft(l,o()),we(l,"placeholder",s()),l.disabled=r()}),C("input",l,c),P(m,_)},h=m=>{var _=zn();zt(_),te(()=>{we(_,"type",i()),Ft(_,o()),we(_,"placeholder",s()),_.disabled=r()}),C("input",_,c),P(m,_)};Q(v,m=>{e()?m(b):m(h,!1)})}w(g),P(n,g),Se()}var Bn=T('<span class="slider-value svelte-jchife"> </span>'),Tn=T('<div class="slider-header svelte-jchife"><span class="slider-label svelte-jchife"> </span> <!></div>'),Dn=T('<div class="slider-container svelte-jchife"><!> <input type="range" class="slider svelte-jchife"/></div>');function ct(n,t){ye(t,!1);let e=x(t,"label",8,""),o=x(t,"min",8,0),i=x(t,"max",8,100),s=x(t,"value",8,50),r=x(t,"step",8,1),u=x(t,"showValue",8,!1),c=x(t,"onChange",8,z=>{}),g=x(t,"onInteractionStart",8,()=>{}),v=x(t,"onInteractionEnd",8,()=>{});function b(z){const R=Number(z.target.value);c()(R)}function h(){g()()}function m(){v()()}Re();var _=Dn(),I=k(_);{var l=z=>{var R=Tn(),A=k(R),W=k(A,!0);w(A);var U=p(A,2);{var E=B=>{var j=Bn(),F=k(j,!0);w(j),te(()=>he(F,s())),P(B,j)};Q(U,B=>{u()&&B(E)})}w(R),te(()=>he(W,e())),P(z,R)};Q(I,z=>{e()&&z(l)})}var d=p(I,2);zt(d),w(_),te(()=>{we(d,"min",o()),we(d,"max",i()),we(d,"step",r()),Ft(d,s())}),C("input",d,b),C("mousedown",d,h),C("touchstart",d,h),C("mouseup",d,m),C("touchend",d,m),P(n,_),Se()}var Un=T('<div class="apply-row svelte-17iy3mz"><button class="btn-apply svelte-17iy3mz">Apply</button></div>'),Ln=T('<div class="crop-controls svelte-17iy3mz"><!> <div class="dimensions-row svelte-17iy3mz"><div class="dimension-input svelte-17iy3mz"><!></div> <button class="icon-btn svelte-17iy3mz"><img alt="" class="icon-btn-img svelte-17iy3mz"/></button> <div class="dimension-input svelte-17iy3mz"><!></div> <button class="icon-btn svelte-17iy3mz" aria-label="Flip horizontal"><img src="/icons/icon-flip-horizontal.svg" alt="" class="icon-btn-img svelte-17iy3mz"/></button> <button class="icon-btn svelte-17iy3mz" aria-label="Rotate"><img src="/icons/icon-rotate.svg" alt="" class="icon-btn-img svelte-17iy3mz"/></button></div> <!> <!></div>');function Hn(n,t){ye(t,!1);let e=x(t,"aspectRatio",8,"9:16"),o=x(t,"cropWidth",8,1080),i=x(t,"cropHeight",8,1920),s=x(t,"ratioLocked",8,!0),r=x(t,"scale",8,100),u=x(t,"cropPending",8,!1),c=x(t,"onRatioChange",8,O=>{}),g=x(t,"onDimensionsChange",8,({width:O,height:K})=>{}),v=x(t,"onLockToggle",8,()=>{}),b=x(t,"onFlip",8,()=>{}),h=x(t,"onRotate",8,()=>{}),m=x(t,"onScaleChange",8,O=>{}),_=x(t,"onApply",8,()=>{});const I=[{id:"9:16",label:"9:16",icon:"icon-vertical"},{id:"1:1",label:"1:1",icon:"icon-square"},{id:"16:9",label:"16:9",icon:"icon-horizontal"},{id:"custom",label:"Custom",icon:"icon-custom"}];function l(O){const K=parseInt(O)||0;g()({width:K,height:i()})}function d(O){const K=parseInt(O)||0;g()({width:o(),height:K})}Re();var z=Ln(),R=k(z);Mn(R,{get options(){return I},get value(){return e()},get onChange(){return c()},showLabels:!0});var A=p(R,2),W=k(A),U=k(W);{let O=Je(()=>(Me(o()),H(()=>o().toString())));ca(U,{label:"Width",type:"number",get value(){return a(O)},onChange:l})}w(W);var E=p(W,2),B=k(E);w(E);var j=p(E,2),F=k(j);{let O=Je(()=>(Me(i()),H(()=>i().toString())));ca(F,{label:"Height",type:"number",get value(){return a(O)},onChange:d})}w(j);var q=p(j,2),G=p(q,2);w(A);var ie=p(A,2);ct(ie,{label:"Scale",min:50,max:200,get value(){return r()},step:1,showValue:!0,get onChange(){return m()}});var D=p(ie,2);{var V=O=>{var K=Un(),ae=k(K);w(K),C("click",ae,function(...re){_()?.apply(this,re)}),P(O,K)};Q(D,O=>{u()&&O(V)})}w(z),te(()=>{we(E,"aria-label",s()?"Unlock aspect ratio":"Lock aspect ratio"),we(B,"src",`/icons/${s()?"icon-lock":"icon-unlock"}.svg`)}),C("click",E,function(...O){v()?.apply(this,O)}),C("click",q,function(...O){b()?.apply(this,O)}),C("click",G,function(...O){h()?.apply(this,O)}),P(n,z),Se()}var Fn=T("<button> </button>"),On=T("<button> </button>"),Nn=T('<div class="blur-controls svelte-1e1k0ax"><div class="blur-control-row svelte-1e1k0ax"><!> <label class="invert-checkbox svelte-1e1k0ax"><input type="checkbox" class="svelte-1e1k0ax"/> <span class="checkbox-label svelte-1e1k0ax">Invert</span></label></div> <div class="slider-row svelte-1e1k0ax"><div class="slider-track svelte-1e1k0ax"><!></div> <button class="reset-btn svelte-1e1k0ax" aria-label="Reset"><img src="/icons/icon-reset.svg" alt="" class="reset-icon svelte-1e1k0ax"/></button></div> <div class="zoom-row svelte-1e1k0ax"><span class="zoom-label svelte-1e1k0ax">Zoom in</span> <div class="zoom-slider-row svelte-1e1k0ax"><div class="slider-track svelte-1e1k0ax"><!></div> <button class="reset-btn svelte-1e1k0ax" aria-label="Reset zoom"><img src="/icons/icon-reset.svg" alt="" class="reset-icon svelte-1e1k0ax"/></button></div></div> <div class="nudge-row svelte-1e1k0ax"><button class="nudge-btn svelte-1e1k0ax" aria-label="Nudge up"><img src="/icons/icon-nudge-up.svg" alt="" class="svelte-1e1k0ax"/></button> <button class="nudge-btn svelte-1e1k0ax" aria-label="Nudge down"><img src="/icons/icon-nudge-down.svg" alt="" class="svelte-1e1k0ax"/></button> <button class="nudge-btn svelte-1e1k0ax" aria-label="Nudge left"><img src="/icons/icon-nudge-left.svg" alt="" class="svelte-1e1k0ax"/></button> <button class="nudge-btn svelte-1e1k0ax" aria-label="Nudge right"><img src="/icons/icon-nudge-right.svg" alt="" class="svelte-1e1k0ax"/></button></div></div>'),Wn=T('<div class="edit-controls svelte-1e1k0ax"><div class="enhancement-row svelte-1e1k0ax"></div> <div class="slider-row svelte-1e1k0ax"><div class="slider-track svelte-1e1k0ax"><!></div> <button class="reset-btn svelte-1e1k0ax" aria-label="Reset"><img src="/icons/icon-reset.svg" alt="" class="reset-icon svelte-1e1k0ax"/></button></div> <div class="blur-section svelte-1e1k0ax"><div class="blur-header svelte-1e1k0ax"><button class="chevron-btn svelte-1e1k0ax"><img alt=""/></button> <span class="blur-label svelte-1e1k0ax">Blur</span> <button><span class="toggle-thumb svelte-1e1k0ax"></span></button></div> <!></div></div>');function qn(n,t){ye(t,!1);const e=Y(),o=Y(),i=Y(),s=Y(),r=Y(),u=Y();let c=x(t,"brightness",8,0),g=x(t,"shadows",8,0),v=x(t,"contrast",8,0),b=x(t,"hdr",8,0),h=x(t,"blurBrushSize",8,50),m=x(t,"blurStrength",8,50),_=x(t,"blurSoften",8,50),I=x(t,"blurInvert",8,!1),l=x(t,"zoomLevel",8,1),d=x(t,"blurEnabled",8,!1),z=x(t,"onBrightnessChange",8,N=>{}),R=x(t,"onShadowsChange",8,N=>{}),A=x(t,"onContrastChange",8,N=>{}),W=x(t,"onHdrChange",8,N=>{}),U=x(t,"onBlurBrushSizeChange",8,N=>{}),E=x(t,"onBlurStrengthChange",8,N=>{}),B=x(t,"onBlurSoftenChange",8,N=>{}),j=x(t,"onBlurInvertChange",8,N=>{}),F=x(t,"onZoomChange",8,N=>{}),q=x(t,"onNudge",8,N=>{}),G=x(t,"onResetZoom",8,()=>{}),ie=x(t,"onBlurToggle",8,N=>{}),D=x(t,"onBrushPreviewChange",8,N=>{}),V=x(t,"onEditEnd",8,()=>{}),O=Y("brightness"),K=Y(d()),ae=Y("brushSize");const re=[{id:"brightness",label:"Brightness"},{id:"shadows",label:"Shadows"},{id:"contrast",label:"Contrast"},{id:"hdr",label:"HDR"}],ce=[{id:"brushSize",label:"Brush size"},{id:"strength",label:"Strength"},{id:"soften",label:"Soften edges"}];function ne(N){switch(a(O)){case"brightness":z()(N);break;case"shadows":R()(N);break;case"contrast":A()(N);break;case"hdr":W()(N);break}}function le(){ne(0)}function ve(N){switch(a(ae)){case"brushSize":U()(N);break;case"strength":E()(N);break;case"soften":B()(N);break}}function Ae(){ve(50)}function me(){const N=!d();ie()(N),y(K,N)}function Be(){d()&&y(K,!a(K))}function Ie(){j()(!I())}function Xe(N){y(O,N),y(K,!1)}function Ne(N){y(ae,N)}function Te(){V()()}function De(){a(ae)==="brushSize"&&D()(!0)}function Ze(){D()(!1),V()()}ze(()=>(a(O),Me(c()),Me(g()),Me(v()),Me(b())),()=>{y(e,(()=>{switch(a(O)){case"brightness":return c();case"shadows":return g();case"contrast":return v();case"hdr":return b();default:return 0}})())}),ze(()=>a(O),()=>{y(o,a(O)==="hdr"?0:-100)}),ze(()=>{},()=>{y(i,100)}),ze(()=>(a(ae),Me(h()),Me(m()),Me(_())),()=>{y(s,(()=>{switch(a(ae)){case"brushSize":return h();case"strength":return m();case"soften":return _();default:return 50}})())}),ze(()=>{},()=>{y(r,1)}),ze(()=>{},()=>{y(u,100)}),It(),Re();var Oe=Wn(),ue=k(Oe);bt(ue,5,()=>re,mt,(N,$)=>{var fe=Fn();let se;var f=k(fe,!0);w(fe),te(()=>{se=Pe(fe,1,"enhancement-btn svelte-1e1k0ax",null,se,{active:a(O)===a($).id}),he(f,(a($),H(()=>a($).label)))}),C("click",fe,()=>Xe(a($).id)),P(N,fe)}),w(ue);var Ee=p(ue,2),Ue=k(Ee),ot=k(Ue);ct(ot,{get min(){return a(o)},get max(){return a(i)},get value(){return a(e)},step:1,onChange:ne,onInteractionEnd:Te}),w(Ue);var dt=p(Ue,2);w(Ee);var Ge=p(Ee,2),Qe=k(Ge),Fe=k(Qe),Ke=k(Fe);let st;w(Fe);var We=p(Fe,4);let S;w(Qe);var Z=p(Qe,2);{var L=N=>{var $=Nn(),fe=k($),se=k(fe);bt(se,1,()=>ce,mt,(wt,it)=>{var tt=On();let Et;var Ea=k(tt,!0);w(tt),te(()=>{Et=Pe(tt,1,"blur-control-btn svelte-1e1k0ax",null,Et,{active:a(ae)===a(it).id}),he(Ea,(a(it),H(()=>a(it).label)))}),C("click",tt,()=>Ne(a(it).id)),P(wt,tt)});var f=p(se,2),M=k(f);zt(M),ft(2),w(f),w(fe);var X=p(fe,2),oe=k(X),J=k(oe);ct(J,{get min(){return a(r)},get max(){return a(u)},get value(){return a(s)},step:1,onChange:ve,onInteractionStart:De,onInteractionEnd:Ze}),w(oe);var de=p(oe,2);w(X);var ge=p(X,2),xe=p(k(ge),2),_e=k(xe),pe=k(_e);ct(pe,{min:1,max:3,step:.1,get value(){return l()},get onChange(){return F()}}),w(_e);var vt=p(_e,2);w(xe),w(ge);var qe=p(ge,2),Rt=k(qe),$e=p(Rt,2),et=p($e,2),pt=p(et,2);w(qe),w($),te(()=>sn(M,I())),C("change",M,Ie),C("click",de,Ae),C("click",vt,function(...wt){G()?.apply(this,wt)}),C("click",Rt,()=>q()("up")),C("click",$e,()=>q()("down")),C("click",et,()=>q()("left")),C("click",pt,()=>q()("right")),P(N,$)};Q(Z,N=>{a(K)&&d()&&N(L)})}w(Ge),w(Oe),te(()=>{Fe.disabled=!d(),we(Fe,"aria-label",a(K)?"Collapse":"Expand"),we(Ke,"src",`/icons/${a(K)?"icon-collapse":"icon-expand"}.svg`),st=Pe(Ke,1,"chevron-icon svelte-1e1k0ax",null,st,{disabled:!d()}),S=Pe(We,1,"toggle-switch svelte-1e1k0ax",null,S,{active:d()}),we(We,"aria-label",d()?"Disable blur":"Enable blur")}),C("click",dt,le),C("click",Fe,Be),C("click",We,me),P(n,Oe),Se()}var jn=T('<button><div class="filter-preview svelte-183y0dt"></div> <span> </span></button>'),Yn=T('<div class="filter-grid svelte-183y0dt"></div>');function Xn(n,t){ye(t,!1);let e=x(t,"filters",24,()=>[]),o=x(t,"value",8,"original"),i=x(t,"imageUrl",8,""),s=x(t,"onChange",8,u=>{});Re();var r=Yn();bt(r,5,e,mt,(u,c)=>{var g=jn();let v;var b=k(g),h=p(b,2);let m;var _=k(h,!0);w(h),w(g),te(()=>{v=Pe(g,1,"filter-card svelte-183y0dt",null,v,{active:o()===a(c).id}),Le(b,`
					background-image: url(${i()??""});
					filter: ${a(c),H(()=>a(c).css||"none")??""};
				`),m=Pe(h,1,"filter-label svelte-183y0dt",null,m,{active:o()===a(c).id}),he(_,(a(c),H(()=>a(c).label)))}),C("click",g,()=>s()(a(c).id)),P(u,g)}),w(r),P(n,r),Se()}var Gn=T('<div class="filter-controls svelte-1274k9v"><!> <div><div class="slider-track svelte-1274k9v"><!></div> <button class="reset-btn svelte-1274k9v" aria-label="Reset filter"><img src="/icons/icon-reset.svg" alt="" class="reset-icon svelte-1274k9v"/></button></div></div>');function Vn(n,t){ye(t,!1);const e=Y();let o=x(t,"imageUrl",8,""),i=x(t,"activeFilter",8,"original"),s=x(t,"filterStrength",8,50),r=x(t,"onFilterChange",8,d=>{}),u=x(t,"onStrengthChange",8,d=>{}),c=x(t,"onReset",8,()=>{});const g=[{id:"original",label:"Original",css:"none"},{id:"greyscale",label:"Greyscale",css:"grayscale(100%)"},{id:"sepia",label:"Sepia",css:"sepia(100%)"},{id:"sunset",label:"Sunset",css:"sepia(30%) saturate(140%) brightness(110%) hue-rotate(-10deg)"},{id:"azure",label:"Azure",css:"saturate(120%) brightness(105%) hue-rotate(180deg)"},{id:"teal",label:"Teal",css:"saturate(130%) hue-rotate(140deg)"}];ze(()=>Me(i()),()=>{y(e,i()==="original")}),It();var v=Gn(),b=k(v);Xn(b,{get filters(){return g},get value(){return i()},get imageUrl(){return o()},get onChange(){return r()}});var h=p(b,2);let m;var _=k(h),I=k(_);{let d=Je(()=>a(e)?()=>{}:u());ct(I,{label:"Strength",min:0,max:100,get value(){return s()},get onChange(){return a(d)}})}w(_);var l=p(_,2);w(h),w(v),te(()=>m=Pe(h,1,"slider-row svelte-1274k9v",null,m,{disabled:a(e)})),C("click",l,function(...d){c()?.apply(this,d)}),P(n,v),Se()}const ua=[{id:"original",label:"Original",css:"none"},{id:"greyscale",label:"Greyscale",css:"grayscale(100%)"},{id:"sepia",label:"Sepia",css:"sepia(100%)"},{id:"sunset",label:"Sunset",css:"sepia(30%) saturate(140%) brightness(110%) hue-rotate(-10deg)"},{id:"azure",label:"Azure",css:"saturate(120%) brightness(105%) hue-rotate(180deg)"},{id:"teal",label:"Teal",css:"saturate(130%) hue-rotate(140deg)"}];function Jn(n){const t=[n];let e=0,o=0;const i=nt({canUndo:!1,canRedo:!1}),{subscribe:s,set:r,update:u}=nt(n);function c(){i.set({canUndo:e>o,canRedo:e<t.length-1})}return{subscribe:s,undoState:i,set:g=>{t.splice(e+1),t.push(g),e=t.length-1,r(g),c()},update:g=>{u(v=>{const b=g(v);return t.splice(e+1),t.push(b),e=t.length-1,c(),b})},silentUpdate:g=>{u(g)},setBaseState:()=>{o=e,c()},undo:()=>{e>o&&(e--,r(t[e]),c())},redo:()=>{e<t.length-1&&(e++,r(t[e]),c())},canUndo:()=>e>o,canRedo:()=>e<t.length-1,reset:()=>{t.length=0,t.push(n),e=0,o=0,r(n),c()}}}const Zn={originalImage:null,currentImage:null,aspectRatio:"custom",width:0,height:0,ratioLocked:!1,scale:1,offsetX:0,offsetY:0,brightness:0,contrast:0,shadows:0,hdr:0,activeFilter:"original",filterStrength:50,cropBox:{x:0,y:0,width:0,height:0},isCropping:!1,cropPending:!1,imageWidth:0,imageHeight:0,blurEnabled:!1,blurBrushSize:50,blurStrength:50,blurSoften:50,blurInvert:!1,blurMask:null,showBrushPreview:!1,zoomLevel:1,zoomOffsetX:0,zoomOffsetY:0},ee=Jn(Zn),yt=nt("none"),Qn=Jt(ee,n=>n.currentImage!==null);function Kn(){ee.reset(),yt.set("none")}var $n=T('<div class="controls-panel svelte-c9tnuw"><!></div>'),eo=T('<div class="controls-panel svelte-c9tnuw"><!></div>'),to=T("<!> <!> <!> <!>",1),ao=T('<div class="crop-tab svelte-c9tnuw"><!> <!> <!></div>');function no(n,t){ye(t,!1);const e=()=>He(ee,"$cropState",r),o=()=>He(yt,"$activeSubMenu",r),i=()=>He(Qn,"$hasImage",r),s=()=>He(b,"$undoState",r),[r,u]=gt(),c=Y(),g=Y(),v=Y(),b=ee.undoState,h=[{id:"crop",label:"Crop"},{id:"edit",label:"Edit"},{id:"filter",label:"Filter"}];let m=Y(null),_=null;async function I(f){const M=await Pt(f);ee.set({...e(),originalImage:f,currentImage:f,imageWidth:M.width,imageHeight:M.height,width:M.width,height:M.height,cropBox:{x:0,y:0,width:100,height:100},isCropping:!0,cropPending:!1,aspectRatio:"custom",ratioLocked:!1}),ee.setBaseState(),yt.set("crop")}function l(f){if(e().cropPending&&o()==="crop"&&f!=="crop"){_=()=>{yt.set(f),ee.silentUpdate(M=>({...M,isCropping:!1}))},y(m,"save");return}f==="crop"?ee.silentUpdate(M=>({...M,isCropping:!0})):ee.silentUpdate(M=>({...M,isCropping:!1})),yt.set(o()===f?"none":f)}async function d(){return await gn(e().currentImage,a(v),e().blurMask)}async function z(){if(e().cropPending){_=async()=>{const f=await d();await Nt(f)},y(m,"save");return}if(e().currentImage){const f=await d();await Nt(f)}}async function R(){if(e().cropPending){_=async()=>{const f=await d();Wt(f,"picflam-export.png")},y(m,"save");return}if(e().currentImage){const f=await d();Wt(f,"picflam-export.png")}}function A(){y(m,"startAgain")}function W(){ee.undo()}function U(){ee.redo()}async function E(){y(m,null),await q(),_&&(await _(),_=null)}function B(){y(m,null),_=null}function j(){y(m,null),Kn()}function F(){y(m,null)}async function q(){const f=e();if(!f.currentImage||!f.cropPending)return;const M=await ka(f.currentImage,f.cropBox,f.imageWidth,f.imageHeight),X=await Pt(M);ee.set({...f,currentImage:M,imageWidth:X.width,imageHeight:X.height,width:X.width,height:X.height,cropBox:{x:0,y:0,width:100,height:100},cropPending:!1})}function G(f){if(f==="custom"){ee.silentUpdate(de=>({...de,aspectRatio:"custom",cropBox:{x:0,y:0,width:100,height:100},ratioLocked:!1,cropPending:!1}));return}const X={"9:16":9/16,"1:1":1,"16:9":16/9}[f],oe=e().imageWidth/e().imageHeight;let J;if(f==="9:16"){const ge=X/oe*100;if(ge<=100)J={x:(100-ge)/2,y:0,width:ge,height:100};else{const xe=oe/X*100;J={x:0,y:(100-xe)/2,width:100,height:xe}}}else if(f==="16:9"){const ge=oe/X*100;if(ge<=100)J={x:0,y:(100-ge)/2,width:100,height:ge};else{const xe=X/oe*100;J={x:(100-xe)/2,y:0,width:xe,height:100}}}else if(f==="1:1")if(oe>1){const de=100/oe;J={x:(100-de)/2,y:0,width:de,height:100}}else{const de=100*oe;J={x:0,y:(100-de)/2,width:100,height:de}}ee.silentUpdate(de=>({...de,aspectRatio:f,cropBox:J,cropPending:!0,isCropping:!0,ratioLocked:!0}))}function ie({width:f,height:M}){const X=e().imageWidth,oe=e().imageHeight,J=Math.min(Math.max(1,f),X),de=Math.min(Math.max(1,M),oe),ge=J/X*100,xe=de/oe*100;let _e;if(e().ratioLocked){const pe=a(c)/a(g);if(f!==a(c)){const qe=J/pe/oe*100;_e={x:(100-ge)/2,y:(100-Math.min(100,qe))/2,width:ge,height:Math.min(100,qe)}}else{const qe=de*pe/X*100;_e={x:(100-Math.min(100,qe))/2,y:(100-xe)/2,width:Math.min(100,qe),height:xe}}}else _e={x:(100-ge)/2,y:(100-xe)/2,width:ge,height:xe};ee.silentUpdate(pe=>({...pe,cropBox:_e,cropPending:!0}))}function D(){ee.silentUpdate(f=>({...f,ratioLocked:!f.ratioLocked}))}async function V(){const f=await vn(e().currentImage);ee.set({...e(),currentImage:f})}async function O(){const f=await dn(e().currentImage,90),M=await Pt(f);ee.set({...e(),currentImage:f,imageWidth:M.width,imageHeight:M.height,cropBox:{x:0,y:0,width:100,height:100},cropPending:!1})}function K(f){ee.silentUpdate(M=>({...M,scale:f/100}))}function ae(f){const M=f.detail.cropBox;if(e().ratioLocked&&e().aspectRatio!=="custom"){const oe={"9:16":.5625,"1:1":1,"16:9":1.7777777777777777}[e().aspectRatio];e().imageWidth/e().imageHeight;const J=M.width*e().imageWidth/(M.height*e().imageHeight);if(Math.abs(J-oe)>.01){const xe=M.width/100*e().imageWidth/oe/e().imageHeight*100;M.height=Math.min(100,xe),M.y+M.height>100&&(M.y=100-M.height)}}ee.silentUpdate(X=>({...X,cropBox:M,cropPending:!0}))}function re(){q()}let ce=null;function ne(){ce===null&&(ce={...e()})}function le(){ce!==null&&(ee.set(e()),ce=null)}function ve(f){ne(),ee.silentUpdate(M=>({...M,brightness:f}))}function Ae(f){ne(),ee.silentUpdate(M=>({...M,shadows:f}))}function me(f){ne(),ee.silentUpdate(M=>({...M,contrast:f}))}function Be(f){ne(),ee.silentUpdate(M=>({...M,hdr:f}))}function Ie(f){ee.set({...e(),blurEnabled:f})}function Xe(f){ne(),ee.silentUpdate(M=>({...M,blurBrushSize:f}))}function Ne(f){ne(),ee.silentUpdate(M=>({...M,blurStrength:f}))}function Te(f){ne(),ee.silentUpdate(M=>({...M,blurSoften:f}))}function De(f){ee.set({...e(),blurInvert:f})}function Ze(f){ee.silentUpdate(M=>({...M,showBrushPreview:f}))}function Oe(){le()}let ue=null,Ee=[],Ue=null;function ot(f){const M=f.detail.point;Ue===null&&(Ue=e().blurMask?[...e().blurMask]:[]),Ee.push(M),ee.silentUpdate(X=>({...X,blurMask:[...X.blurMask||[],M]})),ue&&clearTimeout(ue),ue=setTimeout(()=>{if(Ee.length>0){const X=[...Ue,...Ee];ee.set({...e(),blurMask:X}),Ee=[],Ue=null}ue=null},300)}function dt(f){ee.silentUpdate(M=>({...M,zoomLevel:f}))}function Ge(f){ee.silentUpdate(X=>{let{zoomOffsetX:oe,zoomOffsetY:J}=X;switch(f){case"up":J-=20;break;case"down":J+=20;break;case"left":oe-=20;break;case"right":oe+=20;break}return{...X,zoomOffsetX:oe,zoomOffsetY:J}})}function Qe(){ee.silentUpdate(f=>({...f,zoomLevel:1,zoomOffsetX:0,zoomOffsetY:0}))}function Fe(f){ee.silentUpdate(M=>({...M,activeFilter:f}))}function Ke(f){ne(),ee.silentUpdate(M=>({...M,filterStrength:f}))}function st(){ee.set({...e(),activeFilter:"original",filterStrength:50})}ze(()=>e(),()=>{y(c,Math.round(e().imageWidth*e().cropBox.width/100))}),ze(()=>e(),()=>{y(g,Math.round(e().imageHeight*e().cropBox.height/100))}),ze(()=>(e(),ua),()=>{y(v,(()=>{let f=[];if(e().brightness!==0&&f.push(`brightness(${1+e().brightness/100})`),e().contrast!==0&&f.push(`contrast(${1+e().contrast/100})`),e().shadows!==0){const M=1+e().shadows/200;f.push(`brightness(${M})`)}if(e().hdr!==0){const M=1+e().hdr/100*.3,X=1+e().hdr/100*.2;f.push(`saturate(${M}) contrast(${X})`)}if(e().activeFilter!=="original"){const M=ua.find(X=>X.id===e().activeFilter);if(M&&M.css!=="none"){const X=e().filterStrength/100,oe=M.css.replace(/(\d+)%/g,(J,de)=>`${Math.round(parseInt(de)*X)}%`);f.push(oe)}}return f.length>0?f.join(" "):"none"})())}),It(),Re();var We=ao(),S=k(We);{var Z=f=>{Ca(f,{title:"Crop, edit and add filters to photos",hint:"Import, drag or paste an image",onImageImport:I})},L=f=>{var M=to(),X=Ce(M);Qt(X,{get canUndo(){return s(),H(()=>s().canUndo)},get canRedo(){return s(),H(()=>s().canRedo)},onUndo:W,onRedo:U,onStartAgain:A,onCopy:z,onExport:R});var oe=p(X,2);{let _e=Je(()=>(o(),e(),H(()=>o()==="edit"?e().zoomLevel:e().scale))),pe=Je(()=>(o(),e(),H(()=>o()==="edit"?e().zoomOffsetX:e().offsetX))),vt=Je(()=>(o(),e(),H(()=>o()==="edit"?e().zoomOffsetY:e().offsetY))),qe=Je(()=>(e(),H(()=>e().blurMask||[])));yn(oe,{get imageSrc(){return e(),H(()=>e().currentImage)},get cropBox(){return e(),H(()=>e().cropBox)},get isCropping(){return e(),H(()=>e().isCropping)},get scale(){return a(_e)},get offsetX(){return a(pe)},get offsetY(){return a(vt)},get imageWidth(){return e(),H(()=>e().imageWidth)},get imageHeight(){return e(),H(()=>e().imageHeight)},get editFilters(){return a(v)},get blurEnabled(){return e(),H(()=>e().blurEnabled)},get blurBrushSize(){return e(),H(()=>e().blurBrushSize)},get blurStrength(){return e(),H(()=>e().blurStrength)},get blurSoften(){return e(),H(()=>e().blurSoften)},get blurInvert(){return e(),H(()=>e().blurInvert)},get blurMask(){return a(qe)},get showBrushPreview(){return e(),H(()=>e().showBrushPreview)},$$events:{cropChange:ae,blurPaint:ot}})}var J=p(oe,2);Kt(J,{get tabs(){return h},get activeTab(){return o()},onTabChange:l});var de=p(J,2);{var ge=_e=>{{let pe=Je(()=>(e(),H(()=>Math.round(e().scale*100))));Hn(_e,{get aspectRatio(){return e(),H(()=>e().aspectRatio)},get cropWidth(){return a(c)},get cropHeight(){return a(g)},get ratioLocked(){return e(),H(()=>e().ratioLocked)},get scale(){return a(pe)},get cropPending(){return e(),H(()=>e().cropPending)},onRatioChange:G,onDimensionsChange:ie,onLockToggle:D,onFlip:V,onRotate:O,onScaleChange:K,onApply:re})}},xe=_e=>{var pe=Ve(),vt=Ce(pe);{var qe=$e=>{var et=$n(),pt=k(et);qn(pt,{get brightness(){return e(),H(()=>e().brightness)},get shadows(){return e(),H(()=>e().shadows)},get contrast(){return e(),H(()=>e().contrast)},get hdr(){return e(),H(()=>e().hdr)},get blurEnabled(){return e(),H(()=>e().blurEnabled)},get blurBrushSize(){return e(),H(()=>e().blurBrushSize)},get blurStrength(){return e(),H(()=>e().blurStrength)},get blurSoften(){return e(),H(()=>e().blurSoften)},get blurInvert(){return e(),H(()=>e().blurInvert)},get zoomLevel(){return e(),H(()=>e().zoomLevel)},onBrightnessChange:ve,onShadowsChange:Ae,onContrastChange:me,onHdrChange:Be,onBlurToggle:Ie,onBlurBrushSizeChange:Xe,onBlurStrengthChange:Ne,onBlurSoftenChange:Te,onBlurInvertChange:De,onZoomChange:dt,onNudge:Ge,onResetZoom:Qe,onBrushPreviewChange:Ze,onEditEnd:Oe}),w(et),P($e,et)},Rt=$e=>{var et=Ve(),pt=Ce(et);{var wt=it=>{var tt=eo(),Et=k(tt);Vn(Et,{get imageUrl(){return e(),H(()=>e().currentImage)},get activeFilter(){return e(),H(()=>e().activeFilter)},get filterStrength(){return e(),H(()=>e().filterStrength)},onFilterChange:Fe,onStrengthChange:Ke,onReset:st}),w(tt),P(it,tt)};Q(pt,it=>{o()==="filter"&&it(wt)},!0)}P($e,et)};Q(vt,$e=>{o()==="edit"?$e(qe):$e(Rt,!1)},!0)}P(_e,pe)};Q(de,_e=>{o()==="crop"?_e(ge):_e(xe,!1)})}P(f,M)};Q(S,f=>{i()?f(L,!1):f(Z)})}var N=p(S,2);{var $=f=>{qt(f,{message:"Save changes?",confirmText:"Yes",cancelText:"Cancel",onConfirm:E,onCancel:B})};Q(N,f=>{a(m)==="save"&&f($)})}var fe=p(N,2);{var se=f=>{qt(f,{message:"Start again? Your changes will be lost.",confirmText:"Yes",cancelText:"Cancel",onConfirm:j,onCancel:F})};Q(fe,f=>{a(m)==="startAgain"&&f(se)})}w(We),P(n,We),Se(),u()}const da={originalImage:null,currentImage:null,processedImage:null,isProcessing:!1,processingType:null,upscaleFactor:1,showComparison:!1,comparisonPosition:50};function oo(){const{subscribe:n,set:t,update:e}=nt(da);return{subscribe:n,setImage:o=>e(i=>({...i,originalImage:o,currentImage:o,processedImage:null})),startProcessing:o=>e(i=>({...i,isProcessing:!0,processingType:o})),finishProcessing:o=>e(i=>({...i,isProcessing:!1,processingType:null,processedImage:o,currentImage:o,showComparison:!0})),cancelProcessing:()=>e(o=>({...o,isProcessing:!1,processingType:null})),setUpscaleFactor:o=>e(i=>({...i,upscaleFactor:o})),setComparisonPosition:o=>e(i=>({...i,comparisonPosition:o})),reset:()=>t(da)}}const be=oo(),va=nt("enhance"),so=Jt(be,n=>n.currentImage!==null);let _t=null,kt=null;const ga="https://huggingface.co/bukuroo/RealESRGAN-ONNX/resolve/main/real-esrgan-x4plus-128.onnx",ke=128,ht=16;async function io(n,t=4,e){e?.("Uploading image...");const o=await fetch("/api/upscale",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({image:n,scale:t})}),i=await o.json();if(!o.ok)throw new Error(i.error||`API error: ${o.status}`);if(i.status==="succeeded"&&i.output)return e?.("Downloading result..."),await ya(i.output);if(i.status==="processing"||i.status==="starting")return e?.("Processing in cloud..."),await ro(i.pollUrl,e);throw new Error("Unexpected response")}async function ro(n,t,e=60){for(let o=0;o<e;o++){await new Promise(r=>setTimeout(r,2e3));const i=await fetch(`/api/upscale?pollUrl=${encodeURIComponent(n)}`),s=await i.json();if(!i.ok)throw new Error(s.error||`Polling error: ${i.status}`);if(s.status==="succeeded"&&s.output)return t?.("Downloading result..."),await ya(s.output);if(s.status==="failed")throw new Error(s.error||"Upscaling failed");t?.(`Processing in cloud (${(o+1)*2}s)...`)}throw new Error("Timeout waiting for result")}async function ya(n){const e=await(await fetch(n)).blob();return new Promise((o,i)=>{const s=new FileReader;s.onload=()=>o(s.result),s.onerror=i,s.readAsDataURL(e)})}async function Sa(n){if(_t)return _t;console.log("[AI] Loading Real-ESRGAN model via ONNX Runtime..."),n?.("Downloading Real-ESRGAN model (first time only)...");const t=await Gt(()=>import("../chunks/D5dzwtdw.js"),[],import.meta.url);t.env.wasm.numThreads=navigator.hardwareConcurrency||4;try{_t=await t.InferenceSession.create(ga,{executionProviders:["webgpu","wasm"],graphOptimizationLevel:"all"}),console.log("[AI] Real-ESRGAN model ready")}catch(e){console.log("[AI] WebGPU failed, trying WASM only...",e.message),_t=await t.InferenceSession.create(ga,{executionProviders:["wasm"],graphOptimizationLevel:"all"}),console.log("[AI] Real-ESRGAN model ready (WASM)")}return _t}async function lo(n){if(kt)return kt;console.log("[AI] Loading RMBG background removal model..."),n?.("Downloading model (first time only)...");const{pipeline:t,env:e}=await Gt(async()=>{const{pipeline:o,env:i}=await import("../chunks/bLAnV4ll.js");return{pipeline:o,env:i}},[],import.meta.url);e.allowLocalModels=!1;try{kt=await t("image-segmentation","briaai/RMBG-1.4",{device:"webgpu",dtype:"fp32"}),console.log("[AI] RMBG model ready (WebGPU)")}catch(o){console.log("[AI] WebGPU not available, falling back to WASM...",o.message),kt=await t("image-segmentation","briaai/RMBG-1.4",{dtype:"q8"}),console.log("[AI] RMBG model ready (WASM)")}return kt}async function co(n,t=1){const e=new Float32Array(n),o=(n-1)/2;let i=0;for(let s=0;s<n;s++){const r=s-o,u=-.5*Math.pow(r/(t*o),2),c=Math.exp(u);e[s]=c,i+=c}for(let s=0;s<n;s++)e[s]/=i/(n/4);return e}async function Ia(n,t,e,o,i){const s=await Gt(()=>import("../chunks/D5dzwtdw.js"),[],import.meta.url),r=e*4,u=o*4,c=new Float32Array(r*u*3),g=new Float32Array(r*u),v=Math.ceil((e-ht)/(ke-ht)),b=Math.ceil((o-ht)/(ke-ht)),h=v*b;let m=0;console.log(`[AI] Processing ${h} tiles (${v}x${b}) with Gaussian blending...`);const _=await co(ke*4,.4);for(let l=0;l<b;l++)for(let d=0;d<v;d++){const z=Math.min(d*(ke-ht),Math.max(0,e-ke)),R=Math.min(l*(ke-ht),Math.max(0,o-ke)),A=new Float32Array(3*ke*ke);for(let D=0;D<ke;D++)for(let V=0;V<ke;V++){const O=Math.min(z+V,e-1),ae=(Math.min(R+D,o-1)*e+O)*4,re=D*ke+V;A[0*ke*ke+re]=t[ae]/255,A[1*ke*ke+re]=t[ae+1]/255,A[2*ke*ke+re]=t[ae+2]/255}const W=new s.Tensor("float32",A,[1,3,ke,ke]),E={[(n.inputNames||["input"])[0]]:W},B=await n.run(E),F=(B.output||B[Object.keys(B)[0]]).data,q=ke*4,G=z*4,ie=R*4;for(let D=0;D<q;D++)for(let V=0;V<q;V++){const O=G+V,K=ie+D;if(O>=r||K>=u)continue;const ae=_[V],re=_[D],ce=ae*re,ne=D*q+V,le=K*r+O;c[0*r*u+le]+=F[0*q*q+ne]*ce,c[1*r*u+le]+=F[1*q*q+ne]*ce,c[2*r*u+le]+=F[2*q*q+ne]*ce,g[le]+=ce}m++,i?.(`Processing tile ${m}/${h}...`)}const I=new Uint8ClampedArray(r*u*4);for(let l=0;l<r*u;l++){const d=g[l]||1;I[l*4]=Math.min(255,Math.max(0,Math.round(c[0*r*u+l]/d*255))),I[l*4+1]=Math.min(255,Math.max(0,Math.round(c[1*r*u+l]/d*255))),I[l*4+2]=Math.min(255,Math.max(0,Math.round(c[2*r*u+l]/d*255))),I[l*4+3]=255}return{data:I,width:r,height:u}}async function uo(n,t){try{console.log("[AI] Starting image enhancement with SwinIR..."),t?.("Loading SwinIR model...");const e=await Sa(t),o=await Ra(n),i=o.width,s=o.height,r=document.createElement("canvas");r.width=i,r.height=s;const u=r.getContext("2d");u.drawImage(o,0,0);const c=u.getImageData(0,0,i,s);t?.("Enhancing image...");const g=await Ia(e,c.data,i,s,t),v=document.createElement("canvas");v.width=g.width,v.height=g.height;const b=v.getContext("2d"),h=b.createImageData(g.width,g.height);return h.data.set(g.data),b.putImageData(h,0,0),console.log("[AI] Enhancement complete: "+i+"x"+s+" -> "+g.width+"x"+g.height),v.toDataURL("image/png")}catch(e){throw console.error("[AI] Enhancement failed:",e),new Error("Image enhancement failed: "+e.message)}}async function vo(n,t=2,e){try{console.log(`[AI] Starting image upscaling with SwinIR (scale: ${t}x)...`),e?.("Loading SwinIR model...");const o=await Sa(e),i=await Ra(n),s=i.width,r=i.height,u=document.createElement("canvas");u.width=s,u.height=r;const c=u.getContext("2d");c.drawImage(i,0,0);const g=c.getImageData(0,0,s,r);e?.("Upscaling image...");const v=await Ia(o,g.data,s,r,e);if(Math.abs(t-4)<.01){const b=document.createElement("canvas");b.width=v.width,b.height=v.height;const h=b.getContext("2d"),m=h.createImageData(v.width,v.height);return m.data.set(v.data),h.putImageData(m,0,0),console.log(`[AI] SwinIR upscaling complete: ${s}x${r} -> ${v.width}x${v.height}`),b.toDataURL("image/png")}else{const b=Math.round(s*t),h=Math.round(r*t),m=document.createElement("canvas");m.width=v.width,m.height=v.height;const _=m.getContext("2d"),I=_.createImageData(v.width,v.height);I.data.set(v.data),_.putImageData(I,0,0);const l=document.createElement("canvas");return l.width=b,l.height=h,l.getContext("2d").drawImage(m,0,0,b,h),console.log(`[AI] SwinIR upscaling complete: ${s}x${r} -> ${b}x${h}`),l.toDataURL("image/png")}}catch(o){throw console.error("[AI] Upscaling failed:",o),new Error("Image upscaling failed: "+o.message)}}async function go(n,t){try{console.log("[AI] Starting background removal...");const e=await lo(t);t?.("Processing image...");const o=await e(n);if(console.log("[AI] Segmentation result:",o),!o||o.length===0)throw new Error("No segmentation result returned");const i=o[0];if(console.log("[AI] Segment keys:",Object.keys(i)),i.mask&&i.mask.toDataURL)return console.log("[AI] Background removal complete (RawImage mask)"),await ha(n,i.mask);if(i.mask&&i.mask.data)return console.log("[AI] Background removal complete (data mask)"),await ha(n,i.mask);if(typeof i=="string"&&i.startsWith("data:"))return console.log("[AI] Background removal complete (direct output)"),i;throw console.log("[AI] Segment structure:",JSON.stringify(i,null,2).substring(0,500)),new Error("Unexpected segmentation result format")}catch(e){throw console.error("[AI] Background removal failed:",e),new Error("Background removal failed: "+e.message)}}async function ha(n,t){return new Promise((e,o)=>{const i=new Image;i.onload=async()=>{try{const s=document.createElement("canvas");s.width=i.width,s.height=i.height;const r=s.getContext("2d");r.drawImage(i,0,0);const u=r.getImageData(0,0,s.width,s.height),c=u.data;let g,v,b;if(t.toDataURL){const m=document.createElement("canvas");m.width=t.width,m.height=t.height;const _=m.getContext("2d"),I=new Image;I.onload=()=>{_.drawImage(I,0,0);const l=_.getImageData(0,0,t.width,t.height);fa(c,l.data,s.width,s.height,t.width,t.height,!0),r.putImageData(u,0,0),e(s.toDataURL("image/png"))},I.onerror=o,I.src=t.toDataURL();return}else g=t.data,v=t.width,b=t.height;const h=g.length===v*b*4;fa(c,g,s.width,s.height,v,b,h),r.putImageData(u,0,0),e(s.toDataURL("image/png"))}catch(s){o(s)}},i.onerror=o,i.src=n})}function fa(n,t,e,o,i,s,r){const u=i/e,c=s/o;for(let g=0;g<o;g++)for(let v=0;v<e;v++){const b=Math.floor(v*u),h=Math.floor(g*c);let m;if(r){const I=(h*i+b)*4;m=t[I]}else{const I=h*i+b;m=t[I]||0}const _=(g*e+v)*4;n[_+3]=m}}function Ra(n){return new Promise((t,e)=>{const o=new Image;o.onload=()=>t(o),o.onerror=e,o.src=n})}var ho=T('<div class="before-after-container svelte-1i0ztfp" role="slider" aria-label="Before and after comparison" tabindex="0"><div class="before-image svelte-1i0ztfp"><img alt="Before" class="svelte-1i0ztfp"/></div> <div class="after-image svelte-1i0ztfp"><img alt="After" class="svelte-1i0ztfp"/></div> <div class="slider-handle svelte-1i0ztfp" role="presentation"><div class="slider-line svelte-1i0ztfp"></div> <div class="slider-thumb svelte-1i0ztfp"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" class="svelte-1i0ztfp"><path d="M10 7L6 11M10 7L6 3M10 17L6 13M10 17L6 21M14 7L18 11M14 7L18 3M14 17L18 13M14 17L18 21" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path></svg></div></div></div>');function $t(n,t){ye(t,!1);let e=x(t,"beforeImage",8,""),o=x(t,"afterImage",8,""),i=x(t,"position",12,50),s=x(t,"onChange",8,()=>{}),r=Y(),u=!1;Vt(()=>(window.addEventListener("mousemove",v),window.addEventListener("touchmove",b,{passive:!1}),window.addEventListener("mouseup",h),window.addEventListener("touchend",h),()=>{window.removeEventListener("mousemove",v),window.removeEventListener("touchmove",b),window.removeEventListener("mouseup",h),window.removeEventListener("touchend",h)}));function c(){u=!0}function g(W){W.touches.length===1&&(u=!0)}function v(W){!u||!a(r)||m(W.clientX)}function b(W){!u||!a(r)||W.touches.length!==1||(W.preventDefault(),m(W.touches[0].clientX))}function h(){u=!1}function m(W){const U=a(r).getBoundingClientRect(),E=Math.max(0,Math.min(100,(W-U.left)/U.width*100));i(E),s()(E)}function _(W){if(!a(r))return;const U=a(r).getBoundingClientRect(),E=(W.clientX-U.left)/U.width*100;i(Math.max(0,Math.min(100,E))),s()(i())}Re();var I=ho(),l=k(I),d=k(l);w(l);var z=p(l,2),R=k(z);w(z);var A=p(z,2);w(I),St(I,W=>y(r,W),()=>a(r)),te(()=>{we(d,"src",e()),Le(z,`clip-path: inset(0 ${100-i()}% 0 0)`),we(R,"src",o()),Le(A,`left: ${i()??""}%`)}),C("mousedown",A,c),C("touchstart",A,g),C("click",I,_),P(n,I),Se()}var fo=T('<button class="processing-btn svelte-5xpgkj" disabled><span class="spinner svelte-5xpgkj"></span> </button> <button class="cancel-btn svelte-5xpgkj">Cancel</button>',1),mo=T('<button class="enhance-btn svelte-5xpgkj"><img src="/icons/icon-ai.svg" alt="" class="btn-icon svelte-5xpgkj"/> Enhance image</button> <p class="hint svelte-5xpgkj">Sharpens and enhances images at the same size</p>',1),bo=T('<div class="error-message svelte-5xpgkj"> </div>'),po=T('<div class="controls-content svelte-5xpgkj"><!> <!></div>'),wo=T('<div class="comparison-content svelte-5xpgkj"><!> <button class="enhance-btn svelte-5xpgkj"><img src="/icons/icon-ai.svg" alt="" class="btn-icon svelte-5xpgkj"/> Enhance image</button> <p class="hint svelte-5xpgkj">Sharpens and enhances images at the same size</p></div>'),xo=T('<div class="enhance-controls svelte-5xpgkj"><!></div>');function _o(n,t){ye(t,!1);const e=()=>He(be,"$aiState",o),[o,i]=gt();let s=Y(!1),r=Y(""),u=Y(null),c=Y(!1),g=Y(50);async function v(){if(e().currentImage)try{y(s,!0),y(u,null),y(r,"Starting..."),be.startProcessing("enhance");const d=await uo(e().currentImage,z=>{y(r,z)});be.finishProcessing(d),y(c,!0)}catch(d){y(u,d.message||"Enhancement failed"),be.cancelProcessing()}finally{y(s,!1),y(r,"")}}function b(){y(s,!1),y(r,""),y(u,null),be.cancelProcessing()}function h(d){y(g,d),be.setComparisonPosition(d)}Re();var m=xo(),_=k(m);{var I=d=>{var z=po(),R=k(z);{var A=B=>{var j=fo(),F=Ce(j),q=p(k(F));w(F);var G=p(F,2);te(()=>he(q,` ${a(r)||"Processing..."}`)),C("click",G,b),P(B,j)},W=B=>{var j=mo(),F=Ce(j);ft(2),C("click",F,v),P(B,j)};Q(R,B=>{a(s)?B(A):B(W,!1)})}var U=p(R,2);{var E=B=>{var j=bo(),F=k(j,!0);w(j),te(()=>he(F,a(u))),P(B,j)};Q(U,B=>{a(u)&&B(E)})}w(z),P(d,z)},l=d=>{var z=wo(),R=k(z);$t(R,{get beforeImage(){return e().originalImage},get afterImage(){return e().processedImage},get position(){return a(g)},onChange:h});var A=p(R,2);ft(2),w(z),C("click",A,v),P(d,z)};Q(_,d=>{a(c)?d(l,!1):d(I)})}w(m),P(n,m),Se(),i()}var ko=T('<div class="cloud-info svelte-1rgvkgu"><span class="cloud-badge svelte-1rgvkgu">Face Enhancement ON</span></div>'),Co=T('<div class="size-display svelte-1rgvkgu"> </div>'),yo=T('<button class="processing-btn svelte-1rgvkgu" disabled><span class="spinner svelte-1rgvkgu"></span> </button> <button class="cancel-btn svelte-1rgvkgu">Cancel</button>',1),So=T('<button class="upscale-btn svelte-1rgvkgu"><img src="/icons/icon-ai.svg" alt="" class="btn-icon svelte-1rgvkgu"/> </button> <p class="hint svelte-1rgvkgu"> </p>',1),Io=T('<div class="error-message svelte-1rgvkgu"> </div>'),Ro=T('<div class="controls-content svelte-1rgvkgu"><!> <!> <!></div>'),Eo=T('<div class="comparison-content svelte-1rgvkgu"><!> <button class="upscale-btn svelte-1rgvkgu"><img src="/icons/icon-ai.svg" alt="" class="btn-icon svelte-1rgvkgu"/> </button> <p class="hint svelte-1rgvkgu"> </p></div>'),Mo=T('<div class="upscale-controls svelte-1rgvkgu"><div class="mode-toggle svelte-1rgvkgu"><button>Fast (Local)</button> <button>HQ (Cloud)</button></div> <!> <!></div>');function Po(n,t){ye(t,!1);const e=()=>He(be,"$aiState",o),[o,i]=gt(),s=4;let r=Y(!1),u=Y(""),c=Y(null),g=Y(!1),v=Y(50),b=Y(null),h=Y(!0);async function m(){try{const G=await ut(e().originalImage),ie=Math.round(G.naturalWidth*s),D=Math.round(G.naturalHeight*s);y(b,`${ie} x ${D}`)}catch(G){console.error("Failed to get image dimensions:",G)}}async function _(){if(e().currentImage)try{y(r,!0),y(c,null),y(u,"Starting..."),be.startProcessing("upscale");let G;a(h)?G=await io(e().currentImage,s,ie=>{y(u,ie)}):G=await vo(e().currentImage,s,ie=>{y(u,ie)}),be.finishProcessing(G),y(g,!0)}catch(G){y(c,G.message||"Upscaling failed"),be.cancelProcessing()}finally{y(r,!1),y(u,"")}}function I(){y(r,!1),y(u,""),y(c,null),be.cancelProcessing()}function l(G){y(v,G),be.setComparisonPosition(G)}ze(()=>e(),()=>{e().originalImage&&m()}),It(),Re();var d=Mo(),z=k(d),R=k(z);let A;var W=p(R,2);let U;w(z);var E=p(z,2);{var B=G=>{var ie=ko();P(G,ie)};Q(E,G=>{a(h)&&G(B)})}var j=p(E,2);{var F=G=>{var ie=Ro(),D=k(ie);{var V=ne=>{var le=Co(),ve=k(le);w(le),te(()=>he(ve,`Output: ${a(b)??""}`)),P(ne,le)};Q(D,ne=>{a(b)&&ne(V)})}var O=p(D,2);{var K=ne=>{var le=yo(),ve=Ce(le),Ae=p(k(ve));w(ve);var me=p(ve,2);te(()=>he(Ae,` ${a(u)||"Processing..."}`)),C("click",me,I),P(ne,le)},ae=ne=>{var le=So(),ve=Ce(le),Ae=p(k(ve));w(ve);var me=p(ve,2),Be=k(me,!0);w(me),te(()=>{he(Ae,` Upscale ${a(h)?"(Cloud)":"(Local)"}`),he(Be,a(h)?"Uses cloud API with GFPGAN face enhancement":"Upscales using local Real-ESRGAN model")}),C("click",ve,_),P(ne,le)};Q(O,ne=>{a(r)?ne(K):ne(ae,!1)})}var re=p(O,2);{var ce=ne=>{var le=Io(),ve=k(le,!0);w(le),te(()=>he(ve,a(c))),P(ne,le)};Q(re,ne=>{a(c)&&ne(ce)})}w(ie),P(G,ie)},q=G=>{var ie=Eo(),D=k(ie);$t(D,{get beforeImage(){return e(),H(()=>e().originalImage)},get afterImage(){return e(),H(()=>e().processedImage)},get position(){return a(v)},onChange:l});var V=p(D,2),O=p(k(V));w(V);var K=p(V,2),ae=k(K,!0);w(K),w(ie),te(()=>{he(O,` Upscale ${a(h)?"(Cloud)":"(Local)"}`),he(ae,a(h)?"Uses cloud API with GFPGAN face enhancement":"Upscales using local Real-ESRGAN model")}),C("click",V,_),P(G,ie)};Q(j,G=>{a(g)?G(q,!1):G(F)})}w(d),te(()=>{A=Pe(R,1,"mode-btn svelte-1rgvkgu",null,A,{active:!a(h)}),U=Pe(W,1,"mode-btn svelte-1rgvkgu",null,U,{active:a(h)})}),C("click",R,()=>y(h,!1)),C("click",W,()=>y(h,!0)),P(n,d),Se(),i()}var zo=T('<div class="drawer-overlay svelte-1ibkqf6" role="presentation"><div class="drawer svelte-1ibkqf6" role="dialog"><div class="drawer-header svelte-1ibkqf6"><button class="icon-btn svelte-1ibkqf6" title="Undo"><img src="/icons/icon-undo.svg" alt="Undo" class="svelte-1ibkqf6"/></button> <button class="icon-btn svelte-1ibkqf6" title="Redo"><img src="/icons/icon-redo.svg" alt="Redo" class="svelte-1ibkqf6"/></button> <div class="spacer svelte-1ibkqf6"></div> <button class="icon-btn svelte-1ibkqf6" title="Compare"><img src="/icons/icon-compare.svg" alt="Compare" class="svelte-1ibkqf6"/></button></div> <div class="canvas-wrapper svelte-1ibkqf6" role="presentation"><canvas class="svelte-1ibkqf6"></canvas></div> <div class="controls-section svelte-1ibkqf6"><div class="button-group svelte-1ibkqf6"><button><img src="/icons/icon-erase.svg" alt="" class="svelte-1ibkqf6"/> Erase</button> <button><img src="/icons/icon-restore.svg" alt="" class="svelte-1ibkqf6"/> Restore</button></div> <div class="control-row svelte-1ibkqf6"><label class="svelte-1ibkqf6">Brush size</label> <div class="control-item svelte-1ibkqf6"><!> <button class="reset-btn svelte-1ibkqf6" title="Reset"><img src="/icons/icon-reset.svg" alt="Reset" class="svelte-1ibkqf6"/></button></div></div> <div class="control-row svelte-1ibkqf6"><label class="svelte-1ibkqf6">Soften edges</label> <div class="control-item svelte-1ibkqf6"><!> <button class="reset-btn svelte-1ibkqf6" title="Reset"><img src="/icons/icon-reset.svg" alt="Reset" class="svelte-1ibkqf6"/></button></div></div> <div class="control-row svelte-1ibkqf6"><label class="svelte-1ibkqf6">Zoom in</label> <div class="control-item svelte-1ibkqf6"><!> <button class="reset-btn svelte-1ibkqf6" title="Reset"><img src="/icons/icon-reset.svg" alt="Reset" class="svelte-1ibkqf6"/></button></div></div> <div class="nudge-buttons svelte-1ibkqf6"><button class="nudge-btn svelte-1ibkqf6">â</button> <button class="nudge-btn svelte-1ibkqf6">â</button> <button class="nudge-btn svelte-1ibkqf6">â</button> <button class="nudge-btn svelte-1ibkqf6">â</button></div> <div class="drawer-footer svelte-1ibkqf6"><button class="btn-cancel svelte-1ibkqf6">Cancel</button> <button class="btn-done svelte-1ibkqf6">Done</button></div></div></div></div>');function Ao(n,t){ye(t,!1);let e=x(t,"image",8,""),o=x(t,"onClose",8,()=>{}),i=x(t,"onSave",8,()=>{}),s=Y(),r,u=Y(!0),c=Y(20),g=Y(50),v=Y(1),b=Y(0),h=Y(0),m=!1,_=[],I=0;Vt(async()=>{const L=await ut(e());na(s,a(s).width=L.naturalWidth),na(s,a(s).height=L.naturalHeight),r=a(s).getContext("2d"),r.drawImage(L,0,0),l()});function l(){_=_.slice(0,I+1),_.push(a(s).toDataURL()),I=_.length-1}function d(){I>0&&(I--,R())}function z(){I<_.length-1&&(I++,R())}function R(){const L=new Image;L.onload=()=>{r.clearRect(0,0,a(s).width,a(s).height),r.drawImage(L,0,0)},L.src=_[I]}function A(L){m=!0;const N=a(s).getBoundingClientRect(),$=(L.clientX-N.left)/a(v)-a(b),fe=(L.clientY-N.top)/a(v)-a(h);E($,fe)}function W(L){if(!m)return;const N=a(s).getBoundingClientRect(),$=(L.clientX-N.left)/a(v)-a(b),fe=(L.clientY-N.top)/a(v)-a(h);E($,fe)}function U(){m=!1,l()}function E(L,N){const $=r.createRadialGradient(L,N,0,L,N,a(c));a(u)?($.addColorStop(0,"rgba(0,0,0,1)"),$.addColorStop(.5,"rgba(0,0,0,0.5)"),$.addColorStop(1,"rgba(0,0,0,0)"),r.globalCompositeOperation="destination-out"):($.addColorStop(0,"rgba(255,255,255,1)"),$.addColorStop(.5,"rgba(255,255,255,0.5)"),$.addColorStop(1,"rgba(255,255,255,0)"),r.globalCompositeOperation="destination-over"),r.fillStyle=$,r.beginPath(),r.arc(L,N,a(c),0,Math.PI*2),r.fill(),r.globalCompositeOperation="source-over"}function B(){y(c,20)}function j(){y(g,50)}function F(){y(v,1),y(b,0),y(h,0)}function q(L){switch(L){case"up":y(h,a(h)-10);break;case"down":y(h,a(h)+10);break;case"left":y(b,a(b)-10);break;case"right":y(b,a(b)+10);break}}function G(){o()()}function ie(){const L=a(s).toDataURL("image/png");i()(L)}Re();var D=zo(),V=k(D),O=k(V),K=k(O),ae=p(K,2);ft(4),w(O);var re=p(O,2),ce=k(re);St(ce,L=>y(s,L),()=>a(s)),w(re);var ne=p(re,2),le=k(ne),ve=k(le);let Ae;var me=p(ve,2);let Be;w(le);var Ie=p(le,2),Xe=p(k(Ie),2),Ne=k(Xe);ct(Ne,{min:5,max:100,step:1,get value(){return a(c)},onChange:L=>y(c,L)});var Te=p(Ne,2);w(Xe),w(Ie);var De=p(Ie,2),Ze=p(k(De),2),Oe=k(Ze);ct(Oe,{min:0,max:100,step:1,get value(){return a(g)},onChange:L=>y(g,L)});var ue=p(Oe,2);w(Ze),w(De);var Ee=p(De,2),Ue=p(k(Ee),2),ot=k(Ue);ct(ot,{min:1,max:3,step:.1,get value(){return a(v)},onChange:L=>y(v,L)});var dt=p(ot,2);w(Ue),w(Ee);var Ge=p(Ee,2),Qe=k(Ge),Fe=p(Qe,2),Ke=p(Fe,2),st=p(Ke,2);w(Ge);var We=p(Ge,2),S=k(We),Z=p(S,2);w(We),w(ne),w(V),w(D),te(()=>{Le(re,`transform: scale(${a(v)??""}) translate(${a(b)??""}px, ${a(h)??""}px)`),Ae=Pe(ve,1,"mode-btn svelte-1ibkqf6",null,Ae,{active:a(u)}),Be=Pe(me,1,"mode-btn svelte-1ibkqf6",null,Be,{active:!a(u)})}),C("click",K,d),C("click",ae,z),C("mousedown",re,A),C("mousemove",re,W),C("mouseup",re,U),C("mouseleave",re,U),C("click",ve,()=>y(u,!0)),C("click",me,()=>y(u,!1)),C("click",Te,B),C("click",ue,j),C("click",dt,F),C("click",Qe,()=>q("up")),C("click",Fe,()=>q("down")),C("click",Ke,()=>q("left")),C("click",st,()=>q("right")),C("click",S,G),C("click",Z,ie),C("click",V,je(function(L){Ot.call(this,t,L)})),C("click",D,G),P(n,D),Se()}var Bo=T('<button class="processing-btn svelte-1wdmsm1" disabled><span class="spinner svelte-1wdmsm1"></span> </button> <button class="cancel-btn svelte-1wdmsm1">Cancel</button>',1),To=T('<button class="remove-btn svelte-1wdmsm1"><img src="/icons/icon-ai.svg" alt="" class="btn-icon svelte-1wdmsm1"/> Remove background</button> <p class="hint svelte-1wdmsm1">Remove image background with AI</p> <button class="erase-btn svelte-1wdmsm1" disabled><img src="/icons/icon-erase.svg" alt="" class="btn-icon svelte-1wdmsm1"/> Erase and restore</button> <p class="hint svelte-1wdmsm1">Manually clean up background</p>',1),Do=T('<div class="error-message svelte-1wdmsm1"> </div>'),Uo=T('<div class="controls-content svelte-1wdmsm1"><!> <!></div>'),Lo=T('<div class="comparison-content svelte-1wdmsm1"><!> <button class="remove-btn svelte-1wdmsm1"><img src="/icons/icon-ai.svg" alt="" class="btn-icon svelte-1wdmsm1"/> Remove background</button> <p class="hint svelte-1wdmsm1">Remove image background with AI</p> <button class="erase-btn svelte-1wdmsm1"><img src="/icons/icon-erase.svg" alt="" class="btn-icon svelte-1wdmsm1"/> Erase and restore</button> <p class="hint svelte-1wdmsm1">Manually clean up background</p></div>'),Ho=T('<div class="background-controls svelte-1wdmsm1"><!> <!></div>');function Fo(n,t){ye(t,!1);const e=()=>He(be,"$aiState",o),[o,i]=gt();let s=Y(!1),r=Y(""),u=Y(null),c=Y(!1),g=Y(50),v=Y(!1),b=Y(!1);async function h(){if(e().currentImage)try{y(s,!0),y(u,null),y(r,"Starting..."),be.startProcessing("background");const E=await go(e().currentImage,B=>{y(r,B)});be.finishProcessing(E),y(c,!0),y(b,!0)}catch(E){y(u,E.message||"Background removal failed"),be.cancelProcessing()}finally{y(s,!1),y(r,"")}}function m(){y(s,!1),y(r,""),y(u,null),be.cancelProcessing()}function _(E){y(g,E),be.setComparisonPosition(E)}function I(){y(v,!0)}function l(){y(v,!1)}Re();var d=Ho(),z=k(d);{var R=E=>{var B=Uo(),j=k(B);{var F=D=>{var V=Bo(),O=Ce(V),K=p(k(O));w(O);var ae=p(O,2);te(()=>he(K,` ${a(r)||"Processing..."}`)),C("click",ae,m),P(D,V)},q=D=>{var V=To(),O=Ce(V);ft(6),C("click",O,h),P(D,V)};Q(j,D=>{a(s)?D(F):D(q,!1)})}var G=p(j,2);{var ie=D=>{var V=Do(),O=k(V,!0);w(V),te(()=>he(O,a(u))),P(D,V)};Q(G,D=>{a(u)&&D(ie)})}w(B),P(E,B)},A=E=>{var B=Lo(),j=k(B);$t(j,{get beforeImage(){return e().originalImage},get afterImage(){return e().processedImage},get position(){return a(g)},onChange:_});var F=p(j,2),q=p(F,4);ft(2),w(B),te(()=>{F.disabled=a(s),q.disabled=!a(b)}),C("click",F,h),C("click",q,I),P(E,B)};Q(z,E=>{a(c)?E(A,!1):E(R)})}var W=p(z,2);{var U=E=>{Ao(E,{get image(){return e().processedImage},onClose:l,onSave:B=>{be.finishProcessing(B),y(v,!1)}})};Q(W,E=>{a(v)&&E(U)})}w(d),P(n,d),Se(),i()}var Oo=T('<!> <div class="image-container svelte-17agwu4"><img alt="Working image" class="working-image svelte-17agwu4"/></div> <!> <!>',1),No=T('<div class="ai-tab svelte-17agwu4"><!></div>');function Wo(n,t){ye(t,!1);const e=()=>He(be,"$aiState",s),o=()=>He(so,"$hasAiImage",s),i=()=>He(va,"$activeAiMenu",s),[s,r]=gt(),u=[{id:"enhance",label:"Enhance"},{id:"upscale",label:"Upscale"},{id:"background",label:"Remove background"}];function c(l){be.setImage(l)}function g(l){va.set(l)}async function v(){e().currentImage&&await Nt(e().currentImage)}function b(){e().currentImage&&Wt(e().currentImage,"picflam-ai.png")}Re();var h=No(),m=k(h);{var _=l=>{Ca(l,{title:"Enhance, upscale and remove backgrounds using AI power",hint:"Import, drag or paste an image",onImageImport:c})},I=l=>{var d=Oo(),z=Ce(d);Qt(z,{canUndo:!1,canRedo:!1,onUndo:()=>{},onRedo:()=>{},onStartAgain:()=>be.reset(),onCopy:v,onExport:b});var R=p(z,2),A=k(R);w(R);var W=p(R,2);Kt(W,{get tabs(){return u},get activeTab(){return i()},onTabChange:g});var U=p(W,2);{var E=j=>{_o(j,{})},B=j=>{var F=Ve(),q=Ce(F);{var G=D=>{Po(D,{})},ie=D=>{var V=Ve(),O=Ce(V);{var K=ae=>{Fo(ae,{})};Q(O,ae=>{i()==="background"&&ae(K)},!0)}P(D,V)};Q(q,D=>{i()==="upscale"?D(G):D(ie,!1)},!0)}P(j,F)};Q(U,j=>{i()==="enhance"?j(E):j(B,!1)})}te(()=>we(A,"src",e().currentImage)),P(l,d)};Q(m,l=>{o()?l(I,!1):l(_)})}w(h),P(n,h),Se(),r()}const qo={canvasSize:"1/1",background:{type:"solid",value:"#FFFFFF"},text1:"",text1Font:"Inter",text1Size:5,text1YPosition:3,text1LineSpacing:5,text1Color:"#000000",text1HighlightColor:"transparent",text1IsBold:!0,text1Align:"center",text1QuoteStyle:"none",text1QuoteSize:5,text2:"",text2Font:"Inter",text2Size:3,text2YPosition:8,text2LineSpacing:5,text2Color:"#000000",text2LabelColor:"transparent",text2IsBold:!1,text2Align:"center",overlay:null,overlayScale:1,overlayOpacity:1,overlayX:0,overlayY:0,overlayMask:"none",overlayWrap:!1,overlayBorderWidth:0,overlayBorderColor:"#FFFFFF"};function jo(n){const t=[JSON.parse(JSON.stringify(n))];let e=0;const{subscribe:o,set:i,update:s}=nt(n);return{subscribe:o,set:r=>{t.splice(e+1),t.push(JSON.parse(JSON.stringify(r))),e=t.length-1,i(r)},update:r=>{s(u=>{const c=r(u);return t.splice(e+1),t.push(JSON.parse(JSON.stringify(c))),e=t.length-1,c})},undo:()=>e>0?(e--,i(JSON.parse(JSON.stringify(t[e]))),!0):!1,redo:()=>e<t.length-1?(e++,i(JSON.parse(JSON.stringify(t[e]))),!0):!1,canUndo:()=>e>0,canRedo:()=>e<t.length-1,reset:()=>{const r=JSON.parse(JSON.stringify(n));t.length=0,t.push(r),e=0,i(r)}}}const lt=jo(qo),jt=nt(!0),Yt=nt("none");Jt(lt,n=>n.text1||n.text2||n.overlay||n.background.value!=="#FFFFFF");function Yo(){lt.reset(),jt.set(!0),Yt.set("none")}var Xo=T('<button class="template-card svelte-fxk5n4"><div class="template-placeholder svelte-fxk5n4"> </div></button>'),Go=T('<div class="template-picker svelte-fxk5n4"><p class="picker-title svelte-fxk5n4">Create quotes and cards. Start with a template or blank canvas</p> <button class="blank-canvas-btn svelte-fxk5n4"><img src="/icons/icon-add.svg" alt="" class="add-icon svelte-fxk5n4"/></button> <div class="template-grid svelte-fxk5n4"></div></div>'),Vo=T('<p class="placeholder svelte-fxk5n4">Size controls coming in Phase 5</p>'),Jo=T('<p class="placeholder svelte-fxk5n4">Background controls coming in Phase 5</p>'),Zo=T('<p class="placeholder svelte-fxk5n4">Text 1 controls coming in Phase 5</p>'),Qo=T('<p class="placeholder svelte-fxk5n4">Text 2 controls coming in Phase 5</p>'),Ko=T('<p class="placeholder svelte-fxk5n4">Quote controls coming in Phase 5</p>'),$o=T('<p class="placeholder svelte-fxk5n4">Overlay controls coming in Phase 5</p>'),es=T('<!> <div class="canvas-container svelte-fxk5n4"><div class="design-canvas svelte-fxk5n4"></div></div> <!> <div class="controls-panel svelte-fxk5n4"><!></div>',1),ts=T('<div class="design-tab svelte-fxk5n4"><!></div>');function as(n,t){ye(t,!1);const e=()=>He(Yt,"$activeDesignMenu",s),o=()=>He(jt,"$showTemplatePicker",s),i=()=>He(lt,"$slideState",s),[s,r]=gt(),u=[{id:"size",label:"Size"},{id:"background",label:"Background"},{id:"text1",label:"Text 1"},{id:"text2",label:"Text 2"},{id:"quote",label:"Quote"},{id:"overlay",label:"Overlay"}];function c(l){l==="blank"&&lt.reset(),jt.set(!1)}function g(l){Yt.set(e()===l?"none":l)}async function v(){}function b(){}Re();var h=ts(),m=k(h);{var _=l=>{var d=Go(),z=p(k(d),2),R=p(z,2);bt(R,4,()=>[1,2,3,4,5,6],mt,(A,W)=>{var U=Xo(),E=k(U),B=k(E);w(E),w(U),te(()=>he(B,`Template ${W??""}`)),C("click",U,()=>c(`template-${W}`)),P(A,U)}),w(R),w(d),C("click",z,()=>c("blank")),P(l,d)},I=l=>{var d=es(),z=Ce(d);{let F=Je(()=>lt.canUndo()),q=Je(()=>lt.canRedo());Qt(z,{get canUndo(){return a(F)},get canRedo(){return a(q)},onUndo:()=>lt.undo(),onRedo:()=>lt.redo(),get onStartAgain(){return Yo},onCopy:v,onExport:b})}var R=p(z,2),A=k(R);w(R);var W=p(R,2);Kt(W,{get tabs(){return u},get activeTab(){return e()},onTabChange:g});var U=p(W,2),E=k(U);{var B=F=>{var q=Vo();P(F,q)},j=F=>{var q=Ve(),G=Ce(q);{var ie=V=>{var O=Jo();P(V,O)},D=V=>{var O=Ve(),K=Ce(O);{var ae=ce=>{var ne=Zo();P(ce,ne)},re=ce=>{var ne=Ve(),le=Ce(ne);{var ve=me=>{var Be=Qo();P(me,Be)},Ae=me=>{var Be=Ve(),Ie=Ce(Be);{var Xe=Te=>{var De=Ko();P(Te,De)},Ne=Te=>{var De=Ve(),Ze=Ce(De);{var Oe=ue=>{var Ee=$o();P(ue,Ee)};Q(Ze,ue=>{e()==="overlay"&&ue(Oe)},!0)}P(Te,De)};Q(Ie,Te=>{e()==="quote"?Te(Xe):Te(Ne,!1)},!0)}P(me,Be)};Q(le,me=>{e()==="text2"?me(ve):me(Ae,!1)},!0)}P(ce,ne)};Q(K,ce=>{e()==="text1"?ce(ae):ce(re,!1)},!0)}P(V,O)};Q(G,V=>{e()==="background"?V(ie):V(D,!1)},!0)}P(F,q)};Q(E,F=>{e()==="size"?F(B):F(j,!1)})}w(U),te(()=>Le(A,`
					aspect-ratio: ${i().canvasSize??""};
					background: ${i().background.type==="solid",i().background.value??""};
				`)),P(l,d)};Q(m,l=>{o()?l(_):l(I,!1)})}w(h),P(n,h),Se(),r()}const Ut=nt("crop");var ns=T('<!> <main class="main svelte-1uha8ag"><!></main> <!>',1);function ds(n,t){ye(t,!1);const e=()=>He(Ut,"$activeTab",i),o=()=>He(ee,"$cropState",i),[i,s]=gt();let r=Y(!1),u=null;function c(R){if(e()==="crop"&&o().cropPending&&R!=="crop"){u=R,y(r,!0);return}Ut.set(R)}async function g(){y(r,!1);const R=o();if(R.currentImage&&R.cropPending){const A=await ka(R.currentImage,R.cropBox,R.imageWidth,R.imageHeight),W=await Pt(A);ee.set({...R,currentImage:A,imageWidth:W.width,imageHeight:W.height,cropBox:{x:0,y:0,width:100,height:100},cropPending:!1,isCropping:!1})}u&&(Ut.set(u),u=null)}function v(){y(r,!1),u=null}Re();var b=ns(),h=Ce(b);cn(h,{get activeTab(){return e()},onTabChange:c});var m=p(h,2),_=k(m);{var I=R=>{no(R,{})},l=R=>{var A=Ve(),W=Ce(A);{var U=B=>{Wo(B,{})},E=B=>{var j=Ve(),F=Ce(j);{var q=G=>{as(G,{})};Q(F,G=>{e()==="design"&&G(q)},!0)}P(B,j)};Q(W,B=>{e()==="ai"?B(U):B(E,!1)},!0)}P(R,A)};Q(_,R=>{e()==="crop"?R(I):R(l,!1)})}w(m);var d=p(m,2);{var z=R=>{qt(R,{message:"Save changes?",confirmText:"Yes",cancelText:"Cancel",onConfirm:g,onCancel:v})};Q(d,R=>{a(r)&&R(z)})}P(n,b),Se(),s()}export{ds as component};

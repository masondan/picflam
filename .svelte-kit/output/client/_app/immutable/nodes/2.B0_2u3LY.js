import{f as H,a as y,t as Zt,c as ye}from"../chunks/CDgwKkU-.js";import"../chunks/eg048uQQ.js";import{F as it,h as me,x as Gt,C as rt,a as Qt,O as Kt,g as c,a6 as xe,Q as $t,R as ea,S as St,U as ot,B as Je,ag as ta,aI as aa,as as kt,H as na,L as ct,N as ia,aG as _t,w as Mt,ae as It,$ as he,aO as ra,aP as oa,aQ as sa,aR as Te,I as Ut,K as Lt,aS as st,aC as la,aT as ca,aF as da,J as ua,aU as Wt,X as Nt,aV as va,aW as ga,aX as ha,aY as fa,aZ as pa,p as se,t as G,n as le,s as x,k as C,l as w,a0 as J,d as F,a_ as Ue,a$ as wt,f as Re,at as ma,m as ue}from"../chunks/D2fEE9Ho.js";import{p as v,b as Ot,i as Y,s as Ce,a as Ge}from"../chunks/Bxt-ffiq.js";import{i as ve}from"../chunks/C8CgW_8a.js";import{e as T,s as be}from"../chunks/DUO_ZeU_.js";import{c as ba,o as _a,d as xt,w as Ee}from"../chunks/DmgIoSrK.js";import{s as wa}from"../chunks/Bx3j-Au5.js";let zt=!1;function xa(){zt||(zt=!0,document.addEventListener("reset",a=>{Promise.resolve().then(()=>{if(!a.defaultPrevented)for(const t of a.target.elements)t.__on_r?.()})},{capture:!0}))}function Qe(a,t){return t}function ya(a,t,e){for(var n=[],i=t.length,l,r=t.length,d=0;d<i;d++){let p=t[d];Lt(p,()=>{if(l){if(l.pending.delete(p),l.done.add(p),l.pending.size===0){var m=a.outrogroups;dt(_t(l.done)),m.delete(l),m.size===0&&(a.outrogroups=null)}}else r-=1},!1)}if(r===0){var s=n.length===0&&e!==null;if(s){var u=e,h=u.parentNode;da(h),h.append(u),a.items.clear()}dt(t,!s)}else l={pending:new Set(t),done:new Set},(a.outrogroups??=new Set).add(l)}function dt(a,t=!0){for(var e=0;e<a.length;e++)ua(a[e],t)}var Tt;function Ke(a,t,e,n,i,l=null){var r=a,d=new Map,s=(t&Wt)!==0;if(s){var u=a;r=me?it(Gt(u)):u.appendChild(rt())}me&&Qt();var h=null,p=xe(()=>{var f=e();return Mt(f)?f:f==null?[]:_t(f)}),m,_=!0;function b(){o.fallback=h,Ca(o,m,r,t,n),h!==null&&(m.length===0?(h.f&Te)===0?Ut(h):(h.f^=Te,je(h,null,r)):Lt(h,()=>{h=null}))}var E=Kt(()=>{m=c(p);var f=m.length;let R=!1;if(me){var S=$t(r)===ea;S!==(f===0)&&(r=St(),it(r),ot(!1),R=!0)}for(var B=new Set,k=na,P=ia(),A=0;A<f;A+=1){me&&Je.nodeType===ta&&Je.data===aa&&(r=Je,R=!0,ot(!1));var W=m[A],N=n(W,A),M=_?null:d.get(N);M?(M.v&&kt(M.v,W),M.i&&kt(M.i,A),P&&k.skipped_effects.delete(M.e)):(M=Sa(d,_?r:Tt??=rt(),W,N,A,i,t,e),_||(M.e.f|=Te),d.set(N,M)),B.add(N)}if(f===0&&l&&!h&&(_?h=ct(()=>l(r)):(h=ct(()=>l(Tt??=rt())),h.f|=Te)),me&&f>0&&it(St()),!_)if(P){for(const[O,$]of d)B.has(O)||k.skipped_effects.add($.e);k.oncommit(b),k.ondiscard(()=>{})}else b();R&&ot(!0),c(p)}),o={effect:E,items:d,outrogroups:null,fallback:h};_=!1,me&&(r=Je)}function Ye(a){for(;a!==null&&(a.f&ca)===0;)a=a.next;return a}function Ca(a,t,e,n,i){var l=(n&va)!==0,r=t.length,d=a.items,s=Ye(a.effect.first),u,h=null,p,m=[],_=[],b,E,o,f;if(l)for(f=0;f<r;f+=1)b=t[f],E=i(b,f),o=d.get(E).e,(o.f&Te)===0&&(o.nodes?.a?.measure(),(p??=new Set).add(o));for(f=0;f<r;f+=1){if(b=t[f],E=i(b,f),o=d.get(E).e,a.outrogroups!==null)for(const M of a.outrogroups)M.pending.delete(o),M.done.delete(o);if((o.f&Te)!==0)if(o.f^=Te,o===s)je(o,null,e);else{var R=h?h.next:s;o===a.effect.last&&(a.effect.last=o.prev),o.prev&&(o.prev.next=o.next),o.next&&(o.next.prev=o.prev),Ae(a,h,o),Ae(a,o,R),je(o,R,e),h=o,m=[],_=[],s=Ye(h.next);continue}if((o.f&st)!==0&&(Ut(o),l&&(o.nodes?.a?.unfix(),(p??=new Set).delete(o))),o!==s){if(u!==void 0&&u.has(o)){if(m.length<_.length){var S=_[0],B;h=S.prev;var k=m[0],P=m[m.length-1];for(B=0;B<m.length;B+=1)je(m[B],S,e);for(B=0;B<_.length;B+=1)u.delete(_[B]);Ae(a,k.prev,P.next),Ae(a,h,k),Ae(a,P,S),s=S,h=P,f-=1,m=[],_=[]}else u.delete(o),je(o,s,e),Ae(a,o.prev,o.next),Ae(a,o,h===null?a.effect.first:h.next),Ae(a,h,o),h=o;continue}for(m=[],_=[];s!==null&&s!==o;)(u??=new Set).add(s),_.push(s),s=Ye(s.next);if(s===null)continue}(o.f&Te)===0&&m.push(o),h=o,s=Ye(o.next)}if(a.outrogroups!==null){for(const M of a.outrogroups)M.pending.size===0&&(dt(_t(M.done)),a.outrogroups?.delete(M));a.outrogroups.size===0&&(a.outrogroups=null)}if(s!==null||u!==void 0){var A=[];if(u!==void 0)for(o of u)(o.f&st)===0&&A.push(o);for(;s!==null;)(s.f&st)===0&&s!==a.fallback&&A.push(s),s=Ye(s.next);var W=A.length;if(W>0){var N=(n&Wt)!==0&&r===0?e:null;if(l){for(f=0;f<W;f+=1)A[f].nodes?.a?.measure();for(f=0;f<W;f+=1)A[f].nodes?.a?.fix()}ya(a,A,N)}}l&&Nt(()=>{if(p!==void 0)for(o of p)o.nodes?.a?.apply()})}function Sa(a,t,e,n,i,l,r,d){var s=(r&oa)!==0?(r&sa)===0?he(e,!1,!1):It(e):null,u=(r&ra)!==0?It(i):null;return{v:s,i:u,e:ct(()=>(l(t,s??e,u??i,d),()=>{a.delete(n)}))}}function je(a,t,e){if(a.nodes)for(var n=a.nodes.start,i=a.nodes.end,l=t&&(t.f&Te)===0?t.nodes.start:e;n!==null;){var r=la(n);if(l.before(n),n===i)return;n=r}}function Ae(a,t,e){t===null?a.effect.first=e:t.next=e,e===null?a.effect.last=t:e.prev=t}const Rt=[...` 	
\r\fÂ \v\uFEFF`];function ka(a,t,e){var n=a==null?"":""+a;if(t&&(n=n?n+" "+t:t),e){for(var i in e)if(e[i])n=n?n+" "+i:i;else if(n.length)for(var l=i.length,r=0;(r=n.indexOf(i,r))>=0;){var d=r+l;(r===0||Rt.includes(n[r-1]))&&(d===n.length||Rt.includes(n[d]))?n=(r===0?"":n.substring(0,r))+n.substring(d+1):r=d}}return n===""?null:n}function Ia(a,t){return a==null?null:String(a)}function Se(a,t,e,n,i,l){var r=a.__className;if(me||r!==e||r===void 0){var d=ka(e,n,l);(!me||d!==a.getAttribute("class"))&&(d==null?a.removeAttribute("class"):a.className=d),a.__className=e}else if(l&&i!==l)for(var s in l){var u=!!l[s];(i==null||u!==!!i[s])&&a.classList.toggle(s,u)}return l}function ze(a,t,e,n){var i=a.__style;if(me||i!==t){var l=Ia(t);(!me||l!==a.getAttribute("style"))&&(l==null?a.removeAttribute("style"):a.style.cssText=l),a.__style=t}return n}const za=Symbol("is custom element"),Ta=Symbol("is html");function ut(a){if(me){var t=!1,e=()=>{if(!t){if(t=!0,a.hasAttribute("value")){var n=a.value;oe(a,"value",null),a.value=n}if(a.hasAttribute("checked")){var i=a.checked;oe(a,"checked",null),a.checked=i}}};a.__on_r=e,Nt(e),xa()}}function vt(a,t){var e=Dt(a);e.value===(e.value=t??void 0)||a.value===t&&(t!==0||a.nodeName!=="PROGRESS")||(a.value=t??"")}function oe(a,t,e,n){var i=Dt(a);me&&(i[t]=a.getAttribute(t),t==="src"||t==="srcset"||t==="href"&&a.nodeName==="LINK")||i[t]!==(i[t]=e)&&(t==="loading"&&(a[pa]=e),e==null?a.removeAttribute(t):typeof e!="string"&&Ra(a).includes(t)?a[t]=e:a.setAttribute(t,e))}function Dt(a){return a.__attributes??={[za]:a.nodeName.includes("-"),[Ta]:a.namespaceURI===ga}}var Pt=new Map;function Ra(a){var t=a.getAttribute("is")||a.nodeName,e=Pt.get(t);if(e)return e;Pt.set(t,e=[]);for(var n,i=a,l=Element.prototype;l!==i;){n=fa(i);for(var r in n)n[r].set&&e.push(r);i=ha(i)}return e}function we(a){return function(...t){var e=t[0];return e.stopPropagation(),a?.apply(this,t)}}function gt(a,t){var e=a.$$events?.[t.type],n=Mt(e)?e.slice():e==null?[]:[e];for(var i of n)i.call(this,t)}var Pa=H('<header class="header svelte-hv3zzy"><img src="/logos/logo-picflam-logotype.png" alt="PicFlam" class="header-logo svelte-hv3zzy"/> <nav class="header-nav svelte-hv3zzy"><button aria-label="Crop tab"><img src="/icons/icon-crop.svg" alt="" class="nav-icon svelte-hv3zzy"/></button> <button aria-label="AI tab"><img src="/icons/icon-ai.svg" alt="" class="nav-icon svelte-hv3zzy"/></button> <button aria-label="Design tab"><img src="/icons/icon-design.svg" alt="" class="nav-icon svelte-hv3zzy"/></button></nav></header>');function Aa(a,t){se(t,!1);let e=v(t,"activeTab",8,"crop"),n=v(t,"onTabChange",8);ve();var i=Pa(),l=x(C(i),2),r=C(l);let d;var s=x(r,2);let u;var h=x(s,2);let p;w(l),w(i),G(()=>{d=Se(r,1,"nav-btn svelte-hv3zzy",null,d,{active:e()==="crop"}),u=Se(s,1,"nav-btn svelte-hv3zzy",null,u,{active:e()==="ai"}),p=Se(h,1,"nav-btn svelte-hv3zzy",null,p,{active:e()==="design"})}),T("click",r,()=>n()("crop")),T("click",s,()=>n()("ai")),T("click",h,()=>n()("design")),y(a,i),le()}function Yt(a){return new Promise((t,e)=>{const n=new FileReader;n.onload=i=>t(i.target.result),n.onerror=e,n.readAsDataURL(a)})}function qe(a){return new Promise((t,e)=>{const n=new Image;n.onload=()=>t(n),n.onerror=e,n.src=a})}async function Ve(a){const t=await qe(a);return{width:t.naturalWidth,height:t.naturalHeight}}function At(a,t=2048){return new Promise(async e=>{const n=await qe(a),{naturalWidth:i,naturalHeight:l}=n;if(i<=t&&l<=t){e(a);return}const r=document.createElement("canvas"),d=r.getContext("2d");let s,u;i>l?(s=t,u=l/i*t):(u=t,s=i/l*t),r.width=s,r.height=u,d.drawImage(n,0,0,s,u),e(r.toDataURL("image/jpeg",.92))})}async function Fa(){try{const a=await navigator.clipboard.read();for(const t of a)for(const e of t.types)if(e.startsWith("image/")){const n=await t.getType(e);return await Yt(n)}return null}catch(a){return console.error("Failed to paste from clipboard:",a),null}}async function ht(a){try{const e=await(await fetch(a)).blob();return await navigator.clipboard.write([new ClipboardItem({[e.type]:e})]),!0}catch(t){return console.error("Failed to copy to clipboard:",t),!1}}function ft(a,t="picflam-export.png"){const e=document.createElement("a");e.href=a,e.download=t,document.body.appendChild(e),e.click(),document.body.removeChild(e)}async function jt(a,t,e,n){const i=await qe(a),l=document.createElement("canvas"),r=l.getContext("2d"),d=t.x/100*e,s=t.y/100*n,u=t.width/100*e,h=t.height/100*n;return l.width=u,l.height=h,r.drawImage(i,d,s,u,h,0,0,u,h),l.toDataURL("image/png")}async function Ha(a,t){const e=await qe(a),n=document.createElement("canvas"),i=n.getContext("2d");return n.width=e.naturalHeight,n.height=e.naturalWidth,i.translate(n.width/2,n.height/2),i.rotate(t*Math.PI/180),i.drawImage(e,-e.naturalWidth/2,-e.naturalHeight/2),n.toDataURL("image/png")}async function Ea(a,t){const e=await qe(a),n=document.createElement("canvas"),i=n.getContext("2d");return n.width=e.naturalWidth,n.height=e.naturalHeight,i.translate(n.width,0),i.scale(-1,1),i.drawImage(e,0,0),n.toDataURL("image/png")}var Ba=H('<div role="button" tabindex="0"><p class="import-title svelte-f1bndr"> </p> <img src="/icons/icon-upload.svg" alt="" class="import-icon svelte-f1bndr"/> <p class="import-hint svelte-f1bndr"> </p> <button class="btn-paste svelte-f1bndr">Paste</button> <input type="file" accept="image/*" class="sr-only"/></div>');function Xt(a,t){se(t,!1);let e=v(t,"title",8,"Import an image"),n=v(t,"hint",8,"Import, drag or paste an image"),i=v(t,"onImageImport",8,P=>{}),l=he(!1),r=he();async function d(P){if(!P||!P.type.startsWith("image/"))return;const A=await Yt(P),W=await At(A,2048);i()(W)}function s(P){const A=P.target.files?.[0];A&&d(A)}function u(P){P.preventDefault(),J(l,!1);const A=P.dataTransfer?.files?.[0];A&&d(A)}function h(P){P.preventDefault(),J(l,!0)}function p(){J(l,!1)}async function m(){const P=await Fa();if(P){const A=await At(P,2048);i()(A)}}function _(){c(r)?.click()}ve();var b=Ba();let E;var o=C(b),f=C(o,!0);w(o);var R=x(o,4),S=C(R,!0);w(R);var B=x(R,2),k=x(B,2);Ot(k,P=>J(r,P),()=>c(r)),w(b),G(()=>{E=Se(b,1,"import-area svelte-f1bndr",null,E,{dragging:c(l)}),be(f,e()),be(S,n())}),T("click",B,we(m)),T("change",k,s),T("click",b,_),T("drop",b,u),T("dragover",b,h),T("dragleave",b,p),T("keypress",b,P=>P.key==="Enter"&&_()),y(a,b),le()}var Ma=H('<div class="action-bar svelte-96zw02"><div class="action-group svelte-96zw02"><button class="action-btn svelte-96zw02" aria-label="Undo"><img src="/icons/icon-undo.svg" alt="" class="action-icon svelte-96zw02"/></button> <button class="action-btn svelte-96zw02" aria-label="Redo"><img src="/icons/icon-redo.svg" alt="" class="action-icon svelte-96zw02"/></button></div> <div class="action-group svelte-96zw02"><button class="action-btn svelte-96zw02" aria-label="Start again"><img src="/icons/icon-startagain.svg" alt="" class="action-icon svelte-96zw02"/></button> <button class="action-btn svelte-96zw02" aria-label="Copy to clipboard"><img src="/icons/icon-copy.svg" alt="" class="action-icon svelte-96zw02"/></button> <button class="action-btn svelte-96zw02" aria-label="Export"><img src="/icons/icon-export.svg" alt="" class="action-icon svelte-96zw02"/></button></div></div>');function yt(a,t){let e=v(t,"canUndo",8,!1),n=v(t,"canRedo",8,!1),i=v(t,"onUndo",8,()=>{}),l=v(t,"onRedo",8,()=>{}),r=v(t,"onStartAgain",8,()=>{}),d=v(t,"onCopy",8,()=>{}),s=v(t,"onExport",8,()=>{});var u=Ma(),h=C(u),p=C(h),m=x(p,2);w(h);var _=x(h,2),b=C(_),E=x(b,2),o=x(E,2);w(_),w(u),G(()=>{p.disabled=!e(),m.disabled=!n()}),T("click",p,function(...f){i()?.apply(this,f)}),T("click",m,function(...f){l()?.apply(this,f)}),T("click",b,function(...f){r()?.apply(this,f)}),T("click",E,function(...f){d()?.apply(this,f)}),T("click",o,function(...f){s()?.apply(this,f)}),y(a,u)}var Ua=H("<button> </button>"),La=H('<div class="sub-menu-tabs svelte-tv6tw8"></div>');function Ct(a,t){se(t,!1);let e=v(t,"tabs",24,()=>[]),n=v(t,"activeTab",8,""),i=v(t,"onTabChange",8,r=>{});ve();var l=La();Ke(l,5,e,Qe,(r,d)=>{var s=Ua();let u;var h=C(s,!0);w(s),G(()=>{u=Se(s,1,"sub-menu-tab svelte-tv6tw8",null,u,{active:n()===c(d).id}),be(h,(c(d),F(()=>c(d).label)))}),T("click",s,()=>i()(c(d).id)),y(r,s)}),w(l),y(a,l),le()}var Wa=H('<div class="modal-overlay svelte-qik81a" role="dialog" aria-modal="true" tabindex="-1"><div class="modal svelte-qik81a" role="document"><p class="modal-message svelte-qik81a"> </p> <div class="modal-actions svelte-qik81a"><button class="btn-text svelte-qik81a"> </button> <button class="btn-text btn-confirm svelte-qik81a"> </button></div></div></div>');function pt(a,t){se(t,!1);let e=v(t,"message",8,""),n=v(t,"confirmText",8,"Yes"),i=v(t,"cancelText",8,"Cancel"),l=v(t,"onConfirm",8,()=>{}),r=v(t,"onCancel",8,()=>{});ve();var d=Wa(),s=C(d),u=C(s),h=C(u,!0);w(u);var p=x(u,2),m=C(p),_=C(m,!0);w(m);var b=x(m,2),E=C(b,!0);w(b),w(p),w(s),w(d),G(()=>{be(h,e()),be(_,i()),be(E,n())}),T("click",m,function(...o){r()?.apply(this,o)}),T("click",b,function(...o){l()?.apply(this,o)}),T("click",s,we(function(o){gt.call(this,t,o)})),T("keydown",s,we(function(o){gt.call(this,t,o)})),T("click",d,function(...o){r()?.apply(this,o)}),T("keydown",d,o=>o.key==="Escape"&&r()()),y(a,d),le()}var Na=H('<div class="crop-overlay svelte-pjowa5"><div class="overlay-top svelte-pjowa5"></div> <div class="overlay-bottom svelte-pjowa5"></div> <div class="overlay-left svelte-pjowa5"></div> <div class="overlay-right svelte-pjowa5"></div> <div class="crop-box svelte-pjowa5" role="button" aria-label="Drag to move crop area" tabindex="0"><div class="crop-border svelte-pjowa5"></div> <div class="corner-handle top-left svelte-pjowa5" role="button" aria-label="Resize top-left corner" tabindex="0"></div> <div class="corner-handle top-right svelte-pjowa5" role="button" aria-label="Resize top-right corner" tabindex="0"></div> <div class="corner-handle bottom-left svelte-pjowa5" role="button" aria-label="Resize bottom-left corner" tabindex="0"></div> <div class="corner-handle bottom-right svelte-pjowa5" role="button" aria-label="Resize bottom-right corner" tabindex="0"></div></div></div>'),Oa=H('<div class="crop-canvas svelte-pjowa5" role="application" aria-label="Image crop canvas"><div class="image-wrapper svelte-pjowa5"><img alt="Crop preview" class="canvas-image svelte-pjowa5" draggable="false"/></div> <!></div>');function Da(a,t){se(t,!1);const e=he(),n=he(),i=he();let l=v(t,"imageSrc",8,""),r=v(t,"cropBox",24,()=>({x:10,y:10,width:80,height:80})),d=v(t,"isCropping",8,!1),s=v(t,"scale",8,1),u=v(t,"offsetX",8,0),h=v(t,"offsetY",8,0),p=v(t,"imageWidth",8,0),m=v(t,"imageHeight",8,0),_=v(t,"editFilters",8,"");const b=ba();let E=he(),o=he({width:0,height:0}),f=!1,R=null,S=0,B=0,k=null,P=0,A=1;_a(()=>(W(),window.addEventListener("resize",W),()=>window.removeEventListener("resize",W)));function W(){if(c(E)){const z=c(E).getBoundingClientRect();J(o,{width:z.width,height:z.height})}}function N(z){return z.touches&&z.touches.length>0?{x:z.touches[0].clientX,y:z.touches[0].clientY}:{x:z.clientX,y:z.clientY}}function M(z){if(z.touches&&z.touches.length>=2){const Q=z.touches[0].clientX-z.touches[1].clientX,Z=z.touches[0].clientY-z.touches[1].clientY;return Math.sqrt(Q*Q+Z*Z)}return 0}function O(z,Q="move"){if(!d())return;if(z.touches&&z.touches.length>=2){P=M(z),A=s(),R="pinch";return}z.preventDefault(),f=!0,R=Q;const Z=N(z);S=Z.x,B=Z.y,k={...r()}}function $(z){if(!d())return;if(R==="pinch"&&z.touches&&z.touches.length>=2){const ke=M(z),D=A*(ke/P);b("scaleChange",{scale:Math.max(.5,Math.min(3,D))});return}if(!f||!k)return;z.preventDefault();const Q=N(z),Z=(Q.x-S)/c(e)*100,_e=(Q.y-B)/c(n)*100;let ie={...k};if(R==="move")ie.x=Math.max(0,Math.min(100-k.width,k.x+Z)),ie.y=Math.max(0,Math.min(100-k.height,k.y+_e));else if(R.includes("corner")){if(R.includes("left")){const D=k.x+Z,re=k.width-Z;re>=10&&D>=0&&(ie.x=D,ie.width=re)}if(R.includes("right")){const D=k.width+Z;D>=10&&k.x+D<=100&&(ie.width=D)}if(R.includes("top")){const D=k.y+_e,re=k.height-_e;re>=10&&D>=0&&(ie.y=D,ie.height=re)}if(R.includes("bottom")){const D=k.height+_e;D>=10&&k.y+D<=100&&(ie.height=D)}}b("cropChange",{cropBox:ie})}function ne(){f=!1,R=null,k=null}Ue(()=>c(o),()=>{J(e,c(o).width)}),Ue(()=>(Re(m()),Re(p()),c(e)),()=>{J(n,m()&&p()?c(e)*m()/p():0)}),Ue(()=>(Re(r()),c(e),c(n)),()=>{J(i,{x:r().x/100*c(e),y:r().y/100*c(n),width:r().width/100*c(e),height:r().height/100*c(n)})}),wt(),ve();var X=Oa(),V=C(X),U=C(V);w(V);var te=x(V,2);{var fe=z=>{var Q=Na(),Z=C(Q),_e=x(Z,2),ie=x(_e,2),ke=x(ie,2),D=x(ke,2),re=x(C(D),2),Ie=x(re,2),Pe=x(Ie,2),Le=x(Pe,2);w(D),w(Q),G(()=>{ze(Z,`height: ${c(i),F(()=>c(i).y)??""}px;`),ze(_e,`top: ${c(i),F(()=>c(i).y+c(i).height)??""}px; height: ${c(n),c(i),F(()=>c(n)-c(i).y-c(i).height)??""}px;`),ze(ie,`top: ${c(i),F(()=>c(i).y)??""}px; height: ${c(i),F(()=>c(i).height)??""}px; width: ${c(i),F(()=>c(i).x)??""}px;`),ze(ke,`top: ${c(i),F(()=>c(i).y)??""}px; height: ${c(i),F(()=>c(i).height)??""}px; left: ${c(i),F(()=>c(i).x+c(i).width)??""}px; width: ${c(e),c(i),F(()=>c(e)-c(i).x-c(i).width)??""}px;`),ze(D,`left: ${c(i),F(()=>c(i).x)??""}px; top: ${c(i),F(()=>c(i).y)??""}px; width: ${c(i),F(()=>c(i).width)??""}px; height: ${c(i),F(()=>c(i).height)??""}px;`)}),T("mousedown",re,we(j=>O(j,"corner-top-left"))),T("touchstart",re,we(j=>O(j,"corner-top-left"))),T("mousedown",Ie,we(j=>O(j,"corner-top-right"))),T("touchstart",Ie,we(j=>O(j,"corner-top-right"))),T("mousedown",Pe,we(j=>O(j,"corner-bottom-left"))),T("touchstart",Pe,we(j=>O(j,"corner-bottom-left"))),T("mousedown",Le,we(j=>O(j,"corner-bottom-right"))),T("touchstart",Le,we(j=>O(j,"corner-bottom-right"))),T("mousedown",D,j=>O(j,"move")),T("touchstart",D,j=>O(j,"move")),y(z,Q)};Y(te,z=>{d()&&c(n)>0&&z(fe)})}w(X),Ot(X,z=>J(E,z),()=>c(E)),G(()=>{ze(V,`transform: scale(${s()??""}) translate(${u()??""}px, ${h()??""}px);`),oe(U,"src",l()),ze(U,`filter: ${_()??""};`)}),T("mousemove",X,$),T("mouseup",X,ne),T("mouseleave",X,ne),T("touchmove",X,$),T("touchend",X,ne),y(a,X),le()}var Ya=H('<img alt="" class="toggle-icon svelte-1gdqxne"/>'),ja=H('<span class="toggle-label svelte-1gdqxne"> </span>'),Xa=H("<div><button><!></button> <!></div>"),qa=H('<div class="toggle-group svelte-1gdqxne"></div>');function Ja(a,t){se(t,!1);let e=v(t,"options",24,()=>[]),n=v(t,"value",8,""),i=v(t,"onChange",8,d=>{}),l=v(t,"showLabels",8,!0);ve();var r=qa();Ke(r,5,e,Qe,(d,s)=>{var u=Xa();let h;var p=C(u);let m;var _=C(p);{var b=f=>{var R=Ya();G(()=>oe(R,"src",`/icons/${c(s),F(()=>c(s).icon)??""}.svg`)),y(f,R)};Y(_,f=>{c(s),F(()=>c(s).icon)&&f(b)})}w(p);var E=x(p,2);{var o=f=>{var R=ja(),S=C(R,!0);w(R),G(()=>be(S,(c(s),F(()=>c(s).label)))),y(f,R)};Y(E,f=>{Re(l()),c(s),F(()=>l()&&c(s).label)&&f(o)})}w(u),G(()=>{h=Se(u,1,"toggle-item svelte-1gdqxne",null,h,{active:n()===c(s).id}),m=Se(p,1,"toggle-btn svelte-1gdqxne",null,m,{active:n()===c(s).id}),oe(p,"aria-label",(c(s),F(()=>c(s).label)))}),T("click",p,()=>i()(c(s).id)),y(d,u)}),w(r),y(a,r),le()}var Va=H('<label class="input-label svelte-1r47u3b"> <input class="input svelte-1r47u3b"/></label>'),Za=H('<input class="input svelte-1r47u3b"/>'),Ga=H('<div class="input-field svelte-1r47u3b"><!></div>');function Ft(a,t){se(t,!1);let e=v(t,"label",8,""),n=v(t,"value",12,""),i=v(t,"type",8,"text"),l=v(t,"placeholder",8,""),r=v(t,"disabled",8,!1),d=v(t,"onChange",8,_=>{});function s(_){n(_.target.value),d()(n())}ve();var u=Ga(),h=C(u);{var p=_=>{var b=Va(),E=C(b),o=x(E);ut(o),w(b),G(()=>{be(E,`${e()??""} `),oe(o,"type",i()),vt(o,n()),oe(o,"placeholder",l()),o.disabled=r()}),T("input",o,s),y(_,b)},m=_=>{var b=Za();ut(b),G(()=>{oe(b,"type",i()),vt(b,n()),oe(b,"placeholder",l()),b.disabled=r()}),T("input",b,s),y(_,b)};Y(h,_=>{e()?_(p):_(m,!1)})}w(u),y(a,u),le()}var Qa=H('<span class="slider-value svelte-jchife"> </span>'),Ka=H('<div class="slider-header svelte-jchife"><span class="slider-label svelte-jchife"> </span> <!></div>'),$a=H('<div class="slider-container svelte-jchife"><!> <input type="range" class="slider svelte-jchife"/></div>');function Fe(a,t){se(t,!1);let e=v(t,"label",8,""),n=v(t,"min",8,0),i=v(t,"max",8,100),l=v(t,"value",12,50),r=v(t,"step",8,1),d=v(t,"showValue",8,!1),s=v(t,"onChange",8,b=>{});function u(b){l(Number(b.target.value)),s()(l())}ve();var h=$a(),p=C(h);{var m=b=>{var E=Ka(),o=C(E),f=C(o,!0);w(o);var R=x(o,2);{var S=B=>{var k=Qa(),P=C(k,!0);w(k),G(()=>be(P,l())),y(B,k)};Y(R,B=>{d()&&B(S)})}w(E),G(()=>be(f,e())),y(b,E)};Y(p,b=>{e()&&b(m)})}var _=x(p,2);ut(_),w(h),G(()=>{oe(_,"min",n()),oe(_,"max",i()),oe(_,"step",r()),vt(_,l())}),T("input",_,u),y(a,h),le()}var en=H('<div class="apply-row svelte-17iy3mz"><button class="btn-apply svelte-17iy3mz">Apply</button></div>'),tn=H('<div class="crop-controls svelte-17iy3mz"><!> <div class="dimensions-row svelte-17iy3mz"><div class="dimension-input svelte-17iy3mz"><!></div> <button class="icon-btn svelte-17iy3mz"><img alt="" class="icon-btn-img svelte-17iy3mz"/></button> <div class="dimension-input svelte-17iy3mz"><!></div> <button class="icon-btn svelte-17iy3mz" aria-label="Flip horizontal"><img src="/icons/icon-flip-horizontal.svg" alt="" class="icon-btn-img svelte-17iy3mz"/></button> <button class="icon-btn svelte-17iy3mz" aria-label="Rotate"><img src="/icons/icon-rotate.svg" alt="" class="icon-btn-img svelte-17iy3mz"/></button></div> <!> <!></div>');function an(a,t){se(t,!1);let e=v(t,"aspectRatio",8,"9:16"),n=v(t,"cropWidth",8,1080),i=v(t,"cropHeight",8,1920),l=v(t,"ratioLocked",8,!0),r=v(t,"scale",8,100),d=v(t,"cropPending",8,!1),s=v(t,"onRatioChange",8,U=>{}),u=v(t,"onDimensionsChange",8,({width:U,height:te})=>{}),h=v(t,"onLockToggle",8,()=>{}),p=v(t,"onFlip",8,()=>{}),m=v(t,"onRotate",8,()=>{}),_=v(t,"onScaleChange",8,U=>{}),b=v(t,"onApply",8,()=>{});const E=[{id:"9:16",label:"9:16",icon:"icon-vertical"},{id:"1:1",label:"1:1",icon:"icon-square"},{id:"16:9",label:"16:9",icon:"icon-horizontal"},{id:"custom",label:"Custom",icon:"icon-custom"}];function o(U){const te=parseInt(U)||0;u()({width:te,height:i()})}function f(U){const te=parseInt(U)||0;u()({width:n(),height:te})}ve();var R=tn(),S=C(R);Ja(S,{get options(){return E},get value(){return e()},get onChange(){return s()},showLabels:!0});var B=x(S,2),k=C(B),P=C(k);{let U=xe(()=>(Re(n()),F(()=>n().toString())));Ft(P,{label:"Width",type:"number",get value(){return c(U)},onChange:o})}w(k);var A=x(k,2),W=C(A);w(A);var N=x(A,2),M=C(N);{let U=xe(()=>(Re(i()),F(()=>i().toString())));Ft(M,{label:"Height",type:"number",get value(){return c(U)},onChange:f})}w(N);var O=x(N,2),$=x(O,2);w(B);var ne=x(B,2);Fe(ne,{label:"Scale",min:50,max:200,get value(){return r()},step:1,showValue:!0,get onChange(){return _()}});var X=x(ne,2);{var V=U=>{var te=en(),fe=C(te);w(te),T("click",fe,function(...z){b()?.apply(this,z)}),y(U,te)};Y(X,U=>{d()&&U(V)})}w(R),G(()=>{oe(A,"aria-label",l()?"Unlock aspect ratio":"Lock aspect ratio"),oe(W,"src",`/icons/${l()?"icon-lock":"icon-unlock"}.svg`)}),T("click",A,function(...U){h()?.apply(this,U)}),T("click",O,function(...U){p()?.apply(this,U)}),T("click",$,function(...U){m()?.apply(this,U)}),y(a,R),le()}var nn=H('<img alt="" class="btn-icon svelte-1xko78n"/>'),rn=H("<button><!> <!></button>");function on(a,t){let e=v(t,"variant",8,"secondary"),n=v(t,"disabled",8,!1),i=v(t,"icon",8,null),l=v(t,"fullWidth",8,!1);var r=rn();let d;var s=C(r);{var u=p=>{var m=nn();G(()=>oe(m,"src",`/icons/${i()??""}.svg`)),y(p,m)};Y(s,p=>{i()&&p(u)})}var h=x(s,2);wa(h,t,"default",{}),w(r),G(()=>{d=Se(r,1,`btn btn-${e()??""}`,"svelte-1xko78n",d,{"full-width":l()}),r.disabled=n()}),T("click",r,function(p){gt.call(this,t,p)}),y(a,r)}var sn=H('<div class="edit-controls svelte-1e1k0ax"><div class="section svelte-1e1k0ax"><!></div> <div class="section svelte-1e1k0ax"><!></div> <div class="section svelte-1e1k0ax"><!></div> <div class="section svelte-1e1k0ax"><!></div> <div class="section svelte-1e1k0ax"><h3 class="section-header svelte-1e1k0ax">Blur Brush</h3> <!></div> <div class="section svelte-1e1k0ax"><h3 class="section-header svelte-1e1k0ax">Zoom</h3> <!> <div class="nudge-row svelte-1e1k0ax"><button class="nudge-btn svelte-1e1k0ax" aria-label="Nudge up"><img src="/icons/icon-nudge-up.svg" alt="" class="svelte-1e1k0ax"/></button> <button class="nudge-btn svelte-1e1k0ax" aria-label="Nudge down"><img src="/icons/icon-nudge-down.svg" alt="" class="svelte-1e1k0ax"/></button> <button class="nudge-btn svelte-1e1k0ax" aria-label="Nudge left"><img src="/icons/icon-nudge-left.svg" alt="" class="svelte-1e1k0ax"/></button> <button class="nudge-btn svelte-1e1k0ax" aria-label="Nudge right"><img src="/icons/icon-nudge-right.svg" alt="" class="svelte-1e1k0ax"/></button></div> <!></div></div>');function ln(a,t){se(t,!1);let e=v(t,"brightness",8,0),n=v(t,"shadows",8,0),i=v(t,"contrast",8,0),l=v(t,"hdr",8,0),r=v(t,"blurBrushSize",8,50),d=v(t,"zoomLevel",8,1),s=v(t,"onBrightnessChange",8,z=>{}),u=v(t,"onShadowsChange",8,z=>{}),h=v(t,"onContrastChange",8,z=>{}),p=v(t,"onHdrChange",8,z=>{}),m=v(t,"onBlurBrushSizeChange",8,z=>{}),_=v(t,"onZoomChange",8,z=>{}),b=v(t,"onNudge",8,z=>{}),E=v(t,"onResetZoom",8,()=>{});ve();var o=sn(),f=C(o),R=C(f);Fe(R,{label:"Brightness",min:-100,max:100,get value(){return e()},showValue:!0,get onChange(){return s()}}),w(f);var S=x(f,2),B=C(S);Fe(B,{label:"Shadows",min:-100,max:100,get value(){return n()},showValue:!0,get onChange(){return u()}}),w(S);var k=x(S,2),P=C(k);Fe(P,{label:"Contrast",min:-100,max:100,get value(){return i()},showValue:!0,get onChange(){return h()}}),w(k);var A=x(k,2),W=C(A);Fe(W,{label:"HDR",min:0,max:100,get value(){return l()},showValue:!0,get onChange(){return p()}}),w(A);var N=x(A,2),M=x(C(N),2);Fe(M,{label:"Size",min:10,max:100,get value(){return r()},showValue:!0,get onChange(){return m()}}),w(N);var O=x(N,2),$=x(C(O),2);Fe($,{label:"Zoom In",min:1,max:3,step:.1,get value(){return d()},showValue:!0,get onChange(){return _()}});var ne=x($,2),X=C(ne),V=x(X,2),U=x(V,2),te=x(U,2);w(ne);var fe=x(ne,2);on(fe,{variant:"secondary",fullWidth:!0,$$events:{click(...z){E()?.apply(this,z)}},children:(z,Q)=>{ma();var Z=Zt("Reset");y(z,Z)},$$slots:{default:!0}}),w(O),w(o),T("click",X,()=>b()("up")),T("click",V,()=>b()("down")),T("click",U,()=>b()("left")),T("click",te,()=>b()("right")),y(a,o),le()}var cn=H('<button><div class="filter-preview svelte-183y0dt"></div> <span> </span></button>'),dn=H('<div class="filter-grid svelte-183y0dt"></div>');function un(a,t){se(t,!1);let e=v(t,"filters",24,()=>[]),n=v(t,"value",8,"original"),i=v(t,"imageUrl",8,""),l=v(t,"onChange",8,d=>{});ve();var r=dn();Ke(r,5,e,Qe,(d,s)=>{var u=cn();let h;var p=C(u),m=x(p,2);let _;var b=C(m,!0);w(m),w(u),G(()=>{h=Se(u,1,"filter-card svelte-183y0dt",null,h,{active:n()===c(s).id}),ze(p,`
					background-image: url(${i()??""});
					filter: ${c(s),F(()=>c(s).css||"none")??""};
				`),_=Se(m,1,"filter-label svelte-183y0dt",null,_,{active:n()===c(s).id}),be(b,(c(s),F(()=>c(s).label)))}),T("click",u,()=>l()(c(s).id)),y(d,u)}),w(r),y(a,r),le()}var vn=H('<div class="strength-slider svelte-1274k9v"><!></div>'),gn=H('<div class="filter-controls svelte-1274k9v"><!> <!></div>');function hn(a,t){se(t,!1);const e=he();let n=v(t,"imageUrl",8,""),i=v(t,"activeFilter",8,"original"),l=v(t,"filterStrength",8,50),r=v(t,"onFilterChange",8,_=>{}),d=v(t,"onStrengthChange",8,_=>{});const s=[{id:"original",label:"Original",css:"none"},{id:"greyscale",label:"Greyscale",css:"grayscale(100%)"},{id:"sepia",label:"Sepia",css:"sepia(100%)"},{id:"sunset",label:"Sunset",css:"sepia(30%) saturate(140%) brightness(110%) hue-rotate(-10deg)"},{id:"azure",label:"Azure",css:"saturate(120%) brightness(105%) hue-rotate(180deg)"},{id:"teal",label:"Teal",css:"saturate(130%) hue-rotate(140deg)"}];Ue(()=>Re(i()),()=>{J(e,i()!=="original")}),wt();var u=gn(),h=C(u);un(h,{get filters(){return s},get value(){return i()},get imageUrl(){return n()},get onChange(){return r()}});var p=x(h,2);{var m=_=>{var b=vn(),E=C(b);Fe(E,{label:"Strength",min:0,max:100,get value(){return l()},get onChange(){return d()}}),w(b),y(_,b)};Y(p,_=>{c(e)&&_(m)})}w(u),y(a,u),le()}const Ht=[{id:"original",label:"Original",css:"none"},{id:"greyscale",label:"Greyscale",css:"grayscale(100%)"},{id:"sepia",label:"Sepia",css:"sepia(100%)"},{id:"sunset",label:"Sunset",css:"sepia(30%) saturate(140%) brightness(110%) hue-rotate(-10deg)"},{id:"azure",label:"Azure",css:"saturate(120%) brightness(105%) hue-rotate(180deg)"},{id:"teal",label:"Teal",css:"saturate(130%) hue-rotate(140deg)"}];function fn(a){const t=[a];let e=0,n=0;const{subscribe:i,set:l,update:r}=Ee(a);return{subscribe:i,set:d=>{t.splice(e+1),t.push(d),e=t.length-1,l(d)},update:d=>{r(s=>{const u=d(s);return t.splice(e+1),t.push(u),e=t.length-1,u})},silentUpdate:d=>{r(d)},setBaseState:()=>{n=e},undo:()=>{e>n&&(e--,l(t[e]))},redo:()=>{e<t.length-1&&(e++,l(t[e]))},canUndo:()=>e>n,canRedo:()=>e<t.length-1,reset:()=>{t.length=0,t.push(a),e=0,n=0,l(a)}}}const pn={originalImage:null,currentImage:null,aspectRatio:"custom",width:0,height:0,ratioLocked:!1,scale:1,offsetX:0,offsetY:0,brightness:0,contrast:0,shadows:0,hdr:0,blurBrushSize:20,activeFilter:"original",filterStrength:50,cropBox:{x:0,y:0,width:0,height:0},isCropping:!1,cropPending:!1,imageWidth:0,imageHeight:0,blurMask:null,zoomLevel:1,zoomOffsetX:0,zoomOffsetY:0},L=fn(pn),Xe=Ee("none"),mn=xt(L,a=>a.currentImage!==null);function bn(){L.reset(),Xe.set("none")}var _n=H('<div class="controls-panel svelte-c9tnuw"><!></div>'),wn=H('<div class="controls-panel svelte-c9tnuw"><!></div>'),xn=H("<!> <!> <!> <!>",1),yn=H('<div class="crop-tab svelte-c9tnuw"><!> <!> <!></div>');function Cn(a,t){se(t,!1);const e=()=>Ce(L,"$cropState",l),n=()=>Ce(Xe,"$activeSubMenu",l),i=()=>Ce(mn,"$hasImage",l),[l,r]=Ge(),d=he(),s=he(),u=he(),h=[{id:"crop",label:"Crop"},{id:"edit",label:"Edit"},{id:"filter",label:"Filter"}];let p=he(null),m=null;async function _(g){const I=await Ve(g);L.set({...e(),originalImage:g,currentImage:g,imageWidth:I.width,imageHeight:I.height,width:I.width,height:I.height,cropBox:{x:0,y:0,width:100,height:100},isCropping:!0,cropPending:!1,aspectRatio:"custom",ratioLocked:!1}),L.setBaseState(),Xe.set("crop")}function b(g){if(e().cropPending&&n()==="crop"&&g!=="crop"){m=()=>{Xe.set(g),L.silentUpdate(I=>({...I,isCropping:!1}))},J(p,"save");return}g==="crop"?L.silentUpdate(I=>({...I,isCropping:!0})):L.silentUpdate(I=>({...I,isCropping:!1})),Xe.set(n()===g?"none":g)}async function E(){if(e().cropPending){m=async()=>{await ht(e().currentImage)},J(p,"save");return}e().currentImage&&await ht(e().currentImage)}function o(){if(e().cropPending){m=()=>{ft(e().currentImage,"picflam-crop.png")},J(p,"save");return}e().currentImage&&ft(e().currentImage,"picflam-crop.png")}function f(){J(p,"startAgain")}function R(){L.undo()}function S(){L.redo()}async function B(){J(p,null),await W(),m&&(await m(),m=null)}function k(){J(p,null),m=null}function P(){J(p,null),bn()}function A(){J(p,null)}async function W(){const g=e();if(!g.currentImage||!g.cropPending)return;const I=await jt(g.currentImage,g.cropBox,g.imageWidth,g.imageHeight),q=await Ve(I);L.set({...g,currentImage:I,imageWidth:q.width,imageHeight:q.height,width:q.width,height:q.height,cropBox:{x:0,y:0,width:100,height:100},cropPending:!1})}function N(g){if(g==="custom"){L.silentUpdate(ae=>({...ae,aspectRatio:"custom",cropBox:{x:0,y:0,width:100,height:100},ratioLocked:!1,cropPending:!1}));return}const q={"9:16":9/16,"1:1":1,"16:9":16/9}[g],K=e().imageWidth/e().imageHeight;let ee;if(g==="9:16"){const ce=q/K*100;if(ce<=100)ee={x:(100-ce)/2,y:0,width:ce,height:100};else{const ge=K/q*100;ee={x:0,y:(100-ge)/2,width:100,height:ge}}}else if(g==="16:9"){const ce=K/q*100;if(ce<=100)ee={x:0,y:(100-ce)/2,width:100,height:ce};else{const ge=q/K*100;ee={x:(100-ge)/2,y:0,width:ge,height:100}}}else if(g==="1:1")if(K>1){const ae=100/K;ee={x:(100-ae)/2,y:0,width:ae,height:100}}else{const ae=100*K;ee={x:0,y:(100-ae)/2,width:100,height:ae}}L.silentUpdate(ae=>({...ae,aspectRatio:g,cropBox:ee,cropPending:!0,isCropping:!0,ratioLocked:!0}))}function M({width:g,height:I}){const q=e().imageWidth,K=e().imageHeight,ee=Math.min(Math.max(1,g),q),ae=Math.min(Math.max(1,I),K),ce=ee/q*100,ge=ae/K*100;let de;if(e().ratioLocked){const pe=c(d)/c(s);if(g!==c(d)){const Me=ee/pe/K*100;de={x:(100-ce)/2,y:(100-Math.min(100,Me))/2,width:ce,height:Math.min(100,Me)}}else{const Me=ae*pe/q*100;de={x:(100-Math.min(100,Me))/2,y:(100-ge)/2,width:Math.min(100,Me),height:ge}}}else de={x:(100-ce)/2,y:(100-ge)/2,width:ce,height:ge};L.silentUpdate(pe=>({...pe,cropBox:de,cropPending:!0}))}function O(){L.silentUpdate(g=>({...g,ratioLocked:!g.ratioLocked}))}async function $(){const g=await Ea(e().currentImage);L.set({...e(),currentImage:g})}async function ne(){const g=await Ha(e().currentImage,90),I=await Ve(g);L.set({...e(),currentImage:g,imageWidth:I.width,imageHeight:I.height,cropBox:{x:0,y:0,width:100,height:100},cropPending:!1})}function X(g){L.silentUpdate(I=>({...I,scale:g/100}))}function V(g){const I=g.detail.cropBox;if(e().ratioLocked&&e().aspectRatio!=="custom"){const K={"9:16":.5625,"1:1":1,"16:9":1.7777777777777777}[e().aspectRatio];e().imageWidth/e().imageHeight;const ee=I.width*e().imageWidth/(I.height*e().imageHeight);if(Math.abs(ee-K)>.01){const ge=I.width/100*e().imageWidth/K/e().imageHeight*100;I.height=Math.min(100,ge),I.y+I.height>100&&(I.y=100-I.height)}}L.silentUpdate(q=>({...q,cropBox:I,cropPending:!0}))}function U(){W()}function te(g){L.silentUpdate(I=>({...I,brightness:g}))}function fe(g){L.silentUpdate(I=>({...I,shadows:g}))}function z(g){L.silentUpdate(I=>({...I,contrast:g}))}function Q(g){L.silentUpdate(I=>({...I,hdr:g}))}function Z(g){L.silentUpdate(I=>({...I,blurBrushSize:g}))}function _e(g){L.silentUpdate(I=>({...I,zoomLevel:g}))}function ie(g){L.silentUpdate(q=>{let{zoomOffsetX:K,zoomOffsetY:ee}=q;switch(g){case"up":ee-=20;break;case"down":ee+=20;break;case"left":K-=20;break;case"right":K+=20;break}return{...q,zoomOffsetX:K,zoomOffsetY:ee}})}function ke(){L.silentUpdate(g=>({...g,zoomLevel:1,zoomOffsetX:0,zoomOffsetY:0}))}function D(g){L.silentUpdate(I=>({...I,activeFilter:g}))}function re(g){L.silentUpdate(I=>({...I,filterStrength:g}))}Ue(()=>e(),()=>{J(d,Math.round(e().imageWidth*e().cropBox.width/100))}),Ue(()=>e(),()=>{J(s,Math.round(e().imageHeight*e().cropBox.height/100))}),Ue(()=>(e(),Ht),()=>{J(u,(()=>{let g=[];if(e().brightness!==0&&g.push(`brightness(${1+e().brightness/100})`),e().contrast!==0&&g.push(`contrast(${1+e().contrast/100})`),e().activeFilter!=="original"){const I=Ht.find(q=>q.id===e().activeFilter);I&&I.css!=="none"&&g.push(I.css)}return g.length>0?g.join(" "):"none"})())}),wt(),ve();var Ie=yn(),Pe=C(Ie);{var Le=g=>{Xt(g,{title:"Crop, edit and add filters to photos",hint:"Import, drag or paste an image",onImageImport:_})},j=g=>{var I=xn(),q=ue(I);{let de=xe(()=>(Re(L),F(()=>L.canUndo()))),pe=xe(()=>(Re(L),F(()=>L.canRedo())));yt(q,{get canUndo(){return c(de)},get canRedo(){return c(pe)},onUndo:R,onRedo:S,onStartAgain:f,onCopy:E,onExport:o})}var K=x(q,2);{let de=xe(()=>(n(),e(),F(()=>n()==="edit"?e().zoomLevel:e().scale))),pe=xe(()=>(n(),e(),F(()=>n()==="edit"?e().zoomOffsetX:e().offsetX))),De=xe(()=>(n(),e(),F(()=>n()==="edit"?e().zoomOffsetY:e().offsetY)));Da(K,{get imageSrc(){return e(),F(()=>e().currentImage)},get cropBox(){return e(),F(()=>e().cropBox)},get isCropping(){return e(),F(()=>e().isCropping)},get scale(){return c(de)},get offsetX(){return c(pe)},get offsetY(){return c(De)},get imageWidth(){return e(),F(()=>e().imageWidth)},get imageHeight(){return e(),F(()=>e().imageHeight)},get editFilters(){return c(u)},$$events:{cropChange:V}})}var ee=x(K,2);Ct(ee,{get tabs(){return h},get activeTab(){return n()},onTabChange:b});var ae=x(ee,2);{var ce=de=>{{let pe=xe(()=>(e(),F(()=>Math.round(e().scale*100))));an(de,{get aspectRatio(){return e(),F(()=>e().aspectRatio)},get cropWidth(){return c(d)},get cropHeight(){return c(s)},get ratioLocked(){return e(),F(()=>e().ratioLocked)},get scale(){return c(pe)},get cropPending(){return e(),F(()=>e().cropPending)},onRatioChange:N,onDimensionsChange:M,onLockToggle:O,onFlip:$,onRotate:ne,onScaleChange:X,onApply:U})}},ge=de=>{var pe=ye(),De=ue(pe);{var Me=We=>{var Ne=_n(),tt=C(Ne);ln(tt,{get brightness(){return e(),F(()=>e().brightness)},get shadows(){return e(),F(()=>e().shadows)},get contrast(){return e(),F(()=>e().contrast)},get hdr(){return e(),F(()=>e().hdr)},get blurBrushSize(){return e(),F(()=>e().blurBrushSize)},get zoomLevel(){return e(),F(()=>e().zoomLevel)},onBrightnessChange:te,onShadowsChange:fe,onContrastChange:z,onHdrChange:Q,onBlurBrushSizeChange:Z,onZoomChange:_e,onNudge:ie,onResetZoom:ke}),w(Ne),y(We,Ne)},qt=We=>{var Ne=ye(),tt=ue(Ne);{var Jt=at=>{var nt=wn(),Vt=C(nt);hn(Vt,{get imageUrl(){return e(),F(()=>e().currentImage)},get activeFilter(){return e(),F(()=>e().activeFilter)},get filterStrength(){return e(),F(()=>e().filterStrength)},onFilterChange:D,onStrengthChange:re}),w(nt),y(at,nt)};Y(tt,at=>{n()==="filter"&&at(Jt)},!0)}y(We,Ne)};Y(De,We=>{n()==="edit"?We(Me):We(qt,!1)},!0)}y(de,pe)};Y(ae,de=>{n()==="crop"?de(ce):de(ge,!1)})}y(g,I)};Y(Pe,g=>{i()?g(j,!1):g(Le)})}var Be=x(Pe,2);{var $e=g=>{pt(g,{message:"Save changes?",confirmText:"Yes",cancelText:"Cancel",onConfirm:B,onCancel:k})};Y(Be,g=>{c(p)==="save"&&g($e)})}var et=x(Be,2);{var Oe=g=>{pt(g,{message:"Start again? Your changes will be lost.",confirmText:"Yes",cancelText:"Cancel",onConfirm:P,onCancel:A})};Y(et,g=>{c(p)==="startAgain"&&g(Oe)})}w(Ie),y(a,Ie),le(),r()}const Et={originalImage:null,currentImage:null,processedImage:null,isProcessing:!1,processingType:null,upscaleFactor:1,showComparison:!1,comparisonPosition:50};function Sn(){const{subscribe:a,set:t,update:e}=Ee(Et);return{subscribe:a,setImage:n=>e(i=>({...i,originalImage:n,currentImage:n,processedImage:null})),startProcessing:n=>e(i=>({...i,isProcessing:!0,processingType:n})),finishProcessing:n=>e(i=>({...i,isProcessing:!1,processingType:null,processedImage:n,currentImage:n,showComparison:!0})),cancelProcessing:()=>e(n=>({...n,isProcessing:!1,processingType:null})),setUpscaleFactor:n=>e(i=>({...i,upscaleFactor:n})),setComparisonPosition:n=>e(i=>({...i,comparisonPosition:n})),reset:()=>t(Et)}}const Ze=Sn(),Bt=Ee("enhance"),kn=xt(Ze,a=>a.currentImage!==null);var In=H('<div class="controls-panel svelte-17agwu4"><button class="ai-action-btn svelte-17agwu4"><img src="/icons/icon-ai.svg" alt="" class="ai-icon svelte-17agwu4"/> Enhance image</button> <p class="ai-hint svelte-17agwu4">Sharpens and enhances images at the same size</p></div>'),zn=H('<div class="controls-panel svelte-17agwu4"><p class="placeholder svelte-17agwu4">Upscale controls coming in Phase 4</p></div>'),Tn=H('<div class="controls-panel svelte-17agwu4"><p class="placeholder svelte-17agwu4">Background removal coming in Phase 4</p></div>'),Rn=H('<!> <div class="image-container svelte-17agwu4"><img alt="Working image" class="working-image svelte-17agwu4"/></div> <!> <!>',1),Pn=H('<div class="ai-tab svelte-17agwu4"><!></div>');function An(a,t){se(t,!1);const e=()=>Ce(Ze,"$aiState",l),n=()=>Ce(kn,"$hasAiImage",l),i=()=>Ce(Bt,"$activeAiMenu",l),[l,r]=Ge(),d=[{id:"enhance",label:"Enhance"},{id:"upscale",label:"Upscale"},{id:"background",label:"Remove background"}];function s(o){Ze.setImage(o)}function u(o){Bt.set(o)}async function h(){e().currentImage&&await ht(e().currentImage)}function p(){e().currentImage&&ft(e().currentImage,"picflam-ai.png")}ve();var m=Pn(),_=C(m);{var b=o=>{Xt(o,{title:"Enhance, upscale and remove backgrounds using AI power",hint:"Import, drag or paste an image",onImageImport:s})},E=o=>{var f=Rn(),R=ue(f);yt(R,{canUndo:!1,canRedo:!1,onUndo:()=>{},onRedo:()=>{},onStartAgain:()=>Ze.reset(),onCopy:h,onExport:p});var S=x(R,2),B=C(S);w(S);var k=x(S,2);Ct(k,{get tabs(){return d},get activeTab(){return i()},onTabChange:u});var P=x(k,2);{var A=N=>{var M=In();y(N,M)},W=N=>{var M=ye(),O=ue(M);{var $=X=>{var V=zn();y(X,V)},ne=X=>{var V=ye(),U=ue(V);{var te=fe=>{var z=Tn();y(fe,z)};Y(U,fe=>{i()==="background"&&fe(te)},!0)}y(X,V)};Y(O,X=>{i()==="upscale"?X($):X(ne,!1)},!0)}y(N,M)};Y(P,N=>{i()==="enhance"?N(A):N(W,!1)})}G(()=>oe(B,"src",e().currentImage)),y(o,f)};Y(_,o=>{n()?o(E,!1):o(b)})}w(m),y(a,m),le(),r()}const Fn={canvasSize:"1/1",background:{type:"solid",value:"#FFFFFF"},text1:"",text1Font:"Inter",text1Size:5,text1YPosition:3,text1LineSpacing:5,text1Color:"#000000",text1HighlightColor:"transparent",text1IsBold:!0,text1Align:"center",text1QuoteStyle:"none",text1QuoteSize:5,text2:"",text2Font:"Inter",text2Size:3,text2YPosition:8,text2LineSpacing:5,text2Color:"#000000",text2LabelColor:"transparent",text2IsBold:!1,text2Align:"center",overlay:null,overlayScale:1,overlayOpacity:1,overlayX:0,overlayY:0,overlayMask:"none",overlayWrap:!1,overlayBorderWidth:0,overlayBorderColor:"#FFFFFF"};function Hn(a){const t=[JSON.parse(JSON.stringify(a))];let e=0;const{subscribe:n,set:i,update:l}=Ee(a);return{subscribe:n,set:r=>{t.splice(e+1),t.push(JSON.parse(JSON.stringify(r))),e=t.length-1,i(r)},update:r=>{l(d=>{const s=r(d);return t.splice(e+1),t.push(JSON.parse(JSON.stringify(s))),e=t.length-1,s})},undo:()=>e>0?(e--,i(JSON.parse(JSON.stringify(t[e]))),!0):!1,redo:()=>e<t.length-1?(e++,i(JSON.parse(JSON.stringify(t[e]))),!0):!1,canUndo:()=>e>0,canRedo:()=>e<t.length-1,reset:()=>{const r=JSON.parse(JSON.stringify(a));t.length=0,t.push(r),e=0,i(r)}}}const He=Hn(Fn),mt=Ee(!0),bt=Ee("none");xt(He,a=>a.text1||a.text2||a.overlay||a.background.value!=="#FFFFFF");function En(){He.reset(),mt.set(!0),bt.set("none")}var Bn=H('<button class="template-card svelte-fxk5n4"><div class="template-placeholder svelte-fxk5n4"> </div></button>'),Mn=H('<div class="template-picker svelte-fxk5n4"><p class="picker-title svelte-fxk5n4">Create quotes and cards. Start with a template or blank canvas</p> <button class="blank-canvas-btn svelte-fxk5n4"><img src="/icons/icon-add.svg" alt="" class="add-icon svelte-fxk5n4"/></button> <div class="template-grid svelte-fxk5n4"></div></div>'),Un=H('<p class="placeholder svelte-fxk5n4">Size controls coming in Phase 5</p>'),Ln=H('<p class="placeholder svelte-fxk5n4">Background controls coming in Phase 5</p>'),Wn=H('<p class="placeholder svelte-fxk5n4">Text 1 controls coming in Phase 5</p>'),Nn=H('<p class="placeholder svelte-fxk5n4">Text 2 controls coming in Phase 5</p>'),On=H('<p class="placeholder svelte-fxk5n4">Quote controls coming in Phase 5</p>'),Dn=H('<p class="placeholder svelte-fxk5n4">Overlay controls coming in Phase 5</p>'),Yn=H('<!> <div class="canvas-container svelte-fxk5n4"><div class="design-canvas svelte-fxk5n4"></div></div> <!> <div class="controls-panel svelte-fxk5n4"><!></div>',1),jn=H('<div class="design-tab svelte-fxk5n4"><!></div>');function Xn(a,t){se(t,!1);const e=()=>Ce(bt,"$activeDesignMenu",l),n=()=>Ce(mt,"$showTemplatePicker",l),i=()=>Ce(He,"$slideState",l),[l,r]=Ge(),d=[{id:"size",label:"Size"},{id:"background",label:"Background"},{id:"text1",label:"Text 1"},{id:"text2",label:"Text 2"},{id:"quote",label:"Quote"},{id:"overlay",label:"Overlay"}];function s(o){o==="blank"&&He.reset(),mt.set(!1)}function u(o){bt.set(e()===o?"none":o)}async function h(){}function p(){}ve();var m=jn(),_=C(m);{var b=o=>{var f=Mn(),R=x(C(f),2),S=x(R,2);Ke(S,4,()=>[1,2,3,4,5,6],Qe,(B,k)=>{var P=Bn(),A=C(P),W=C(A);w(A),w(P),G(()=>be(W,`Template ${k??""}`)),T("click",P,()=>s(`template-${k}`)),y(B,P)}),w(S),w(f),T("click",R,()=>s("blank")),y(o,f)},E=o=>{var f=Yn(),R=ue(f);{let M=xe(()=>He.canUndo()),O=xe(()=>He.canRedo());yt(R,{get canUndo(){return c(M)},get canRedo(){return c(O)},onUndo:()=>He.undo(),onRedo:()=>He.redo(),get onStartAgain(){return En},onCopy:h,onExport:p})}var S=x(R,2),B=C(S);w(S);var k=x(S,2);Ct(k,{get tabs(){return d},get activeTab(){return e()},onTabChange:u});var P=x(k,2),A=C(P);{var W=M=>{var O=Un();y(M,O)},N=M=>{var O=ye(),$=ue(O);{var ne=V=>{var U=Ln();y(V,U)},X=V=>{var U=ye(),te=ue(U);{var fe=Q=>{var Z=Wn();y(Q,Z)},z=Q=>{var Z=ye(),_e=ue(Z);{var ie=D=>{var re=Nn();y(D,re)},ke=D=>{var re=ye(),Ie=ue(re);{var Pe=j=>{var Be=On();y(j,Be)},Le=j=>{var Be=ye(),$e=ue(Be);{var et=Oe=>{var g=Dn();y(Oe,g)};Y($e,Oe=>{e()==="overlay"&&Oe(et)},!0)}y(j,Be)};Y(Ie,j=>{e()==="quote"?j(Pe):j(Le,!1)},!0)}y(D,re)};Y(_e,D=>{e()==="text2"?D(ie):D(ke,!1)},!0)}y(Q,Z)};Y(te,Q=>{e()==="text1"?Q(fe):Q(z,!1)},!0)}y(V,U)};Y($,V=>{e()==="background"?V(ne):V(X,!1)},!0)}y(M,O)};Y(A,M=>{e()==="size"?M(W):M(N,!1)})}w(P),G(()=>ze(B,`
					aspect-ratio: ${i().canvasSize??""};
					background: ${i().background.type==="solid",i().background.value??""};
				`)),y(o,f)};Y(_,o=>{n()?o(b):o(E,!1)})}w(m),y(a,m),le(),r()}const lt=Ee("crop");var qn=H('<!> <main class="main svelte-1uha8ag"><!></main> <!>',1);function ti(a,t){se(t,!1);const e=()=>Ce(lt,"$activeTab",i),n=()=>Ce(L,"$cropState",i),[i,l]=Ge();let r=he(!1),d=null;function s(S){if(e()==="crop"&&n().cropPending&&S!=="crop"){d=S,J(r,!0);return}lt.set(S)}async function u(){J(r,!1);const S=n();if(S.currentImage&&S.cropPending){const B=await jt(S.currentImage,S.cropBox,S.imageWidth,S.imageHeight),k=await Ve(B);L.set({...S,currentImage:B,imageWidth:k.width,imageHeight:k.height,cropBox:{x:0,y:0,width:100,height:100},cropPending:!1,isCropping:!1})}d&&(lt.set(d),d=null)}function h(){J(r,!1),d=null}ve();var p=qn(),m=ue(p);Aa(m,{get activeTab(){return e()},onTabChange:s});var _=x(m,2),b=C(_);{var E=S=>{Cn(S,{})},o=S=>{var B=ye(),k=ue(B);{var P=W=>{An(W,{})},A=W=>{var N=ye(),M=ue(N);{var O=$=>{Xn($,{})};Y(M,$=>{e()==="design"&&$(O)},!0)}y(W,N)};Y(k,W=>{e()==="ai"?W(P):W(A,!1)},!0)}y(S,B)};Y(b,S=>{e()==="crop"?S(E):S(o,!1)})}w(_);var f=x(_,2);{var R=S=>{pt(S,{message:"Save changes?",confirmText:"Yes",cancelText:"Cancel",onConfirm:u,onCancel:h})};Y(f,S=>{c(r)&&S(R)})}y(a,p),le(),l()}export{ti as component};

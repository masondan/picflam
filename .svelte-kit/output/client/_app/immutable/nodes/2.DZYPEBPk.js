import{b as ca,d as Oa,f as F,a as T,c as gt}from"../chunks/Dj8On0Xh.js";import"../chunks/Bnc7oL5D.js";import{F as Ut,i as tt,x as Dt,C as jt,j as Vt,M as Ua,g as n,aI as at,aA as Ha,O as Wa,a5 as da,aj as Nt,B as St,N as Sa,ao as ja,a2 as va,ax as Ct,P as Jt,az as Na,am as na,w as Ia,I as ua,at as N,aO as Ya,aP as Xa,aQ as Ga,aR as ht,ay as za,R as Ra,aS as Yt,ah as Ba,aT as Qa,al as Va,a3 as Ja,aU as Ea,L as Pa,aV as Za,t as J,A as Ka,aW as $a,ap as en,ai as tn,aX as an,aY as nn,aZ as on,a_ as rn,a$ as ln,b0 as sn,av as cn,b as m,J as dn,b1 as vn,p as Le,n as Me,s as u,k as f,l as g,aq as z,b2 as je,b3 as pt,e as Pe,a4 as _t,m as Ye,b4 as ga,b5 as La}from"../chunks/c1y374w_.js";import{p as h,b as ft,i as $,s as it,a as Rt,_ as un}from"../chunks/DZfZzOi_.js";import{i as Te}from"../chunks/CBwOI1Gw.js";import{e as p,s as He}from"../chunks/8R3vFiuv.js";import{c as gn,o as Bt,d as ia,w as bt,a as oa}from"../chunks/pj8eKBGp.js";function dt(i,a){return a}function hn(i,a,e){for(var t=[],o=a.length,r,d=a.length,c=0;c<o;c++){let y=a[c];Ra(y,()=>{if(r){if(r.pending.delete(y),r.done.add(y),r.pending.size===0){var S=i.outrogroups;Zt(na(r.done)),S.delete(r),S.size===0&&(i.outrogroups=null)}}else d-=1},!1)}if(d===0){var s=t.length===0&&e!==null;if(s){var v=e,b=v.parentNode;Va(b),b.append(v),i.items.clear()}Zt(a,!s)}else r={pending:new Set(a),done:new Set},(i.outrogroups??=new Set).add(r)}function Zt(i,a=!0){for(var e=0;e<i.length;e++)Ja(i[e],a)}var ha;function vt(i,a,e,t,o,r=null){var d=i,c=new Map,s=(a&Ea)!==0;if(s){var v=i;d=tt?Ut(Dt(v)):v.appendChild(jt())}tt&&Vt();var b=null,y=at(()=>{var w=e();return Ia(w)?w:w==null?[]:na(w)}),S,x=!0;function _(){l.fallback=b,fn(l,S,d,a,t),b!==null&&(S.length===0?(b.f&ht)===0?za(b):(b.f^=ht,Tt(b,null,d)):Ra(b,()=>{b=null}))}var R=Ua(()=>{S=n(y);var w=S.length;let M=!1;if(tt){var E=Ha(d)===Wa;E!==(w===0)&&(d=da(),Ut(d),Nt(!1),M=!0)}for(var L=new Set,D=Ct,I=Na(),C=0;C<w;C+=1){tt&&St.nodeType===Sa&&St.data===ja&&(d=St,M=!0,Nt(!1));var P=S[C],H=t(P,C),Y=x?null:c.get(H);Y?(Y.v&&va(Y.v,P),Y.i&&va(Y.i,C),I&&D.skipped_effects.delete(Y.e)):(Y=bn(c,x?d:ha??=jt(),P,H,C,o,a,e),x||(Y.e.f|=ht),c.set(H,Y)),L.add(H)}if(w===0&&r&&!b&&(x?b=Jt(()=>r(d)):(b=Jt(()=>r(ha??=jt())),b.f|=ht)),tt&&w>0&&Ut(da()),!x)if(I){for(const[ee,me]of c)L.has(ee)||D.skipped_effects.add(me.e);D.oncommit(_),D.ondiscard(()=>{})}else _();M&&Nt(!0),n(y)}),l={effect:R,items:c,outrogroups:null,fallback:b};x=!1,tt&&(d=St)}function Pt(i){for(;i!==null&&(i.f&Qa)===0;)i=i.next;return i}function fn(i,a,e,t,o){var r=(t&Za)!==0,d=a.length,c=i.items,s=Pt(i.effect.first),v,b=null,y,S=[],x=[],_,R,l,w;if(r)for(w=0;w<d;w+=1)_=a[w],R=o(_,w),l=c.get(R).e,(l.f&ht)===0&&(l.nodes?.a?.measure(),(y??=new Set).add(l));for(w=0;w<d;w+=1){if(_=a[w],R=o(_,w),l=c.get(R).e,i.outrogroups!==null)for(const Y of i.outrogroups)Y.pending.delete(l),Y.done.delete(l);if((l.f&ht)!==0)if(l.f^=ht,l===s)Tt(l,null,e);else{var M=b?b.next:s;l===i.effect.last&&(i.effect.last=l.prev),l.prev&&(l.prev.next=l.next),l.next&&(l.next.prev=l.prev),xt(i,b,l),xt(i,l,M),Tt(l,M,e),b=l,S=[],x=[],s=Pt(b.next);continue}if((l.f&Yt)!==0&&(za(l),r&&(l.nodes?.a?.unfix(),(y??=new Set).delete(l))),l!==s){if(v!==void 0&&v.has(l)){if(S.length<x.length){var E=x[0],L;b=E.prev;var D=S[0],I=S[S.length-1];for(L=0;L<S.length;L+=1)Tt(S[L],E,e);for(L=0;L<x.length;L+=1)v.delete(x[L]);xt(i,D.prev,I.next),xt(i,b,D),xt(i,I,E),s=E,b=I,w-=1,S=[],x=[]}else v.delete(l),Tt(l,s,e),xt(i,l.prev,l.next),xt(i,l,b===null?i.effect.first:b.next),xt(i,b,l),b=l;continue}for(S=[],x=[];s!==null&&s!==l;)(v??=new Set).add(s),x.push(s),s=Pt(s.next);if(s===null)continue}(l.f&ht)===0&&S.push(l),b=l,s=Pt(l.next)}if(i.outrogroups!==null){for(const Y of i.outrogroups)Y.pending.size===0&&(Zt(na(Y.done)),i.outrogroups?.delete(Y));i.outrogroups.size===0&&(i.outrogroups=null)}if(s!==null||v!==void 0){var C=[];if(v!==void 0)for(l of v)(l.f&Yt)===0&&C.push(l);for(;s!==null;)(s.f&Yt)===0&&s!==i.fallback&&C.push(s),s=Pt(s.next);var P=C.length;if(P>0){var H=(t&Ea)!==0&&d===0?e:null;if(r){for(w=0;w<P;w+=1)C[w].nodes?.a?.measure();for(w=0;w<P;w+=1)C[w].nodes?.a?.fix()}hn(i,C,H)}}r&&Pa(()=>{if(y!==void 0)for(l of y)l.nodes?.a?.apply()})}function bn(i,a,e,t,o,r,d,c){var s=(d&Xa)!==0?(d&Ga)===0?N(e,!1,!1):ua(e):null,v=(d&Ya)!==0?ua(o):null;return{v:s,i:v,e:Jt(()=>(r(a,s??e,v??o,c),()=>{i.delete(t)}))}}function Tt(i,a,e){if(i.nodes)for(var t=i.nodes.start,o=i.nodes.end,r=a&&(a.f&ht)===0?a.nodes.start:e;t!==null;){var d=Ba(t);if(r.before(t),t===o)return;t=d}}function xt(i,a,e){a===null?i.effect.first=e:a.next=e,e===null?i.effect.last=a:e.prev=a}function fa(i,a,e=!1,t=!1,o=!1){var r=i,d="";J(()=>{var c=Ka;if(d===(d=a()??"")){tt&&Vt();return}if(c.nodes!==null&&($a(c.nodes.start,c.nodes.end),c.nodes=null),d!==""){if(tt){St.data;for(var s=Vt(),v=s;s!==null&&(s.nodeType!==Sa||s.data!=="");)v=s,s=Ba(s);if(s===null)throw en(),tn;ca(St,v),r=Ut(s);return}var b=d+"";e?b=`<svg>${b}</svg>`:t&&(b=`<math>${b}</math>`);var y=Oa(b);if((e||t)&&(y=Dt(y)),ca(Dt(y),y.lastChild),e||t)for(;Dt(y);)r.before(Dt(y));else r.before(y)}})}const ba=[...` 	
\r\fÂ \v\uFEFF`];function mn(i,a,e){var t=i==null?"":""+i;if(e){for(var o in e)if(e[o])t=t?t+" "+o:o;else if(t.length)for(var r=o.length,d=0;(d=t.indexOf(o,d))>=0;){var c=d+r;(d===0||ba.includes(t[d-1]))&&(c===t.length||ba.includes(t[c]))?t=(d===0?"":t.substring(0,d))+t.substring(c+1):d=c}}return t===""?null:t}function pn(i,a){return i==null?null:String(i)}function ue(i,a,e,t,o,r){var d=i.__className;if(tt||d!==e||d===void 0){var c=mn(e,t,r);(!tt||c!==i.getAttribute("class"))&&(c==null?i.removeAttribute("class"):i.className=c),i.__className=e}else if(r&&o!==r)for(var s in r){var v=!!r[s];(o==null||v!==!!o[s])&&i.classList.toggle(s,v)}return r}function we(i,a,e,t){var o=i.__style;if(tt||o!==a){var r=pn(a);(!tt||r!==i.getAttribute("style"))&&(r==null?i.removeAttribute("style"):i.style.cssText=r),i.__style=a}return t}const wn=Symbol("is custom element"),xn=Symbol("is html");function Ft(i){if(tt){var a=!1,e=()=>{if(!a){if(a=!0,i.hasAttribute("value")){var t=i.value;_e(i,"value",null),i.value=t}if(i.hasAttribute("checked")){var o=i.checked;_e(i,"checked",null),i.checked=o}}};i.__on_r=e,Pa(e),ln()}}function qt(i,a){var e=ra(i);e.value===(e.value=a??void 0)||i.value===a&&(a!==0||i.nodeName!=="PROGRESS")||(i.value=a??"")}function _n(i,a){var e=ra(i);e.checked!==(e.checked=a??void 0)&&(i.checked=a)}function _e(i,a,e,t){var o=ra(i);tt&&(o[a]=i.getAttribute(a),a==="src"||a==="srcset"||a==="href"&&i.nodeName==="LINK")||o[a]!==(o[a]=e)&&(a==="loading"&&(i[an]=e),e==null?i.removeAttribute(a):typeof e!="string"&&yn(i).includes(a)?i[a]=e:i.setAttribute(a,e))}function ra(i){return i.__attributes??={[wn]:i.nodeName.includes("-"),[xn]:i.namespaceURI===nn}}var ma=new Map;function yn(i){var a=i.getAttribute("is")||i.nodeName,e=ma.get(a);if(e)return e;ma.set(a,e=[]);for(var t,o=i,r=Element.prototype;r!==o;){t=rn(o);for(var d in t)t[d].set&&e.push(d);o=on(o)}return e}function kn(i,a,e=a){var t=new WeakSet;sn(i,"input",async o=>{var r=o?i.defaultValue:i.value;if(r=Xt(i)?Gt(r):r,e(r),Ct!==null&&t.add(Ct),await cn(),r!==(r=a())){var d=i.selectionStart,c=i.selectionEnd,s=i.value.length;if(i.value=r??"",c!==null){var v=i.value.length;d===c&&c===s&&v>s?(i.selectionStart=v,i.selectionEnd=v):(i.selectionStart=d,i.selectionEnd=Math.min(c,v))}}}),(tt&&i.defaultValue!==i.value||m(a)==null&&i.value)&&(e(Xt(i)?Gt(i.value):i.value),Ct!==null&&t.add(Ct)),dn(()=>{var o=a();if(i===document.activeElement){var r=vn??Ct;if(t.has(r))return}Xt(i)&&o===Gt(i.value)||i.type==="date"&&!o&&!i.value||o!==i.value&&(i.value=o??"")})}function Xt(i){var a=i.type;return a==="number"||a==="range"}function Gt(i){return i===""?null:+i}function st(i){return function(...a){var e=a[0];return e.stopPropagation(),i?.apply(this,a)}}function Kt(i,a){var e=i.$$events?.[a.type],t=Ia(e)?e.slice():e==null?[]:[e];for(var o of t)o.call(this,a)}var Cn=F('<header class="header svelte-hv3zzy"><img src="/logos/logo-picflam-logotype.png" alt="PicFlam" class="header-logo svelte-hv3zzy"/> <nav class="header-nav svelte-hv3zzy"><button aria-label="Crop tab"><img src="/icons/icon-crop.svg" alt="" class="nav-icon svelte-hv3zzy"/></button> <button aria-label="AI tab"><img src="/icons/icon-ai.svg" alt="" class="nav-icon svelte-hv3zzy"/></button> <button aria-label="Design tab"><img src="/icons/icon-design.svg" alt="" class="nav-icon svelte-hv3zzy"/></button></nav></header>');function Sn(i,a){Le(a,!1);let e=h(a,"activeTab",8,"crop"),t=h(a,"onTabChange",8);Te();var o=Cn(),r=u(f(o),2),d=f(r);let c;var s=u(d,2);let v;var b=u(s,2);let y;g(r),g(o),J(()=>{c=ue(d,1,"nav-btn svelte-hv3zzy",null,c,{active:e()==="crop"}),v=ue(s,1,"nav-btn svelte-hv3zzy",null,v,{active:e()==="ai"}),y=ue(b,1,"nav-btn svelte-hv3zzy",null,y,{active:e()==="design"})}),p("click",d,()=>t()("crop")),p("click",s,()=>t()("ai")),p("click",b,()=>t()("design")),T(i,o),Me()}function Ma(i){return new Promise((a,e)=>{const t=new FileReader;t.onload=o=>a(o.target.result),t.onerror=e,t.readAsDataURL(i)})}function mt(i){return new Promise((a,e)=>{const t=new Image;t.onload=()=>a(t),t.onerror=e,t.src=i})}async function Ht(i){const a=await mt(i);return{width:a.naturalWidth,height:a.naturalHeight}}function pa(i,a=2048){return new Promise(async e=>{const t=await mt(i),{naturalWidth:o,naturalHeight:r}=t;if(o<=a&&r<=a){e(i);return}const d=document.createElement("canvas"),c=d.getContext("2d");let s,v;o>r?(s=a,v=r/o*a):(v=a,s=o/r*a),d.width=s,d.height=v,c.drawImage(t,0,0,s,v),e(d.toDataURL("image/jpeg",.92))})}async function In(){try{const i=await navigator.clipboard.read();for(const a of i)for(const e of a.types)if(e.startsWith("image/")){const t=await a.getType(e);return await Ma(t)}return null}catch(i){return console.error("Failed to paste from clipboard:",i),null}}async function $t(i){try{const e=await(await fetch(i)).blob();return await navigator.clipboard.write([new ClipboardItem({[e.type]:e})]),!0}catch(a){return console.error("Failed to copy to clipboard:",a),!1}}function ea(i,a="picflam-export.png"){const e=document.createElement("a");e.href=i,e.download=a,document.body.appendChild(e),e.click(),document.body.removeChild(e)}async function Da(i,a,e,t){const o=await mt(i),r=document.createElement("canvas"),d=r.getContext("2d"),c=a.x/100*e,s=a.y/100*t,v=a.width/100*e,b=a.height/100*t;return r.width=v,r.height=b,d.drawImage(o,c,s,v,b,0,0,v,b),r.toDataURL("image/png")}async function zn(i,a){const e=await mt(i),t=document.createElement("canvas"),o=t.getContext("2d");return t.width=e.naturalHeight,t.height=e.naturalWidth,o.translate(t.width/2,t.height/2),o.rotate(a*Math.PI/180),o.drawImage(e,-e.naturalWidth/2,-e.naturalHeight/2),t.toDataURL("image/png")}async function Rn(i,a){const e=await mt(i),t=document.createElement("canvas"),o=t.getContext("2d");return t.width=e.naturalWidth,t.height=e.naturalHeight,o.translate(t.width,0),o.scale(-1,1),o.drawImage(e,0,0),t.toDataURL("image/png")}async function Bn(i,a,e){const t=await mt(i),o=document.createElement("canvas"),r=o.getContext("2d");if(o.width=t.naturalWidth,o.height=t.naturalHeight,a&&a!=="none"&&(r.filter=a),r.drawImage(t,0,0),r.filter="none",e&&Array.isArray(e)&&e.length>0)if(e.some(c=>c.invert)){const s=.5+e.reduce((l,w)=>l+(w.strength||50),0)/e.length/100*9.5,v=document.createElement("canvas");v.width=o.width,v.height=o.height;const b=v.getContext("2d");b.filter=`blur(${s}px)`,a&&a!=="none"&&(b.filter=`blur(${s}px) ${a}`),b.drawImage(t,0,0);const y=document.createElement("canvas");y.width=o.width,y.height=o.height;const S=y.getContext("2d");S.fillStyle="white",S.fillRect(0,0,y.width,y.height);for(const l of e){if(!l.invert)continue;const w=(l.soften||50)/100,M=S.createRadialGradient(l.x,l.y,0,l.x,l.y,l.radius);M.addColorStop(0,"rgba(0,0,0,1)"),M.addColorStop(.5+w*.3,"rgba(0,0,0,0.5)"),M.addColorStop(1,"rgba(0,0,0,0)"),S.fillStyle=M,S.beginPath(),S.arc(l.x,l.y,l.radius,0,Math.PI*2),S.fill()}const x=r.getImageData(0,0,o.width,o.height),_=b.getImageData(0,0,o.width,o.height),R=S.getImageData(0,0,o.width,o.height);for(let l=0;l<x.data.length;l+=4){const w=R.data[l]/255;x.data[l]=x.data[l]*w+_.data[l]*(1-w),x.data[l+1]=x.data[l+1]*w+_.data[l+1]*(1-w),x.data[l+2]=x.data[l+2]*w+_.data[l+2]*(1-w)}r.putImageData(x,0,0)}else for(const c of e){const s=c.strength||50,v=(c.soften||50)/100,b=.5+s/100*9.5,y=document.createElement("canvas");y.width=o.width,y.height=o.height;const S=y.getContext("2d");S.filter=`blur(${b}px)`,a&&a!=="none"&&(S.filter=`blur(${b}px) ${a}`),S.drawImage(t,0,0);const x=document.createElement("canvas");x.width=o.width,x.height=o.height;const _=x.getContext("2d"),R=_.createRadialGradient(c.x,c.y,0,c.x,c.y,c.radius);R.addColorStop(0,"rgba(255,255,255,1)"),R.addColorStop(.5+v*.3,"rgba(255,255,255,0.5)"),R.addColorStop(1,"rgba(255,255,255,0)"),_.fillStyle=R,_.beginPath(),_.arc(c.x,c.y,c.radius,0,Math.PI*2),_.fill();const l=r.getImageData(0,0,o.width,o.height),w=S.getImageData(0,0,o.width,o.height),M=_.getImageData(0,0,o.width,o.height);for(let E=0;E<l.data.length;E+=4){const L=M.data[E]/255;l.data[E]=l.data[E]*(1-L)+w.data[E]*L,l.data[E+1]=l.data[E+1]*(1-L)+w.data[E+1]*L,l.data[E+2]=l.data[E+2]*(1-L)+w.data[E+2]*L}r.putImageData(l,0,0)}return o.toDataURL("image/png")}var En=F('<div role="button" tabindex="0"><p class="import-title svelte-f1bndr"> </p> <img src="/icons/icon-upload.svg" alt="" class="import-icon svelte-f1bndr"/> <p class="import-hint svelte-f1bndr"> </p> <button class="btn-paste svelte-f1bndr">Paste</button> <input type="file" accept="image/*" class="sr-only"/></div>');function Ta(i,a){Le(a,!1);let e=h(a,"title",8,"Import an image"),t=h(a,"hint",8,"Import, drag or paste an image"),o=h(a,"onImageImport",8,I=>{}),r=N(!1),d=N();async function c(I){if(!I||!I.type.startsWith("image/"))return;const C=await Ma(I),P=await pa(C,2048);o()(P)}function s(I){const C=I.target.files?.[0];C&&c(C)}function v(I){I.preventDefault(),z(r,!1);const C=I.dataTransfer?.files?.[0];C&&c(C)}function b(I){I.preventDefault(),z(r,!0)}function y(){z(r,!1)}async function S(){const I=await In();if(I){const C=await pa(I,2048);o()(C)}}function x(){n(d)?.click()}Te();var _=En();let R;var l=f(_),w=f(l,!0);g(l);var M=u(l,4),E=f(M,!0);g(M);var L=u(M,2),D=u(L,2);ft(D,I=>z(d,I),()=>n(d)),g(_),J(()=>{R=ue(_,1,"import-area svelte-f1bndr",null,R,{dragging:n(r)}),He(w,e()),He(E,t())}),p("click",L,st(S)),p("change",D,s),p("click",_,x),p("drop",_,v),p("dragover",_,b),p("dragleave",_,y),p("keypress",_,I=>I.key==="Enter"&&x()),T(i,_),Me()}var Pn=F('<div class="action-bar svelte-96zw02"><div class="action-group svelte-96zw02"><button class="action-btn svelte-96zw02" aria-label="Undo"><img src="/icons/icon-undo.svg" alt="" class="action-icon svelte-96zw02"/></button> <button class="action-btn svelte-96zw02" aria-label="Redo"><img src="/icons/icon-redo.svg" alt="" class="action-icon svelte-96zw02"/></button></div> <div class="action-group svelte-96zw02"><button class="action-btn svelte-96zw02" aria-label="Start again"><img src="/icons/icon-startagain.svg" alt="" class="action-icon svelte-96zw02"/></button> <button class="action-btn svelte-96zw02" aria-label="Copy to clipboard"><img src="/icons/icon-copy.svg" alt="" class="action-icon svelte-96zw02"/></button> <button class="action-btn svelte-96zw02" aria-label="Export"><img src="/icons/icon-export.svg" alt="" class="action-icon svelte-96zw02"/></button></div></div>');function la(i,a){let e=h(a,"canUndo",8,!1),t=h(a,"canRedo",8,!1),o=h(a,"onUndo",8,()=>{}),r=h(a,"onRedo",8,()=>{}),d=h(a,"onStartAgain",8,()=>{}),c=h(a,"onCopy",8,()=>{}),s=h(a,"onExport",8,()=>{});var v=Pn(),b=f(v),y=f(b),S=u(y,2);g(b);var x=u(b,2),_=f(x),R=u(_,2),l=u(R,2);g(x),g(v),J(()=>{y.disabled=!e(),S.disabled=!t()}),p("click",y,function(...w){o()?.apply(this,w)}),p("click",S,function(...w){r()?.apply(this,w)}),p("click",_,function(...w){d()?.apply(this,w)}),p("click",R,function(...w){c()?.apply(this,w)}),p("click",l,function(...w){s()?.apply(this,w)}),T(i,v)}var Ln=F("<button> </button>"),Mn=F('<div class="sub-menu-tabs svelte-tv6tw8"></div>');function sa(i,a){Le(a,!1);let e=h(a,"tabs",24,()=>[]),t=h(a,"activeTab",8,""),o=h(a,"onTabChange",8,d=>{});Te();var r=Mn();vt(r,5,e,dt,(d,c)=>{var s=Ln();let v;var b=f(s,!0);g(s),J(()=>{v=ue(s,1,"sub-menu-tab svelte-tv6tw8",null,v,{active:t()===n(c).id}),He(b,(n(c),m(()=>n(c).label)))}),p("click",s,()=>o()(n(c).id)),T(d,s)}),g(r),T(i,r),Me()}var Dn=F('<div class="modal-overlay svelte-qik81a" role="dialog" aria-modal="true" tabindex="-1"><div class="modal svelte-qik81a" role="document"><p class="modal-message svelte-qik81a"> </p> <div class="modal-actions svelte-qik81a"><button class="btn-text svelte-qik81a"> </button> <button class="btn-text btn-confirm svelte-qik81a"> </button></div></div></div>');function ta(i,a){Le(a,!1);let e=h(a,"message",8,""),t=h(a,"confirmText",8,"Yes"),o=h(a,"cancelText",8,"Cancel"),r=h(a,"onConfirm",8,()=>{}),d=h(a,"onCancel",8,()=>{});Te();var c=Dn(),s=f(c),v=f(s),b=f(v,!0);g(v);var y=u(v,2),S=f(y),x=f(S,!0);g(S);var _=u(S,2),R=f(_,!0);g(_),g(y),g(s),g(c),J(()=>{He(b,e()),He(x,o()),He(R,t())}),p("click",S,function(...l){d()?.apply(this,l)}),p("click",_,function(...l){r()?.apply(this,l)}),p("click",s,st(function(l){Kt.call(this,a,l)})),p("keydown",s,st(function(l){Kt.call(this,a,l)})),p("click",c,function(...l){d()?.apply(this,l)}),p("keydown",c,l=>l.key==="Escape"&&d()()),T(i,c),Me()}var Tn=F('<canvas class="blur-canvas svelte-pjowa5"></canvas>'),An=F('<div class="blur-brush-indicator svelte-pjowa5"></div>'),Fn=F('<div class="blur-brush-preview svelte-pjowa5"></div>'),qn=F('<div class="crop-overlay svelte-pjowa5"><div class="overlay-top svelte-pjowa5"></div> <div class="overlay-bottom svelte-pjowa5"></div> <div class="overlay-left svelte-pjowa5"></div> <div class="overlay-right svelte-pjowa5"></div> <div class="crop-box svelte-pjowa5" role="button" aria-label="Drag to move crop area" tabindex="0"><div class="crop-border svelte-pjowa5"></div> <div class="corner-handle top-left svelte-pjowa5" role="button" aria-label="Resize top-left corner" tabindex="0"></div> <div class="corner-handle top-right svelte-pjowa5" role="button" aria-label="Resize top-right corner" tabindex="0"></div> <div class="corner-handle bottom-left svelte-pjowa5" role="button" aria-label="Resize bottom-left corner" tabindex="0"></div> <div class="corner-handle bottom-right svelte-pjowa5" role="button" aria-label="Resize bottom-right corner" tabindex="0"></div></div></div>'),On=F('<div class="crop-canvas svelte-pjowa5" role="application" aria-label="Image crop canvas"><div class="image-wrapper svelte-pjowa5"><img alt="Crop preview" class="canvas-image svelte-pjowa5" draggable="false"/> <!></div> <!> <!> <!></div>');function Un(i,a){Le(a,!1);const e=N(),t=N(),o=N(),r=N();let d=h(a,"imageSrc",8,""),c=h(a,"cropBox",24,()=>({x:10,y:10,width:80,height:80})),s=h(a,"isCropping",8,!1),v=h(a,"scale",8,1),b=h(a,"offsetX",8,0),y=h(a,"offsetY",8,0),S=h(a,"imageWidth",8,0),x=h(a,"imageHeight",8,0),_=h(a,"editFilters",8,""),R=h(a,"blurEnabled",8,!1),l=h(a,"blurBrushSize",8,50),w=h(a,"blurStrength",8,50),M=h(a,"blurSoften",8,50),E=h(a,"blurInvert",8,!1),L=h(a,"blurMask",24,()=>[]),D=h(a,"showBrushPreview",8,!1);const I=gn();let C=N(),P=N(),H=N({width:0,height:0}),Y=!1,ee=null,me=0,oe=0,K=null,fe=0,q=1,W=!1,re=N({x:0,y:0,visible:!1}),ge=N(null),Re=N("");async function ye(){z(Re,d());const B=new Image;B.crossOrigin="anonymous",B.onload=()=>{z(ge,B)},B.src=d()}function Ze(B){const Z=document.createElement("canvas");Z.width=n(ge).naturalWidth,Z.height=n(ge).naturalHeight;const le=Z.getContext("2d");return le.filter=`blur(${B}px)`,le.drawImage(n(ge),0,0),Z}function U(){if(!n(P)||!n(ge)||!L())return;const B=n(P).getContext("2d"),Z=n(P).width,le=n(P).height;if(B.clearRect(0,0,Z,le),L().length===0)return;const Q=Z/S(),se=le/x();if(L().some(ce=>ce.invert)){const ce=L().reduce((j,ie)=>j+(ie.strength||50),0)/L().length;L().reduce((j,ie)=>j+(ie.soften||50),0)/L().length;const k=.5+ce/100*9.5,A=Ze(k);B.drawImage(A,0,0,Z,le),B.globalCompositeOperation="destination-out";for(const j of L()){if(!j.invert)continue;const ie=j.x*Q,V=j.y*se,xe=j.radius*Math.min(Q,se),ke=(j.soften||50)/100,Ce=Math.max(0,.3-ke*.3),ze=.3+(1-ke)*.4,Ee=B.createRadialGradient(ie,V,0,ie,V,xe);Ee.addColorStop(Ce,"rgba(0,0,0,1)"),Ee.addColorStop(ze,`rgba(0,0,0,${.5+ke*.3})`),Ee.addColorStop(1,"rgba(0,0,0,0)"),B.fillStyle=Ee,B.beginPath(),B.arc(ie,V,xe,0,Math.PI*2),B.fill()}B.globalCompositeOperation="source-over"}else for(const ce of L()){const k=ce.x*Q,A=ce.y*se,j=ce.radius*Math.min(Q,se),ie=ce.strength||50,V=(ce.soften||50)/100,xe=.5+ie/100*9.5,ke=Ze(xe);B.save();const Ce=Math.max(0,.2-V*.2),ze=.2+(1-V)*.5,Ee=B.createRadialGradient(k,A,0,k,A,j);Ee.addColorStop(Ce,"rgba(255,255,255,1)"),Ee.addColorStop(ze,`rgba(255,255,255,${.4+V*.3})`),Ee.addColorStop(1,"rgba(255,255,255,0)"),B.beginPath(),B.arc(k,A,j,0,Math.PI*2),B.clip(),B.drawImage(ke,0,0,Z,le),B.restore()}}Bt(()=>(X(),window.addEventListener("resize",X),()=>window.removeEventListener("resize",X)));function X(){if(n(C)){const B=n(C).getBoundingClientRect();z(H,{width:B.width,height:B.height})}}function te(B){return B.touches&&B.touches.length>0?{x:B.touches[0].clientX,y:B.touches[0].clientY}:{x:B.clientX,y:B.clientY}}function be(B){if(B.touches&&B.touches.length>=2){const Z=B.touches[0].clientX-B.touches[1].clientX,le=B.touches[0].clientY-B.touches[1].clientY;return Math.sqrt(Z*Z+le*le)}return 0}function de(B,Z="move"){if(!s())return;if(B.touches&&B.touches.length>=2){fe=be(B),q=v(),ee="pinch";return}B.preventDefault(),Y=!0,ee=Z;const le=te(B);me=le.x,oe=le.y,K={...c()}}function Ie(B){if(!s())return;if(ee==="pinch"&&B.touches&&B.touches.length>=2){const De=be(B),ce=q*(De/fe);I("scaleChange",{scale:Math.max(.5,Math.min(3,ce))});return}if(!Y||!K)return;B.preventDefault();const Z=te(B),le=(Z.x-me)/n(e)*100,Q=(Z.y-oe)/n(t)*100;let se={...K};if(ee==="move")se.x=Math.max(0,Math.min(100-K.width,K.x+le)),se.y=Math.max(0,Math.min(100-K.height,K.y+Q));else if(ee.includes("corner")){if(ee.includes("left")){const ce=K.x+le,k=K.width-le;k>=10&&ce>=0&&(se.x=ce,se.width=k)}if(ee.includes("right")){const ce=K.width+le;ce>=10&&K.x+ce<=100&&(se.width=ce)}if(ee.includes("top")){const ce=K.y+Q,k=K.height-Q;k>=10&&ce>=0&&(se.y=ce,se.height=k)}if(ee.includes("bottom")){const ce=K.height+Q;ce>=10&&K.y+ce<=100&&(se.height=ce)}}I("cropChange",{cropBox:se})}function Be(){Y=!1,ee=null,K=null,W&&(W=!1)}function Fe(B){R()&&(B.preventDefault(),W=!0,Ve(B))}function qe(B){if(!R())return;const Z=n(C).getBoundingClientRect(),le=te(B);z(re,{x:le.x-Z.left,y:le.y-Z.top,visible:!0}),W&&Ve(B)}function Qe(){z(re,{...n(re),visible:!1}),W&&(W=!1)}function Ve(B){const Z=n(C).getBoundingClientRect(),le=te(B),Q=(le.x-Z.left)/n(e)*S(),se=(le.y-Z.top)/n(t)*x(),De=l()/100*Math.min(S(),x())*.15;I("blurPaint",{point:{x:Q,y:se,radius:De,strength:w(),soften:M(),invert:E()}})}je(()=>n(H),()=>{z(e,n(H).width)}),je(()=>(Pe(x()),Pe(S()),n(e)),()=>{z(t,x()&&S()?n(e)*x()/S():0)}),je(()=>(Pe(l()),n(e),n(t)),()=>{z(o,l()/100*Math.min(n(e),n(t))*.3)}),je(()=>(Pe(d()),n(P),n(Re)),()=>{d()&&n(P)&&d()!==n(Re)&&ye()}),je(()=>(Pe(L()),n(P),n(ge)),()=>{L()&&Array.isArray(L())&&L().length>0&&n(P)&&n(ge)&&U()}),je(()=>(Pe(c()),n(e),n(t)),()=>{z(r,{x:c().x/100*n(e),y:c().y/100*n(t),width:c().width/100*n(e),height:c().height/100*n(t)})}),pt(),Te();var he=On(),Oe=f(he),O=f(Oe),Ue=u(O,2);{var nt=B=>{var Z=Tn();ft(Z,le=>z(P,le),()=>n(P)),J(()=>{_e(Z,"width",n(e)),_e(Z,"height",n(t)),we(Z,`filter: ${_()??""};`)}),T(B,Z)};$(Ue,B=>{R()&&n(e)>0&&n(t)>0&&B(nt)})}g(Oe);var ae=u(Oe,2);{var ne=B=>{var Z=An();J(()=>we(Z,`
				left: ${n(re),m(()=>n(re).x)??""}px;
				top: ${n(re),m(()=>n(re).y)??""}px;
				width: ${n(o)??""}px;
				height: ${n(o)??""}px;
			`)),T(B,Z)};$(ae,B=>{Pe(R()),n(re),m(()=>R()&&n(re).visible)&&B(ne)})}var Se=u(ae,2);{var We=B=>{var Z=Fn();J(()=>we(Z,`
				left: ${n(e)/2}px;
				top: ${n(t)/2}px;
				width: ${n(o)??""}px;
				height: ${n(o)??""}px;
			`)),T(B,Z)};$(Se,B=>{D()&&n(e)>0&&n(t)>0&&B(We)})}var Xe=u(Se,2);{var Ae=B=>{var Z=qn(),le=f(Z),Q=u(le,2),se=u(Q,2),De=u(se,2),ce=u(De,2),k=u(f(ce),2),A=u(k,2),j=u(A,2),ie=u(j,2);g(ce),g(Z),J(()=>{we(le,`height: ${n(r),m(()=>n(r).y)??""}px;`),we(Q,`top: ${n(r),m(()=>n(r).y+n(r).height)??""}px; height: ${n(t),n(r),m(()=>n(t)-n(r).y-n(r).height)??""}px;`),we(se,`top: ${n(r),m(()=>n(r).y)??""}px; height: ${n(r),m(()=>n(r).height)??""}px; width: ${n(r),m(()=>n(r).x)??""}px;`),we(De,`top: ${n(r),m(()=>n(r).y)??""}px; height: ${n(r),m(()=>n(r).height)??""}px; left: ${n(r),m(()=>n(r).x+n(r).width)??""}px; width: ${n(e),n(r),m(()=>n(e)-n(r).x-n(r).width)??""}px;`),we(ce,`left: ${n(r),m(()=>n(r).x)??""}px; top: ${n(r),m(()=>n(r).y)??""}px; width: ${n(r),m(()=>n(r).width)??""}px; height: ${n(r),m(()=>n(r).height)??""}px;`)}),p("mousedown",k,st(V=>de(V,"corner-top-left"))),p("touchstart",k,st(V=>de(V,"corner-top-left"))),p("mousedown",A,st(V=>de(V,"corner-top-right"))),p("touchstart",A,st(V=>de(V,"corner-top-right"))),p("mousedown",j,st(V=>de(V,"corner-bottom-left"))),p("touchstart",j,st(V=>de(V,"corner-bottom-left"))),p("mousedown",ie,st(V=>de(V,"corner-bottom-right"))),p("touchstart",ie,st(V=>de(V,"corner-bottom-right"))),p("mousedown",ce,V=>de(V,"move")),p("touchstart",ce,V=>de(V,"move")),T(B,Z)};$(Xe,B=>{s()&&n(t)>0&&B(Ae)})}g(he),ft(he,B=>z(C,B),()=>n(C)),J(()=>{we(Oe,`transform: scale(${v()??""}) translate(${b()??""}px, ${y()??""}px);`),_e(O,"src",d()),we(O,`filter: ${_()??""};`)}),p("mousemove",he,function(...B){(R()?qe:Ie)?.apply(this,B)}),p("mouseup",he,Be),p("mouseleave",he,function(...B){(R()?Qe:Be)?.apply(this,B)}),p("touchmove",he,function(...B){(R()?qe:Ie)?.apply(this,B)}),p("touchend",he,Be),p("mousedown",he,function(...B){(R()?Fe:null)?.apply(this,B)}),p("touchstart",he,function(...B){(R()?Fe:null)?.apply(this,B)}),T(i,he),Me()}var Hn=F('<img alt="" class="toggle-icon svelte-1gdqxne"/>'),Wn=F('<span class="toggle-label svelte-1gdqxne"> </span>'),jn=F("<div><button><!></button> <!></div>"),Nn=F("<div></div>");function Aa(i,a){Le(a,!1);let e=h(a,"options",24,()=>[]),t=h(a,"value",8,""),o=h(a,"onChange",8,v=>{}),r=h(a,"showLabels",8,!0),d=h(a,"centered",8,!1);Te();var c=Nn();let s;vt(c,5,e,dt,(v,b)=>{var y=jn();let S;var x=f(y);let _;var R=f(x);{var l=E=>{var L=Hn();J(()=>_e(L,"src",`/icons/${n(b),m(()=>n(b).icon)??""}.svg`)),T(E,L)};$(R,E=>{n(b),m(()=>n(b).icon)&&E(l)})}g(x);var w=u(x,2);{var M=E=>{var L=Wn(),D=f(L,!0);g(L),J(()=>He(D,(n(b),m(()=>n(b).label)))),T(E,L)};$(w,E=>{Pe(r()),n(b),m(()=>r()&&n(b).label)&&E(M)})}g(y),J(()=>{S=ue(y,1,"toggle-item svelte-1gdqxne",null,S,{active:t()===n(b).id}),_=ue(x,1,"toggle-btn svelte-1gdqxne",null,_,{active:t()===n(b).id}),_e(x,"aria-label",(n(b),m(()=>n(b).label)))}),p("click",x,()=>o()(n(b).id)),T(v,y)}),g(c),J(()=>s=ue(c,1,"toggle-group svelte-1gdqxne",null,s,{centered:d()})),T(i,c),Me()}var Yn=F('<label class="input-label svelte-1r47u3b"> <input class="input svelte-1r47u3b"/></label>'),Xn=F('<input class="input svelte-1r47u3b"/>'),Gn=F('<div class="input-field svelte-1r47u3b"><!></div>');function wa(i,a){Le(a,!1);let e=h(a,"label",8,""),t=h(a,"value",12,""),o=h(a,"type",8,"text"),r=h(a,"placeholder",8,""),d=h(a,"disabled",8,!1),c=h(a,"onChange",8,x=>{});function s(x){t(x.target.value),c()(t())}Te();var v=Gn(),b=f(v);{var y=x=>{var _=Yn(),R=f(_),l=u(R);Ft(l),g(_),J(()=>{He(R,`${e()??""} `),_e(l,"type",o()),qt(l,t()),_e(l,"placeholder",r()),l.disabled=d()}),p("input",l,s),T(x,_)},S=x=>{var _=Xn();Ft(_),J(()=>{_e(_,"type",o()),qt(_,t()),_e(_,"placeholder",r()),_.disabled=d()}),p("input",_,s),T(x,_)};$(b,x=>{e()?x(y):x(S,!1)})}g(v),T(i,v),Me()}var Qn=F('<span class="slider-value svelte-jchife"> </span>'),Vn=F('<div class="slider-header svelte-jchife"><span class="slider-label svelte-jchife"> </span> <!></div>'),Jn=F('<div class="slider-container svelte-jchife"><!> <input type="range" class="slider svelte-jchife"/></div>');function Je(i,a){Le(a,!1);let e=h(a,"label",8,""),t=h(a,"min",8,0),o=h(a,"max",8,100),r=h(a,"value",8,50),d=h(a,"step",8,1),c=h(a,"showValue",8,!1),s=h(a,"onChange",8,M=>{}),v=h(a,"onInteractionStart",8,()=>{}),b=h(a,"onInteractionEnd",8,()=>{});function y(M){const E=Number(M.target.value);s()(E)}function S(){v()()}function x(){b()()}Te();var _=Jn(),R=f(_);{var l=M=>{var E=Vn(),L=f(E),D=f(L,!0);g(L);var I=u(L,2);{var C=P=>{var H=Qn(),Y=f(H,!0);g(H),J(()=>He(Y,r())),T(P,H)};$(I,P=>{c()&&P(C)})}g(E),J(()=>He(D,e())),T(M,E)};$(R,M=>{e()&&M(l)})}var w=u(R,2);Ft(w),g(_),J(()=>{_e(w,"min",t()),_e(w,"max",o()),_e(w,"step",d()),qt(w,r())}),p("input",w,y),p("mousedown",w,S),p("touchstart",w,S),p("mouseup",w,x),p("touchend",w,x),T(i,_),Me()}var Zn=F('<div class="apply-row svelte-17iy3mz"><button class="btn-apply svelte-17iy3mz">Apply</button></div>'),Kn=F('<div class="crop-controls svelte-17iy3mz"><!> <div class="dimensions-row svelte-17iy3mz"><div class="dimension-input svelte-17iy3mz"><!></div> <button class="icon-btn svelte-17iy3mz"><img alt="" class="icon-btn-img svelte-17iy3mz"/></button> <div class="dimension-input svelte-17iy3mz"><!></div> <button class="icon-btn svelte-17iy3mz" aria-label="Flip horizontal"><img src="/icons/icon-flip-horizontal.svg" alt="" class="icon-btn-img svelte-17iy3mz"/></button> <button class="icon-btn svelte-17iy3mz" aria-label="Rotate"><img src="/icons/icon-rotate.svg" alt="" class="icon-btn-img svelte-17iy3mz"/></button></div> <!> <!></div>');function $n(i,a){Le(a,!1);let e=h(a,"aspectRatio",8,"9:16"),t=h(a,"cropWidth",8,1080),o=h(a,"cropHeight",8,1920),r=h(a,"ratioLocked",8,!0),d=h(a,"scale",8,100),c=h(a,"cropPending",8,!1),s=h(a,"onRatioChange",8,q=>{}),v=h(a,"onDimensionsChange",8,({width:q,height:W})=>{}),b=h(a,"onLockToggle",8,()=>{}),y=h(a,"onFlip",8,()=>{}),S=h(a,"onRotate",8,()=>{}),x=h(a,"onScaleChange",8,q=>{}),_=h(a,"onApply",8,()=>{});const R=[{id:"9:16",label:"9:16",icon:"icon-vertical"},{id:"1:1",label:"1:1",icon:"icon-square"},{id:"16:9",label:"16:9",icon:"icon-horizontal"},{id:"custom",label:"Custom",icon:"icon-custom"}];function l(q){const W=parseInt(q)||0;v()({width:W,height:o()})}function w(q){const W=parseInt(q)||0;v()({width:t(),height:W})}Te();var M=Kn(),E=f(M);Aa(E,{get options(){return R},get value(){return e()},get onChange(){return s()},showLabels:!0});var L=u(E,2),D=f(L),I=f(D);{let q=at(()=>(Pe(t()),m(()=>t().toString())));wa(I,{label:"Width",type:"number",get value(){return n(q)},onChange:l})}g(D);var C=u(D,2),P=f(C);g(C);var H=u(C,2),Y=f(H);{let q=at(()=>(Pe(o()),m(()=>o().toString())));wa(Y,{label:"Height",type:"number",get value(){return n(q)},onChange:w})}g(H);var ee=u(H,2),me=u(ee,2);g(L);var oe=u(L,2);Je(oe,{label:"Scale",min:50,max:200,get value(){return d()},step:1,showValue:!0,get onChange(){return x()}});var K=u(oe,2);{var fe=q=>{var W=Zn(),re=f(W);g(W),p("click",re,function(...ge){_()?.apply(this,ge)}),T(q,W)};$(K,q=>{c()&&q(fe)})}g(M),J(()=>{_e(C,"aria-label",r()?"Unlock aspect ratio":"Lock aspect ratio"),_e(P,"src",`/icons/${r()?"icon-lock":"icon-unlock"}.svg`)}),p("click",C,function(...q){b()?.apply(this,q)}),p("click",ee,function(...q){y()?.apply(this,q)}),p("click",me,function(...q){S()?.apply(this,q)}),T(i,M),Me()}var ei=F("<button> </button>"),ti=F("<button> </button>"),ai=F('<div class="blur-controls svelte-1e1k0ax"><div class="blur-control-row svelte-1e1k0ax"><!> <label class="invert-checkbox svelte-1e1k0ax"><input type="checkbox" class="svelte-1e1k0ax"/> <span class="checkbox-label svelte-1e1k0ax">Invert</span></label></div> <div class="slider-row svelte-1e1k0ax"><div class="slider-track svelte-1e1k0ax"><!></div> <button class="reset-btn svelte-1e1k0ax" aria-label="Reset"><img src="/icons/icon-reset.svg" alt="" class="reset-icon svelte-1e1k0ax"/></button></div> <div class="zoom-row svelte-1e1k0ax"><span class="zoom-label svelte-1e1k0ax">Zoom in</span> <div class="zoom-slider-row svelte-1e1k0ax"><div class="slider-track svelte-1e1k0ax"><!></div> <button class="reset-btn svelte-1e1k0ax" aria-label="Reset zoom"><img src="/icons/icon-reset.svg" alt="" class="reset-icon svelte-1e1k0ax"/></button></div></div> <div class="nudge-row svelte-1e1k0ax"><button class="nudge-btn svelte-1e1k0ax" aria-label="Nudge up"><img src="/icons/icon-nudge-up.svg" alt="" class="svelte-1e1k0ax"/></button> <button class="nudge-btn svelte-1e1k0ax" aria-label="Nudge down"><img src="/icons/icon-nudge-down.svg" alt="" class="svelte-1e1k0ax"/></button> <button class="nudge-btn svelte-1e1k0ax" aria-label="Nudge left"><img src="/icons/icon-nudge-left.svg" alt="" class="svelte-1e1k0ax"/></button> <button class="nudge-btn svelte-1e1k0ax" aria-label="Nudge right"><img src="/icons/icon-nudge-right.svg" alt="" class="svelte-1e1k0ax"/></button></div></div>'),ni=F('<div class="edit-controls svelte-1e1k0ax"><div class="enhancement-row svelte-1e1k0ax"></div> <div class="slider-row svelte-1e1k0ax"><div class="slider-track svelte-1e1k0ax"><!></div> <button class="reset-btn svelte-1e1k0ax" aria-label="Reset"><img src="/icons/icon-reset.svg" alt="" class="reset-icon svelte-1e1k0ax"/></button></div> <div class="blur-section svelte-1e1k0ax"><div class="blur-header svelte-1e1k0ax"><button class="chevron-btn svelte-1e1k0ax"><img alt=""/></button> <span class="blur-label svelte-1e1k0ax">Blur</span> <button><span class="toggle-thumb svelte-1e1k0ax"></span></button></div> <!></div></div>');function ii(i,a){Le(a,!1);const e=N(),t=N(),o=N(),r=N(),d=N(),c=N();let s=h(a,"brightness",8,0),v=h(a,"shadows",8,0),b=h(a,"contrast",8,0),y=h(a,"hdr",8,0),S=h(a,"blurBrushSize",8,50),x=h(a,"blurStrength",8,50),_=h(a,"blurSoften",8,50),R=h(a,"blurInvert",8,!1),l=h(a,"zoomLevel",8,1),w=h(a,"blurEnabled",8,!1),M=h(a,"onBrightnessChange",8,Q=>{}),E=h(a,"onShadowsChange",8,Q=>{}),L=h(a,"onContrastChange",8,Q=>{}),D=h(a,"onHdrChange",8,Q=>{}),I=h(a,"onBlurBrushSizeChange",8,Q=>{}),C=h(a,"onBlurStrengthChange",8,Q=>{}),P=h(a,"onBlurSoftenChange",8,Q=>{}),H=h(a,"onBlurInvertChange",8,Q=>{}),Y=h(a,"onZoomChange",8,Q=>{}),ee=h(a,"onNudge",8,Q=>{}),me=h(a,"onResetZoom",8,()=>{}),oe=h(a,"onBlurToggle",8,Q=>{}),K=h(a,"onBrushPreviewChange",8,Q=>{}),fe=h(a,"onEditEnd",8,()=>{}),q=N("brightness"),W=N(w()),re=N("brushSize");const ge=[{id:"brightness",label:"Brightness"},{id:"shadows",label:"Shadows"},{id:"contrast",label:"Contrast"},{id:"hdr",label:"HDR"}],Re=[{id:"brushSize",label:"Brush size"},{id:"strength",label:"Strength"},{id:"soften",label:"Soften edges"}];function ye(Q){switch(n(q)){case"brightness":M()(Q);break;case"shadows":E()(Q);break;case"contrast":L()(Q);break;case"hdr":D()(Q);break}}function Ze(){ye(0)}function U(Q){switch(n(re)){case"brushSize":I()(Q);break;case"strength":C()(Q);break;case"soften":P()(Q);break}}function X(){U(50)}function te(){const Q=!w();oe()(Q),z(W,Q)}function be(){w()&&z(W,!n(W))}function de(){H()(!R())}function Ie(Q){z(q,Q),z(W,!1)}function Be(Q){z(re,Q)}function Fe(){fe()()}function qe(){n(re)==="brushSize"&&K()(!0)}function Qe(){K()(!1),fe()()}je(()=>(n(q),Pe(s()),Pe(v()),Pe(b()),Pe(y())),()=>{z(e,(()=>{switch(n(q)){case"brightness":return s();case"shadows":return v();case"contrast":return b();case"hdr":return y();default:return 0}})())}),je(()=>n(q),()=>{z(t,n(q)==="hdr"?0:-100)}),je(()=>{},()=>{z(o,100)}),je(()=>(n(re),Pe(S()),Pe(x()),Pe(_())),()=>{z(r,(()=>{switch(n(re)){case"brushSize":return S();case"strength":return x();case"soften":return _();default:return 50}})())}),je(()=>{},()=>{z(d,1)}),je(()=>{},()=>{z(c,100)}),pt(),Te();var Ve=ni(),he=f(Ve);vt(he,5,()=>ge,dt,(Q,se)=>{var De=ei();let ce;var k=f(De,!0);g(De),J(()=>{ce=ue(De,1,"enhancement-btn svelte-1e1k0ax",null,ce,{active:n(q)===n(se).id}),He(k,(n(se),m(()=>n(se).label)))}),p("click",De,()=>Ie(n(se).id)),T(Q,De)}),g(he);var Oe=u(he,2),O=f(Oe),Ue=f(O);Je(Ue,{get min(){return n(t)},get max(){return n(o)},get value(){return n(e)},step:1,onChange:ye,onInteractionEnd:Fe}),g(O);var nt=u(O,2);g(Oe);var ae=u(Oe,2),ne=f(ae),Se=f(ne),We=f(Se);let Xe;g(Se);var Ae=u(Se,4);let B;g(ne);var Z=u(ne,2);{var le=Q=>{var se=ai(),De=f(se),ce=f(De);vt(ce,1,()=>Re,dt,(G,pe)=>{var Ke=ti();let et;var Et=f(Ke,!0);g(Ke),J(()=>{et=ue(Ke,1,"blur-control-btn svelte-1e1k0ax",null,et,{active:n(re)===n(pe).id}),He(Et,(n(pe),m(()=>n(pe).label)))}),p("click",Ke,()=>Be(n(pe).id)),T(G,Ke)});var k=u(ce,2),A=f(k);Ft(A),_t(2),g(k),g(De);var j=u(De,2),ie=f(j),V=f(ie);Je(V,{get min(){return n(d)},get max(){return n(c)},get value(){return n(r)},step:1,onChange:U,onInteractionStart:qe,onInteractionEnd:Qe}),g(ie);var xe=u(ie,2);g(j);var ke=u(j,2),Ce=u(f(ke),2),ze=f(Ce),Ee=f(ze);Je(Ee,{min:1,max:3,step:.1,get value(){return l()},get onChange(){return Y()}}),g(ze);var ot=u(ze,2);g(Ce),g(ke);var Ge=u(ke,2),kt=f(Ge),rt=u(kt,2),lt=u(rt,2),yt=u(lt,2);g(Ge),g(se),J(()=>_n(A,R())),p("change",A,de),p("click",xe,X),p("click",ot,function(...G){me()?.apply(this,G)}),p("click",kt,()=>ee()("up")),p("click",rt,()=>ee()("down")),p("click",lt,()=>ee()("left")),p("click",yt,()=>ee()("right")),T(Q,se)};$(Z,Q=>{n(W)&&w()&&Q(le)})}g(ae),g(Ve),J(()=>{Se.disabled=!w(),_e(Se,"aria-label",n(W)?"Collapse":"Expand"),_e(We,"src",`/icons/${n(W)?"icon-collapse":"icon-expand"}.svg`),Xe=ue(We,1,"chevron-icon svelte-1e1k0ax",null,Xe,{disabled:!w()}),B=ue(Ae,1,"toggle-switch svelte-1e1k0ax",null,B,{active:w()}),_e(Ae,"aria-label",w()?"Disable blur":"Enable blur")}),p("click",nt,Ze),p("click",Se,be),p("click",Ae,te),T(i,Ve),Me()}var oi=F('<button><div class="filter-preview svelte-183y0dt"></div> <span> </span></button>'),ri=F('<div class="filter-grid svelte-183y0dt"></div>');function li(i,a){Le(a,!1);let e=h(a,"filters",24,()=>[]),t=h(a,"value",8,"original"),o=h(a,"imageUrl",8,""),r=h(a,"onChange",8,c=>{});Te();var d=ri();vt(d,5,e,dt,(c,s)=>{var v=oi();let b;var y=f(v),S=u(y,2);let x;var _=f(S,!0);g(S),g(v),J(()=>{b=ue(v,1,"filter-card svelte-183y0dt",null,b,{active:t()===n(s).id}),we(y,`
					background-image: url(${o()??""});
					filter: ${n(s),m(()=>n(s).css||"none")??""};
				`),x=ue(S,1,"filter-label svelte-183y0dt",null,x,{active:t()===n(s).id}),He(_,(n(s),m(()=>n(s).label)))}),p("click",v,()=>r()(n(s).id)),T(c,v)}),g(d),T(i,d),Me()}var si=F('<div class="filter-controls svelte-1274k9v"><!> <div><div class="slider-track svelte-1274k9v"><!></div> <button class="reset-btn svelte-1274k9v" aria-label="Reset filter"><img src="/icons/icon-reset.svg" alt="" class="reset-icon svelte-1274k9v"/></button></div></div>');function ci(i,a){Le(a,!1);const e=N();let t=h(a,"imageUrl",8,""),o=h(a,"activeFilter",8,"original"),r=h(a,"filterStrength",8,50),d=h(a,"onFilterChange",8,w=>{}),c=h(a,"onStrengthChange",8,w=>{}),s=h(a,"onReset",8,()=>{});const v=[{id:"original",label:"Original",css:"none"},{id:"greyscale",label:"Greyscale",css:"grayscale(100%)"},{id:"sepia",label:"Sepia",css:"sepia(100%)"},{id:"sunset",label:"Sunset",css:"sepia(30%) saturate(140%) brightness(110%) hue-rotate(-10deg)"},{id:"azure",label:"Azure",css:"saturate(120%) brightness(105%) hue-rotate(180deg)"},{id:"teal",label:"Teal",css:"saturate(130%) hue-rotate(140deg)"}];je(()=>Pe(o()),()=>{z(e,o()==="original")}),pt();var b=si(),y=f(b);li(y,{get filters(){return v},get value(){return o()},get imageUrl(){return t()},get onChange(){return d()}});var S=u(y,2);let x;var _=f(S),R=f(_);{let w=at(()=>n(e)?()=>{}:c());Je(R,{label:"Strength",min:0,max:100,get value(){return r()},get onChange(){return n(w)}})}g(_);var l=u(_,2);g(S),g(b),J(()=>x=ue(S,1,"slider-row svelte-1274k9v",null,x,{disabled:n(e)})),p("click",l,function(...w){s()?.apply(this,w)}),T(i,b),Me()}const xa=[{id:"original",label:"Original",css:"none"},{id:"greyscale",label:"Greyscale",css:"grayscale(100%)"},{id:"sepia",label:"Sepia",css:"sepia(100%)"},{id:"sunset",label:"Sunset",css:"sepia(30%) saturate(140%) brightness(110%) hue-rotate(-10deg)"},{id:"azure",label:"Azure",css:"saturate(120%) brightness(105%) hue-rotate(180deg)"},{id:"teal",label:"Teal",css:"saturate(130%) hue-rotate(140deg)"}];function di(i){const a=[i];let e=0,t=0;const o=bt({canUndo:!1,canRedo:!1}),{subscribe:r,set:d,update:c}=bt(i);function s(){o.set({canUndo:e>t,canRedo:e<a.length-1})}return{subscribe:r,undoState:o,set:v=>{a.splice(e+1),a.push(v),e=a.length-1,d(v),s()},update:v=>{c(b=>{const y=v(b);return a.splice(e+1),a.push(y),e=a.length-1,s(),y})},silentUpdate:v=>{c(v)},setBaseState:()=>{t=e,s()},undo:()=>{e>t&&(e--,d(a[e]),s())},redo:()=>{e<a.length-1&&(e++,d(a[e]),s())},canUndo:()=>e>t,canRedo:()=>e<a.length-1,reset:()=>{a.length=0,a.push(i),e=0,t=0,d(i),s()}}}const vi={originalImage:null,currentImage:null,aspectRatio:"custom",width:0,height:0,ratioLocked:!1,scale:1,offsetX:0,offsetY:0,brightness:0,contrast:0,shadows:0,hdr:0,activeFilter:"original",filterStrength:50,cropBox:{x:0,y:0,width:0,height:0},isCropping:!1,cropPending:!1,imageWidth:0,imageHeight:0,blurEnabled:!1,blurBrushSize:50,blurStrength:50,blurSoften:50,blurInvert:!1,blurMask:null,showBrushPreview:!1,zoomLevel:1,zoomOffsetX:0,zoomOffsetY:0},ve=di(vi),At=bt("none"),ui=ia(ve,i=>i.currentImage!==null);function gi(){ve.reset(),At.set("none")}var hi=F('<div class="controls-panel svelte-c9tnuw"><!></div>'),fi=F('<div class="controls-panel svelte-c9tnuw"><!></div>'),bi=F("<!> <!> <!> <!>",1),mi=F('<div class="crop-tab svelte-c9tnuw"><!> <!> <!></div>');function pi(i,a){Le(a,!1);const e=()=>it(ve,"$cropState",d),t=()=>it(At,"$activeSubMenu",d),o=()=>it(ui,"$hasImage",d),r=()=>it(y,"$undoState",d),[d,c]=Rt(),s=N(),v=N(),b=N(),y=ve.undoState,S=[{id:"crop",label:"Crop"},{id:"edit",label:"Edit"},{id:"filter",label:"Filter"}];let x=N(null),_=null;async function R(k){const A=await Ht(k);ve.set({...e(),originalImage:k,currentImage:k,imageWidth:A.width,imageHeight:A.height,width:A.width,height:A.height,cropBox:{x:0,y:0,width:100,height:100},isCropping:!0,cropPending:!1,aspectRatio:"custom",ratioLocked:!1}),ve.setBaseState(),At.set("crop")}function l(k){if(e().cropPending&&t()==="crop"&&k!=="crop"){_=()=>{At.set(k),ve.silentUpdate(A=>({...A,isCropping:!1}))},z(x,"save");return}k==="crop"?ve.silentUpdate(A=>({...A,isCropping:!0})):ve.silentUpdate(A=>({...A,isCropping:!1})),At.set(t()===k?"none":k)}async function w(){return await Bn(e().currentImage,n(b),e().blurMask)}async function M(){if(e().cropPending){_=async()=>{const k=await w();await $t(k)},z(x,"save");return}if(e().currentImage){const k=await w();await $t(k)}}async function E(){if(e().cropPending){_=async()=>{const k=await w();ea(k,"picflam-export.png")},z(x,"save");return}if(e().currentImage){const k=await w();ea(k,"picflam-export.png")}}function L(){z(x,"startAgain")}function D(){ve.undo()}function I(){ve.redo()}async function C(){z(x,null),await ee(),_&&(await _(),_=null)}function P(){z(x,null),_=null}function H(){z(x,null),gi()}function Y(){z(x,null)}async function ee(){const k=e();if(!k.currentImage||!k.cropPending)return;const A=await Da(k.currentImage,k.cropBox,k.imageWidth,k.imageHeight),j=await Ht(A);ve.set({...k,currentImage:A,imageWidth:j.width,imageHeight:j.height,width:j.width,height:j.height,cropBox:{x:0,y:0,width:100,height:100},cropPending:!1})}function me(k){if(k==="custom"){ve.silentUpdate(xe=>({...xe,aspectRatio:"custom",cropBox:{x:0,y:0,width:100,height:100},ratioLocked:!1,cropPending:!1}));return}const j={"9:16":9/16,"1:1":1,"16:9":16/9}[k],ie=e().imageWidth/e().imageHeight;let V;if(k==="9:16"){const ke=j/ie*100;if(ke<=100)V={x:(100-ke)/2,y:0,width:ke,height:100};else{const Ce=ie/j*100;V={x:0,y:(100-Ce)/2,width:100,height:Ce}}}else if(k==="16:9"){const ke=ie/j*100;if(ke<=100)V={x:0,y:(100-ke)/2,width:100,height:ke};else{const Ce=j/ie*100;V={x:(100-Ce)/2,y:0,width:Ce,height:100}}}else if(k==="1:1")if(ie>1){const xe=100/ie;V={x:(100-xe)/2,y:0,width:xe,height:100}}else{const xe=100*ie;V={x:0,y:(100-xe)/2,width:100,height:xe}}ve.silentUpdate(xe=>({...xe,aspectRatio:k,cropBox:V,cropPending:!0,isCropping:!0,ratioLocked:!0}))}function oe({width:k,height:A}){const j=e().imageWidth,ie=e().imageHeight,V=Math.min(Math.max(1,k),j),xe=Math.min(Math.max(1,A),ie),ke=V/j*100,Ce=xe/ie*100;let ze;if(e().ratioLocked){const Ee=n(s)/n(v);if(k!==n(s)){const Ge=V/Ee/ie*100;ze={x:(100-ke)/2,y:(100-Math.min(100,Ge))/2,width:ke,height:Math.min(100,Ge)}}else{const Ge=xe*Ee/j*100;ze={x:(100-Math.min(100,Ge))/2,y:(100-Ce)/2,width:Math.min(100,Ge),height:Ce}}}else ze={x:(100-ke)/2,y:(100-Ce)/2,width:ke,height:Ce};ve.silentUpdate(Ee=>({...Ee,cropBox:ze,cropPending:!0}))}function K(){ve.silentUpdate(k=>({...k,ratioLocked:!k.ratioLocked}))}async function fe(){const k=await Rn(e().currentImage);ve.set({...e(),currentImage:k})}async function q(){const k=await zn(e().currentImage,90),A=await Ht(k);ve.set({...e(),currentImage:k,imageWidth:A.width,imageHeight:A.height,cropBox:{x:0,y:0,width:100,height:100},cropPending:!1})}function W(k){ve.silentUpdate(A=>({...A,scale:k/100}))}function re(k){const A=k.detail.cropBox;if(e().ratioLocked&&e().aspectRatio!=="custom"){const ie={"9:16":.5625,"1:1":1,"16:9":1.7777777777777777}[e().aspectRatio];e().imageWidth/e().imageHeight;const V=A.width*e().imageWidth/(A.height*e().imageHeight);if(Math.abs(V-ie)>.01){const Ce=A.width/100*e().imageWidth/ie/e().imageHeight*100;A.height=Math.min(100,Ce),A.y+A.height>100&&(A.y=100-A.height)}}ve.silentUpdate(j=>({...j,cropBox:A,cropPending:!0}))}function ge(){ee()}let Re=null;function ye(){Re===null&&(Re={...e()})}function Ze(){Re!==null&&(ve.set(e()),Re=null)}function U(k){ye(),ve.silentUpdate(A=>({...A,brightness:k}))}function X(k){ye(),ve.silentUpdate(A=>({...A,shadows:k}))}function te(k){ye(),ve.silentUpdate(A=>({...A,contrast:k}))}function be(k){ye(),ve.silentUpdate(A=>({...A,hdr:k}))}function de(k){ve.set({...e(),blurEnabled:k})}function Ie(k){ye(),ve.silentUpdate(A=>({...A,blurBrushSize:k}))}function Be(k){ye(),ve.silentUpdate(A=>({...A,blurStrength:k}))}function Fe(k){ye(),ve.silentUpdate(A=>({...A,blurSoften:k}))}function qe(k){ve.set({...e(),blurInvert:k})}function Qe(k){ve.silentUpdate(A=>({...A,showBrushPreview:k}))}function Ve(){Ze()}let he=null,Oe=[],O=null;function Ue(k){const A=k.detail.point;O===null&&(O=e().blurMask?[...e().blurMask]:[]),Oe.push(A),ve.silentUpdate(j=>({...j,blurMask:[...j.blurMask||[],A]})),he&&clearTimeout(he),he=setTimeout(()=>{if(Oe.length>0){const j=[...O,...Oe];ve.set({...e(),blurMask:j}),Oe=[],O=null}he=null},300)}function nt(k){ve.silentUpdate(A=>({...A,zoomLevel:k}))}function ae(k){ve.silentUpdate(j=>{let{zoomOffsetX:ie,zoomOffsetY:V}=j;switch(k){case"up":V-=20;break;case"down":V+=20;break;case"left":ie-=20;break;case"right":ie+=20;break}return{...j,zoomOffsetX:ie,zoomOffsetY:V}})}function ne(){ve.silentUpdate(k=>({...k,zoomLevel:1,zoomOffsetX:0,zoomOffsetY:0}))}function Se(k){ve.silentUpdate(A=>({...A,activeFilter:k}))}function We(k){ye(),ve.silentUpdate(A=>({...A,filterStrength:k}))}function Xe(){ve.set({...e(),activeFilter:"original",filterStrength:50})}je(()=>e(),()=>{z(s,Math.round(e().imageWidth*e().cropBox.width/100))}),je(()=>e(),()=>{z(v,Math.round(e().imageHeight*e().cropBox.height/100))}),je(()=>(e(),xa),()=>{z(b,(()=>{let k=[];if(e().brightness!==0&&k.push(`brightness(${1+e().brightness/100})`),e().contrast!==0&&k.push(`contrast(${1+e().contrast/100})`),e().shadows!==0){const A=1+e().shadows/200;k.push(`brightness(${A})`)}if(e().hdr!==0){const A=1+e().hdr/100*.3,j=1+e().hdr/100*.2;k.push(`saturate(${A}) contrast(${j})`)}if(e().activeFilter!=="original"){const A=xa.find(j=>j.id===e().activeFilter);if(A&&A.css!=="none"){const j=e().filterStrength/100,ie=A.css.replace(/(\d+)%/g,(V,xe)=>`${Math.round(parseInt(xe)*j)}%`);k.push(ie)}}return k.length>0?k.join(" "):"none"})())}),pt(),Te();var Ae=mi(),B=f(Ae);{var Z=k=>{Ta(k,{title:"Crop, edit and add filters to photos",hint:"Import, drag or paste an image",onImageImport:R})},le=k=>{var A=bi(),j=Ye(A);la(j,{get canUndo(){return r(),m(()=>r().canUndo)},get canRedo(){return r(),m(()=>r().canRedo)},onUndo:D,onRedo:I,onStartAgain:L,onCopy:M,onExport:E});var ie=u(j,2);{let ze=at(()=>(t(),e(),m(()=>t()==="edit"?e().zoomLevel:e().scale))),Ee=at(()=>(t(),e(),m(()=>t()==="edit"?e().zoomOffsetX:e().offsetX))),ot=at(()=>(t(),e(),m(()=>t()==="edit"?e().zoomOffsetY:e().offsetY))),Ge=at(()=>(e(),m(()=>e().blurMask||[])));Un(ie,{get imageSrc(){return e(),m(()=>e().currentImage)},get cropBox(){return e(),m(()=>e().cropBox)},get isCropping(){return e(),m(()=>e().isCropping)},get scale(){return n(ze)},get offsetX(){return n(Ee)},get offsetY(){return n(ot)},get imageWidth(){return e(),m(()=>e().imageWidth)},get imageHeight(){return e(),m(()=>e().imageHeight)},get editFilters(){return n(b)},get blurEnabled(){return e(),m(()=>e().blurEnabled)},get blurBrushSize(){return e(),m(()=>e().blurBrushSize)},get blurStrength(){return e(),m(()=>e().blurStrength)},get blurSoften(){return e(),m(()=>e().blurSoften)},get blurInvert(){return e(),m(()=>e().blurInvert)},get blurMask(){return n(Ge)},get showBrushPreview(){return e(),m(()=>e().showBrushPreview)},$$events:{cropChange:re,blurPaint:Ue}})}var V=u(ie,2);sa(V,{get tabs(){return S},get activeTab(){return t()},onTabChange:l});var xe=u(V,2);{var ke=ze=>{{let Ee=at(()=>(e(),m(()=>Math.round(e().scale*100))));$n(ze,{get aspectRatio(){return e(),m(()=>e().aspectRatio)},get cropWidth(){return n(s)},get cropHeight(){return n(v)},get ratioLocked(){return e(),m(()=>e().ratioLocked)},get scale(){return n(Ee)},get cropPending(){return e(),m(()=>e().cropPending)},onRatioChange:me,onDimensionsChange:oe,onLockToggle:K,onFlip:fe,onRotate:q,onScaleChange:W,onApply:ge})}},Ce=ze=>{var Ee=gt(),ot=Ye(Ee);{var Ge=rt=>{var lt=hi(),yt=f(lt);ii(yt,{get brightness(){return e(),m(()=>e().brightness)},get shadows(){return e(),m(()=>e().shadows)},get contrast(){return e(),m(()=>e().contrast)},get hdr(){return e(),m(()=>e().hdr)},get blurEnabled(){return e(),m(()=>e().blurEnabled)},get blurBrushSize(){return e(),m(()=>e().blurBrushSize)},get blurStrength(){return e(),m(()=>e().blurStrength)},get blurSoften(){return e(),m(()=>e().blurSoften)},get blurInvert(){return e(),m(()=>e().blurInvert)},get zoomLevel(){return e(),m(()=>e().zoomLevel)},onBrightnessChange:U,onShadowsChange:X,onContrastChange:te,onHdrChange:be,onBlurToggle:de,onBlurBrushSizeChange:Ie,onBlurStrengthChange:Be,onBlurSoftenChange:Fe,onBlurInvertChange:qe,onZoomChange:nt,onNudge:ae,onResetZoom:ne,onBrushPreviewChange:Qe,onEditEnd:Ve}),g(lt),T(rt,lt)},kt=rt=>{var lt=gt(),yt=Ye(lt);{var G=pe=>{var Ke=fi(),et=f(Ke);ci(et,{get imageUrl(){return e(),m(()=>e().currentImage)},get activeFilter(){return e(),m(()=>e().activeFilter)},get filterStrength(){return e(),m(()=>e().filterStrength)},onFilterChange:Se,onStrengthChange:We,onReset:Xe}),g(Ke),T(pe,Ke)};$(yt,pe=>{t()==="filter"&&pe(G)},!0)}T(rt,lt)};$(ot,rt=>{t()==="edit"?rt(Ge):rt(kt,!1)},!0)}T(ze,Ee)};$(xe,ze=>{t()==="crop"?ze(ke):ze(Ce,!1)})}T(k,A)};$(B,k=>{o()?k(le,!1):k(Z)})}var Q=u(B,2);{var se=k=>{ta(k,{message:"Save changes?",confirmText:"Yes",cancelText:"Cancel",onConfirm:C,onCancel:P})};$(Q,k=>{n(x)==="save"&&k(se)})}var De=u(Q,2);{var ce=k=>{ta(k,{message:"Start again? Your changes will be lost.",confirmText:"Yes",cancelText:"Cancel",onConfirm:H,onCancel:Y})};$(De,k=>{n(x)==="startAgain"&&k(ce)})}g(Ae),T(i,Ae),Me(),c()}var wi=F('<div class="before-after-container svelte-1i0ztfp" role="slider" aria-label="Before and after comparison" tabindex="0"><div class="before-image svelte-1i0ztfp"><img alt="Before" class="svelte-1i0ztfp"/></div> <div class="after-image svelte-1i0ztfp"><img alt="After" class="svelte-1i0ztfp"/></div> <div class="slider-handle svelte-1i0ztfp" role="presentation"><div class="slider-line svelte-1i0ztfp"></div> <div class="slider-thumb svelte-1i0ztfp"><img src="/icons/icon-ai-slider.svg" alt="" class="slider-icon svelte-1i0ztfp"/></div></div></div>');function xi(i,a){Le(a,!1);let e=h(a,"beforeImage",8,""),t=h(a,"afterImage",8,""),o=h(a,"position",12,50),r=h(a,"onChange",8,()=>{}),d=N(),c=!1;Bt(()=>(window.addEventListener("mousemove",b),window.addEventListener("touchmove",y,{passive:!1}),window.addEventListener("mouseup",S),window.addEventListener("touchend",S),()=>{window.removeEventListener("mousemove",b),window.removeEventListener("touchmove",y),window.removeEventListener("mouseup",S),window.removeEventListener("touchend",S)}));function s(){c=!0}function v(D){D.touches.length===1&&(c=!0)}function b(D){!c||!n(d)||x(D.clientX)}function y(D){!c||!n(d)||D.touches.length!==1||(D.preventDefault(),x(D.touches[0].clientX))}function S(){c=!1}function x(D){const I=n(d).getBoundingClientRect(),C=Math.max(0,Math.min(100,(D-I.left)/I.width*100));o(C),r()(C)}function _(D){if(!n(d))return;const I=n(d).getBoundingClientRect(),C=(D.clientX-I.left)/I.width*100;o(Math.max(0,Math.min(100,C))),r()(o())}Te();var R=wi(),l=f(R),w=f(l);g(l);var M=u(l,2),E=f(M);g(M);var L=u(M,2);g(R),ft(R,D=>z(d,D),()=>n(d)),J(()=>{_e(w,"src",e()),we(M,`clip-path: inset(0 ${100-o()}% 0 0)`),_e(E,"src",t()),we(L,`left: ${o()??""}%`)}),p("mousedown",L,s),p("touchstart",L,v),p("click",R,_),T(i,R),Me()}const _a={originalImage:null,currentImage:null,processedImage:null,isProcessing:!1,processingType:null,upscaleFactor:1,showComparison:!1,comparisonPosition:50};function _i(){const{subscribe:i,set:a,update:e}=bt(_a);return{subscribe:i,setImage:t=>e(o=>({...o,originalImage:t,currentImage:t,processedImage:null})),startProcessing:t=>e(o=>({...o,isProcessing:!0,processingType:t})),finishProcessing:t=>e(o=>({...o,isProcessing:!1,processingType:null,processedImage:t,currentImage:t,showComparison:!0})),cancelProcessing:()=>e(t=>({...t,isProcessing:!1,processingType:null})),setUpscaleFactor:t=>e(o=>({...o,upscaleFactor:t})),setComparisonPosition:t=>e(o=>({...o,comparisonPosition:t})),reset:()=>a(_a)}}const $e=_i(),ya=bt("enhance"),yi=ia($e,i=>i.currentImage!==null);let Lt=null;async function ki(i,a=4,e){e?.("Uploading image...");const t=await fetch("/api/face-enhance",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({image:i,scale:a,faceEnhance:.5})}),o=await t.json();if(!t.ok)throw new Error(o.error||`API error: ${t.status}`);if(o.status==="succeeded"&&o.output)return e?.("Downloading result..."),await Fa(o.output);if(o.status==="processing"||o.status==="starting")return e?.("Processing with CodeFormer..."),await Ci(o.pollUrl,e);throw new Error("Unexpected response")}async function Ci(i,a,e=60){for(let t=0;t<e;t++){await new Promise(d=>setTimeout(d,2e3));const o=await fetch(`/api/upscale?pollUrl=${encodeURIComponent(i)}`),r=await o.json();if(!o.ok)throw new Error(r.error||`Polling error: ${o.status}`);if(r.status==="succeeded"&&r.output)return a?.("Downloading result..."),await Fa(r.output);if(r.status==="failed")throw new Error(r.error||"Upscaling failed");a?.(`Processing in cloud (${(t+1)*2}s)...`)}throw new Error("Timeout waiting for result")}async function Fa(i){const e=await(await fetch(i)).blob();return new Promise((t,o)=>{const r=new FileReader;r.onload=()=>t(r.result),r.onerror=o,r.readAsDataURL(e)})}async function Si(i){if(Lt)return Lt;console.log("[AI] Loading RMBG background removal model..."),i?.("Downloading model (first time only)...");const{pipeline:a,env:e}=await un(async()=>{const{pipeline:t,env:o}=await import("../chunks/bLAnV4ll.js");return{pipeline:t,env:o}},[],import.meta.url);e.allowLocalModels=!1;try{Lt=await a("image-segmentation","briaai/RMBG-1.4",{device:"webgpu",dtype:"fp32"}),console.log("[AI] RMBG model ready (WebGPU)")}catch(t){console.log("[AI] WebGPU not available, falling back to WASM...",t.message),Lt=await a("image-segmentation","briaai/RMBG-1.4",{dtype:"q8"}),console.log("[AI] RMBG model ready (WASM)")}return Lt}async function Ii(i,a){try{console.log("[AI] Starting background removal...");const e=await Si(a);a?.("Processing image...");const t=await e(i);if(console.log("[AI] Segmentation result:",t),!t||t.length===0)throw new Error("No segmentation result returned");const o=t[0];if(console.log("[AI] Segment keys:",Object.keys(o)),o.mask&&o.mask.toDataURL)return console.log("[AI] Background removal complete (RawImage mask)"),await ka(i,o.mask);if(o.mask&&o.mask.data)return console.log("[AI] Background removal complete (data mask)"),await ka(i,o.mask);if(typeof o=="string"&&o.startsWith("data:"))return console.log("[AI] Background removal complete (direct output)"),o;throw console.log("[AI] Segment structure:",JSON.stringify(o,null,2).substring(0,500)),new Error("Unexpected segmentation result format")}catch(e){throw console.error("[AI] Background removal failed:",e),new Error("Background removal failed: "+e.message)}}async function ka(i,a){return new Promise((e,t)=>{const o=new Image;o.onload=async()=>{try{const r=document.createElement("canvas");r.width=o.width,r.height=o.height;const d=r.getContext("2d");d.drawImage(o,0,0);const c=d.getImageData(0,0,r.width,r.height),s=c.data;let v,b,y;if(a.toDataURL){const x=document.createElement("canvas");x.width=a.width,x.height=a.height;const _=x.getContext("2d"),R=new Image;R.onload=()=>{_.drawImage(R,0,0);const l=_.getImageData(0,0,a.width,a.height);Ca(s,l.data,r.width,r.height,a.width,a.height,!0),d.putImageData(c,0,0),e(r.toDataURL("image/png"))},R.onerror=t,R.src=a.toDataURL();return}else v=a.data,b=a.width,y=a.height;const S=v.length===b*y*4;Ca(s,v,r.width,r.height,b,y,S),d.putImageData(c,0,0),e(r.toDataURL("image/png"))}catch(r){t(r)}},o.onerror=t,o.src=i})}function Ca(i,a,e,t,o,r,d){const c=o/e,s=r/t;for(let v=0;v<t;v++)for(let b=0;b<e;b++){const y=Math.floor(b*c),S=Math.floor(v*s);let x;if(d){const R=(S*o+y)*4;x=a[R]}else{const R=S*o+y;x=a[R]||0}const _=(v*e+b)*4;i[_+3]=x}}var zi=F('<div class="size-display svelte-1rgvkgu"> </div>'),Ri=F('<button class="processing-btn svelte-1rgvkgu" disabled><span class="spinner svelte-1rgvkgu"></span> </button> <button class="cancel-btn svelte-1rgvkgu">Cancel</button>',1),Bi=F('<button class="upscale-btn svelte-1rgvkgu"><img src="/icons/icon-ai.svg" alt="" class="btn-icon svelte-1rgvkgu"/> Upscale image</button> <p class="hint svelte-1rgvkgu">Upscales, sharpens and enhances images</p>',1),Ei=F('<div class="error-message svelte-1rgvkgu"> </div>'),Pi=F('<div class="upscale-controls svelte-1rgvkgu"><div class="controls-content svelte-1rgvkgu"><!> <!> <!></div></div>');function Li(i,a){Le(a,!1);const e=()=>it($e,"$aiState",t),[t,o]=Rt(),r=4;let d=N(!1),c=N(""),s=N(null),v=N(null);async function b(){try{const I=await mt(e().originalImage),C=Math.round(I.naturalWidth*r),P=Math.round(I.naturalHeight*r);z(v,`${C} x ${P}`)}catch(I){console.error("Failed to get image dimensions:",I)}}async function y(){if(e().originalImage)try{z(d,!0),z(s,null),z(c,"Starting..."),$e.startProcessing("upscale");const I=await ki(e().originalImage,r,C=>{z(c,C)});$e.finishProcessing(I)}catch(I){z(s,I.message||"Upscaling failed"),$e.cancelProcessing()}finally{z(d,!1),z(c,"")}}function S(){z(d,!1),z(c,""),z(s,null),$e.cancelProcessing()}je(()=>e(),()=>{e().originalImage&&b()}),pt(),Te();var x=Pi(),_=f(x),R=f(_);{var l=I=>{var C=zi(),P=f(C);g(C),J(()=>He(P,`Output: ${n(v)??""}`)),T(I,C)};$(R,I=>{n(v)&&I(l)})}var w=u(R,2);{var M=I=>{var C=Ri(),P=Ye(C),H=u(f(P));g(P);var Y=u(P,2);J(()=>He(H,` ${n(c)||"Processing..."}`)),p("click",Y,S),T(I,C)},E=I=>{var C=Bi(),P=Ye(C);_t(2),p("click",P,y),T(I,C)};$(w,I=>{n(d)?I(M):I(E,!1)})}var L=u(w,2);{var D=I=>{var C=Ei(),P=f(C,!0);g(C),J(()=>He(P,n(s))),T(I,C)};$(L,I=>{n(s)&&I(D)})}g(_),g(x),T(i,x),Me(),o()}var Mi=F('<img alt="Original" class="compare-overlay svelte-1ibkqf6"/>'),Di=F('<div class="brush-indicator svelte-1ibkqf6"></div>'),Ti=F('<div class="brush-preview svelte-1ibkqf6"></div>'),Ai=F('<div class="drawer-overlay svelte-1ibkqf6" role="presentation"><div class="drawer svelte-1ibkqf6" role="dialog"><div class="drawer-header svelte-1ibkqf6"><button class="icon-btn svelte-1ibkqf6" title="Undo"><img src="/icons/icon-undo.svg" alt="Undo" class="svelte-1ibkqf6"/></button> <button class="icon-btn svelte-1ibkqf6" title="Redo"><img src="/icons/icon-redo.svg" alt="Redo" class="svelte-1ibkqf6"/></button> <div class="spacer svelte-1ibkqf6"></div> <button title="Compare"><img src="/icons/icon-compare.svg" alt="Compare" class="svelte-1ibkqf6"/></button></div> <div class="canvas-container svelte-1ibkqf6"><div class="canvas-wrapper svelte-1ibkqf6" role="presentation"><canvas class="svelte-1ibkqf6"></canvas> <!> <!> <!></div></div> <div class="controls-section svelte-1ibkqf6"><div class="button-group svelte-1ibkqf6"><button><img src="/icons/icon-erase.svg" alt="" class="svelte-1ibkqf6"/> Erase</button> <button><img src="/icons/icon-restore.svg" alt="" class="svelte-1ibkqf6"/> Restore</button></div> <div class="control-row svelte-1ibkqf6"><label class="svelte-1ibkqf6">Brush size</label> <div class="control-item svelte-1ibkqf6"><!> <button class="reset-btn svelte-1ibkqf6" title="Reset"><img src="/icons/icon-reset.svg" alt="Reset" class="svelte-1ibkqf6"/></button></div></div> <div class="control-row svelte-1ibkqf6"><label class="svelte-1ibkqf6">Soften edges</label> <div class="control-item svelte-1ibkqf6"><!> <button class="reset-btn svelte-1ibkqf6" title="Reset"><img src="/icons/icon-reset.svg" alt="Reset" class="svelte-1ibkqf6"/></button></div></div> <div class="control-row svelte-1ibkqf6"><label class="svelte-1ibkqf6">Zoom in</label> <div class="control-item svelte-1ibkqf6"><!> <button class="reset-btn svelte-1ibkqf6" title="Reset"><img src="/icons/icon-reset.svg" alt="Reset" class="svelte-1ibkqf6"/></button></div></div> <div class="nudge-buttons svelte-1ibkqf6"><button class="nudge-btn svelte-1ibkqf6">â</button> <button class="nudge-btn svelte-1ibkqf6">â</button> <button class="nudge-btn svelte-1ibkqf6">â</button> <button class="nudge-btn svelte-1ibkqf6">â</button></div> <div class="drawer-footer svelte-1ibkqf6"><button class="btn-cancel svelte-1ibkqf6">Cancel</button> <button class="btn-done svelte-1ibkqf6">Done</button></div></div></div></div>');function Fi(i,a){Le(a,!1);const e=N();let t=h(a,"image",8,""),o=h(a,"originalFullImage",8,""),r=h(a,"onClose",8,()=>{}),d=h(a,"onSave",8,()=>{}),c=N(),s=N(),v,b=N(!0),y=N(20),S=N(50),x=N(1),_=N(0),R=N(0),l=!1,w=[],M=0,E=null,L=N({x:0,y:0,visible:!1}),D=N(!1),I=N(0),C=N(0),P=N(!1);Bt(async()=>{const G=await mt(t());ga(c,n(c).width=G.naturalWidth),ga(c,n(c).height=G.naturalHeight),v=n(c).getContext("2d"),v.drawImage(G,0,0),o()?E=await mt(o()):E=G,H(),Y()});function H(){if(n(s)){const G=n(s).getBoundingClientRect();z(I,G.width),z(C,G.height)}}function Y(){w=w.slice(0,M+1),w.push(n(c).toDataURL()),M=w.length-1}function ee(){M>0&&(M--,oe())}function me(){M<w.length-1&&(M++,oe())}function oe(){const G=new Image;G.onload=()=>{v.clearRect(0,0,n(c).width,n(c).height),v.drawImage(G,0,0)},G.src=w[M]}function K(G){const pe=n(s).getBoundingClientRect(),Ke=n(c).width/pe.width,et=n(c).height/pe.height,Et=(G.clientX-pe.left)*Ke,Ot=(G.clientY-pe.top)*et;return{x:Et,y:Ot}}function fe(G){l=!0;const{x:pe,y:Ke}=K(G);ge(pe,Ke)}function q(G){const pe=n(s).getBoundingClientRect();if(z(L,{x:G.clientX-pe.left,y:G.clientY-pe.top,visible:!0}),!l)return;const{x:Ke,y:et}=K(G);ge(Ke,et)}function W(){l&&(l=!1,Y())}function re(){z(L,{...n(L),visible:!1}),l&&(l=!1,Y())}function ge(G,pe){const Ke=n(c).width/n(s).getBoundingClientRect().width,et=n(e)/2*Ke,Et=n(S)/100,Ot=Math.min(et-.001,et*(1-Et));v.save();try{if(n(b)){const ut=v.createRadialGradient(G,pe,Ot,G,pe,et);ut.addColorStop(0,"rgba(0,0,0,1)"),ut.addColorStop(1,"rgba(0,0,0,0)"),v.globalCompositeOperation="destination-out",v.fillStyle=ut,v.beginPath(),v.arc(G,pe,et,0,Math.PI*2),v.fill()}else{if(!E)return;const ut=document.createElement("canvas");ut.width=n(c).width,ut.height=n(c).height;const wt=ut.getContext("2d"),Wt=wt.createRadialGradient(G,pe,Ot,G,pe,et);Wt.addColorStop(0,"rgba(0,0,0,1)"),Wt.addColorStop(1,"rgba(0,0,0,0)"),wt.globalCompositeOperation="source-over",wt.drawImage(E,0,0,ut.width,ut.height),wt.globalCompositeOperation="destination-in",wt.fillStyle=Wt,wt.beginPath(),wt.arc(G,pe,et,0,Math.PI*2),wt.fill(),v.globalCompositeOperation="source-over",v.drawImage(ut,0,0)}}finally{v.restore()}}function Re(){z(y,20)}function ye(){z(S,50)}function Ze(){z(x,1),z(_,0),z(R,0)}function U(G){switch(G){case"up":z(R,n(R)-10);break;case"down":z(R,n(R)+10);break;case"left":z(_,n(_)-10);break;case"right":z(_,n(_)+10);break}}function X(){r()()}function te(){const G=n(c).toDataURL("image/png");d()(G)}je(()=>(n(y),n(I),n(C)),()=>{z(e,n(y)/100*Math.min(n(I)||300,n(C)||300)*.5)}),pt(),Te();var be=Ai(),de=f(be),Ie=f(de),Be=f(Ie),Fe=u(Be,2),qe=u(Fe,4);let Qe;g(Ie);var Ve=u(Ie,2),he=f(Ve),Oe=f(he);ft(Oe,G=>z(c,G),()=>n(c));var O=u(Oe,2);{var Ue=G=>{var pe=Mi();J(()=>_e(pe,"src",o())),T(G,pe)};$(O,G=>{n(P)&&o()&&G(Ue)})}var nt=u(O,2);{var ae=G=>{var pe=Di();J(()=>we(pe,`
							left: ${n(L),m(()=>n(L).x)??""}px;
							top: ${n(L),m(()=>n(L).y)??""}px;
							width: ${n(e)??""}px;
							height: ${n(e)??""}px;
						`)),T(G,pe)};$(nt,G=>{n(L),n(I),m(()=>n(L).visible&&n(I)>0)&&G(ae)})}var ne=u(nt,2);{var Se=G=>{var pe=Ti();J(()=>we(pe,`
						left: ${n(I)/2}px;
						top: ${n(C)/2}px;
						width: ${n(e)??""}px;
						height: ${n(e)??""}px;
					`)),T(G,pe)};$(ne,G=>{n(D)&&n(I)>0&&n(C)>0&&G(Se)})}g(he),ft(he,G=>z(s,G),()=>n(s)),g(Ve);var We=u(Ve,2),Xe=f(We),Ae=f(Xe);let B;var Z=u(Ae,2);let le;g(Xe);var Q=u(Xe,2),se=u(f(Q),2),De=f(se);Je(De,{min:5,max:100,step:1,get value(){return n(y)},onChange:G=>z(y,G),onInteractionStart:()=>{H(),z(D,!0)},onInteractionEnd:()=>z(D,!1)});var ce=u(De,2);g(se),g(Q);var k=u(Q,2),A=u(f(k),2),j=f(A);Je(j,{min:0,max:100,step:1,get value(){return n(S)},onChange:G=>z(S,G)});var ie=u(j,2);g(A),g(k);var V=u(k,2),xe=u(f(V),2),ke=f(xe);Je(ke,{min:1,max:3,step:.1,get value(){return n(x)},onChange:G=>z(x,G)});var Ce=u(ke,2);g(xe),g(V);var ze=u(V,2),Ee=f(ze),ot=u(Ee,2),Ge=u(ot,2),kt=u(Ge,2);g(ze);var rt=u(ze,2),lt=f(rt),yt=u(lt,2);g(rt),g(We),g(de),g(be),J(()=>{Qe=ue(qe,1,"icon-btn svelte-1ibkqf6",null,Qe,{active:n(P)}),we(he,`transform: scale(${n(x)??""}) translate(${n(_)??""}px, ${n(R)??""}px)`),B=ue(Ae,1,"mode-btn svelte-1ibkqf6",null,B,{active:n(b)}),le=ue(Z,1,"mode-btn svelte-1ibkqf6",null,le,{active:!n(b)})}),p("click",Be,ee),p("click",Fe,me),p("mousedown",qe,()=>z(P,!0)),p("mouseup",qe,()=>z(P,!1)),p("mouseleave",qe,()=>z(P,!1)),p("touchstart",qe,()=>z(P,!0)),p("touchend",qe,()=>z(P,!1)),p("mousedown",he,fe),p("mousemove",he,q),p("mouseup",he,W),p("mouseleave",he,re),p("click",Ae,()=>z(b,!0)),p("click",Z,()=>z(b,!1)),p("click",ce,Re),p("click",ie,ye),p("click",Ce,Ze),p("click",Ee,()=>U("up")),p("click",ot,()=>U("down")),p("click",Ge,()=>U("left")),p("click",kt,()=>U("right")),p("click",lt,X),p("click",yt,te),p("click",de,st(function(G){Kt.call(this,a,G)})),p("click",be,X),T(i,be),Me()}var qi=F('<button class="processing-btn svelte-1wdmsm1" disabled><span class="spinner svelte-1wdmsm1"></span> </button> <button class="cancel-btn svelte-1wdmsm1">Cancel</button>',1),Oi=F('<button class="remove-btn svelte-1wdmsm1"><img src="/icons/icon-ai.svg" alt="" class="btn-icon svelte-1wdmsm1"/> Remove background</button> <p class="hint svelte-1wdmsm1">Remove image background with AI</p> <button class="erase-btn svelte-1wdmsm1"><img src="/icons/icon-erase.svg" alt="" class="btn-icon svelte-1wdmsm1"/> Erase and restore</button> <p class="hint svelte-1wdmsm1">Manually clean up background</p>',1),Ui=F('<div class="error-message svelte-1wdmsm1"> </div>'),Hi=F('<div class="background-controls svelte-1wdmsm1"><div class="controls-content svelte-1wdmsm1"><!> <!></div> <!></div>');function Wi(i,a){Le(a,!1);const e=()=>it($e,"$aiState",t),[t,o]=Rt(),r=N();let d=N(!1),c=N(""),s=N(null),v=N(!1);async function b(){if(e().originalImage)try{z(d,!0),z(s,null),z(c,"Starting..."),$e.startProcessing("background");const C=await Ii(e().originalImage,P=>{z(c,P)});$e.finishProcessing(C)}catch(C){z(s,C.message||"Background removal failed"),$e.cancelProcessing()}finally{z(d,!1),z(c,"")}}function y(){z(d,!1),z(c,""),z(s,null),$e.cancelProcessing()}function S(){z(v,!0)}function x(){z(v,!1)}je(()=>e(),()=>{z(r,e().showComparison&&e().processedImage)}),pt(),Te();var _=Hi(),R=f(_),l=f(R);{var w=C=>{var P=qi(),H=Ye(P),Y=u(f(H));g(H);var ee=u(H,2);J(()=>He(Y,` ${n(c)||"Processing..."}`)),p("click",ee,y),T(C,P)},M=C=>{var P=Oi(),H=Ye(P),Y=u(H,4);_t(2),J(()=>Y.disabled=!n(r)),p("click",H,b),p("click",Y,S),T(C,P)};$(l,C=>{n(d)?C(w):C(M,!1)})}var E=u(l,2);{var L=C=>{var P=Ui(),H=f(P,!0);g(P),J(()=>He(H,n(s))),T(C,P)};$(E,C=>{n(s)&&C(L)})}g(R);var D=u(R,2);{var I=C=>{Fi(C,{get image(){return e(),m(()=>e().processedImage)},get originalFullImage(){return e(),m(()=>e().originalImage)},onClose:x,onSave:P=>{$e.finishProcessing(P),z(v,!1)}})};$(D,C=>{n(v)&&C(I)})}g(_),T(i,_),Me(),o()}var ji=F('<img alt="Working image" class="working-image svelte-17agwu4"/>'),Ni=F('<!> <div class="image-container svelte-17agwu4"><!></div> <!> <!>',1),Yi=F('<div class="ai-tab svelte-17agwu4"><!></div>');function Xi(i,a){Le(a,!1);const e=()=>it($e,"$aiState",r),t=()=>it(yi,"$hasAiImage",r),o=()=>it(ya,"$activeAiMenu",r),[r,d]=Rt();let c=N(50);function s(M){z(c,M),$e.setComparisonPosition(M)}const v=[{id:"upscale",label:"Upscale"},{id:"background",label:"Remove background"}];function b(M){$e.setImage(M)}function y(M){ya.set(M)}async function S(){e().currentImage&&await $t(e().currentImage)}function x(){e().currentImage&&ea(e().currentImage,"picflam-ai.png")}Te();var _=Yi(),R=f(_);{var l=M=>{Ta(M,{title:"Upscale and remove backgrounds using AI power",hint:"Import, drag or paste an image",onImageImport:b})},w=M=>{var E=Ni(),L=Ye(E);la(L,{canUndo:!1,canRedo:!1,onUndo:()=>{},onRedo:()=>{},onStartAgain:()=>$e.reset(),onCopy:S,onExport:x});var D=u(L,2),I=f(D);{var C=oe=>{xi(oe,{get beforeImage(){return e().originalImage},get afterImage(){return e().processedImage},get position(){return n(c)},onChange:s})},P=oe=>{var K=ji();J(()=>_e(K,"src",e().currentImage)),T(oe,K)};$(I,oe=>{e().showComparison&&e().processedImage?oe(C):oe(P,!1)})}g(D);var H=u(D,2);sa(H,{get tabs(){return v},get activeTab(){return o()},onTabChange:y});var Y=u(H,2);{var ee=oe=>{Li(oe,{})},me=oe=>{var K=gt(),fe=Ye(K);{var q=W=>{Wi(W,{})};$(fe,W=>{o()==="background"&&W(q)},!0)}T(oe,K)};$(Y,oe=>{o()==="upscale"?oe(ee):oe(me,!1)})}T(M,E)};$(R,M=>{t()?M(w,!1):M(l)})}g(_),T(i,_),Me(),d()}var Gi=F('<div class="size-controls svelte-1l8e210"><!></div>');function Qi(i,a){Le(a,!1);let e=h(a,"canvasSize",8,"1/1"),t=h(a,"onSizeChange",8,s=>{});const o=[{id:"9/16",label:"9:16",icon:"icon-vertical"},{id:"1/1",label:"1:1",icon:"icon-square"},{id:"16/9",label:"16:9",icon:"icon-horizontal"}];function r(s){t()(s)}Te();var d=Gi(),c=f(d);Aa(c,{get options(){return o},get value(){return e()},onChange:r,showLabels:!0,centered:!0}),g(d),T(i,d),Me()}var Vi=F("<button></button>"),Ji=F('<div class="color-picker-popover svelte-x97jji"><input type="color" class="svelte-x97jji"/></div>'),Zi=F('<button aria-label="Custom color"></button> <!>',1),Ki=F('<div class="color-swatches svelte-x97jji"><!> <!></div>');function zt(i,a){Le(a,!1);let e=h(a,"colors",24,()=>[]),t=h(a,"value",8,""),o=h(a,"onChange",8,S=>{}),r=h(a,"showRainbow",8,!0),d=N(!1),c=N("#5422b0");Te();var s=Ki(),v=f(s);vt(v,1,e,dt,(S,x)=>{var _=Vi();let R;J(()=>{R=ue(_,1,"swatch svelte-x97jji",null,R,{active:t()===n(x),white:n(x)==="#FFFFFF"}),we(_,`background-color: ${n(x)??""};`),_e(_,"aria-label",`Select color ${n(x)??""}`)}),p("click",_,()=>o()(n(x))),T(S,_)});var b=u(v,2);{var y=S=>{var x=Zi(),_=Ye(x);let R;var l=u(_,2);{var w=M=>{var E=Ji(),L=f(E);Ft(L),g(E),kn(L,()=>n(c),D=>z(c,D)),p("change",L,()=>o()(n(c))),T(M,E)};$(l,M=>{n(d)&&M(w)})}J(M=>R=ue(_,1,"swatch rainbow svelte-x97jji",null,R,M),[()=>({active:!e().includes(t())&&t()!=="transparent"})]),p("click",_,()=>z(d,!n(d))),T(S,x)};$(b,S=>{r()&&S(y)})}g(s),T(i,s),Me()}const It={solids:["#FFFFFF","#000000","#007C1F","#00679D","#B20715"],gradients:["linear-gradient(135deg, #5422b0 0%, #4B0082 100%)","linear-gradient(135deg, #15509B 0%, #20244F 100%)","linear-gradient(135deg, #A8076B 0%, #62045F 100%)","linear-gradient(135deg, #EA5C56 0%, #3C0C40 100%)","linear-gradient(135deg, #0A8F9D 0%, #202B54 100%)","linear-gradient(135deg, #D17A29 0%, #41363C 100%)"]},qa=["Inter","Roboto Slab","Saira Condensed","Lora","Playfair Display","Special Elite"],Mt={up:"to top",down:"to bottom",left:"to left",right:"to right"},$i={canvasSize:"1/1",background:{type:"solid",value:"#FFFFFF",direction:"down",gradientColors:["#5422b0","#4B0082"]},text1:"",text1Font:"Inter",text1Size:5,text1YPosition:3,text1LineSpacing:5,text1Color:"#000000",text1HighlightColor:"transparent",text1IsBold:!0,text1Align:"center",text1QuoteStyle:"none",text1QuoteSize:5,text2:"",text2Font:"Inter",text2Size:3,text2YPosition:8,text2LineSpacing:5,text2Color:"#000000",text2LabelColor:"transparent",text2IsBold:!1,text2Align:"center",overlay:null,overlaySize:50,overlayOpacity:100,overlayX:50,overlayY:50,overlayMask:"none",overlayLayer:"above",overlayBorderWidth:0,overlayBorderColor:"#FFFFFF",overlayNaturalWidth:0,overlayNaturalHeight:0};function eo(i){const a=[JSON.parse(JSON.stringify(i))];let e=0;const{subscribe:t,set:o,update:r}=bt(i);return{subscribe:t,set:d=>{a.splice(e+1),a.push(JSON.parse(JSON.stringify(d))),e=a.length-1,o(d)},update:d=>{r(c=>{const s=d(c);return a.splice(e+1),a.push(JSON.parse(JSON.stringify(s))),e=a.length-1,s})},undo:()=>e>0?(e--,o(JSON.parse(JSON.stringify(a[e]))),!0):!1,redo:()=>e<a.length-1?(e++,o(JSON.parse(JSON.stringify(a[e]))),!0):!1,canUndo:()=>e>0,canRedo:()=>e<a.length-1,reset:()=>{const d=JSON.parse(JSON.stringify(i));a.length=0,a.push(d),e=0,o(d)}}}const Ne=eo($i),aa=bt(!0),ct=bt("none");ia(Ne,i=>i.text1||i.text2||i.overlay||i.background.value!=="#FFFFFF");function to(){Ne.reset(),aa.set(!0),ct.set("none")}var ao=F('<button aria-label="Select gradient"></button>'),no=F('<div class="background-controls svelte-18tfgkp"><div class="section svelte-18tfgkp"><div class="color-row svelte-18tfgkp"><!></div></div> <div class="section svelte-18tfgkp"><div class="gradient-row svelte-18tfgkp"></div></div> <div class="section svelte-18tfgkp"><div class="gradient-preview-row svelte-18tfgkp"><button class="gradient-endpoint svelte-18tfgkp" aria-label="Edit start color"></button> <div class="gradient-preview svelte-18tfgkp"></div> <button class="gradient-endpoint svelte-18tfgkp" aria-label="Edit end color"></button></div></div> <div class="section svelte-18tfgkp"><div><button aria-label="Gradient direction up"><img src="/icons/icon-nudge-up.svg" alt="" class="direction-icon svelte-18tfgkp"/></button> <button aria-label="Gradient direction down"><img src="/icons/icon-nudge-down.svg" alt="" class="direction-icon svelte-18tfgkp"/></button> <button aria-label="Gradient direction left"><img src="/icons/icon-nudge-left.svg" alt="" class="direction-icon svelte-18tfgkp"/></button> <button aria-label="Gradient direction right"><img src="/icons/icon-nudge-right.svg" alt="" class="direction-icon svelte-18tfgkp"/></button></div></div></div>');function io(i,a){Le(a,!1);const e=N();let t=h(a,"background",24,()=>({type:"solid",value:"#FFFFFF",direction:"down",gradientColors:["#5422b0","#4B0082"]})),o=h(a,"onBackgroundChange",8,q=>{});const r=It.gradients.map(q=>{const W=q.match(/#[A-Fa-f0-9]{6}/g);return W?[W[0],W[1]]:["#5422b0","#4B0082"]});function d(q){o()({...t(),type:"solid",value:q})}function c(q){const W=r[q],re=Mt[t().direction]||"to bottom";o()({...t(),type:"gradient",value:`linear-gradient(${re}, ${W[0]} 0%, ${W[1]} 100%)`,gradientColors:W})}function s(q){const W=Mt[q],re=t().gradientColors||["#5422b0","#4B0082"];o()({...t(),direction:q,value:`linear-gradient(${W}, ${re[0]} 0%, ${re[1]} 100%)`})}function v(q,W){const re=[...t().gradientColors||["#5422b0","#4B0082"]];re[q]=W;const ge=Mt[t().direction]||"to bottom";o()({...t(),type:"gradient",value:`linear-gradient(${ge}, ${re[0]} 0%, ${re[1]} 100%)`,gradientColors:re})}je(()=>(Pe(t()),Mt),()=>{z(e,t().type==="gradient"?`linear-gradient(${Mt[t().direction]||"to bottom"}, ${t().gradientColors?.[0]||"#5422b0"} 0%, ${t().gradientColors?.[1]||"#4B0082"} 100%)`:`linear-gradient(to bottom, ${r[0][0]} 0%, ${r[0][1]} 100%)`)}),pt(),Te();var b=no(),y=f(b),S=f(y),x=f(S);{let q=at(()=>(Pe(t()),m(()=>t().type==="solid"?t().value:"")));zt(x,{get colors(){return Pe(It),m(()=>It.solids)},get value(){return n(q)},onChange:d,showRainbow:!0})}g(S),g(y);var _=u(y,2),R=f(_);vt(R,5,()=>r,dt,(q,W,re)=>{var ge=ao();let Re;J(()=>{Re=ue(ge,1,"gradient-swatch svelte-18tfgkp",null,Re,{active:t().type==="gradient"&&t().gradientColors?.[0]===n(W)[0]&&t().gradientColors?.[1]===n(W)[1]}),we(ge,`background: linear-gradient(135deg, ${n(W),m(()=>n(W)[0])??""} 0%, ${n(W),m(()=>n(W)[1])??""} 100%);`)}),p("click",ge,()=>c(re)),T(q,ge)}),g(R),g(_);var l=u(_,2),w=f(l),M=f(w),E=u(M,2),L=u(E,2);g(w),g(l);var D=u(l,2),I=f(D);let C;var P=f(I);let H;var Y=u(P,2);let ee;var me=u(Y,2);let oe;var K=u(me,2);let fe;g(I),g(D),g(b),J(()=>{we(M,`background-color: ${Pe(t()),m(()=>t().gradientColors?.[0]||"#5422b0")??""};`),we(E,`background: ${n(e)??""};`),we(L,`background-color: ${Pe(t()),m(()=>t().gradientColors?.[1]||"#4B0082")??""};`),C=ue(I,1,"direction-row svelte-18tfgkp",null,C,{inactive:t().type!=="gradient"}),H=ue(P,1,"direction-btn svelte-18tfgkp",null,H,{active:t().direction==="up"}),ee=ue(Y,1,"direction-btn svelte-18tfgkp",null,ee,{active:t().direction==="down"}),oe=ue(me,1,"direction-btn svelte-18tfgkp",null,oe,{active:t().direction==="left"}),fe=ue(K,1,"direction-btn svelte-18tfgkp",null,fe,{active:t().direction==="right"})}),p("click",M,()=>{const q=document.createElement("input");q.type="color",q.value=t().gradientColors?.[0]||"#5422b0",q.addEventListener("input",W=>v(0,W.target.value)),q.click()}),p("click",L,()=>{const q=document.createElement("input");q.type="color",q.value=t().gradientColors?.[1]||"#4B0082",q.addEventListener("input",W=>v(1,W.target.value)),q.click()}),p("click",P,()=>s("up")),p("click",Y,()=>s("down")),p("click",me,()=>s("left")),p("click",K,()=>s("right")),T(i,b),Me()}var oo=F("<button> </button>"),ro=F('<div class="font-dropdown-menu svelte-fspusj"></div>'),lo=F('<div class="text1-controls svelte-fspusj"><div class="text-input-container svelte-fspusj"><textarea class="text-input svelte-fspusj" placeholder="How to ==highlight== text"></textarea> <div class="resize-handle svelte-fspusj"></div></div> <div class="font-row svelte-fspusj"><span class="row-label svelte-fspusj">Font</span> <div class="font-dropdown-wrapper svelte-fspusj"><button class="font-dropdown-trigger svelte-fspusj"> <span class="dropdown-arrow svelte-fspusj">â¾</span></button> <!></div> <button aria-label="Bold"><img src="/icons/icon-bold.svg" alt="" class="btn-icon svelte-fspusj"/></button> <button class="icon-btn svelte-fspusj"><img alt="" class="btn-icon svelte-fspusj"/></button></div> <div class="slider-row svelte-fspusj"><!> <button class="reset-btn svelte-fspusj" aria-label="Reset size"><img src="/icons/icon-reset.svg" alt="" class="reset-icon svelte-fspusj"/></button></div> <div class="slider-row svelte-fspusj"><!> <button class="reset-btn svelte-fspusj" aria-label="Reset position"><img src="/icons/icon-reset.svg" alt="" class="reset-icon svelte-fspusj"/></button></div> <div class="slider-row svelte-fspusj"><!> <button class="reset-btn svelte-fspusj" aria-label="Reset line spacing"><img src="/icons/icon-reset.svg" alt="" class="reset-icon svelte-fspusj"/></button></div> <div class="color-section svelte-fspusj"><span class="section-label svelte-fspusj">Text colour</span> <!></div> <div class="color-section svelte-fspusj"><span class="section-label svelte-fspusj">Highlight colour</span> <!></div></div>');function so(i,a){Le(a,!1);let e=h(a,"text1",8,""),t=h(a,"text1Font",8,"Inter"),o=h(a,"text1Size",8,5),r=h(a,"text1YPosition",8,3),d=h(a,"text1LineSpacing",8,5),c=h(a,"text1Color",8,"#000000"),s=h(a,"text1HighlightColor",8,"transparent"),v=h(a,"text1IsBold",8,!0),b=h(a,"text1Align",8,"center"),y=h(a,"onChange",8,(O,Ue)=>{});const S=It.solids,x=["#FFD700","#000000","#007C1F","#00679D","#B20715"],_=["left","center","right"],R={text1Size:5,text1YPosition:3,text1LineSpacing:5};let l=N(!1),w=N();function M(O){n(w)&&!n(w).contains(O.target)&&z(l,!1)}Bt(()=>{document.addEventListener("click",M)}),oa(()=>{document.removeEventListener("click",M)});function E(O){y()("text1",O.target.value)}function L(O){y()("text1Font",O),z(l,!1)}function D(){y()("text1IsBold",!v())}function I(){const Ue=(_.indexOf(b())+1)%_.length;y()("text1Align",_[Ue])}function C(O){y()("text1Color",O)}function P(O){y()("text1HighlightColor",O===s()?"transparent":O)}function H(O){y()(O,R[O])}Te();var Y=lo(),ee=f(Y),me=f(ee);La(me),_t(2),g(ee);var oe=u(ee,2),K=u(f(oe),2),fe=f(K),q=f(fe);_t(),g(fe);var W=u(fe,2);{var re=O=>{var Ue=ro();vt(Ue,5,()=>qa,dt,(nt,ae)=>{var ne=oo();let Se;var We=f(ne,!0);g(ne),J(()=>{Se=ue(ne,1,"font-option svelte-fspusj",null,Se,{selected:t()===n(ae)}),we(ne,`font-family: '${n(ae)??""}'`),He(We,n(ae)==="Inter"?"Inter (Default)":n(ae))}),p("click",ne,()=>L(n(ae))),T(nt,ne)}),g(Ue),T(O,Ue)};$(W,O=>{n(l)&&O(re)})}g(K),ft(K,O=>z(w,O),()=>n(w));var ge=u(K,2);let Re;var ye=u(ge,2),Ze=f(ye);g(ye),g(oe);var U=u(oe,2),X=f(U);Je(X,{label:"Size",min:1,max:10,get value(){return o()},onChange:O=>y()("text1Size",O)});var te=u(X,2);g(U);var be=u(U,2),de=f(be);Je(de,{label:"Position",min:0,max:10,get value(){return r()},onChange:O=>y()("text1YPosition",O)});var Ie=u(de,2);g(be);var Be=u(be,2),Fe=f(Be);Je(Fe,{label:"Line spacing",min:1,max:10,get value(){return d()},onChange:O=>y()("text1LineSpacing",O)});var qe=u(Fe,2);g(Be);var Qe=u(Be,2),Ve=u(f(Qe),2);zt(Ve,{get colors(){return S},get value(){return c()},onChange:C,showRainbow:!0}),g(Qe);var he=u(Qe,2),Oe=u(f(he),2);zt(Oe,{get colors(){return x},get value(){return s()},onChange:P,showRainbow:!0}),g(he),g(Y),J(()=>{qt(me,e()),we(fe,`font-family: '${t()??""}'`),He(q,`${(t()==="Inter"?"Inter (Default)":t())??""} `),Re=ue(ge,1,"icon-btn svelte-fspusj",null,Re,{active:v()}),_e(ye,"aria-label",`Align ${b()??""}`),_e(Ze,"src",`/icons/icon-align-${b()??""}.svg`)}),p("input",me,E),p("click",fe,()=>z(l,!n(l))),p("click",ge,D),p("click",ye,I),p("click",te,()=>H("text1Size")),p("click",Ie,()=>H("text1YPosition")),p("click",qe,()=>H("text1LineSpacing")),T(i,Y),Me()}var co=F("<button> </button>"),vo=F('<div class="font-dropdown-menu svelte-n6z268"></div>'),uo=F('<div class="text2-controls svelte-n6z268"><div class="text-input-container svelte-n6z268"><textarea class="text-input svelte-n6z268" placeholder="How to ==highlight== text"></textarea> <div class="resize-handle svelte-n6z268"></div></div> <div class="font-row svelte-n6z268"><span class="row-label svelte-n6z268">Font</span> <div class="font-dropdown-wrapper svelte-n6z268"><button class="font-dropdown-trigger svelte-n6z268"> <span class="dropdown-arrow svelte-n6z268">â¾</span></button> <!></div> <button aria-label="Bold"><img src="/icons/icon-bold.svg" alt="" class="btn-icon svelte-n6z268"/></button> <button class="icon-btn svelte-n6z268"><img alt="" class="btn-icon svelte-n6z268"/></button></div> <div class="slider-row svelte-n6z268"><!> <button class="reset-btn svelte-n6z268" aria-label="Reset size"><img src="/icons/icon-reset.svg" alt="" class="reset-icon svelte-n6z268"/></button></div> <div class="slider-row svelte-n6z268"><!> <button class="reset-btn svelte-n6z268" aria-label="Reset position"><img src="/icons/icon-reset.svg" alt="" class="reset-icon svelte-n6z268"/></button></div> <div class="slider-row svelte-n6z268"><!> <button class="reset-btn svelte-n6z268" aria-label="Reset line spacing"><img src="/icons/icon-reset.svg" alt="" class="reset-icon svelte-n6z268"/></button></div> <div class="color-section svelte-n6z268"><span class="section-label svelte-n6z268">Text colour</span> <!></div> <div class="color-section svelte-n6z268"><span class="section-label svelte-n6z268">Highlight colour</span> <!></div></div>');function go(i,a){Le(a,!1);let e=h(a,"text2",8,""),t=h(a,"text2Font",8,"Inter"),o=h(a,"text2Size",8,3),r=h(a,"text2YPosition",8,8),d=h(a,"text2LineSpacing",8,5),c=h(a,"text2Color",8,"#000000"),s=h(a,"text2LabelColor",8,"transparent"),v=h(a,"text2IsBold",8,!1),b=h(a,"text2Align",8,"center"),y=h(a,"onChange",8,(O,Ue)=>{});const S=It.solids,x=["#FFD700","#000000","#007C1F","#00679D","#B20715"],_=["left","center","right"],R={text2Size:3,text2YPosition:8,text2LineSpacing:5};let l=N(!1),w=N();function M(O){n(w)&&!n(w).contains(O.target)&&z(l,!1)}Bt(()=>{document.addEventListener("click",M)}),oa(()=>{document.removeEventListener("click",M)});function E(O){y()("text2",O.target.value)}function L(O){y()("text2Font",O),z(l,!1)}function D(){y()("text2IsBold",!v())}function I(){const Ue=(_.indexOf(b())+1)%_.length;y()("text2Align",_[Ue])}function C(O){y()("text2Color",O)}function P(O){y()("text2LabelColor",O===s()?"transparent":O)}function H(O){y()(O,R[O])}Te();var Y=uo(),ee=f(Y),me=f(ee);La(me),_t(2),g(ee);var oe=u(ee,2),K=u(f(oe),2),fe=f(K),q=f(fe);_t(),g(fe);var W=u(fe,2);{var re=O=>{var Ue=vo();vt(Ue,5,()=>qa,dt,(nt,ae)=>{var ne=co();let Se;var We=f(ne,!0);g(ne),J(()=>{Se=ue(ne,1,"font-option svelte-n6z268",null,Se,{selected:t()===n(ae)}),we(ne,`font-family: '${n(ae)??""}'`),He(We,n(ae)==="Inter"?"Inter (Default)":n(ae))}),p("click",ne,()=>L(n(ae))),T(nt,ne)}),g(Ue),T(O,Ue)};$(W,O=>{n(l)&&O(re)})}g(K),ft(K,O=>z(w,O),()=>n(w));var ge=u(K,2);let Re;var ye=u(ge,2),Ze=f(ye);g(ye),g(oe);var U=u(oe,2),X=f(U);Je(X,{label:"Size",min:1,max:10,get value(){return o()},onChange:O=>y()("text2Size",O)});var te=u(X,2);g(U);var be=u(U,2),de=f(be);Je(de,{label:"Position",min:0,max:10,get value(){return r()},onChange:O=>y()("text2YPosition",O)});var Ie=u(de,2);g(be);var Be=u(be,2),Fe=f(Be);Je(Fe,{label:"Line spacing",min:1,max:10,get value(){return d()},onChange:O=>y()("text2LineSpacing",O)});var qe=u(Fe,2);g(Be);var Qe=u(Be,2),Ve=u(f(Qe),2);zt(Ve,{get colors(){return S},get value(){return c()},onChange:C,showRainbow:!0}),g(Qe);var he=u(Qe,2),Oe=u(f(he),2);zt(Oe,{get colors(){return x},get value(){return s()},onChange:P,showRainbow:!0}),g(he),g(Y),J(()=>{qt(me,e()),we(fe,`font-family: '${t()??""}'`),He(q,`${(t()==="Inter"?"Inter (Default)":t())??""} `),Re=ue(ge,1,"icon-btn svelte-n6z268",null,Re,{active:v()}),_e(ye,"aria-label",`Align ${b()??""}`),_e(Ze,"src",`/icons/icon-align-${b()??""}.svg`)}),p("input",me,E),p("click",fe,()=>z(l,!n(l))),p("click",ge,D),p("click",ye,I),p("click",te,()=>H("text2Size")),p("click",Ie,()=>H("text2YPosition")),p("click",qe,()=>H("text2LineSpacing")),T(i,Y),Me()}var ho=F('<button><img alt="" class="style-icon svelte-4vqdnp"/></button>'),fo=F('<div class="quote-controls svelte-4vqdnp"><div class="style-row svelte-4vqdnp"></div> <div><!> <button class="reset-btn svelte-4vqdnp" aria-label="Reset size"><img src="/icons/icon-reset.svg" alt="" class="reset-icon svelte-4vqdnp"/></button></div></div>');function bo(i,a){Le(a,!1);let e=h(a,"quoteStyle",8,"none"),t=h(a,"quoteSize",8,5),o=h(a,"onChange",8,(R,l)=>{});const r=[{id:"none",icon:"/icons/icon-none.svg",label:"No quote"},{id:"serif",icon:"/icons/icon-quote-serif.svg",label:"Serif quote"},{id:"slab",icon:"/icons/icon-quote-slab.svg",label:"Slab quote"}],d={quoteSize:5};function c(R){o()("text1QuoteStyle",R)}function s(R){o()("text1QuoteSize",d[R])}Te();var v=fo(),b=f(v);vt(b,5,()=>r,dt,(R,l)=>{var w=ho();let M;var E=f(w);g(w),J(()=>{M=ue(w,1,"style-btn svelte-4vqdnp",null,M,{active:e()===n(l).id,"is-none":n(l).id==="none"}),_e(w,"aria-label",(n(l),m(()=>n(l).label))),_e(E,"src",(n(l),m(()=>n(l).icon)))}),p("click",w,()=>c(n(l).id)),T(R,w)}),g(b);var y=u(b,2);let S;var x=f(y);Je(x,{label:"Size",min:1,max:10,get value(){return t()},onChange:R=>e()!=="none"&&o()("text1QuoteSize",R)});var _=u(x,2);g(y),g(v),J(()=>{S=ue(y,1,"slider-row svelte-4vqdnp",null,S,{disabled:e()==="none"}),_.disabled=e()==="none"}),p("click",_,()=>s("quoteSize")),T(i,v),Me()}var mo=F('<div class="import-box svelte-qirtgp" role="button" tabindex="0"><label class="import-area svelte-qirtgp"><input type="file" accept="image/*" class="file-input svelte-qirtgp"/> <img src="/icons/icon-upload.svg" alt="" class="upload-icon svelte-qirtgp"/> <span class="import-text svelte-qirtgp">Import, drag or<br/>paste an image</span></label> <button class="paste-btn svelte-qirtgp">Paste</button></div>'),po=F('<div class="slider-row svelte-qirtgp"><!></div> <div class="slider-row svelte-qirtgp"><!></div> <div class="mask-row svelte-qirtgp"><span class="row-label svelte-qirtgp">Mask</span> <div class="mask-buttons svelte-qirtgp"><button aria-label="No mask"><img src="/icons/icon-none.svg" alt="" class="mask-icon svelte-qirtgp"/></button> <button aria-label="Rounded mask"><img src="/icons/icon-square.svg" alt="" class="mask-icon svelte-qirtgp"/></button> <button aria-label="Circle mask"><div class="circle-icon svelte-qirtgp"></div></button></div> <span class="row-label layer-label svelte-qirtgp">Layers</span> <div class="layer-buttons svelte-qirtgp"><button aria-label="Overlay above text"><img src="/icons/icon-layer-above.svg" alt="" class="layer-icon svelte-qirtgp"/></button> <button aria-label="Overlay below text"><img src="/icons/icon-layer-below.svg" alt="" class="layer-icon svelte-qirtgp"/></button></div></div> <div class="slider-row svelte-qirtgp"><!></div> <div class="color-section svelte-qirtgp"><span class="section-label svelte-qirtgp">Border colour</span> <!></div>',1),wo=F('<div class="overlay-controls svelte-qirtgp"><!></div>');function xo(i,a){Le(a,!1);let e=h(a,"overlay",8,null),t=h(a,"overlaySize",8,50),o=h(a,"overlayOpacity",8,100),r=h(a,"overlayMask",8,"none"),d=h(a,"overlayLayer",8,"above"),c=h(a,"overlayBorderWidth",8,0),s=h(a,"overlayBorderColor",8,"#FFFFFF"),v=h(a,"onChange",8,(D,I)=>{});const b=It.solids,y=[0,1,2,3];function S(D){const I=D.target.files?.[0];if(I&&I.type.startsWith("image/")){const C=new FileReader;C.onload=P=>{v()("overlay",P.target.result)},C.readAsDataURL(I)}D.target.value=""}function x(D){D.preventDefault();const I=D.dataTransfer?.files?.[0];if(I&&I.type.startsWith("image/")){const C=new FileReader;C.onload=P=>{v()("overlay",P.target.result)},C.readAsDataURL(I)}}function _(D){D.preventDefault()}async function R(){try{const D=await navigator.clipboard.read();for(const I of D){const C=I.types.find(P=>P.startsWith("image/"));if(C){const P=await I.getType(C),H=new FileReader;H.onload=Y=>{v()("overlay",Y.target.result)},H.readAsDataURL(P);return}}}catch(D){console.error("Paste failed:",D)}}function l(D){const I=y.reduce((C,P)=>Math.abs(P-D)<Math.abs(C-D)?P:C);v()("overlayBorderWidth",I)}Te();var w=wo(),M=f(w);{var E=D=>{var I=mo(),C=f(I),P=f(C);_t(4),g(C);var H=u(C,2);g(I),p("change",P,S),p("click",H,R),p("drop",I,x),p("dragover",I,_),T(D,I)},L=D=>{var I=po(),C=Ye(I),P=f(C);Je(P,{label:"Size",min:10,max:100,get value(){return t()},onChange:Ie=>v()("overlaySize",Ie)}),g(C);var H=u(C,2),Y=f(H);Je(Y,{label:"Opacity",min:0,max:100,get value(){return o()},onChange:Ie=>v()("overlayOpacity",Ie)}),g(H);var ee=u(H,2),me=u(f(ee),2),oe=f(me);let K;var fe=u(oe,2);let q;var W=u(fe,2);let re;g(me);var ge=u(me,4),Re=f(ge);let ye;var Ze=u(Re,2);let U;g(ge),g(ee);var X=u(ee,2),te=f(X);Je(te,{label:"Border width",min:0,max:3,step:1,get value(){return c()},onChange:l}),g(X);var be=u(X,2),de=u(f(be),2);zt(de,{get colors(){return b},get value(){return s()},onChange:Ie=>v()("overlayBorderColor",Ie),showRainbow:!0}),g(be),J(()=>{K=ue(oe,1,"mask-btn svelte-qirtgp",null,K,{active:r()==="none"}),q=ue(fe,1,"mask-btn svelte-qirtgp",null,q,{active:r()==="rounded"}),re=ue(W,1,"mask-btn svelte-qirtgp",null,re,{active:r()==="circle"}),ye=ue(Re,1,"layer-btn svelte-qirtgp",null,ye,{active:d()==="above"}),U=ue(Ze,1,"layer-btn svelte-qirtgp",null,U,{active:d()==="below"})}),p("click",oe,()=>v()("overlayMask","none")),p("click",fe,()=>v()("overlayMask","rounded")),p("click",W,()=>v()("overlayMask","circle")),p("click",Re,()=>v()("overlayLayer","above")),p("click",Ze,()=>v()("overlayLayer","below")),T(D,I)};$(M,D=>{e()?D(L,!1):D(E)})}g(w),T(i,w),Me()}var _o=F('<button class="template-card svelte-fxk5n4"><div class="template-placeholder svelte-fxk5n4"> </div></button>'),yo=F('<div class="template-picker svelte-fxk5n4"><p class="picker-title svelte-fxk5n4">Create quotes and cards. Start with a template or blank canvas</p> <button class="blank-canvas-btn svelte-fxk5n4"><img src="/icons/icon-add.svg" alt="" class="add-icon svelte-fxk5n4"/></button> <div class="template-grid svelte-fxk5n4"></div></div>'),ko=F('<div class="canvas-quote svelte-fxk5n4">&#8220;</div>'),Co=F('<div class="text1-wrapper svelte-fxk5n4"><!> <div class="canvas-text text1 svelte-fxk5n4"><!></div></div>'),So=F('<div class="canvas-text text2 svelte-fxk5n4"><!></div>'),Io=F('<div role="button" tabindex="0"><div><button class="delete-btn svelte-fxk5n4" aria-label="Delete overlay"><img src="/icons/icon-close.svg" alt="" class="delete-icon svelte-fxk5n4"/></button> <div><img alt="Overlay" class="overlay-image svelte-fxk5n4" draggable="false"/></div></div></div>'),zo=F('<!> <div class="canvas-container svelte-fxk5n4"><div class="design-canvas svelte-fxk5n4" role="button" tabindex="0"><!> <!> <!></div></div> <!> <div class="controls-panel svelte-fxk5n4"><!></div>',1),Ro=F('<div class="design-tab svelte-fxk5n4"><!></div>');function Bo(i,a){Le(a,!1);const e=()=>it(ct,"$activeDesignMenu",r),t=()=>it(Ne,"$slideState",r),o=()=>it(aa,"$showTemplatePicker",r),[r,d]=Rt(),c=N();let s=N(),v=N(300),b=300,y=300,S,x=!1,_=0,R=0,l=0,w=0;Bt(()=>{n(s)&&(S=new ResizeObserver(([U])=>{const{width:X,height:te}=U.contentRect;b=X,y=te,z(v,Math.min(X,te))}),S.observe(n(s)))}),oa(()=>{S&&S.disconnect()});const M=[{id:"size",label:"Size"},{id:"background",label:"Background"},{id:"text1",label:"Text 1"},{id:"text2",label:"Text 2"},{id:"quote",label:"Quote"},{id:"overlay",label:"Overlay"}];function E(U){U==="blank"&&Ne.reset(),aa.set(!1)}function L(U){ct.set(e()===U?"none":U)}async function D(){}function I(){}function C(U){Ne.update(X=>({...X,canvasSize:U}))}function P(U){Ne.update(X=>({...X,background:U}))}function H(U,X){Ne.update(te=>({...te,[U]:X}))}function Y(U,X){Ne.update(te=>({...te,[U]:X}))}function ee(U,X){Ne.update(te=>({...te,[U]:X}))}function me(U,X){if(U==="overlay"&&X){const te=new Image;te.onload=()=>{Ne.update(be=>({...be,overlay:X,overlayNaturalWidth:te.naturalWidth,overlayNaturalHeight:te.naturalHeight,overlayX:50,overlayY:50})),ct.set("overlay")},te.src=X}else U==="overlayLayer"?(Ne.update(te=>({...te,[U]:X})),ct.set("none")):Ne.update(te=>({...te,[U]:X}))}function oe(){Ne.update(U=>({...U,overlay:null,overlayNaturalWidth:0,overlayNaturalHeight:0})),ct.set("none")}function K(U){if(U.target.closest(".delete-btn"))return;U.preventDefault(),x=!0;const X=U.touches?.[0]||U;_=X.clientX,R=X.clientY,l=t().overlayX,w=t().overlayY,window.addEventListener("mousemove",fe),window.addEventListener("mouseup",q),window.addEventListener("touchmove",fe,{passive:!1}),window.addEventListener("touchend",q)}function fe(U){if(!x)return;U.preventDefault();const X=U.touches?.[0]||U,te=X.clientX-_,be=X.clientY-R,de=te/b*100,Ie=be/y*100,Be=Math.max(0,Math.min(100,l+de)),Fe=Math.max(0,Math.min(100,w+Ie));Ne.update(qe=>({...qe,overlayX:Be,overlayY:Fe}))}function q(){x=!1,window.removeEventListener("mousemove",fe),window.removeEventListener("mouseup",q),window.removeEventListener("touchmove",fe),window.removeEventListener("touchend",q)}function W(U){const X=U.target;X.closest(".overlay-wrapper")?ct.set("overlay"):X.closest(".text1-wrapper")?ct.set("text1"):X.closest(".canvas-text.text2")?ct.set("text2"):X.closest(".canvas-quote")?ct.set("quote"):ct.set("none")}function re(U){if(!U.overlay||!U.overlayNaturalWidth)return null;const X=U.overlayNaturalWidth/U.overlayNaturalHeight,te=U.overlaySize/100*100;let be,de;return X>=1?(be=te,de=te/X):(de=te,be=te*X),{width:be,height:de}}je(()=>t(),()=>{z(c,re(t()))}),pt(),Te();var ge=Ro(),Re=f(ge);{var ye=U=>{var X=yo(),te=u(f(X),2),be=u(te,2);vt(be,4,()=>[1,2,3,4,5,6],dt,(de,Ie)=>{var Be=_o(),Fe=f(Be),qe=f(Fe);g(Fe),g(Be),J(()=>He(qe,`Template ${Ie??""}`)),p("click",Be,()=>E(`template-${Ie}`)),T(de,Be)}),g(be),g(X),p("click",te,()=>E("blank")),T(U,X)},Ze=U=>{var X=zo(),te=Ye(X);{let ae=at(()=>(Pe(Ne),m(()=>Ne.canUndo()))),ne=at(()=>(Pe(Ne),m(()=>Ne.canRedo())));la(te,{get canUndo(){return n(ae)},get canRedo(){return n(ne)},onUndo:()=>Ne.undo(),onRedo:()=>Ne.redo(),get onStartAgain(){return to},onCopy:D,onExport:I})}var be=u(te,2),de=f(be),Ie=f(de);{var Be=ae=>{var ne=Co(),Se=f(ne);{var We=B=>{const Z=at(()=>(n(v),t(),m(()=>n(v)*.1*t().text1Size/5))),le=at(()=>(Pe(n(Z)),t(),m(()=>n(Z)*(1+t().text1LineSpacing*.1)))),Q=at(()=>(Pe(n(le)),t(),m(()=>n(le)*(t().text1QuoteStyle==="slab"?.35:.4))));var se=ko();J(()=>we(se,`
									font-family: ${t(),m(()=>t().text1QuoteStyle==="serif"?'"Playfair Display", serif':'"Alfa Slab One", cursive')??""};
									font-size: ${n(v),t(),m(()=>n(v)*.08*t().text1QuoteSize)??""}px;
									font-weight: ${t(),m(()=>t().text1QuoteStyle==="serif"?"bold":"normal")??""};
									color: ${t(),m(()=>t().text1Color)??""};
									margin-bottom: ${n(Q)??""}px;
								`)),T(B,se)};$(Se,B=>{t(),m(()=>t().text1QuoteStyle!=="none")&&B(We)})}var Xe=u(Se,2),Ae=f(Xe);fa(Ae,()=>(t(),m(()=>t().text1.replace(/==(.+?)==/g,`<span style="color: ${t().text1HighlightColor};">$1</span>`).replace(/\n/g,"<br>")))),g(Xe),g(ne),J(()=>{we(ne,`top: ${t(),m(()=>t().text1YPosition*10)??""}%;`),we(Xe,`
								font-family: '${t(),m(()=>t().text1Font)??""}';
								font-size: ${t(),m(()=>t().text1Size*.5)??""}em;
								font-weight: ${t(),m(()=>t().text1IsBold?"bold":"normal")??""};
								color: ${t(),m(()=>t().text1Color)??""};
								text-align: ${t(),m(()=>t().text1Align)??""};
								line-height: ${t(),m(()=>1+t().text1LineSpacing*.1)??""};
							`)}),T(ae,ne)};$(Ie,ae=>{t(),m(()=>t().text1)&&ae(Be)})}var Fe=u(Ie,2);{var qe=ae=>{var ne=So(),Se=f(ne);fa(Se,()=>(t(),m(()=>t().text2.replace(/==(.+?)==/g,`<span style="color: ${t().text2LabelColor};">$1</span>`).replace(/\n/g,"<br>")))),g(ne),J(()=>we(ne,`
							font-family: '${t(),m(()=>t().text2Font)??""}';
							font-size: ${t(),m(()=>t().text2Size*.5)??""}em;
							font-weight: ${t(),m(()=>t().text2IsBold?"bold":"normal")??""};
							color: ${t(),m(()=>t().text2Color)??""};
							text-align: ${t(),m(()=>t().text2Align)??""};
							top: ${t(),m(()=>t().text2YPosition*10)??""}%;
							line-height: ${t(),m(()=>1+t().text2LineSpacing*.1)??""};
						`)),T(ae,ne)};$(Fe,ae=>{t(),m(()=>t().text2)&&ae(qe)})}var Qe=u(Fe,2);{var Ve=ae=>{var ne=Io();let Se;var We=f(ne);let Xe;var Ae=f(We),B=u(Ae,2);let Z;var le=f(B);g(B),g(We),g(ne),J(()=>{Se=ue(ne,1,"overlay-wrapper svelte-fxk5n4",null,Se,{active:e()==="overlay"}),we(ne,`
							left: ${t(),m(()=>t().overlayX)??""}%;
							top: ${t(),m(()=>t().overlayY)??""}%;
							width: ${n(c),m(()=>n(c).width)??""}%;
							opacity: ${t(),m(()=>t().overlayOpacity/100)??""};
							z-index: ${e(),t(),m(()=>e()==="overlay"?11:t().overlayLayer==="below"?1:10)??""};
						`),Xe=ue(We,1,"overlay-bounding-box svelte-fxk5n4",null,Xe,{"mask-none":t().overlayMask==="none","mask-rounded":t().overlayMask==="rounded","mask-circle":t().overlayMask==="circle"}),we(We,`
								border-width: ${t(),m(()=>t().overlayBorderWidth*2)??""}px;
								border-color: ${t(),m(()=>t().overlayBorderColor)??""};
							`),Z=ue(B,1,"overlay-image-container svelte-fxk5n4",null,Z,{"mask-rounded":t().overlayMask==="rounded","mask-circle":t().overlayMask==="circle"}),_e(le,"src",(t(),m(()=>t().overlay)))}),p("click",Ae,oe),p("mousedown",ne,K),p("touchstart",ne,K),T(ae,ne)};$(Qe,ae=>{t(),n(c),m(()=>t().overlay&&n(c))&&ae(Ve)})}g(de),ft(de,ae=>z(s,ae),()=>n(s)),g(be);var he=u(be,2);sa(he,{get tabs(){return M},get activeTab(){return e()},onTabChange:L});var Oe=u(he,2),O=f(Oe);{var Ue=ae=>{xo(ae,{get overlay(){return t(),m(()=>t().overlay)},get overlaySize(){return t(),m(()=>t().overlaySize)},get overlayOpacity(){return t(),m(()=>t().overlayOpacity)},get overlayMask(){return t(),m(()=>t().overlayMask)},get overlayLayer(){return t(),m(()=>t().overlayLayer)},get overlayBorderWidth(){return t(),m(()=>t().overlayBorderWidth)},get overlayBorderColor(){return t(),m(()=>t().overlayBorderColor)},onChange:me,onDelete:oe})},nt=ae=>{var ne=gt(),Se=Ye(ne);{var We=Ae=>{Qi(Ae,{get canvasSize(){return t(),m(()=>t().canvasSize)},onSizeChange:C})},Xe=Ae=>{var B=gt(),Z=Ye(B);{var le=se=>{io(se,{get background(){return t(),m(()=>t().background)},onBackgroundChange:P})},Q=se=>{var De=gt(),ce=Ye(De);{var k=j=>{so(j,{get text1(){return t(),m(()=>t().text1)},get text1Font(){return t(),m(()=>t().text1Font)},get text1Size(){return t(),m(()=>t().text1Size)},get text1YPosition(){return t(),m(()=>t().text1YPosition)},get text1LineSpacing(){return t(),m(()=>t().text1LineSpacing)},get text1Color(){return t(),m(()=>t().text1Color)},get text1HighlightColor(){return t(),m(()=>t().text1HighlightColor)},get text1IsBold(){return t(),m(()=>t().text1IsBold)},get text1Align(){return t(),m(()=>t().text1Align)},onChange:H})},A=j=>{var ie=gt(),V=Ye(ie);{var xe=Ce=>{go(Ce,{get text2(){return t(),m(()=>t().text2)},get text2Font(){return t(),m(()=>t().text2Font)},get text2Size(){return t(),m(()=>t().text2Size)},get text2YPosition(){return t(),m(()=>t().text2YPosition)},get text2LineSpacing(){return t(),m(()=>t().text2LineSpacing)},get text2Color(){return t(),m(()=>t().text2Color)},get text2LabelColor(){return t(),m(()=>t().text2LabelColor)},get text2IsBold(){return t(),m(()=>t().text2IsBold)},get text2Align(){return t(),m(()=>t().text2Align)},onChange:Y})},ke=Ce=>{var ze=gt(),Ee=Ye(ze);{var ot=Ge=>{bo(Ge,{get quoteStyle(){return t(),m(()=>t().text1QuoteStyle)},get quoteSize(){return t(),m(()=>t().text1QuoteSize)},onChange:ee})};$(Ee,Ge=>{e()==="quote"&&Ge(ot)},!0)}T(Ce,ze)};$(V,Ce=>{e()==="text2"?Ce(xe):Ce(ke,!1)},!0)}T(j,ie)};$(ce,j=>{e()==="text1"?j(k):j(A,!1)},!0)}T(se,De)};$(Z,se=>{e()==="background"?se(le):se(Q,!1)},!0)}T(Ae,B)};$(Se,Ae=>{e()==="size"?Ae(We):Ae(Xe,!1)},!0)}T(ae,ne)};$(O,ae=>{e(),t(),m(()=>e()==="overlay"||e()==="none"&&t().overlay)?ae(Ue):ae(nt,!1)})}g(Oe),J(()=>we(de,`
					aspect-ratio: ${t(),m(()=>t().canvasSize)??""};
					background: ${t(),m(()=>(t().background.type==="solid",t().background.value))??""};
				`)),p("click",de,W),p("keydown",de,ae=>ae.key==="Enter"&&W(ae)),T(U,X)};$(Re,U=>{o()?U(ye):U(Ze,!1)})}g(ge),T(i,ge),Me(),d()}const Qt=bt("crop");var Eo=F('<!> <main class="main svelte-1uha8ag"><!></main> <!>',1);function qo(i,a){Le(a,!1);const e=()=>it(Qt,"$activeTab",o),t=()=>it(ve,"$cropState",o),[o,r]=Rt();let d=N(!1),c=null;function s(E){if(e()==="crop"&&t().cropPending&&E!=="crop"){c=E,z(d,!0);return}Qt.set(E)}async function v(){z(d,!1);const E=t();if(E.currentImage&&E.cropPending){const L=await Da(E.currentImage,E.cropBox,E.imageWidth,E.imageHeight),D=await Ht(L);ve.set({...E,currentImage:L,imageWidth:D.width,imageHeight:D.height,cropBox:{x:0,y:0,width:100,height:100},cropPending:!1,isCropping:!1})}c&&(Qt.set(c),c=null)}function b(){z(d,!1),c=null}Te();var y=Eo(),S=Ye(y);Sn(S,{get activeTab(){return e()},onTabChange:s});var x=u(S,2),_=f(x);{var R=E=>{pi(E,{})},l=E=>{var L=gt(),D=Ye(L);{var I=P=>{Xi(P,{})},C=P=>{var H=gt(),Y=Ye(H);{var ee=me=>{Bo(me,{})};$(Y,me=>{e()==="design"&&me(ee)},!0)}T(P,H)};$(D,P=>{e()==="ai"?P(I):P(C,!1)},!0)}T(E,L)};$(_,E=>{e()==="crop"?E(R):E(l,!1)})}g(x);var w=u(x,2);{var M=E=>{ta(E,{message:"Save changes?",confirmText:"Yes",cancelText:"Cancel",onConfirm:v,onCancel:b})};$(w,E=>{n(d)&&E(M)})}T(i,y),Me(),r()}export{qo as component};

import{f as D,a as A,c as nt}from"../chunks/fofpT_Z8.js";import"../chunks/B0wnF16V.js";import{F as Tt,i as Ze,x as ya,C as At,j as Sa,M as Ia,g as a,aI as Qe,aA as Ra,O as za,a5 as ea,aj as Ut,B as Bt,N as Ba,ao as Ea,a2 as ta,ax as Pa,P as Ht,az as Ma,am as Gt,w as fa,I as aa,at as W,aO as Ta,aP as Aa,aQ as Ua,aR as st,ay as ma,R as ba,aS as Dt,ah as Da,aT as La,al as Ha,a3 as Fa,aU as pa,L as wa,aV as qa,aW as Oa,aX as Wa,aY as Na,aZ as Ya,p as pe,t as Q,n as we,s as p,k as S,l as _,aq as y,b as U,a_ as xe,a$ as bt,e as Re,a4 as Jt,m as ze,b0 as na}from"../chunks/DKVK_XYJ.js";import{p as m,b as wt,i as Z,s as qe,a as kt,_ as ja}from"../chunks/BJ6IQwyK.js";import{i as Ce}from"../chunks/D8EnKHUR.js";import{e as k,s as ke}from"../chunks/CuybRmit.js";import{c as Xa,o as Vt,d as Zt,w as lt}from"../chunks/umaFkCoN.js";let ia=!1;function Ga(){ia||(ia=!0,document.addEventListener("reset",n=>{Promise.resolve().then(()=>{if(!n.defaultPrevented)for(const t of n.target.elements)t.__on_r?.()})},{capture:!0}))}function _t(n,t){return t}function Ja(n,t,e){for(var i=[],o=t.length,r,c=t.length,d=0;d<o;d++){let I=t[d];ba(I,()=>{if(r){if(r.pending.delete(I),r.done.add(I),r.pending.size===0){var w=n.outrogroups;Ft(Gt(r.done)),w.delete(r),w.size===0&&(n.outrogroups=null)}}else c-=1},!1)}if(c===0){var l=i.length===0&&e!==null;if(l){var u=e,h=u.parentNode;Ha(h),h.append(u),n.items.clear()}Ft(t,!l)}else r={pending:new Set(t),done:new Set},(n.outrogroups??=new Set).add(r)}function Ft(n,t=!0){for(var e=0;e<n.length;e++)Fa(n[e],t)}var oa;function xt(n,t,e,i,o,r=null){var c=n,d=new Map,l=(t&pa)!==0;if(l){var u=n;c=Ze?Tt(ya(u)):u.appendChild(At())}Ze&&Sa();var h=null,I=Qe(()=>{var g=e();return fa(g)?g:g==null?[]:Gt(g)}),w,f=!0;function b(){s.fallback=h,Va(s,w,c,t,i),h!==null&&(w.length===0?(h.f&st)===0?ma(h):(h.f^=st,It(h,null,c)):ba(h,()=>{h=null}))}var B=Ia(()=>{w=a(I);var g=w.length;let P=!1;if(Ze){var E=Ra(c)===za;E!==(g===0)&&(c=ea(),Tt(c),Ut(!1),P=!0)}for(var M=new Set,H=Pa,R=Ma(),x=0;x<g;x+=1){Ze&&Bt.nodeType===Ba&&Bt.data===Ea&&(c=Bt,P=!0,Ut(!1));var T=w[x],j=i(T,x),N=f?null:d.get(j);N?(N.v&&ta(N.v,T),N.i&&ta(N.i,x),R&&H.skipped_effects.delete(N.e)):(N=Za(d,f?c:oa??=At(),T,j,x,o,t,e),f||(N.e.f|=st),d.set(j,N)),M.add(j)}if(g===0&&r&&!h&&(f?h=Ht(()=>r(c)):(h=Ht(()=>r(oa??=At())),h.f|=st)),Ze&&g>0&&Tt(ea()),!f)if(R){for(const[K,he]of d)M.has(K)||H.skipped_effects.add(he.e);H.oncommit(b),H.ondiscard(()=>{})}else b();P&&Ut(!0),a(I)}),s={effect:B,items:d,outrogroups:null,fallback:h};f=!1,Ze&&(c=Bt)}function yt(n){for(;n!==null&&(n.f&La)===0;)n=n.next;return n}function Va(n,t,e,i,o){var r=(i&qa)!==0,c=t.length,d=n.items,l=yt(n.effect.first),u,h=null,I,w=[],f=[],b,B,s,g;if(r)for(g=0;g<c;g+=1)b=t[g],B=o(b,g),s=d.get(B).e,(s.f&st)===0&&(s.nodes?.a?.measure(),(I??=new Set).add(s));for(g=0;g<c;g+=1){if(b=t[g],B=o(b,g),s=d.get(B).e,n.outrogroups!==null)for(const N of n.outrogroups)N.pending.delete(s),N.done.delete(s);if((s.f&st)!==0)if(s.f^=st,s===l)It(s,null,e);else{var P=h?h.next:l;s===n.effect.last&&(n.effect.last=s.prev),s.prev&&(s.prev.next=s.next),s.next&&(s.next.prev=s.prev),vt(n,h,s),vt(n,s,P),It(s,P,e),h=s,w=[],f=[],l=yt(h.next);continue}if((s.f&Dt)!==0&&(ma(s),r&&(s.nodes?.a?.unfix(),(I??=new Set).delete(s))),s!==l){if(u!==void 0&&u.has(s)){if(w.length<f.length){var E=f[0],M;h=E.prev;var H=w[0],R=w[w.length-1];for(M=0;M<w.length;M+=1)It(w[M],E,e);for(M=0;M<f.length;M+=1)u.delete(f[M]);vt(n,H.prev,R.next),vt(n,h,H),vt(n,R,E),l=E,h=R,g-=1,w=[],f=[]}else u.delete(s),It(s,l,e),vt(n,s.prev,s.next),vt(n,s,h===null?n.effect.first:h.next),vt(n,h,s),h=s;continue}for(w=[],f=[];l!==null&&l!==s;)(u??=new Set).add(l),f.push(l),l=yt(l.next);if(l===null)continue}(s.f&st)===0&&w.push(s),h=s,l=yt(s.next)}if(n.outrogroups!==null){for(const N of n.outrogroups)N.pending.size===0&&(Ft(Gt(N.done)),n.outrogroups?.delete(N));n.outrogroups.size===0&&(n.outrogroups=null)}if(l!==null||u!==void 0){var x=[];if(u!==void 0)for(s of u)(s.f&Dt)===0&&x.push(s);for(;l!==null;)(l.f&Dt)===0&&l!==n.fallback&&x.push(l),l=yt(l.next);var T=x.length;if(T>0){var j=(i&pa)!==0&&c===0?e:null;if(r){for(g=0;g<T;g+=1)x[g].nodes?.a?.measure();for(g=0;g<T;g+=1)x[g].nodes?.a?.fix()}Ja(n,x,j)}}r&&wa(()=>{if(I!==void 0)for(s of I)s.nodes?.a?.apply()})}function Za(n,t,e,i,o,r,c,d){var l=(c&Aa)!==0?(c&Ua)===0?W(e,!1,!1):aa(e):null,u=(c&Ta)!==0?aa(o):null;return{v:l,i:u,e:Ht(()=>(r(t,l??e,u??o,d),()=>{n.delete(i)}))}}function It(n,t,e){if(n.nodes)for(var i=n.nodes.start,o=n.nodes.end,r=t&&(t.f&st)===0?t.nodes.start:e;i!==null;){var c=Da(i);if(r.before(i),i===o)return;i=c}}function vt(n,t,e){t===null?n.effect.first=e:t.next=e,e===null?n.effect.last=t:e.prev=t}const ra=[...` 	
\r\fÂ \v\uFEFF`];function Qa(n,t,e){var i=n==null?"":""+n;if(e){for(var o in e)if(e[o])i=i?i+" "+o:o;else if(i.length)for(var r=o.length,c=0;(c=i.indexOf(o,c))>=0;){var d=c+r;(c===0||ra.includes(i[c-1]))&&(d===i.length||ra.includes(i[d]))?i=(c===0?"":i.substring(0,c))+i.substring(d+1):c=d}}return i===""?null:i}function Ka(n,t){return n==null?null:String(n)}function Me(n,t,e,i,o,r){var c=n.__className;if(Ze||c!==e||c===void 0){var d=Qa(e,i,r);(!Ze||d!==n.getAttribute("class"))&&(d==null?n.removeAttribute("class"):n.className=d),n.__className=e}else if(r&&o!==r)for(var l in r){var u=!!r[l];(o==null||u!==!!o[l])&&n.classList.toggle(l,u)}return r}function Pe(n,t,e,i){var o=n.__style;if(Ze||o!==t){var r=Ka(t);(!Ze||r!==n.getAttribute("style"))&&(r==null?n.removeAttribute("style"):n.style.cssText=r),n.__style=t}return i}const $a=Symbol("is custom element"),en=Symbol("is html");function Pt(n){if(Ze){var t=!1,e=()=>{if(!t){if(t=!0,n.hasAttribute("value")){var i=n.value;ge(n,"value",null),n.value=i}if(n.hasAttribute("checked")){var o=n.checked;ge(n,"checked",null),n.checked=o}}};n.__on_r=e,wa(e),Ga()}}function qt(n,t){var e=Qt(n);e.value===(e.value=t??void 0)||n.value===t&&(t!==0||n.nodeName!=="PROGRESS")||(n.value=t??"")}function tn(n,t){var e=Qt(n);e.checked!==(e.checked=t??void 0)&&(n.checked=t)}function ge(n,t,e,i){var o=Qt(n);Ze&&(o[t]=n.getAttribute(t),t==="src"||t==="srcset"||t==="href"&&n.nodeName==="LINK")||o[t]!==(o[t]=e)&&(t==="loading"&&(n[Oa]=e),e==null?n.removeAttribute(t):typeof e!="string"&&an(n).includes(t)?n[t]=e:n.setAttribute(t,e))}function Qt(n){return n.__attributes??={[$a]:n.nodeName.includes("-"),[en]:n.namespaceURI===Wa}}var sa=new Map;function an(n){var t=n.getAttribute("is")||n.nodeName,e=sa.get(t);if(e)return e;sa.set(t,e=[]);for(var i,o=n,r=Element.prototype;r!==o;){i=Ya(o);for(var c in i)i[c].set&&e.push(c);o=Na(o)}return e}function Ve(n){return function(...t){var e=t[0];return e.stopPropagation(),n?.apply(this,t)}}function Ot(n,t){var e=n.$$events?.[t.type],i=fa(e)?e.slice():e==null?[]:[e];for(var o of i)o.call(this,t)}var nn=D('<header class="header svelte-hv3zzy"><img src="/logos/logo-picflam-logotype.png" alt="PicFlam" class="header-logo svelte-hv3zzy"/> <nav class="header-nav svelte-hv3zzy"><button aria-label="Crop tab"><img src="/icons/icon-crop.svg" alt="" class="nav-icon svelte-hv3zzy"/></button> <button aria-label="AI tab"><img src="/icons/icon-ai.svg" alt="" class="nav-icon svelte-hv3zzy"/></button> <button aria-label="Design tab"><img src="/icons/icon-design.svg" alt="" class="nav-icon svelte-hv3zzy"/></button></nav></header>');function on(n,t){pe(t,!1);let e=m(t,"activeTab",8,"crop"),i=m(t,"onTabChange",8);Ce();var o=nn(),r=p(S(o),2),c=S(r);let d;var l=p(c,2);let u;var h=p(l,2);let I;_(r),_(o),Q(()=>{d=Me(c,1,"nav-btn svelte-hv3zzy",null,d,{active:e()==="crop"}),u=Me(l,1,"nav-btn svelte-hv3zzy",null,u,{active:e()==="ai"}),I=Me(h,1,"nav-btn svelte-hv3zzy",null,I,{active:e()==="design"})}),k("click",c,()=>i()("crop")),k("click",l,()=>i()("ai")),k("click",h,()=>i()("design")),A(n,o),we()}function _a(n){return new Promise((t,e)=>{const i=new FileReader;i.onload=o=>t(o.target.result),i.onerror=e,i.readAsDataURL(n)})}function ct(n){return new Promise((t,e)=>{const i=new Image;i.onload=()=>t(i),i.onerror=e,i.src=n})}async function Et(n){const t=await ct(n);return{width:t.naturalWidth,height:t.naturalHeight}}function la(n,t=2048){return new Promise(async e=>{const i=await ct(n),{naturalWidth:o,naturalHeight:r}=i;if(o<=t&&r<=t){e(n);return}const c=document.createElement("canvas"),d=c.getContext("2d");let l,u;o>r?(l=t,u=r/o*t):(u=t,l=o/r*t),c.width=l,c.height=u,d.drawImage(i,0,0,l,u),e(c.toDataURL("image/jpeg",.92))})}async function rn(){try{const n=await navigator.clipboard.read();for(const t of n)for(const e of t.types)if(e.startsWith("image/")){const i=await t.getType(e);return await _a(i)}return null}catch(n){return console.error("Failed to paste from clipboard:",n),null}}async function Wt(n){try{const e=await(await fetch(n)).blob();return await navigator.clipboard.write([new ClipboardItem({[e.type]:e})]),!0}catch(t){return console.error("Failed to copy to clipboard:",t),!1}}function Nt(n,t="picflam-export.png"){const e=document.createElement("a");e.href=n,e.download=t,document.body.appendChild(e),e.click(),document.body.removeChild(e)}async function xa(n,t,e,i){const o=await ct(n),r=document.createElement("canvas"),c=r.getContext("2d"),d=t.x/100*e,l=t.y/100*i,u=t.width/100*e,h=t.height/100*i;return r.width=u,r.height=h,c.drawImage(o,d,l,u,h,0,0,u,h),r.toDataURL("image/png")}async function sn(n,t){const e=await ct(n),i=document.createElement("canvas"),o=i.getContext("2d");return i.width=e.naturalHeight,i.height=e.naturalWidth,o.translate(i.width/2,i.height/2),o.rotate(t*Math.PI/180),o.drawImage(e,-e.naturalWidth/2,-e.naturalHeight/2),i.toDataURL("image/png")}async function ln(n,t){const e=await ct(n),i=document.createElement("canvas"),o=i.getContext("2d");return i.width=e.naturalWidth,i.height=e.naturalHeight,o.translate(i.width,0),o.scale(-1,1),o.drawImage(e,0,0),i.toDataURL("image/png")}async function cn(n,t,e){const i=await ct(n),o=document.createElement("canvas"),r=o.getContext("2d");if(o.width=i.naturalWidth,o.height=i.naturalHeight,t&&t!=="none"&&(r.filter=t),r.drawImage(i,0,0),r.filter="none",e&&Array.isArray(e)&&e.length>0)if(e.some(d=>d.invert)){const l=.5+e.reduce((s,g)=>s+(g.strength||50),0)/e.length/100*9.5,u=document.createElement("canvas");u.width=o.width,u.height=o.height;const h=u.getContext("2d");h.filter=`blur(${l}px)`,t&&t!=="none"&&(h.filter=`blur(${l}px) ${t}`),h.drawImage(i,0,0);const I=document.createElement("canvas");I.width=o.width,I.height=o.height;const w=I.getContext("2d");w.fillStyle="white",w.fillRect(0,0,I.width,I.height);for(const s of e){if(!s.invert)continue;const g=(s.soften||50)/100,P=w.createRadialGradient(s.x,s.y,0,s.x,s.y,s.radius);P.addColorStop(0,"rgba(0,0,0,1)"),P.addColorStop(.5+g*.3,"rgba(0,0,0,0.5)"),P.addColorStop(1,"rgba(0,0,0,0)"),w.fillStyle=P,w.beginPath(),w.arc(s.x,s.y,s.radius,0,Math.PI*2),w.fill()}const f=r.getImageData(0,0,o.width,o.height),b=h.getImageData(0,0,o.width,o.height),B=w.getImageData(0,0,o.width,o.height);for(let s=0;s<f.data.length;s+=4){const g=B.data[s]/255;f.data[s]=f.data[s]*g+b.data[s]*(1-g),f.data[s+1]=f.data[s+1]*g+b.data[s+1]*(1-g),f.data[s+2]=f.data[s+2]*g+b.data[s+2]*(1-g)}r.putImageData(f,0,0)}else for(const d of e){const l=d.strength||50,u=(d.soften||50)/100,h=.5+l/100*9.5,I=document.createElement("canvas");I.width=o.width,I.height=o.height;const w=I.getContext("2d");w.filter=`blur(${h}px)`,t&&t!=="none"&&(w.filter=`blur(${h}px) ${t}`),w.drawImage(i,0,0);const f=document.createElement("canvas");f.width=o.width,f.height=o.height;const b=f.getContext("2d"),B=b.createRadialGradient(d.x,d.y,0,d.x,d.y,d.radius);B.addColorStop(0,"rgba(255,255,255,1)"),B.addColorStop(.5+u*.3,"rgba(255,255,255,0.5)"),B.addColorStop(1,"rgba(255,255,255,0)"),b.fillStyle=B,b.beginPath(),b.arc(d.x,d.y,d.radius,0,Math.PI*2),b.fill();const s=r.getImageData(0,0,o.width,o.height),g=w.getImageData(0,0,o.width,o.height),P=b.getImageData(0,0,o.width,o.height);for(let E=0;E<s.data.length;E+=4){const M=P.data[E]/255;s.data[E]=s.data[E]*(1-M)+g.data[E]*M,s.data[E+1]=s.data[E+1]*(1-M)+g.data[E+1]*M,s.data[E+2]=s.data[E+2]*(1-M)+g.data[E+2]*M}r.putImageData(s,0,0)}return o.toDataURL("image/png")}var dn=D('<div role="button" tabindex="0"><p class="import-title svelte-f1bndr"> </p> <img src="/icons/icon-upload.svg" alt="" class="import-icon svelte-f1bndr"/> <p class="import-hint svelte-f1bndr"> </p> <button class="btn-paste svelte-f1bndr">Paste</button> <input type="file" accept="image/*" class="sr-only"/></div>');function ka(n,t){pe(t,!1);let e=m(t,"title",8,"Import an image"),i=m(t,"hint",8,"Import, drag or paste an image"),o=m(t,"onImageImport",8,R=>{}),r=W(!1),c=W();async function d(R){if(!R||!R.type.startsWith("image/"))return;const x=await _a(R),T=await la(x,2048);o()(T)}function l(R){const x=R.target.files?.[0];x&&d(x)}function u(R){R.preventDefault(),y(r,!1);const x=R.dataTransfer?.files?.[0];x&&d(x)}function h(R){R.preventDefault(),y(r,!0)}function I(){y(r,!1)}async function w(){const R=await rn();if(R){const x=await la(R,2048);o()(x)}}function f(){a(c)?.click()}Ce();var b=dn();let B;var s=S(b),g=S(s,!0);_(s);var P=p(s,4),E=S(P,!0);_(P);var M=p(P,2),H=p(M,2);wt(H,R=>y(c,R),()=>a(c)),_(b),Q(()=>{B=Me(b,1,"import-area svelte-f1bndr",null,B,{dragging:a(r)}),ke(g,e()),ke(E,i())}),k("click",M,Ve(w)),k("change",H,l),k("click",b,f),k("drop",b,u),k("dragover",b,h),k("dragleave",b,I),k("keypress",b,R=>R.key==="Enter"&&f()),A(n,b),we()}var un=D('<div class="action-bar svelte-96zw02"><div class="action-group svelte-96zw02"><button class="action-btn svelte-96zw02" aria-label="Undo"><img src="/icons/icon-undo.svg" alt="" class="action-icon svelte-96zw02"/></button> <button class="action-btn svelte-96zw02" aria-label="Redo"><img src="/icons/icon-redo.svg" alt="" class="action-icon svelte-96zw02"/></button></div> <div class="action-group svelte-96zw02"><button class="action-btn svelte-96zw02" aria-label="Start again"><img src="/icons/icon-startagain.svg" alt="" class="action-icon svelte-96zw02"/></button> <button class="action-btn svelte-96zw02" aria-label="Copy to clipboard"><img src="/icons/icon-copy.svg" alt="" class="action-icon svelte-96zw02"/></button> <button class="action-btn svelte-96zw02" aria-label="Export"><img src="/icons/icon-export.svg" alt="" class="action-icon svelte-96zw02"/></button></div></div>');function Kt(n,t){let e=m(t,"canUndo",8,!1),i=m(t,"canRedo",8,!1),o=m(t,"onUndo",8,()=>{}),r=m(t,"onRedo",8,()=>{}),c=m(t,"onStartAgain",8,()=>{}),d=m(t,"onCopy",8,()=>{}),l=m(t,"onExport",8,()=>{});var u=un(),h=S(u),I=S(h),w=p(I,2);_(h);var f=p(h,2),b=S(f),B=p(b,2),s=p(B,2);_(f),_(u),Q(()=>{I.disabled=!e(),w.disabled=!i()}),k("click",I,function(...g){o()?.apply(this,g)}),k("click",w,function(...g){r()?.apply(this,g)}),k("click",b,function(...g){c()?.apply(this,g)}),k("click",B,function(...g){d()?.apply(this,g)}),k("click",s,function(...g){l()?.apply(this,g)}),A(n,u)}var vn=D("<button> </button>"),gn=D('<div class="sub-menu-tabs svelte-tv6tw8"></div>');function $t(n,t){pe(t,!1);let e=m(t,"tabs",24,()=>[]),i=m(t,"activeTab",8,""),o=m(t,"onTabChange",8,c=>{});Ce();var r=gn();xt(r,5,e,_t,(c,d)=>{var l=vn();let u;var h=S(l,!0);_(l),Q(()=>{u=Me(l,1,"sub-menu-tab svelte-tv6tw8",null,u,{active:i()===a(d).id}),ke(h,(a(d),U(()=>a(d).label)))}),k("click",l,()=>o()(a(d).id)),A(c,l)}),_(r),A(n,r),we()}var hn=D('<div class="modal-overlay svelte-qik81a" role="dialog" aria-modal="true" tabindex="-1"><div class="modal svelte-qik81a" role="document"><p class="modal-message svelte-qik81a"> </p> <div class="modal-actions svelte-qik81a"><button class="btn-text svelte-qik81a"> </button> <button class="btn-text btn-confirm svelte-qik81a"> </button></div></div></div>');function Yt(n,t){pe(t,!1);let e=m(t,"message",8,""),i=m(t,"confirmText",8,"Yes"),o=m(t,"cancelText",8,"Cancel"),r=m(t,"onConfirm",8,()=>{}),c=m(t,"onCancel",8,()=>{});Ce();var d=hn(),l=S(d),u=S(l),h=S(u,!0);_(u);var I=p(u,2),w=S(I),f=S(w,!0);_(w);var b=p(w,2),B=S(b,!0);_(b),_(I),_(l),_(d),Q(()=>{ke(h,e()),ke(f,o()),ke(B,i())}),k("click",w,function(...s){c()?.apply(this,s)}),k("click",b,function(...s){r()?.apply(this,s)}),k("click",l,Ve(function(s){Ot.call(this,t,s)})),k("keydown",l,Ve(function(s){Ot.call(this,t,s)})),k("click",d,function(...s){c()?.apply(this,s)}),k("keydown",d,s=>s.key==="Escape"&&c()()),A(n,d),we()}var fn=D('<canvas class="blur-canvas svelte-pjowa5"></canvas>'),mn=D('<div class="blur-brush-indicator svelte-pjowa5"></div>'),bn=D('<div class="blur-brush-preview svelte-pjowa5"></div>'),pn=D('<div class="crop-overlay svelte-pjowa5"><div class="overlay-top svelte-pjowa5"></div> <div class="overlay-bottom svelte-pjowa5"></div> <div class="overlay-left svelte-pjowa5"></div> <div class="overlay-right svelte-pjowa5"></div> <div class="crop-box svelte-pjowa5" role="button" aria-label="Drag to move crop area" tabindex="0"><div class="crop-border svelte-pjowa5"></div> <div class="corner-handle top-left svelte-pjowa5" role="button" aria-label="Resize top-left corner" tabindex="0"></div> <div class="corner-handle top-right svelte-pjowa5" role="button" aria-label="Resize top-right corner" tabindex="0"></div> <div class="corner-handle bottom-left svelte-pjowa5" role="button" aria-label="Resize bottom-left corner" tabindex="0"></div> <div class="corner-handle bottom-right svelte-pjowa5" role="button" aria-label="Resize bottom-right corner" tabindex="0"></div></div></div>'),wn=D('<div class="crop-canvas svelte-pjowa5" role="application" aria-label="Image crop canvas"><div class="image-wrapper svelte-pjowa5"><img alt="Crop preview" class="canvas-image svelte-pjowa5" draggable="false"/> <!></div> <!> <!> <!></div>');function _n(n,t){pe(t,!1);const e=W(),i=W(),o=W(),r=W();let c=m(t,"imageSrc",8,""),d=m(t,"cropBox",24,()=>({x:10,y:10,width:80,height:80})),l=m(t,"isCropping",8,!1),u=m(t,"scale",8,1),h=m(t,"offsetX",8,0),I=m(t,"offsetY",8,0),w=m(t,"imageWidth",8,0),f=m(t,"imageHeight",8,0),b=m(t,"editFilters",8,""),B=m(t,"blurEnabled",8,!1),s=m(t,"blurBrushSize",8,50),g=m(t,"blurStrength",8,50),P=m(t,"blurSoften",8,50),E=m(t,"blurInvert",8,!1),M=m(t,"blurMask",24,()=>[]),H=m(t,"showBrushPreview",8,!1);const R=Xa();let x=W(),T=W(),j=W({width:0,height:0}),N=!1,K=null,he=0,re=0,te=null,fe=0,X=1,ae=!1,de=W({x:0,y:0,visible:!1}),ye=W(null),_e=W("");async function me(){y(_e,c());const C=new Image;C.crossOrigin="anonymous",C.onload=()=>{y(ye,C)},C.src=c()}function Ke(C){const Y=document.createElement("canvas");Y.width=a(ye).naturalWidth,Y.height=a(ye).naturalHeight;const $=Y.getContext("2d");return $.filter=`blur(${C}px)`,$.drawImage(a(ye),0,0),Y}function Oe(){if(!a(T)||!a(ye)||!M())return;const C=a(T).getContext("2d"),Y=a(T).width,$=a(T).height;if(C.clearRect(0,0,Y,$),M().length===0)return;const q=Y/w(),ie=$/f();if(M().some(J=>J.invert)){const J=M().reduce((F,G)=>F+(G.strength||50),0)/M().length;M().reduce((F,G)=>F+(G.soften||50),0)/M().length;const v=.5+J/100*9.5,z=Ke(v);C.drawImage(z,0,0,Y,$),C.globalCompositeOperation="destination-out";for(const F of M()){if(!F.invert)continue;const G=F.x*q,O=F.y*ie,oe=F.radius*Math.min(q,ie),se=(F.soften||50)/100,ve=Math.max(0,.3-se*.3),le=.3+(1-se)*.4,ce=C.createRadialGradient(G,O,0,G,O,oe);ce.addColorStop(ve,"rgba(0,0,0,1)"),ce.addColorStop(le,`rgba(0,0,0,${.5+se*.3})`),ce.addColorStop(1,"rgba(0,0,0,0)"),C.fillStyle=ce,C.beginPath(),C.arc(G,O,oe,0,Math.PI*2),C.fill()}C.globalCompositeOperation="source-over"}else for(const J of M()){const v=J.x*q,z=J.y*ie,F=J.radius*Math.min(q,ie),G=J.strength||50,O=(J.soften||50)/100,oe=.5+G/100*9.5,se=Ke(oe);C.save();const ve=Math.max(0,.2-O*.2),le=.2+(1-O)*.5,ce=C.createRadialGradient(v,z,0,v,z,F);ce.addColorStop(ve,"rgba(255,255,255,1)"),ce.addColorStop(le,`rgba(255,255,255,${.4+O*.3})`),ce.addColorStop(1,"rgba(255,255,255,0)"),C.beginPath(),C.arc(v,z,F,0,Math.PI*2),C.clip(),C.drawImage(se,0,0,Y,$),C.restore()}}Vt(()=>(Ye(),window.addEventListener("resize",Ye),()=>window.removeEventListener("resize",Ye)));function Ye(){if(a(x)){const C=a(x).getBoundingClientRect();y(j,{width:C.width,height:C.height})}}function Be(C){return C.touches&&C.touches.length>0?{x:C.touches[0].clientX,y:C.touches[0].clientY}:{x:C.clientX,y:C.clientY}}function Te(C){if(C.touches&&C.touches.length>=2){const Y=C.touches[0].clientX-C.touches[1].clientX,$=C.touches[0].clientY-C.touches[1].clientY;return Math.sqrt(Y*Y+$*$)}return 0}function be(C,Y="move"){if(!l())return;if(C.touches&&C.touches.length>=2){fe=Te(C),X=u(),K="pinch";return}C.preventDefault(),N=!0,K=Y;const $=Be(C);he=$.x,re=$.y,te={...d()}}function je(C){if(!l())return;if(K==="pinch"&&C.touches&&C.touches.length>=2){const ue=Te(C),J=X*(ue/fe);R("scaleChange",{scale:Math.max(.5,Math.min(3,J))});return}if(!N||!te)return;C.preventDefault();const Y=Be(C),$=(Y.x-he)/a(e)*100,q=(Y.y-re)/a(i)*100;let ie={...te};if(K==="move")ie.x=Math.max(0,Math.min(100-te.width,te.x+$)),ie.y=Math.max(0,Math.min(100-te.height,te.y+q));else if(K.includes("corner")){if(K.includes("left")){const J=te.x+$,v=te.width-$;v>=10&&J>=0&&(ie.x=J,ie.width=v)}if(K.includes("right")){const J=te.width+$;J>=10&&te.x+J<=100&&(ie.width=J)}if(K.includes("top")){const J=te.y+q,v=te.height-q;v>=10&&J>=0&&(ie.y=J,ie.height=v)}if(K.includes("bottom")){const J=te.height+q;J>=10&&te.y+J<=100&&(ie.height=J)}}R("cropChange",{cropBox:ie})}function Xe(){N=!1,K=null,te=null,ae&&(ae=!1)}function Ae(C){B()&&(C.preventDefault(),ae=!0,Fe(C))}function Se(C){if(!B())return;const Y=a(x).getBoundingClientRect(),$=Be(C);y(de,{x:$.x-Y.left,y:$.y-Y.top,visible:!0}),ae&&Fe(C)}function $e(){y(de,{...a(de),visible:!1}),ae&&(ae=!1)}function Fe(C){const Y=a(x).getBoundingClientRect(),$=Be(C),q=($.x-Y.left)/a(e)*w(),ie=($.y-Y.top)/a(i)*f(),ue=s()/100*Math.min(w(),f())*.15;R("blurPaint",{point:{x:q,y:ie,radius:ue,strength:g(),soften:P(),invert:E()}})}xe(()=>a(j),()=>{y(e,a(j).width)}),xe(()=>(Re(f()),Re(w()),a(e)),()=>{y(i,f()&&w()?a(e)*f()/w():0)}),xe(()=>(Re(s()),a(e),a(i)),()=>{y(o,s()/100*Math.min(a(e),a(i))*.3)}),xe(()=>(Re(c()),a(T),a(_e)),()=>{c()&&a(T)&&c()!==a(_e)&&me()}),xe(()=>(Re(M()),a(T),a(ye)),()=>{M()&&Array.isArray(M())&&M().length>0&&a(T)&&a(ye)&&Oe()}),xe(()=>(Re(d()),a(e),a(i)),()=>{y(r,{x:d().x/100*a(e),y:d().y/100*a(i),width:d().width/100*a(e),height:d().height/100*a(i)})}),bt(),Ce();var ne=wn(),Ie=S(ne),De=S(Ie),ft=p(De,2);{var dt=C=>{var Y=fn();wt(Y,$=>y(T,$),()=>a(T)),Q(()=>{ge(Y,"width",a(e)),ge(Y,"height",a(i)),Pe(Y,`filter: ${b()??""};`)}),A(C,Y)};Z(ft,C=>{B()&&a(e)>0&&a(i)>0&&C(dt)})}_(Ie);var it=p(Ie,2);{var ot=C=>{var Y=mn();Q(()=>Pe(Y,`
				left: ${a(de),U(()=>a(de).x)??""}px;
				top: ${a(de),U(()=>a(de).y)??""}px;
				width: ${a(o)??""}px;
				height: ${a(o)??""}px;
			`)),A(C,Y)};Z(it,C=>{Re(B()),a(de),U(()=>B()&&a(de).visible)&&C(ot)})}var We=p(it,2);{var rt=C=>{var Y=bn();Q(()=>Pe(Y,`
				left: ${a(e)/2}px;
				top: ${a(i)/2}px;
				width: ${a(o)??""}px;
				height: ${a(o)??""}px;
			`)),A(C,Y)};Z(We,C=>{H()&&a(e)>0&&a(i)>0&&C(rt)})}var et=p(We,2);{var Ne=C=>{var Y=pn(),$=S(Y),q=p($,2),ie=p(q,2),ue=p(ie,2),J=p(ue,2),v=p(S(J),2),z=p(v,2),F=p(z,2),G=p(F,2);_(J),_(Y),Q(()=>{Pe($,`height: ${a(r),U(()=>a(r).y)??""}px;`),Pe(q,`top: ${a(r),U(()=>a(r).y+a(r).height)??""}px; height: ${a(i),a(r),U(()=>a(i)-a(r).y-a(r).height)??""}px;`),Pe(ie,`top: ${a(r),U(()=>a(r).y)??""}px; height: ${a(r),U(()=>a(r).height)??""}px; width: ${a(r),U(()=>a(r).x)??""}px;`),Pe(ue,`top: ${a(r),U(()=>a(r).y)??""}px; height: ${a(r),U(()=>a(r).height)??""}px; left: ${a(r),U(()=>a(r).x+a(r).width)??""}px; width: ${a(e),a(r),U(()=>a(e)-a(r).x-a(r).width)??""}px;`),Pe(J,`left: ${a(r),U(()=>a(r).x)??""}px; top: ${a(r),U(()=>a(r).y)??""}px; width: ${a(r),U(()=>a(r).width)??""}px; height: ${a(r),U(()=>a(r).height)??""}px;`)}),k("mousedown",v,Ve(O=>be(O,"corner-top-left"))),k("touchstart",v,Ve(O=>be(O,"corner-top-left"))),k("mousedown",z,Ve(O=>be(O,"corner-top-right"))),k("touchstart",z,Ve(O=>be(O,"corner-top-right"))),k("mousedown",F,Ve(O=>be(O,"corner-bottom-left"))),k("touchstart",F,Ve(O=>be(O,"corner-bottom-left"))),k("mousedown",G,Ve(O=>be(O,"corner-bottom-right"))),k("touchstart",G,Ve(O=>be(O,"corner-bottom-right"))),k("mousedown",J,O=>be(O,"move")),k("touchstart",J,O=>be(O,"move")),A(C,Y)};Z(et,C=>{l()&&a(i)>0&&C(Ne)})}_(ne),wt(ne,C=>y(x,C),()=>a(x)),Q(()=>{Pe(Ie,`transform: scale(${u()??""}) translate(${h()??""}px, ${I()??""}px);`),ge(De,"src",c()),Pe(De,`filter: ${b()??""};`)}),k("mousemove",ne,function(...C){(B()?Se:je)?.apply(this,C)}),k("mouseup",ne,Xe),k("mouseleave",ne,function(...C){(B()?$e:Xe)?.apply(this,C)}),k("touchmove",ne,function(...C){(B()?Se:je)?.apply(this,C)}),k("touchend",ne,Xe),k("mousedown",ne,function(...C){(B()?Ae:null)?.apply(this,C)}),k("touchstart",ne,function(...C){(B()?Ae:null)?.apply(this,C)}),A(n,ne),we()}var xn=D('<img alt="" class="toggle-icon svelte-1gdqxne"/>'),kn=D('<span class="toggle-label svelte-1gdqxne"> </span>'),Cn=D("<div><button><!></button> <!></div>"),yn=D('<div class="toggle-group svelte-1gdqxne"></div>');function Sn(n,t){pe(t,!1);let e=m(t,"options",24,()=>[]),i=m(t,"value",8,""),o=m(t,"onChange",8,d=>{}),r=m(t,"showLabels",8,!0);Ce();var c=yn();xt(c,5,e,_t,(d,l)=>{var u=Cn();let h;var I=S(u);let w;var f=S(I);{var b=g=>{var P=xn();Q(()=>ge(P,"src",`/icons/${a(l),U(()=>a(l).icon)??""}.svg`)),A(g,P)};Z(f,g=>{a(l),U(()=>a(l).icon)&&g(b)})}_(I);var B=p(I,2);{var s=g=>{var P=kn(),E=S(P,!0);_(P),Q(()=>ke(E,(a(l),U(()=>a(l).label)))),A(g,P)};Z(B,g=>{Re(r()),a(l),U(()=>r()&&a(l).label)&&g(s)})}_(u),Q(()=>{h=Me(u,1,"toggle-item svelte-1gdqxne",null,h,{active:i()===a(l).id}),w=Me(I,1,"toggle-btn svelte-1gdqxne",null,w,{active:i()===a(l).id}),ge(I,"aria-label",(a(l),U(()=>a(l).label)))}),k("click",I,()=>o()(a(l).id)),A(d,u)}),_(c),A(n,c),we()}var In=D('<label class="input-label svelte-1r47u3b"> <input class="input svelte-1r47u3b"/></label>'),Rn=D('<input class="input svelte-1r47u3b"/>'),zn=D('<div class="input-field svelte-1r47u3b"><!></div>');function ca(n,t){pe(t,!1);let e=m(t,"label",8,""),i=m(t,"value",12,""),o=m(t,"type",8,"text"),r=m(t,"placeholder",8,""),c=m(t,"disabled",8,!1),d=m(t,"onChange",8,f=>{});function l(f){i(f.target.value),d()(i())}Ce();var u=zn(),h=S(u);{var I=f=>{var b=In(),B=S(b),s=p(B);Pt(s),_(b),Q(()=>{ke(B,`${e()??""} `),ge(s,"type",o()),qt(s,i()),ge(s,"placeholder",r()),s.disabled=c()}),k("input",s,l),A(f,b)},w=f=>{var b=Rn();Pt(b),Q(()=>{ge(b,"type",o()),qt(b,i()),ge(b,"placeholder",r()),b.disabled=c()}),k("input",b,l),A(f,b)};Z(h,f=>{e()?f(I):f(w,!1)})}_(u),A(n,u),we()}var Bn=D('<span class="slider-value svelte-jchife"> </span>'),En=D('<div class="slider-header svelte-jchife"><span class="slider-label svelte-jchife"> </span> <!></div>'),Pn=D('<div class="slider-container svelte-jchife"><!> <input type="range" class="slider svelte-jchife"/></div>');function ht(n,t){pe(t,!1);let e=m(t,"label",8,""),i=m(t,"min",8,0),o=m(t,"max",8,100),r=m(t,"value",8,50),c=m(t,"step",8,1),d=m(t,"showValue",8,!1),l=m(t,"onChange",8,P=>{}),u=m(t,"onInteractionStart",8,()=>{}),h=m(t,"onInteractionEnd",8,()=>{});function I(P){const E=Number(P.target.value);l()(E)}function w(){u()()}function f(){h()()}Ce();var b=Pn(),B=S(b);{var s=P=>{var E=En(),M=S(E),H=S(M,!0);_(M);var R=p(M,2);{var x=T=>{var j=Bn(),N=S(j,!0);_(j),Q(()=>ke(N,r())),A(T,j)};Z(R,T=>{d()&&T(x)})}_(E),Q(()=>ke(H,e())),A(P,E)};Z(B,P=>{e()&&P(s)})}var g=p(B,2);Pt(g),_(b),Q(()=>{ge(g,"min",i()),ge(g,"max",o()),ge(g,"step",c()),qt(g,r())}),k("input",g,I),k("mousedown",g,w),k("touchstart",g,w),k("mouseup",g,f),k("touchend",g,f),A(n,b),we()}var Mn=D('<div class="apply-row svelte-17iy3mz"><button class="btn-apply svelte-17iy3mz">Apply</button></div>'),Tn=D('<div class="crop-controls svelte-17iy3mz"><!> <div class="dimensions-row svelte-17iy3mz"><div class="dimension-input svelte-17iy3mz"><!></div> <button class="icon-btn svelte-17iy3mz"><img alt="" class="icon-btn-img svelte-17iy3mz"/></button> <div class="dimension-input svelte-17iy3mz"><!></div> <button class="icon-btn svelte-17iy3mz" aria-label="Flip horizontal"><img src="/icons/icon-flip-horizontal.svg" alt="" class="icon-btn-img svelte-17iy3mz"/></button> <button class="icon-btn svelte-17iy3mz" aria-label="Rotate"><img src="/icons/icon-rotate.svg" alt="" class="icon-btn-img svelte-17iy3mz"/></button></div> <!> <!></div>');function An(n,t){pe(t,!1);let e=m(t,"aspectRatio",8,"9:16"),i=m(t,"cropWidth",8,1080),o=m(t,"cropHeight",8,1920),r=m(t,"ratioLocked",8,!0),c=m(t,"scale",8,100),d=m(t,"cropPending",8,!1),l=m(t,"onRatioChange",8,X=>{}),u=m(t,"onDimensionsChange",8,({width:X,height:ae})=>{}),h=m(t,"onLockToggle",8,()=>{}),I=m(t,"onFlip",8,()=>{}),w=m(t,"onRotate",8,()=>{}),f=m(t,"onScaleChange",8,X=>{}),b=m(t,"onApply",8,()=>{});const B=[{id:"9:16",label:"9:16",icon:"icon-vertical"},{id:"1:1",label:"1:1",icon:"icon-square"},{id:"16:9",label:"16:9",icon:"icon-horizontal"},{id:"custom",label:"Custom",icon:"icon-custom"}];function s(X){const ae=parseInt(X)||0;u()({width:ae,height:o()})}function g(X){const ae=parseInt(X)||0;u()({width:i(),height:ae})}Ce();var P=Tn(),E=S(P);Sn(E,{get options(){return B},get value(){return e()},get onChange(){return l()},showLabels:!0});var M=p(E,2),H=S(M),R=S(H);{let X=Qe(()=>(Re(i()),U(()=>i().toString())));ca(R,{label:"Width",type:"number",get value(){return a(X)},onChange:s})}_(H);var x=p(H,2),T=S(x);_(x);var j=p(x,2),N=S(j);{let X=Qe(()=>(Re(o()),U(()=>o().toString())));ca(N,{label:"Height",type:"number",get value(){return a(X)},onChange:g})}_(j);var K=p(j,2),he=p(K,2);_(M);var re=p(M,2);ht(re,{label:"Scale",min:50,max:200,get value(){return c()},step:1,showValue:!0,get onChange(){return f()}});var te=p(re,2);{var fe=X=>{var ae=Mn(),de=S(ae);_(ae),k("click",de,function(...ye){b()?.apply(this,ye)}),A(X,ae)};Z(te,X=>{d()&&X(fe)})}_(P),Q(()=>{ge(x,"aria-label",r()?"Unlock aspect ratio":"Lock aspect ratio"),ge(T,"src",`/icons/${r()?"icon-lock":"icon-unlock"}.svg`)}),k("click",x,function(...X){h()?.apply(this,X)}),k("click",K,function(...X){I()?.apply(this,X)}),k("click",he,function(...X){w()?.apply(this,X)}),A(n,P),we()}var Un=D("<button> </button>"),Dn=D("<button> </button>"),Ln=D('<div class="blur-controls svelte-1e1k0ax"><div class="blur-control-row svelte-1e1k0ax"><!> <label class="invert-checkbox svelte-1e1k0ax"><input type="checkbox" class="svelte-1e1k0ax"/> <span class="checkbox-label svelte-1e1k0ax">Invert</span></label></div> <div class="slider-row svelte-1e1k0ax"><div class="slider-track svelte-1e1k0ax"><!></div> <button class="reset-btn svelte-1e1k0ax" aria-label="Reset"><img src="/icons/icon-reset.svg" alt="" class="reset-icon svelte-1e1k0ax"/></button></div> <div class="zoom-row svelte-1e1k0ax"><span class="zoom-label svelte-1e1k0ax">Zoom in</span> <div class="zoom-slider-row svelte-1e1k0ax"><div class="slider-track svelte-1e1k0ax"><!></div> <button class="reset-btn svelte-1e1k0ax" aria-label="Reset zoom"><img src="/icons/icon-reset.svg" alt="" class="reset-icon svelte-1e1k0ax"/></button></div></div> <div class="nudge-row svelte-1e1k0ax"><button class="nudge-btn svelte-1e1k0ax" aria-label="Nudge up"><img src="/icons/icon-nudge-up.svg" alt="" class="svelte-1e1k0ax"/></button> <button class="nudge-btn svelte-1e1k0ax" aria-label="Nudge down"><img src="/icons/icon-nudge-down.svg" alt="" class="svelte-1e1k0ax"/></button> <button class="nudge-btn svelte-1e1k0ax" aria-label="Nudge left"><img src="/icons/icon-nudge-left.svg" alt="" class="svelte-1e1k0ax"/></button> <button class="nudge-btn svelte-1e1k0ax" aria-label="Nudge right"><img src="/icons/icon-nudge-right.svg" alt="" class="svelte-1e1k0ax"/></button></div></div>'),Hn=D('<div class="edit-controls svelte-1e1k0ax"><div class="enhancement-row svelte-1e1k0ax"></div> <div class="slider-row svelte-1e1k0ax"><div class="slider-track svelte-1e1k0ax"><!></div> <button class="reset-btn svelte-1e1k0ax" aria-label="Reset"><img src="/icons/icon-reset.svg" alt="" class="reset-icon svelte-1e1k0ax"/></button></div> <div class="blur-section svelte-1e1k0ax"><div class="blur-header svelte-1e1k0ax"><button class="chevron-btn svelte-1e1k0ax"><img alt=""/></button> <span class="blur-label svelte-1e1k0ax">Blur</span> <button><span class="toggle-thumb svelte-1e1k0ax"></span></button></div> <!></div></div>');function Fn(n,t){pe(t,!1);const e=W(),i=W(),o=W(),r=W(),c=W(),d=W();let l=m(t,"brightness",8,0),u=m(t,"shadows",8,0),h=m(t,"contrast",8,0),I=m(t,"hdr",8,0),w=m(t,"blurBrushSize",8,50),f=m(t,"blurStrength",8,50),b=m(t,"blurSoften",8,50),B=m(t,"blurInvert",8,!1),s=m(t,"zoomLevel",8,1),g=m(t,"blurEnabled",8,!1),P=m(t,"onBrightnessChange",8,q=>{}),E=m(t,"onShadowsChange",8,q=>{}),M=m(t,"onContrastChange",8,q=>{}),H=m(t,"onHdrChange",8,q=>{}),R=m(t,"onBlurBrushSizeChange",8,q=>{}),x=m(t,"onBlurStrengthChange",8,q=>{}),T=m(t,"onBlurSoftenChange",8,q=>{}),j=m(t,"onBlurInvertChange",8,q=>{}),N=m(t,"onZoomChange",8,q=>{}),K=m(t,"onNudge",8,q=>{}),he=m(t,"onResetZoom",8,()=>{}),re=m(t,"onBlurToggle",8,q=>{}),te=m(t,"onBrushPreviewChange",8,q=>{}),fe=m(t,"onEditEnd",8,()=>{}),X=W("brightness"),ae=W(g()),de=W("brushSize");const ye=[{id:"brightness",label:"Brightness"},{id:"shadows",label:"Shadows"},{id:"contrast",label:"Contrast"},{id:"hdr",label:"HDR"}],_e=[{id:"brushSize",label:"Brush size"},{id:"strength",label:"Strength"},{id:"soften",label:"Soften edges"}];function me(q){switch(a(X)){case"brightness":P()(q);break;case"shadows":E()(q);break;case"contrast":M()(q);break;case"hdr":H()(q);break}}function Ke(){me(0)}function Oe(q){switch(a(de)){case"brushSize":R()(q);break;case"strength":x()(q);break;case"soften":T()(q);break}}function Ye(){Oe(50)}function Be(){const q=!g();re()(q),y(ae,q)}function Te(){g()&&y(ae,!a(ae))}function be(){j()(!B())}function je(q){y(X,q),y(ae,!1)}function Xe(q){y(de,q)}function Ae(){fe()()}function Se(){a(de)==="brushSize"&&te()(!0)}function $e(){te()(!1),fe()()}xe(()=>(a(X),Re(l()),Re(u()),Re(h()),Re(I())),()=>{y(e,(()=>{switch(a(X)){case"brightness":return l();case"shadows":return u();case"contrast":return h();case"hdr":return I();default:return 0}})())}),xe(()=>a(X),()=>{y(i,a(X)==="hdr"?0:-100)}),xe(()=>{},()=>{y(o,100)}),xe(()=>(a(de),Re(w()),Re(f()),Re(b())),()=>{y(r,(()=>{switch(a(de)){case"brushSize":return w();case"strength":return f();case"soften":return b();default:return 50}})())}),xe(()=>{},()=>{y(c,1)}),xe(()=>{},()=>{y(d,100)}),bt(),Ce();var Fe=Hn(),ne=S(Fe);xt(ne,5,()=>ye,_t,(q,ie)=>{var ue=Un();let J;var v=S(ue,!0);_(ue),Q(()=>{J=Me(ue,1,"enhancement-btn svelte-1e1k0ax",null,J,{active:a(X)===a(ie).id}),ke(v,(a(ie),U(()=>a(ie).label)))}),k("click",ue,()=>je(a(ie).id)),A(q,ue)}),_(ne);var Ie=p(ne,2),De=S(Ie),ft=S(De);ht(ft,{get min(){return a(i)},get max(){return a(o)},get value(){return a(e)},step:1,onChange:me,onInteractionEnd:Ae}),_(De);var dt=p(De,2);_(Ie);var it=p(Ie,2),ot=S(it),We=S(ot),rt=S(We);let et;_(We);var Ne=p(We,4);let C;_(ot);var Y=p(ot,2);{var $=q=>{var ie=Ln(),ue=S(ie),J=S(ue);xt(J,1,()=>_e,_t,(L,ee)=>{var Ee=Dn();let He;var Ct=S(Ee,!0);_(Ee),Q(()=>{He=Me(Ee,1,"blur-control-btn svelte-1e1k0ax",null,He,{active:a(de)===a(ee).id}),ke(Ct,(a(ee),U(()=>a(ee).label)))}),k("click",Ee,()=>Xe(a(ee).id)),A(L,Ee)});var v=p(J,2),z=S(v);Pt(z),Jt(2),_(v),_(ue);var F=p(ue,2),G=S(F),O=S(G);ht(O,{get min(){return a(c)},get max(){return a(d)},get value(){return a(r)},step:1,onChange:Oe,onInteractionStart:Se,onInteractionEnd:$e}),_(G);var oe=p(G,2);_(F);var se=p(F,2),ve=p(S(se),2),le=S(ve),ce=S(le);ht(ce,{min:1,max:3,step:.1,get value(){return s()},get onChange(){return N()}}),_(le);var tt=p(le,2);_(ve),_(se);var Le=p(se,2),pt=S(Le),Ge=p(pt,2),Je=p(Ge,2),mt=p(Je,2);_(Le),_(ie),Q(()=>tn(z,B())),k("change",z,be),k("click",oe,Ye),k("click",tt,function(...L){he()?.apply(this,L)}),k("click",pt,()=>K()("up")),k("click",Ge,()=>K()("down")),k("click",Je,()=>K()("left")),k("click",mt,()=>K()("right")),A(q,ie)};Z(Y,q=>{a(ae)&&g()&&q($)})}_(it),_(Fe),Q(()=>{We.disabled=!g(),ge(We,"aria-label",a(ae)?"Collapse":"Expand"),ge(rt,"src",`/icons/${a(ae)?"icon-collapse":"icon-expand"}.svg`),et=Me(rt,1,"chevron-icon svelte-1e1k0ax",null,et,{disabled:!g()}),C=Me(Ne,1,"toggle-switch svelte-1e1k0ax",null,C,{active:g()}),ge(Ne,"aria-label",g()?"Disable blur":"Enable blur")}),k("click",dt,Ke),k("click",We,Te),k("click",Ne,Be),A(n,Fe),we()}var qn=D('<button><div class="filter-preview svelte-183y0dt"></div> <span> </span></button>'),On=D('<div class="filter-grid svelte-183y0dt"></div>');function Wn(n,t){pe(t,!1);let e=m(t,"filters",24,()=>[]),i=m(t,"value",8,"original"),o=m(t,"imageUrl",8,""),r=m(t,"onChange",8,d=>{});Ce();var c=On();xt(c,5,e,_t,(d,l)=>{var u=qn();let h;var I=S(u),w=p(I,2);let f;var b=S(w,!0);_(w),_(u),Q(()=>{h=Me(u,1,"filter-card svelte-183y0dt",null,h,{active:i()===a(l).id}),Pe(I,`
					background-image: url(${o()??""});
					filter: ${a(l),U(()=>a(l).css||"none")??""};
				`),f=Me(w,1,"filter-label svelte-183y0dt",null,f,{active:i()===a(l).id}),ke(b,(a(l),U(()=>a(l).label)))}),k("click",u,()=>r()(a(l).id)),A(d,u)}),_(c),A(n,c),we()}var Nn=D('<div class="filter-controls svelte-1274k9v"><!> <div><div class="slider-track svelte-1274k9v"><!></div> <button class="reset-btn svelte-1274k9v" aria-label="Reset filter"><img src="/icons/icon-reset.svg" alt="" class="reset-icon svelte-1274k9v"/></button></div></div>');function Yn(n,t){pe(t,!1);const e=W();let i=m(t,"imageUrl",8,""),o=m(t,"activeFilter",8,"original"),r=m(t,"filterStrength",8,50),c=m(t,"onFilterChange",8,g=>{}),d=m(t,"onStrengthChange",8,g=>{}),l=m(t,"onReset",8,()=>{});const u=[{id:"original",label:"Original",css:"none"},{id:"greyscale",label:"Greyscale",css:"grayscale(100%)"},{id:"sepia",label:"Sepia",css:"sepia(100%)"},{id:"sunset",label:"Sunset",css:"sepia(30%) saturate(140%) brightness(110%) hue-rotate(-10deg)"},{id:"azure",label:"Azure",css:"saturate(120%) brightness(105%) hue-rotate(180deg)"},{id:"teal",label:"Teal",css:"saturate(130%) hue-rotate(140deg)"}];xe(()=>Re(o()),()=>{y(e,o()==="original")}),bt();var h=Nn(),I=S(h);Wn(I,{get filters(){return u},get value(){return o()},get imageUrl(){return i()},get onChange(){return c()}});var w=p(I,2);let f;var b=S(w),B=S(b);{let g=Qe(()=>a(e)?()=>{}:d());ht(B,{label:"Strength",min:0,max:100,get value(){return r()},get onChange(){return a(g)}})}_(b);var s=p(b,2);_(w),_(h),Q(()=>f=Me(w,1,"slider-row svelte-1274k9v",null,f,{disabled:a(e)})),k("click",s,function(...g){l()?.apply(this,g)}),A(n,h),we()}const da=[{id:"original",label:"Original",css:"none"},{id:"greyscale",label:"Greyscale",css:"grayscale(100%)"},{id:"sepia",label:"Sepia",css:"sepia(100%)"},{id:"sunset",label:"Sunset",css:"sepia(30%) saturate(140%) brightness(110%) hue-rotate(-10deg)"},{id:"azure",label:"Azure",css:"saturate(120%) brightness(105%) hue-rotate(180deg)"},{id:"teal",label:"Teal",css:"saturate(130%) hue-rotate(140deg)"}];function jn(n){const t=[n];let e=0,i=0;const o=lt({canUndo:!1,canRedo:!1}),{subscribe:r,set:c,update:d}=lt(n);function l(){o.set({canUndo:e>i,canRedo:e<t.length-1})}return{subscribe:r,undoState:o,set:u=>{t.splice(e+1),t.push(u),e=t.length-1,c(u),l()},update:u=>{d(h=>{const I=u(h);return t.splice(e+1),t.push(I),e=t.length-1,l(),I})},silentUpdate:u=>{d(u)},setBaseState:()=>{i=e,l()},undo:()=>{e>i&&(e--,c(t[e]),l())},redo:()=>{e<t.length-1&&(e++,c(t[e]),l())},canUndo:()=>e>i,canRedo:()=>e<t.length-1,reset:()=>{t.length=0,t.push(n),e=0,i=0,c(n),l()}}}const Xn={originalImage:null,currentImage:null,aspectRatio:"custom",width:0,height:0,ratioLocked:!1,scale:1,offsetX:0,offsetY:0,brightness:0,contrast:0,shadows:0,hdr:0,activeFilter:"original",filterStrength:50,cropBox:{x:0,y:0,width:0,height:0},isCropping:!1,cropPending:!1,imageWidth:0,imageHeight:0,blurEnabled:!1,blurBrushSize:50,blurStrength:50,blurSoften:50,blurInvert:!1,blurMask:null,showBrushPreview:!1,zoomLevel:1,zoomOffsetX:0,zoomOffsetY:0},V=jn(Xn),Rt=lt("none"),Gn=Zt(V,n=>n.currentImage!==null);function Jn(){V.reset(),Rt.set("none")}var Vn=D('<div class="controls-panel svelte-c9tnuw"><!></div>'),Zn=D('<div class="controls-panel svelte-c9tnuw"><!></div>'),Qn=D("<!> <!> <!> <!>",1),Kn=D('<div class="crop-tab svelte-c9tnuw"><!> <!> <!></div>');function $n(n,t){pe(t,!1);const e=()=>qe(V,"$cropState",c),i=()=>qe(Rt,"$activeSubMenu",c),o=()=>qe(Gn,"$hasImage",c),r=()=>qe(I,"$undoState",c),[c,d]=kt(),l=W(),u=W(),h=W(),I=V.undoState,w=[{id:"crop",label:"Crop"},{id:"edit",label:"Edit"},{id:"filter",label:"Filter"}];let f=W(null),b=null;async function B(v){const z=await Et(v);V.set({...e(),originalImage:v,currentImage:v,imageWidth:z.width,imageHeight:z.height,width:z.width,height:z.height,cropBox:{x:0,y:0,width:100,height:100},isCropping:!0,cropPending:!1,aspectRatio:"custom",ratioLocked:!1}),V.setBaseState(),Rt.set("crop")}function s(v){if(e().cropPending&&i()==="crop"&&v!=="crop"){b=()=>{Rt.set(v),V.silentUpdate(z=>({...z,isCropping:!1}))},y(f,"save");return}v==="crop"?V.silentUpdate(z=>({...z,isCropping:!0})):V.silentUpdate(z=>({...z,isCropping:!1})),Rt.set(i()===v?"none":v)}async function g(){return await cn(e().currentImage,a(h),e().blurMask)}async function P(){if(e().cropPending){b=async()=>{const v=await g();await Wt(v)},y(f,"save");return}if(e().currentImage){const v=await g();await Wt(v)}}async function E(){if(e().cropPending){b=async()=>{const v=await g();Nt(v,"picflam-export.png")},y(f,"save");return}if(e().currentImage){const v=await g();Nt(v,"picflam-export.png")}}function M(){y(f,"startAgain")}function H(){V.undo()}function R(){V.redo()}async function x(){y(f,null),await K(),b&&(await b(),b=null)}function T(){y(f,null),b=null}function j(){y(f,null),Jn()}function N(){y(f,null)}async function K(){const v=e();if(!v.currentImage||!v.cropPending)return;const z=await xa(v.currentImage,v.cropBox,v.imageWidth,v.imageHeight),F=await Et(z);V.set({...v,currentImage:z,imageWidth:F.width,imageHeight:F.height,width:F.width,height:F.height,cropBox:{x:0,y:0,width:100,height:100},cropPending:!1})}function he(v){if(v==="custom"){V.silentUpdate(oe=>({...oe,aspectRatio:"custom",cropBox:{x:0,y:0,width:100,height:100},ratioLocked:!1,cropPending:!1}));return}const F={"9:16":9/16,"1:1":1,"16:9":16/9}[v],G=e().imageWidth/e().imageHeight;let O;if(v==="9:16"){const se=F/G*100;if(se<=100)O={x:(100-se)/2,y:0,width:se,height:100};else{const ve=G/F*100;O={x:0,y:(100-ve)/2,width:100,height:ve}}}else if(v==="16:9"){const se=G/F*100;if(se<=100)O={x:0,y:(100-se)/2,width:100,height:se};else{const ve=F/G*100;O={x:(100-ve)/2,y:0,width:ve,height:100}}}else if(v==="1:1")if(G>1){const oe=100/G;O={x:(100-oe)/2,y:0,width:oe,height:100}}else{const oe=100*G;O={x:0,y:(100-oe)/2,width:100,height:oe}}V.silentUpdate(oe=>({...oe,aspectRatio:v,cropBox:O,cropPending:!0,isCropping:!0,ratioLocked:!0}))}function re({width:v,height:z}){const F=e().imageWidth,G=e().imageHeight,O=Math.min(Math.max(1,v),F),oe=Math.min(Math.max(1,z),G),se=O/F*100,ve=oe/G*100;let le;if(e().ratioLocked){const ce=a(l)/a(u);if(v!==a(l)){const Le=O/ce/G*100;le={x:(100-se)/2,y:(100-Math.min(100,Le))/2,width:se,height:Math.min(100,Le)}}else{const Le=oe*ce/F*100;le={x:(100-Math.min(100,Le))/2,y:(100-ve)/2,width:Math.min(100,Le),height:ve}}}else le={x:(100-se)/2,y:(100-ve)/2,width:se,height:ve};V.silentUpdate(ce=>({...ce,cropBox:le,cropPending:!0}))}function te(){V.silentUpdate(v=>({...v,ratioLocked:!v.ratioLocked}))}async function fe(){const v=await ln(e().currentImage);V.set({...e(),currentImage:v})}async function X(){const v=await sn(e().currentImage,90),z=await Et(v);V.set({...e(),currentImage:v,imageWidth:z.width,imageHeight:z.height,cropBox:{x:0,y:0,width:100,height:100},cropPending:!1})}function ae(v){V.silentUpdate(z=>({...z,scale:v/100}))}function de(v){const z=v.detail.cropBox;if(e().ratioLocked&&e().aspectRatio!=="custom"){const G={"9:16":.5625,"1:1":1,"16:9":1.7777777777777777}[e().aspectRatio];e().imageWidth/e().imageHeight;const O=z.width*e().imageWidth/(z.height*e().imageHeight);if(Math.abs(O-G)>.01){const ve=z.width/100*e().imageWidth/G/e().imageHeight*100;z.height=Math.min(100,ve),z.y+z.height>100&&(z.y=100-z.height)}}V.silentUpdate(F=>({...F,cropBox:z,cropPending:!0}))}function ye(){K()}let _e=null;function me(){_e===null&&(_e={...e()})}function Ke(){_e!==null&&(V.set(e()),_e=null)}function Oe(v){me(),V.silentUpdate(z=>({...z,brightness:v}))}function Ye(v){me(),V.silentUpdate(z=>({...z,shadows:v}))}function Be(v){me(),V.silentUpdate(z=>({...z,contrast:v}))}function Te(v){me(),V.silentUpdate(z=>({...z,hdr:v}))}function be(v){V.set({...e(),blurEnabled:v})}function je(v){me(),V.silentUpdate(z=>({...z,blurBrushSize:v}))}function Xe(v){me(),V.silentUpdate(z=>({...z,blurStrength:v}))}function Ae(v){me(),V.silentUpdate(z=>({...z,blurSoften:v}))}function Se(v){V.set({...e(),blurInvert:v})}function $e(v){V.silentUpdate(z=>({...z,showBrushPreview:v}))}function Fe(){Ke()}let ne=null,Ie=[],De=null;function ft(v){const z=v.detail.point;De===null&&(De=e().blurMask?[...e().blurMask]:[]),Ie.push(z),V.silentUpdate(F=>({...F,blurMask:[...F.blurMask||[],z]})),ne&&clearTimeout(ne),ne=setTimeout(()=>{if(Ie.length>0){const F=[...De,...Ie];V.set({...e(),blurMask:F}),Ie=[],De=null}ne=null},300)}function dt(v){V.silentUpdate(z=>({...z,zoomLevel:v}))}function it(v){V.silentUpdate(F=>{let{zoomOffsetX:G,zoomOffsetY:O}=F;switch(v){case"up":O-=20;break;case"down":O+=20;break;case"left":G-=20;break;case"right":G+=20;break}return{...F,zoomOffsetX:G,zoomOffsetY:O}})}function ot(){V.silentUpdate(v=>({...v,zoomLevel:1,zoomOffsetX:0,zoomOffsetY:0}))}function We(v){V.silentUpdate(z=>({...z,activeFilter:v}))}function rt(v){me(),V.silentUpdate(z=>({...z,filterStrength:v}))}function et(){V.set({...e(),activeFilter:"original",filterStrength:50})}xe(()=>e(),()=>{y(l,Math.round(e().imageWidth*e().cropBox.width/100))}),xe(()=>e(),()=>{y(u,Math.round(e().imageHeight*e().cropBox.height/100))}),xe(()=>(e(),da),()=>{y(h,(()=>{let v=[];if(e().brightness!==0&&v.push(`brightness(${1+e().brightness/100})`),e().contrast!==0&&v.push(`contrast(${1+e().contrast/100})`),e().shadows!==0){const z=1+e().shadows/200;v.push(`brightness(${z})`)}if(e().hdr!==0){const z=1+e().hdr/100*.3,F=1+e().hdr/100*.2;v.push(`saturate(${z}) contrast(${F})`)}if(e().activeFilter!=="original"){const z=da.find(F=>F.id===e().activeFilter);if(z&&z.css!=="none"){const F=e().filterStrength/100,G=z.css.replace(/(\d+)%/g,(O,oe)=>`${Math.round(parseInt(oe)*F)}%`);v.push(G)}}return v.length>0?v.join(" "):"none"})())}),bt(),Ce();var Ne=Kn(),C=S(Ne);{var Y=v=>{ka(v,{title:"Crop, edit and add filters to photos",hint:"Import, drag or paste an image",onImageImport:B})},$=v=>{var z=Qn(),F=ze(z);Kt(F,{get canUndo(){return r(),U(()=>r().canUndo)},get canRedo(){return r(),U(()=>r().canRedo)},onUndo:H,onRedo:R,onStartAgain:M,onCopy:P,onExport:E});var G=p(F,2);{let le=Qe(()=>(i(),e(),U(()=>i()==="edit"?e().zoomLevel:e().scale))),ce=Qe(()=>(i(),e(),U(()=>i()==="edit"?e().zoomOffsetX:e().offsetX))),tt=Qe(()=>(i(),e(),U(()=>i()==="edit"?e().zoomOffsetY:e().offsetY))),Le=Qe(()=>(e(),U(()=>e().blurMask||[])));_n(G,{get imageSrc(){return e(),U(()=>e().currentImage)},get cropBox(){return e(),U(()=>e().cropBox)},get isCropping(){return e(),U(()=>e().isCropping)},get scale(){return a(le)},get offsetX(){return a(ce)},get offsetY(){return a(tt)},get imageWidth(){return e(),U(()=>e().imageWidth)},get imageHeight(){return e(),U(()=>e().imageHeight)},get editFilters(){return a(h)},get blurEnabled(){return e(),U(()=>e().blurEnabled)},get blurBrushSize(){return e(),U(()=>e().blurBrushSize)},get blurStrength(){return e(),U(()=>e().blurStrength)},get blurSoften(){return e(),U(()=>e().blurSoften)},get blurInvert(){return e(),U(()=>e().blurInvert)},get blurMask(){return a(Le)},get showBrushPreview(){return e(),U(()=>e().showBrushPreview)},$$events:{cropChange:de,blurPaint:ft}})}var O=p(G,2);$t(O,{get tabs(){return w},get activeTab(){return i()},onTabChange:s});var oe=p(O,2);{var se=le=>{{let ce=Qe(()=>(e(),U(()=>Math.round(e().scale*100))));An(le,{get aspectRatio(){return e(),U(()=>e().aspectRatio)},get cropWidth(){return a(l)},get cropHeight(){return a(u)},get ratioLocked(){return e(),U(()=>e().ratioLocked)},get scale(){return a(ce)},get cropPending(){return e(),U(()=>e().cropPending)},onRatioChange:he,onDimensionsChange:re,onLockToggle:te,onFlip:fe,onRotate:X,onScaleChange:ae,onApply:ye})}},ve=le=>{var ce=nt(),tt=ze(ce);{var Le=Ge=>{var Je=Vn(),mt=S(Je);Fn(mt,{get brightness(){return e(),U(()=>e().brightness)},get shadows(){return e(),U(()=>e().shadows)},get contrast(){return e(),U(()=>e().contrast)},get hdr(){return e(),U(()=>e().hdr)},get blurEnabled(){return e(),U(()=>e().blurEnabled)},get blurBrushSize(){return e(),U(()=>e().blurBrushSize)},get blurStrength(){return e(),U(()=>e().blurStrength)},get blurSoften(){return e(),U(()=>e().blurSoften)},get blurInvert(){return e(),U(()=>e().blurInvert)},get zoomLevel(){return e(),U(()=>e().zoomLevel)},onBrightnessChange:Oe,onShadowsChange:Ye,onContrastChange:Be,onHdrChange:Te,onBlurToggle:be,onBlurBrushSizeChange:je,onBlurStrengthChange:Xe,onBlurSoftenChange:Ae,onBlurInvertChange:Se,onZoomChange:dt,onNudge:it,onResetZoom:ot,onBrushPreviewChange:$e,onEditEnd:Fe}),_(Je),A(Ge,Je)},pt=Ge=>{var Je=nt(),mt=ze(Je);{var L=ee=>{var Ee=Zn(),He=S(Ee);Yn(He,{get imageUrl(){return e(),U(()=>e().currentImage)},get activeFilter(){return e(),U(()=>e().activeFilter)},get filterStrength(){return e(),U(()=>e().filterStrength)},onFilterChange:We,onStrengthChange:rt,onReset:et}),_(Ee),A(ee,Ee)};Z(mt,ee=>{i()==="filter"&&ee(L)},!0)}A(Ge,Je)};Z(tt,Ge=>{i()==="edit"?Ge(Le):Ge(pt,!1)},!0)}A(le,ce)};Z(oe,le=>{i()==="crop"?le(se):le(ve,!1)})}A(v,z)};Z(C,v=>{o()?v($,!1):v(Y)})}var q=p(C,2);{var ie=v=>{Yt(v,{message:"Save changes?",confirmText:"Yes",cancelText:"Cancel",onConfirm:x,onCancel:T})};Z(q,v=>{a(f)==="save"&&v(ie)})}var ue=p(q,2);{var J=v=>{Yt(v,{message:"Start again? Your changes will be lost.",confirmText:"Yes",cancelText:"Cancel",onConfirm:j,onCancel:N})};Z(ue,v=>{a(f)==="startAgain"&&v(J)})}_(Ne),A(n,Ne),we(),d()}var ei=D('<div class="before-after-container svelte-1i0ztfp" role="slider" aria-label="Before and after comparison" tabindex="0"><div class="before-image svelte-1i0ztfp"><img alt="Before" class="svelte-1i0ztfp"/></div> <div class="after-image svelte-1i0ztfp"><img alt="After" class="svelte-1i0ztfp"/></div> <div class="slider-handle svelte-1i0ztfp" role="presentation"><div class="slider-line svelte-1i0ztfp"></div> <div class="slider-thumb svelte-1i0ztfp"><img src="/icons/icon-ai-slider.svg" alt="" class="slider-icon svelte-1i0ztfp"/></div></div></div>');function ti(n,t){pe(t,!1);let e=m(t,"beforeImage",8,""),i=m(t,"afterImage",8,""),o=m(t,"position",12,50),r=m(t,"onChange",8,()=>{}),c=W(),d=!1;Vt(()=>(window.addEventListener("mousemove",h),window.addEventListener("touchmove",I,{passive:!1}),window.addEventListener("mouseup",w),window.addEventListener("touchend",w),()=>{window.removeEventListener("mousemove",h),window.removeEventListener("touchmove",I),window.removeEventListener("mouseup",w),window.removeEventListener("touchend",w)}));function l(){d=!0}function u(H){H.touches.length===1&&(d=!0)}function h(H){!d||!a(c)||f(H.clientX)}function I(H){!d||!a(c)||H.touches.length!==1||(H.preventDefault(),f(H.touches[0].clientX))}function w(){d=!1}function f(H){const R=a(c).getBoundingClientRect(),x=Math.max(0,Math.min(100,(H-R.left)/R.width*100));o(x),r()(x)}function b(H){if(!a(c))return;const R=a(c).getBoundingClientRect(),x=(H.clientX-R.left)/R.width*100;o(Math.max(0,Math.min(100,x))),r()(o())}Ce();var B=ei(),s=S(B),g=S(s);_(s);var P=p(s,2),E=S(P);_(P);var M=p(P,2);_(B),wt(B,H=>y(c,H),()=>a(c)),Q(()=>{ge(g,"src",e()),Pe(P,`clip-path: inset(0 ${100-o()}% 0 0)`),ge(E,"src",i()),Pe(M,`left: ${o()??""}%`)}),k("mousedown",M,l),k("touchstart",M,u),k("click",B,b),A(n,B),we()}const ua={originalImage:null,currentImage:null,processedImage:null,isProcessing:!1,processingType:null,upscaleFactor:1,showComparison:!1,comparisonPosition:50};function ai(){const{subscribe:n,set:t,update:e}=lt(ua);return{subscribe:n,setImage:i=>e(o=>({...o,originalImage:i,currentImage:i,processedImage:null})),startProcessing:i=>e(o=>({...o,isProcessing:!0,processingType:i})),finishProcessing:i=>e(o=>({...o,isProcessing:!1,processingType:null,processedImage:i,currentImage:i,showComparison:!0})),cancelProcessing:()=>e(i=>({...i,isProcessing:!1,processingType:null})),setUpscaleFactor:i=>e(o=>({...o,upscaleFactor:i})),setComparisonPosition:i=>e(o=>({...o,comparisonPosition:i})),reset:()=>t(ua)}}const Ue=ai(),va=lt("enhance"),ni=Zt(Ue,n=>n.currentImage!==null);let St=null;async function ii(n,t=4,e){e?.("Uploading image...");const i=await fetch("/api/face-enhance",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({image:n,scale:t,faceEnhance:.5})}),o=await i.json();if(!i.ok)throw new Error(o.error||`API error: ${i.status}`);if(o.status==="succeeded"&&o.output)return e?.("Downloading result..."),await Ca(o.output);if(o.status==="processing"||o.status==="starting")return e?.("Processing with CodeFormer..."),await oi(o.pollUrl,e);throw new Error("Unexpected response")}async function oi(n,t,e=60){for(let i=0;i<e;i++){await new Promise(c=>setTimeout(c,2e3));const o=await fetch(`/api/upscale?pollUrl=${encodeURIComponent(n)}`),r=await o.json();if(!o.ok)throw new Error(r.error||`Polling error: ${o.status}`);if(r.status==="succeeded"&&r.output)return t?.("Downloading result..."),await Ca(r.output);if(r.status==="failed")throw new Error(r.error||"Upscaling failed");t?.(`Processing in cloud (${(i+1)*2}s)...`)}throw new Error("Timeout waiting for result")}async function Ca(n){const e=await(await fetch(n)).blob();return new Promise((i,o)=>{const r=new FileReader;r.onload=()=>i(r.result),r.onerror=o,r.readAsDataURL(e)})}async function ri(n){if(St)return St;console.log("[AI] Loading RMBG background removal model..."),n?.("Downloading model (first time only)...");const{pipeline:t,env:e}=await ja(async()=>{const{pipeline:i,env:o}=await import("../chunks/bLAnV4ll.js");return{pipeline:i,env:o}},[],import.meta.url);e.allowLocalModels=!1;try{St=await t("image-segmentation","briaai/RMBG-1.4",{device:"webgpu",dtype:"fp32"}),console.log("[AI] RMBG model ready (WebGPU)")}catch(i){console.log("[AI] WebGPU not available, falling back to WASM...",i.message),St=await t("image-segmentation","briaai/RMBG-1.4",{dtype:"q8"}),console.log("[AI] RMBG model ready (WASM)")}return St}async function si(n,t){try{console.log("[AI] Starting background removal...");const e=await ri(t);t?.("Processing image...");const i=await e(n);if(console.log("[AI] Segmentation result:",i),!i||i.length===0)throw new Error("No segmentation result returned");const o=i[0];if(console.log("[AI] Segment keys:",Object.keys(o)),o.mask&&o.mask.toDataURL)return console.log("[AI] Background removal complete (RawImage mask)"),await ga(n,o.mask);if(o.mask&&o.mask.data)return console.log("[AI] Background removal complete (data mask)"),await ga(n,o.mask);if(typeof o=="string"&&o.startsWith("data:"))return console.log("[AI] Background removal complete (direct output)"),o;throw console.log("[AI] Segment structure:",JSON.stringify(o,null,2).substring(0,500)),new Error("Unexpected segmentation result format")}catch(e){throw console.error("[AI] Background removal failed:",e),new Error("Background removal failed: "+e.message)}}async function ga(n,t){return new Promise((e,i)=>{const o=new Image;o.onload=async()=>{try{const r=document.createElement("canvas");r.width=o.width,r.height=o.height;const c=r.getContext("2d");c.drawImage(o,0,0);const d=c.getImageData(0,0,r.width,r.height),l=d.data;let u,h,I;if(t.toDataURL){const f=document.createElement("canvas");f.width=t.width,f.height=t.height;const b=f.getContext("2d"),B=new Image;B.onload=()=>{b.drawImage(B,0,0);const s=b.getImageData(0,0,t.width,t.height);ha(l,s.data,r.width,r.height,t.width,t.height,!0),c.putImageData(d,0,0),e(r.toDataURL("image/png"))},B.onerror=i,B.src=t.toDataURL();return}else u=t.data,h=t.width,I=t.height;const w=u.length===h*I*4;ha(l,u,r.width,r.height,h,I,w),c.putImageData(d,0,0),e(r.toDataURL("image/png"))}catch(r){i(r)}},o.onerror=i,o.src=n})}function ha(n,t,e,i,o,r,c){const d=o/e,l=r/i;for(let u=0;u<i;u++)for(let h=0;h<e;h++){const I=Math.floor(h*d),w=Math.floor(u*l);let f;if(c){const B=(w*o+I)*4;f=t[B]}else{const B=w*o+I;f=t[B]||0}const b=(u*e+h)*4;n[b+3]=f}}var li=D('<div class="size-display svelte-1rgvkgu"> </div>'),ci=D('<button class="processing-btn svelte-1rgvkgu" disabled><span class="spinner svelte-1rgvkgu"></span> </button> <button class="cancel-btn svelte-1rgvkgu">Cancel</button>',1),di=D('<button class="upscale-btn svelte-1rgvkgu"><img src="/icons/icon-ai.svg" alt="" class="btn-icon svelte-1rgvkgu"/> Upscale image</button> <p class="hint svelte-1rgvkgu">Upscales, sharpens and enhances images</p>',1),ui=D('<div class="error-message svelte-1rgvkgu"> </div>'),vi=D('<div class="upscale-controls svelte-1rgvkgu"><div class="controls-content svelte-1rgvkgu"><!> <!> <!></div></div>');function gi(n,t){pe(t,!1);const e=()=>qe(Ue,"$aiState",i),[i,o]=kt(),r=4;let c=W(!1),d=W(""),l=W(null),u=W(null);async function h(){try{const R=await ct(e().originalImage),x=Math.round(R.naturalWidth*r),T=Math.round(R.naturalHeight*r);y(u,`${x} x ${T}`)}catch(R){console.error("Failed to get image dimensions:",R)}}async function I(){if(e().originalImage)try{y(c,!0),y(l,null),y(d,"Starting..."),Ue.startProcessing("upscale");const R=await ii(e().originalImage,r,x=>{y(d,x)});Ue.finishProcessing(R)}catch(R){y(l,R.message||"Upscaling failed"),Ue.cancelProcessing()}finally{y(c,!1),y(d,"")}}function w(){y(c,!1),y(d,""),y(l,null),Ue.cancelProcessing()}xe(()=>e(),()=>{e().originalImage&&h()}),bt(),Ce();var f=vi(),b=S(f),B=S(b);{var s=R=>{var x=li(),T=S(x);_(x),Q(()=>ke(T,`Output: ${a(u)??""}`)),A(R,x)};Z(B,R=>{a(u)&&R(s)})}var g=p(B,2);{var P=R=>{var x=ci(),T=ze(x),j=p(S(T));_(T);var N=p(T,2);Q(()=>ke(j,` ${a(d)||"Processing..."}`)),k("click",N,w),A(R,x)},E=R=>{var x=di(),T=ze(x);Jt(2),k("click",T,I),A(R,x)};Z(g,R=>{a(c)?R(P):R(E,!1)})}var M=p(g,2);{var H=R=>{var x=ui(),T=S(x,!0);_(x),Q(()=>ke(T,a(l))),A(R,x)};Z(M,R=>{a(l)&&R(H)})}_(b),_(f),A(n,f),we(),o()}var hi=D('<img alt="Original" class="compare-overlay svelte-1ibkqf6"/>'),fi=D('<div class="brush-indicator svelte-1ibkqf6"></div>'),mi=D('<div class="brush-preview svelte-1ibkqf6"></div>'),bi=D('<div class="drawer-overlay svelte-1ibkqf6" role="presentation"><div class="drawer svelte-1ibkqf6" role="dialog"><div class="drawer-header svelte-1ibkqf6"><button class="icon-btn svelte-1ibkqf6" title="Undo"><img src="/icons/icon-undo.svg" alt="Undo" class="svelte-1ibkqf6"/></button> <button class="icon-btn svelte-1ibkqf6" title="Redo"><img src="/icons/icon-redo.svg" alt="Redo" class="svelte-1ibkqf6"/></button> <div class="spacer svelte-1ibkqf6"></div> <button title="Compare"><img src="/icons/icon-compare.svg" alt="Compare" class="svelte-1ibkqf6"/></button></div> <div class="canvas-container svelte-1ibkqf6"><div class="canvas-wrapper svelte-1ibkqf6" role="presentation"><canvas class="svelte-1ibkqf6"></canvas> <!> <!> <!></div></div> <div class="controls-section svelte-1ibkqf6"><div class="button-group svelte-1ibkqf6"><button><img src="/icons/icon-erase.svg" alt="" class="svelte-1ibkqf6"/> Erase</button> <button><img src="/icons/icon-restore.svg" alt="" class="svelte-1ibkqf6"/> Restore</button></div> <div class="control-row svelte-1ibkqf6"><label class="svelte-1ibkqf6">Brush size</label> <div class="control-item svelte-1ibkqf6"><!> <button class="reset-btn svelte-1ibkqf6" title="Reset"><img src="/icons/icon-reset.svg" alt="Reset" class="svelte-1ibkqf6"/></button></div></div> <div class="control-row svelte-1ibkqf6"><label class="svelte-1ibkqf6">Soften edges</label> <div class="control-item svelte-1ibkqf6"><!> <button class="reset-btn svelte-1ibkqf6" title="Reset"><img src="/icons/icon-reset.svg" alt="Reset" class="svelte-1ibkqf6"/></button></div></div> <div class="control-row svelte-1ibkqf6"><label class="svelte-1ibkqf6">Zoom in</label> <div class="control-item svelte-1ibkqf6"><!> <button class="reset-btn svelte-1ibkqf6" title="Reset"><img src="/icons/icon-reset.svg" alt="Reset" class="svelte-1ibkqf6"/></button></div></div> <div class="nudge-buttons svelte-1ibkqf6"><button class="nudge-btn svelte-1ibkqf6">â</button> <button class="nudge-btn svelte-1ibkqf6">â</button> <button class="nudge-btn svelte-1ibkqf6">â</button> <button class="nudge-btn svelte-1ibkqf6">â</button></div> <div class="drawer-footer svelte-1ibkqf6"><button class="btn-cancel svelte-1ibkqf6">Cancel</button> <button class="btn-done svelte-1ibkqf6">Done</button></div></div></div></div>');function pi(n,t){pe(t,!1);const e=W();let i=m(t,"image",8,""),o=m(t,"originalFullImage",8,""),r=m(t,"onClose",8,()=>{}),c=m(t,"onSave",8,()=>{}),d=W(),l=W(),u,h=W(!0),I=W(20),w=W(50),f=W(1),b=W(0),B=W(0),s=!1,g=[],P=0,E=null,M=W({x:0,y:0,visible:!1}),H=W(!1),R=W(0),x=W(0),T=W(!1);Vt(async()=>{const L=await ct(i());na(d,a(d).width=L.naturalWidth),na(d,a(d).height=L.naturalHeight),u=a(d).getContext("2d"),u.drawImage(L,0,0),o()?E=await ct(o()):E=L,j(),N()});function j(){if(a(l)){const L=a(l).getBoundingClientRect();y(R,L.width),y(x,L.height)}}function N(){g=g.slice(0,P+1),g.push(a(d).toDataURL()),P=g.length-1}function K(){P>0&&(P--,re())}function he(){P<g.length-1&&(P++,re())}function re(){const L=new Image;L.onload=()=>{u.clearRect(0,0,a(d).width,a(d).height),u.drawImage(L,0,0)},L.src=g[P]}function te(L){const ee=a(l).getBoundingClientRect(),Ee=a(d).width/ee.width,He=a(d).height/ee.height,Ct=(L.clientX-ee.left)*Ee,zt=(L.clientY-ee.top)*He;return{x:Ct,y:zt}}function fe(L){s=!0;const{x:ee,y:Ee}=te(L);ye(ee,Ee)}function X(L){const ee=a(l).getBoundingClientRect();if(y(M,{x:L.clientX-ee.left,y:L.clientY-ee.top,visible:!0}),!s)return;const{x:Ee,y:He}=te(L);ye(Ee,He)}function ae(){s&&(s=!1,N())}function de(){y(M,{...a(M),visible:!1}),s&&(s=!1,N())}function ye(L,ee){const Ee=a(d).width/a(l).getBoundingClientRect().width,He=a(e)/2*Ee,Ct=a(w)/100,zt=Math.min(He-.001,He*(1-Ct));u.save();try{if(a(h)){const at=u.createRadialGradient(L,ee,zt,L,ee,He);at.addColorStop(0,"rgba(0,0,0,1)"),at.addColorStop(1,"rgba(0,0,0,0)"),u.globalCompositeOperation="destination-out",u.fillStyle=at,u.beginPath(),u.arc(L,ee,He,0,Math.PI*2),u.fill()}else{if(!E)return;const at=document.createElement("canvas");at.width=a(d).width,at.height=a(d).height;const ut=at.getContext("2d"),Mt=ut.createRadialGradient(L,ee,zt,L,ee,He);Mt.addColorStop(0,"rgba(0,0,0,1)"),Mt.addColorStop(1,"rgba(0,0,0,0)"),ut.globalCompositeOperation="source-over",ut.drawImage(E,0,0,at.width,at.height),ut.globalCompositeOperation="destination-in",ut.fillStyle=Mt,ut.beginPath(),ut.arc(L,ee,He,0,Math.PI*2),ut.fill(),u.globalCompositeOperation="source-over",u.drawImage(at,0,0)}}finally{u.restore()}}function _e(){y(I,20)}function me(){y(w,50)}function Ke(){y(f,1),y(b,0),y(B,0)}function Oe(L){switch(L){case"up":y(B,a(B)-10);break;case"down":y(B,a(B)+10);break;case"left":y(b,a(b)-10);break;case"right":y(b,a(b)+10);break}}function Ye(){r()()}function Be(){const L=a(d).toDataURL("image/png");c()(L)}xe(()=>(a(I),a(R),a(x)),()=>{y(e,a(I)/100*Math.min(a(R)||300,a(x)||300)*.5)}),bt(),Ce();var Te=bi(),be=S(Te),je=S(be),Xe=S(je),Ae=p(Xe,2),Se=p(Ae,4);let $e;_(je);var Fe=p(je,2),ne=S(Fe),Ie=S(ne);wt(Ie,L=>y(d,L),()=>a(d));var De=p(Ie,2);{var ft=L=>{var ee=hi();Q(()=>ge(ee,"src",o())),A(L,ee)};Z(De,L=>{a(T)&&o()&&L(ft)})}var dt=p(De,2);{var it=L=>{var ee=fi();Q(()=>Pe(ee,`
							left: ${a(M),U(()=>a(M).x)??""}px;
							top: ${a(M),U(()=>a(M).y)??""}px;
							width: ${a(e)??""}px;
							height: ${a(e)??""}px;
						`)),A(L,ee)};Z(dt,L=>{a(M),a(R),U(()=>a(M).visible&&a(R)>0)&&L(it)})}var ot=p(dt,2);{var We=L=>{var ee=mi();Q(()=>Pe(ee,`
						left: ${a(R)/2}px;
						top: ${a(x)/2}px;
						width: ${a(e)??""}px;
						height: ${a(e)??""}px;
					`)),A(L,ee)};Z(ot,L=>{a(H)&&a(R)>0&&a(x)>0&&L(We)})}_(ne),wt(ne,L=>y(l,L),()=>a(l)),_(Fe);var rt=p(Fe,2),et=S(rt),Ne=S(et);let C;var Y=p(Ne,2);let $;_(et);var q=p(et,2),ie=p(S(q),2),ue=S(ie);ht(ue,{min:5,max:100,step:1,get value(){return a(I)},onChange:L=>y(I,L),onInteractionStart:()=>{j(),y(H,!0)},onInteractionEnd:()=>y(H,!1)});var J=p(ue,2);_(ie),_(q);var v=p(q,2),z=p(S(v),2),F=S(z);ht(F,{min:0,max:100,step:1,get value(){return a(w)},onChange:L=>y(w,L)});var G=p(F,2);_(z),_(v);var O=p(v,2),oe=p(S(O),2),se=S(oe);ht(se,{min:1,max:3,step:.1,get value(){return a(f)},onChange:L=>y(f,L)});var ve=p(se,2);_(oe),_(O);var le=p(O,2),ce=S(le),tt=p(ce,2),Le=p(tt,2),pt=p(Le,2);_(le);var Ge=p(le,2),Je=S(Ge),mt=p(Je,2);_(Ge),_(rt),_(be),_(Te),Q(()=>{$e=Me(Se,1,"icon-btn svelte-1ibkqf6",null,$e,{active:a(T)}),Pe(ne,`transform: scale(${a(f)??""}) translate(${a(b)??""}px, ${a(B)??""}px)`),C=Me(Ne,1,"mode-btn svelte-1ibkqf6",null,C,{active:a(h)}),$=Me(Y,1,"mode-btn svelte-1ibkqf6",null,$,{active:!a(h)})}),k("click",Xe,K),k("click",Ae,he),k("mousedown",Se,()=>y(T,!0)),k("mouseup",Se,()=>y(T,!1)),k("mouseleave",Se,()=>y(T,!1)),k("touchstart",Se,()=>y(T,!0)),k("touchend",Se,()=>y(T,!1)),k("mousedown",ne,fe),k("mousemove",ne,X),k("mouseup",ne,ae),k("mouseleave",ne,de),k("click",Ne,()=>y(h,!0)),k("click",Y,()=>y(h,!1)),k("click",J,_e),k("click",G,me),k("click",ve,Ke),k("click",ce,()=>Oe("up")),k("click",tt,()=>Oe("down")),k("click",Le,()=>Oe("left")),k("click",pt,()=>Oe("right")),k("click",Je,Ye),k("click",mt,Be),k("click",be,Ve(function(L){Ot.call(this,t,L)})),k("click",Te,Ye),A(n,Te),we()}var wi=D('<button class="processing-btn svelte-1wdmsm1" disabled><span class="spinner svelte-1wdmsm1"></span> </button> <button class="cancel-btn svelte-1wdmsm1">Cancel</button>',1),_i=D('<button class="remove-btn svelte-1wdmsm1"><img src="/icons/icon-ai.svg" alt="" class="btn-icon svelte-1wdmsm1"/> Remove background</button> <p class="hint svelte-1wdmsm1">Remove image background with AI</p> <button class="erase-btn svelte-1wdmsm1"><img src="/icons/icon-erase.svg" alt="" class="btn-icon svelte-1wdmsm1"/> Erase and restore</button> <p class="hint svelte-1wdmsm1">Manually clean up background</p>',1),xi=D('<div class="error-message svelte-1wdmsm1"> </div>'),ki=D('<div class="background-controls svelte-1wdmsm1"><div class="controls-content svelte-1wdmsm1"><!> <!></div> <!></div>');function Ci(n,t){pe(t,!1);const e=()=>qe(Ue,"$aiState",i),[i,o]=kt(),r=W();let c=W(!1),d=W(""),l=W(null),u=W(!1);async function h(){if(e().originalImage)try{y(c,!0),y(l,null),y(d,"Starting..."),Ue.startProcessing("background");const x=await si(e().originalImage,T=>{y(d,T)});Ue.finishProcessing(x)}catch(x){y(l,x.message||"Background removal failed"),Ue.cancelProcessing()}finally{y(c,!1),y(d,"")}}function I(){y(c,!1),y(d,""),y(l,null),Ue.cancelProcessing()}function w(){y(u,!0)}function f(){y(u,!1)}xe(()=>e(),()=>{y(r,e().showComparison&&e().processedImage)}),bt(),Ce();var b=ki(),B=S(b),s=S(B);{var g=x=>{var T=wi(),j=ze(T),N=p(S(j));_(j);var K=p(j,2);Q(()=>ke(N,` ${a(d)||"Processing..."}`)),k("click",K,I),A(x,T)},P=x=>{var T=_i(),j=ze(T),N=p(j,4);Jt(2),Q(()=>N.disabled=!a(r)),k("click",j,h),k("click",N,w),A(x,T)};Z(s,x=>{a(c)?x(g):x(P,!1)})}var E=p(s,2);{var M=x=>{var T=xi(),j=S(T,!0);_(T),Q(()=>ke(j,a(l))),A(x,T)};Z(E,x=>{a(l)&&x(M)})}_(B);var H=p(B,2);{var R=x=>{pi(x,{get image(){return e(),U(()=>e().processedImage)},get originalFullImage(){return e(),U(()=>e().originalImage)},onClose:f,onSave:T=>{Ue.finishProcessing(T),y(u,!1)}})};Z(H,x=>{a(u)&&x(R)})}_(b),A(n,b),we(),o()}var yi=D('<img alt="Working image" class="working-image svelte-17agwu4"/>'),Si=D('<!> <div class="image-container svelte-17agwu4"><!></div> <!> <!>',1),Ii=D('<div class="ai-tab svelte-17agwu4"><!></div>');function Ri(n,t){pe(t,!1);const e=()=>qe(Ue,"$aiState",r),i=()=>qe(ni,"$hasAiImage",r),o=()=>qe(va,"$activeAiMenu",r),[r,c]=kt();let d=W(50);function l(P){y(d,P),Ue.setComparisonPosition(P)}const u=[{id:"upscale",label:"Upscale"},{id:"background",label:"Remove background"}];function h(P){Ue.setImage(P)}function I(P){va.set(P)}async function w(){e().currentImage&&await Wt(e().currentImage)}function f(){e().currentImage&&Nt(e().currentImage,"picflam-ai.png")}Ce();var b=Ii(),B=S(b);{var s=P=>{ka(P,{title:"Upscale and remove backgrounds using AI power",hint:"Import, drag or paste an image",onImageImport:h})},g=P=>{var E=Si(),M=ze(E);Kt(M,{canUndo:!1,canRedo:!1,onUndo:()=>{},onRedo:()=>{},onStartAgain:()=>Ue.reset(),onCopy:w,onExport:f});var H=p(M,2),R=S(H);{var x=re=>{ti(re,{get beforeImage(){return e().originalImage},get afterImage(){return e().processedImage},get position(){return a(d)},onChange:l})},T=re=>{var te=yi();Q(()=>ge(te,"src",e().currentImage)),A(re,te)};Z(R,re=>{e().showComparison&&e().processedImage?re(x):re(T,!1)})}_(H);var j=p(H,2);$t(j,{get tabs(){return u},get activeTab(){return o()},onTabChange:I});var N=p(j,2);{var K=re=>{gi(re,{})},he=re=>{var te=nt(),fe=ze(te);{var X=ae=>{Ci(ae,{})};Z(fe,ae=>{o()==="background"&&ae(X)},!0)}A(re,te)};Z(N,re=>{o()==="upscale"?re(K):re(he,!1)})}A(P,E)};Z(B,P=>{i()?P(g,!1):P(s)})}_(b),A(n,b),we(),c()}const zi={canvasSize:"1/1",background:{type:"solid",value:"#FFFFFF"},text1:"",text1Font:"Inter",text1Size:5,text1YPosition:3,text1LineSpacing:5,text1Color:"#000000",text1HighlightColor:"transparent",text1IsBold:!0,text1Align:"center",text1QuoteStyle:"none",text1QuoteSize:5,text2:"",text2Font:"Inter",text2Size:3,text2YPosition:8,text2LineSpacing:5,text2Color:"#000000",text2LabelColor:"transparent",text2IsBold:!1,text2Align:"center",overlay:null,overlayScale:1,overlayOpacity:1,overlayX:0,overlayY:0,overlayMask:"none",overlayWrap:!1,overlayBorderWidth:0,overlayBorderColor:"#FFFFFF"};function Bi(n){const t=[JSON.parse(JSON.stringify(n))];let e=0;const{subscribe:i,set:o,update:r}=lt(n);return{subscribe:i,set:c=>{t.splice(e+1),t.push(JSON.parse(JSON.stringify(c))),e=t.length-1,o(c)},update:c=>{r(d=>{const l=c(d);return t.splice(e+1),t.push(JSON.parse(JSON.stringify(l))),e=t.length-1,l})},undo:()=>e>0?(e--,o(JSON.parse(JSON.stringify(t[e]))),!0):!1,redo:()=>e<t.length-1?(e++,o(JSON.parse(JSON.stringify(t[e]))),!0):!1,canUndo:()=>e>0,canRedo:()=>e<t.length-1,reset:()=>{const c=JSON.parse(JSON.stringify(n));t.length=0,t.push(c),e=0,o(c)}}}const gt=Bi(zi),jt=lt(!0),Xt=lt("none");Zt(gt,n=>n.text1||n.text2||n.overlay||n.background.value!=="#FFFFFF");function Ei(){gt.reset(),jt.set(!0),Xt.set("none")}var Pi=D('<button class="template-card svelte-fxk5n4"><div class="template-placeholder svelte-fxk5n4"> </div></button>'),Mi=D('<div class="template-picker svelte-fxk5n4"><p class="picker-title svelte-fxk5n4">Create quotes and cards. Start with a template or blank canvas</p> <button class="blank-canvas-btn svelte-fxk5n4"><img src="/icons/icon-add.svg" alt="" class="add-icon svelte-fxk5n4"/></button> <div class="template-grid svelte-fxk5n4"></div></div>'),Ti=D('<p class="placeholder svelte-fxk5n4">Size controls coming in Phase 5</p>'),Ai=D('<p class="placeholder svelte-fxk5n4">Background controls coming in Phase 5</p>'),Ui=D('<p class="placeholder svelte-fxk5n4">Text 1 controls coming in Phase 5</p>'),Di=D('<p class="placeholder svelte-fxk5n4">Text 2 controls coming in Phase 5</p>'),Li=D('<p class="placeholder svelte-fxk5n4">Quote controls coming in Phase 5</p>'),Hi=D('<p class="placeholder svelte-fxk5n4">Overlay controls coming in Phase 5</p>'),Fi=D('<!> <div class="canvas-container svelte-fxk5n4"><div class="design-canvas svelte-fxk5n4"></div></div> <!> <div class="controls-panel svelte-fxk5n4"><!></div>',1),qi=D('<div class="design-tab svelte-fxk5n4"><!></div>');function Oi(n,t){pe(t,!1);const e=()=>qe(Xt,"$activeDesignMenu",r),i=()=>qe(jt,"$showTemplatePicker",r),o=()=>qe(gt,"$slideState",r),[r,c]=kt(),d=[{id:"size",label:"Size"},{id:"background",label:"Background"},{id:"text1",label:"Text 1"},{id:"text2",label:"Text 2"},{id:"quote",label:"Quote"},{id:"overlay",label:"Overlay"}];function l(s){s==="blank"&&gt.reset(),jt.set(!1)}function u(s){Xt.set(e()===s?"none":s)}async function h(){}function I(){}Ce();var w=qi(),f=S(w);{var b=s=>{var g=Mi(),P=p(S(g),2),E=p(P,2);xt(E,4,()=>[1,2,3,4,5,6],_t,(M,H)=>{var R=Pi(),x=S(R),T=S(x);_(x),_(R),Q(()=>ke(T,`Template ${H??""}`)),k("click",R,()=>l(`template-${H}`)),A(M,R)}),_(E),_(g),k("click",P,()=>l("blank")),A(s,g)},B=s=>{var g=Fi(),P=ze(g);{let N=Qe(()=>gt.canUndo()),K=Qe(()=>gt.canRedo());Kt(P,{get canUndo(){return a(N)},get canRedo(){return a(K)},onUndo:()=>gt.undo(),onRedo:()=>gt.redo(),get onStartAgain(){return Ei},onCopy:h,onExport:I})}var E=p(P,2),M=S(E);_(E);var H=p(E,2);$t(H,{get tabs(){return d},get activeTab(){return e()},onTabChange:u});var R=p(H,2),x=S(R);{var T=N=>{var K=Ti();A(N,K)},j=N=>{var K=nt(),he=ze(K);{var re=fe=>{var X=Ai();A(fe,X)},te=fe=>{var X=nt(),ae=ze(X);{var de=_e=>{var me=Ui();A(_e,me)},ye=_e=>{var me=nt(),Ke=ze(me);{var Oe=Be=>{var Te=Di();A(Be,Te)},Ye=Be=>{var Te=nt(),be=ze(Te);{var je=Ae=>{var Se=Li();A(Ae,Se)},Xe=Ae=>{var Se=nt(),$e=ze(Se);{var Fe=ne=>{var Ie=Hi();A(ne,Ie)};Z($e,ne=>{e()==="overlay"&&ne(Fe)},!0)}A(Ae,Se)};Z(be,Ae=>{e()==="quote"?Ae(je):Ae(Xe,!1)},!0)}A(Be,Te)};Z(Ke,Be=>{e()==="text2"?Be(Oe):Be(Ye,!1)},!0)}A(_e,me)};Z(ae,_e=>{e()==="text1"?_e(de):_e(ye,!1)},!0)}A(fe,X)};Z(he,fe=>{e()==="background"?fe(re):fe(te,!1)},!0)}A(N,K)};Z(x,N=>{e()==="size"?N(T):N(j,!1)})}_(R),Q(()=>Pe(M,`
					aspect-ratio: ${o().canvasSize??""};
					background: ${o().background.type==="solid",o().background.value??""};
				`)),A(s,g)};Z(f,s=>{i()?s(b):s(B,!1)})}_(w),A(n,w),we(),c()}const Lt=lt("crop");var Wi=D('<!> <main class="main svelte-1uha8ag"><!></main> <!>',1);function Zi(n,t){pe(t,!1);const e=()=>qe(Lt,"$activeTab",o),i=()=>qe(V,"$cropState",o),[o,r]=kt();let c=W(!1),d=null;function l(E){if(e()==="crop"&&i().cropPending&&E!=="crop"){d=E,y(c,!0);return}Lt.set(E)}async function u(){y(c,!1);const E=i();if(E.currentImage&&E.cropPending){const M=await xa(E.currentImage,E.cropBox,E.imageWidth,E.imageHeight),H=await Et(M);V.set({...E,currentImage:M,imageWidth:H.width,imageHeight:H.height,cropBox:{x:0,y:0,width:100,height:100},cropPending:!1,isCropping:!1})}d&&(Lt.set(d),d=null)}function h(){y(c,!1),d=null}Ce();var I=Wi(),w=ze(I);on(w,{get activeTab(){return e()},onTabChange:l});var f=p(w,2),b=S(f);{var B=E=>{$n(E,{})},s=E=>{var M=nt(),H=ze(M);{var R=T=>{Ri(T,{})},x=T=>{var j=nt(),N=ze(j);{var K=he=>{Oi(he,{})};Z(N,he=>{e()==="design"&&he(K)},!0)}A(T,j)};Z(H,T=>{e()==="ai"?T(R):T(x,!1)},!0)}A(E,M)};Z(b,E=>{e()==="crop"?E(B):E(s,!1)})}_(f);var g=p(f,2);{var P=E=>{Yt(E,{message:"Save changes?",confirmText:"Yes",cancelText:"Cancel",onConfirm:u,onCancel:h})};Z(g,E=>{a(c)&&E(P)})}A(n,I),we(),r()}export{Zi as component};

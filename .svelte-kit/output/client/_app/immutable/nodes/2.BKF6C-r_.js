import{b as ca,d as Oa,f as F,a as A,c as gt}from"../chunks/Dj8On0Xh.js";import"../chunks/Bnc7oL5D.js";import{F as Ht,i as at,x as Mt,C as jt,j as Vt,M as Ha,g as n,aI as We,aA as Ua,O as Wa,a5 as da,aj as Nt,B as St,N as Sa,ao as ja,a2 as va,ax as Ct,P as Jt,az as Na,am as na,w as Ia,I as ua,at as N,aO as Ya,aP as Xa,aQ as Ga,aR as ht,ay as za,R as Ra,aS as Yt,ah as Ba,aT as Qa,al as Va,a3 as Ja,aU as Ea,L as Pa,aV as Za,t as J,A as Ka,aW as $a,ap as en,ai as tn,aX as an,aY as nn,aZ as on,a_ as rn,a$ as ln,b0 as sn,av as cn,b as m,J as dn,b1 as vn,p as Te,n as Me,s as u,k as f,l as g,aq as z,b2 as Ye,b3 as pt,e as Le,a4 as _t,m as Ne,b4 as ga,b5 as La}from"../chunks/c1y374w_.js";import{p as h,b as ft,i as $,s as ot,a as Rt,_ as un}from"../chunks/DZfZzOi_.js";import{i as De}from"../chunks/CBwOI1Gw.js";import{e as p,s as je}from"../chunks/8R3vFiuv.js";import{c as gn,o as Bt,d as oa,w as bt,a as ia}from"../chunks/pj8eKBGp.js";function dt(o,a){return a}function hn(o,a,e){for(var t=[],i=a.length,r,d=a.length,c=0;c<i;c++){let k=a[c];Ra(k,()=>{if(r){if(r.pending.delete(k),r.done.add(k),r.pending.size===0){var S=o.outrogroups;Zt(na(r.done)),S.delete(r),S.size===0&&(o.outrogroups=null)}}else d-=1},!1)}if(d===0){var s=t.length===0&&e!==null;if(s){var v=e,b=v.parentNode;Va(b),b.append(v),o.items.clear()}Zt(a,!s)}else r={pending:new Set(a),done:new Set},(o.outrogroups??=new Set).add(r)}function Zt(o,a=!0){for(var e=0;e<o.length;e++)Ja(o[e],a)}var ha;function vt(o,a,e,t,i,r=null){var d=o,c=new Map,s=(a&Ea)!==0;if(s){var v=o;d=at?Ht(Mt(v)):v.appendChild(jt())}at&&Vt();var b=null,k=We(()=>{var w=e();return Ia(w)?w:w==null?[]:na(w)}),S,x=!0;function _(){l.fallback=b,fn(l,S,d,a,t),b!==null&&(S.length===0?(b.f&ht)===0?za(b):(b.f^=ht,Dt(b,null,d)):Ra(b,()=>{b=null}))}var R=Ha(()=>{S=n(k);var w=S.length;let T=!1;if(at){var E=Ua(d)===Wa;E!==(w===0)&&(d=da(),Ht(d),Nt(!1),T=!0)}for(var L=new Set,M=Ct,I=Na(),C=0;C<w;C+=1){at&&St.nodeType===Sa&&St.data===ja&&(d=St,T=!0,Nt(!1));var P=S[C],W=t(P,C),Y=x?null:c.get(W);Y?(Y.v&&va(Y.v,P),Y.i&&va(Y.i,C),I&&M.skipped_effects.delete(Y.e)):(Y=bn(c,x?d:ha??=jt(),P,W,C,i,a,e),x||(Y.e.f|=ht),c.set(W,Y)),L.add(W)}if(w===0&&r&&!b&&(x?b=Jt(()=>r(d)):(b=Jt(()=>r(ha??=jt())),b.f|=ht)),at&&w>0&&Ht(da()),!x)if(I){for(const[te,me]of c)L.has(te)||M.skipped_effects.add(me.e);M.oncommit(_),M.ondiscard(()=>{})}else _();T&&Nt(!0),n(k)}),l={effect:R,items:c,outrogroups:null,fallback:b};x=!1,at&&(d=St)}function Pt(o){for(;o!==null&&(o.f&Qa)===0;)o=o.next;return o}function fn(o,a,e,t,i){var r=(t&Za)!==0,d=a.length,c=o.items,s=Pt(o.effect.first),v,b=null,k,S=[],x=[],_,R,l,w;if(r)for(w=0;w<d;w+=1)_=a[w],R=i(_,w),l=c.get(R).e,(l.f&ht)===0&&(l.nodes?.a?.measure(),(k??=new Set).add(l));for(w=0;w<d;w+=1){if(_=a[w],R=i(_,w),l=c.get(R).e,o.outrogroups!==null)for(const Y of o.outrogroups)Y.pending.delete(l),Y.done.delete(l);if((l.f&ht)!==0)if(l.f^=ht,l===s)Dt(l,null,e);else{var T=b?b.next:s;l===o.effect.last&&(o.effect.last=l.prev),l.prev&&(l.prev.next=l.next),l.next&&(l.next.prev=l.prev),xt(o,b,l),xt(o,l,T),Dt(l,T,e),b=l,S=[],x=[],s=Pt(b.next);continue}if((l.f&Yt)!==0&&(za(l),r&&(l.nodes?.a?.unfix(),(k??=new Set).delete(l))),l!==s){if(v!==void 0&&v.has(l)){if(S.length<x.length){var E=x[0],L;b=E.prev;var M=S[0],I=S[S.length-1];for(L=0;L<S.length;L+=1)Dt(S[L],E,e);for(L=0;L<x.length;L+=1)v.delete(x[L]);xt(o,M.prev,I.next),xt(o,b,M),xt(o,I,E),s=E,b=I,w-=1,S=[],x=[]}else v.delete(l),Dt(l,s,e),xt(o,l.prev,l.next),xt(o,l,b===null?o.effect.first:b.next),xt(o,b,l),b=l;continue}for(S=[],x=[];s!==null&&s!==l;)(v??=new Set).add(s),x.push(s),s=Pt(s.next);if(s===null)continue}(l.f&ht)===0&&S.push(l),b=l,s=Pt(l.next)}if(o.outrogroups!==null){for(const Y of o.outrogroups)Y.pending.size===0&&(Zt(na(Y.done)),o.outrogroups?.delete(Y));o.outrogroups.size===0&&(o.outrogroups=null)}if(s!==null||v!==void 0){var C=[];if(v!==void 0)for(l of v)(l.f&Yt)===0&&C.push(l);for(;s!==null;)(s.f&Yt)===0&&s!==o.fallback&&C.push(s),s=Pt(s.next);var P=C.length;if(P>0){var W=(t&Ea)!==0&&d===0?e:null;if(r){for(w=0;w<P;w+=1)C[w].nodes?.a?.measure();for(w=0;w<P;w+=1)C[w].nodes?.a?.fix()}hn(o,C,W)}}r&&Pa(()=>{if(k!==void 0)for(l of k)l.nodes?.a?.apply()})}function bn(o,a,e,t,i,r,d,c){var s=(d&Xa)!==0?(d&Ga)===0?N(e,!1,!1):ua(e):null,v=(d&Ya)!==0?ua(i):null;return{v:s,i:v,e:Jt(()=>(r(a,s??e,v??i,c),()=>{o.delete(t)}))}}function Dt(o,a,e){if(o.nodes)for(var t=o.nodes.start,i=o.nodes.end,r=a&&(a.f&ht)===0?a.nodes.start:e;t!==null;){var d=Ba(t);if(r.before(t),t===i)return;t=d}}function xt(o,a,e){a===null?o.effect.first=e:a.next=e,e===null?o.effect.last=a:e.prev=a}function fa(o,a,e=!1,t=!1,i=!1){var r=o,d="";J(()=>{var c=Ka;if(d===(d=a()??"")){at&&Vt();return}if(c.nodes!==null&&($a(c.nodes.start,c.nodes.end),c.nodes=null),d!==""){if(at){St.data;for(var s=Vt(),v=s;s!==null&&(s.nodeType!==Sa||s.data!=="");)v=s,s=Ba(s);if(s===null)throw en(),tn;ca(St,v),r=Ht(s);return}var b=d+"";e?b=`<svg>${b}</svg>`:t&&(b=`<math>${b}</math>`);var k=Oa(b);if((e||t)&&(k=Mt(k)),ca(Mt(k),k.lastChild),e||t)for(;Mt(k);)r.before(Mt(k));else r.before(k)}})}const ba=[...` 	
\r\fÂ \v\uFEFF`];function mn(o,a,e){var t=o==null?"":""+o;if(e){for(var i in e)if(e[i])t=t?t+" "+i:i;else if(t.length)for(var r=i.length,d=0;(d=t.indexOf(i,d))>=0;){var c=d+r;(d===0||ba.includes(t[d-1]))&&(c===t.length||ba.includes(t[c]))?t=(d===0?"":t.substring(0,d))+t.substring(c+1):d=c}}return t===""?null:t}function pn(o,a){return o==null?null:String(o)}function ue(o,a,e,t,i,r){var d=o.__className;if(at||d!==e||d===void 0){var c=mn(e,t,r);(!at||c!==o.getAttribute("class"))&&(c==null?o.removeAttribute("class"):o.className=c),o.__className=e}else if(r&&i!==r)for(var s in r){var v=!!r[s];(i==null||v!==!!i[s])&&o.classList.toggle(s,v)}return r}function _e(o,a,e,t){var i=o.__style;if(at||i!==a){var r=pn(a);(!at||r!==o.getAttribute("style"))&&(r==null?o.removeAttribute("style"):o.style.cssText=r),o.__style=a}return t}const wn=Symbol("is custom element"),xn=Symbol("is html");function Ft(o){if(at){var a=!1,e=()=>{if(!a){if(a=!0,o.hasAttribute("value")){var t=o.value;ye(o,"value",null),o.value=t}if(o.hasAttribute("checked")){var i=o.checked;ye(o,"checked",null),o.checked=i}}};o.__on_r=e,Pa(e),ln()}}function qt(o,a){var e=ra(o);e.value===(e.value=a??void 0)||o.value===a&&(a!==0||o.nodeName!=="PROGRESS")||(o.value=a??"")}function _n(o,a){var e=ra(o);e.checked!==(e.checked=a??void 0)&&(o.checked=a)}function ye(o,a,e,t){var i=ra(o);at&&(i[a]=o.getAttribute(a),a==="src"||a==="srcset"||a==="href"&&o.nodeName==="LINK")||i[a]!==(i[a]=e)&&(a==="loading"&&(o[an]=e),e==null?o.removeAttribute(a):typeof e!="string"&&yn(o).includes(a)?o[a]=e:o.setAttribute(a,e))}function ra(o){return o.__attributes??={[wn]:o.nodeName.includes("-"),[xn]:o.namespaceURI===nn}}var ma=new Map;function yn(o){var a=o.getAttribute("is")||o.nodeName,e=ma.get(a);if(e)return e;ma.set(a,e=[]);for(var t,i=o,r=Element.prototype;r!==i;){t=rn(i);for(var d in t)t[d].set&&e.push(d);i=on(i)}return e}function kn(o,a,e=a){var t=new WeakSet;sn(o,"input",async i=>{var r=i?o.defaultValue:o.value;if(r=Xt(o)?Gt(r):r,e(r),Ct!==null&&t.add(Ct),await cn(),r!==(r=a())){var d=o.selectionStart,c=o.selectionEnd,s=o.value.length;if(o.value=r??"",c!==null){var v=o.value.length;d===c&&c===s&&v>s?(o.selectionStart=v,o.selectionEnd=v):(o.selectionStart=d,o.selectionEnd=Math.min(c,v))}}}),(at&&o.defaultValue!==o.value||m(a)==null&&o.value)&&(e(Xt(o)?Gt(o.value):o.value),Ct!==null&&t.add(Ct)),dn(()=>{var i=a();if(o===document.activeElement){var r=vn??Ct;if(t.has(r))return}Xt(o)&&i===Gt(o.value)||o.type==="date"&&!i&&!o.value||i!==o.value&&(o.value=i??"")})}function Xt(o){var a=o.type;return a==="number"||a==="range"}function Gt(o){return o===""?null:+o}function st(o){return function(...a){var e=a[0];return e.stopPropagation(),o?.apply(this,a)}}function Kt(o,a){var e=o.$$events?.[a.type],t=Ia(e)?e.slice():e==null?[]:[e];for(var i of t)i.call(this,a)}var Cn=F('<header class="header svelte-hv3zzy"><img src="/logos/logo-picflam-logotype.png" alt="PicFlam" class="header-logo svelte-hv3zzy"/> <nav class="header-nav svelte-hv3zzy"><button aria-label="Crop tab"><img src="/icons/icon-crop.svg" alt="" class="nav-icon svelte-hv3zzy"/></button> <button aria-label="AI tab"><img src="/icons/icon-ai.svg" alt="" class="nav-icon svelte-hv3zzy"/></button> <button aria-label="Design tab"><img src="/icons/icon-design.svg" alt="" class="nav-icon svelte-hv3zzy"/></button></nav></header>');function Sn(o,a){Te(a,!1);let e=h(a,"activeTab",8,"crop"),t=h(a,"onTabChange",8);De();var i=Cn(),r=u(f(i),2),d=f(r);let c;var s=u(d,2);let v;var b=u(s,2);let k;g(r),g(i),J(()=>{c=ue(d,1,"nav-btn svelte-hv3zzy",null,c,{active:e()==="crop"}),v=ue(s,1,"nav-btn svelte-hv3zzy",null,v,{active:e()==="ai"}),k=ue(b,1,"nav-btn svelte-hv3zzy",null,k,{active:e()==="design"})}),p("click",d,()=>t()("crop")),p("click",s,()=>t()("ai")),p("click",b,()=>t()("design")),A(o,i),Me()}function Ta(o){return new Promise((a,e)=>{const t=new FileReader;t.onload=i=>a(i.target.result),t.onerror=e,t.readAsDataURL(o)})}function mt(o){return new Promise((a,e)=>{const t=new Image;t.onload=()=>a(t),t.onerror=e,t.src=o})}async function Ut(o){const a=await mt(o);return{width:a.naturalWidth,height:a.naturalHeight}}function pa(o,a=2048){return new Promise(async e=>{const t=await mt(o),{naturalWidth:i,naturalHeight:r}=t;if(i<=a&&r<=a){e(o);return}const d=document.createElement("canvas"),c=d.getContext("2d");let s,v;i>r?(s=a,v=r/i*a):(v=a,s=i/r*a),d.width=s,d.height=v,c.drawImage(t,0,0,s,v),e(d.toDataURL("image/jpeg",.92))})}async function In(){try{const o=await navigator.clipboard.read();for(const a of o)for(const e of a.types)if(e.startsWith("image/")){const t=await a.getType(e);return await Ta(t)}return null}catch(o){return console.error("Failed to paste from clipboard:",o),null}}async function $t(o){try{const e=await(await fetch(o)).blob();return await navigator.clipboard.write([new ClipboardItem({[e.type]:e})]),!0}catch(a){return console.error("Failed to copy to clipboard:",a),!1}}function ea(o,a="picflam-export.png"){const e=document.createElement("a");e.href=o,e.download=a,document.body.appendChild(e),e.click(),document.body.removeChild(e)}async function Ma(o,a,e,t){const i=await mt(o),r=document.createElement("canvas"),d=r.getContext("2d"),c=a.x/100*e,s=a.y/100*t,v=a.width/100*e,b=a.height/100*t;return r.width=v,r.height=b,d.drawImage(i,c,s,v,b,0,0,v,b),r.toDataURL("image/png")}async function zn(o,a){const e=await mt(o),t=document.createElement("canvas"),i=t.getContext("2d");return t.width=e.naturalHeight,t.height=e.naturalWidth,i.translate(t.width/2,t.height/2),i.rotate(a*Math.PI/180),i.drawImage(e,-e.naturalWidth/2,-e.naturalHeight/2),t.toDataURL("image/png")}async function Rn(o,a){const e=await mt(o),t=document.createElement("canvas"),i=t.getContext("2d");return t.width=e.naturalWidth,t.height=e.naturalHeight,i.translate(t.width,0),i.scale(-1,1),i.drawImage(e,0,0),t.toDataURL("image/png")}async function Bn(o,a,e){const t=await mt(o),i=document.createElement("canvas"),r=i.getContext("2d");if(i.width=t.naturalWidth,i.height=t.naturalHeight,a&&a!=="none"&&(r.filter=a),r.drawImage(t,0,0),r.filter="none",e&&Array.isArray(e)&&e.length>0)if(e.some(c=>c.invert)){const s=.5+e.reduce((l,w)=>l+(w.strength||50),0)/e.length/100*9.5,v=document.createElement("canvas");v.width=i.width,v.height=i.height;const b=v.getContext("2d");b.filter=`blur(${s}px)`,a&&a!=="none"&&(b.filter=`blur(${s}px) ${a}`),b.drawImage(t,0,0);const k=document.createElement("canvas");k.width=i.width,k.height=i.height;const S=k.getContext("2d");S.fillStyle="white",S.fillRect(0,0,k.width,k.height);for(const l of e){if(!l.invert)continue;const w=(l.soften||50)/100,T=S.createRadialGradient(l.x,l.y,0,l.x,l.y,l.radius);T.addColorStop(0,"rgba(0,0,0,1)"),T.addColorStop(.5+w*.3,"rgba(0,0,0,0.5)"),T.addColorStop(1,"rgba(0,0,0,0)"),S.fillStyle=T,S.beginPath(),S.arc(l.x,l.y,l.radius,0,Math.PI*2),S.fill()}const x=r.getImageData(0,0,i.width,i.height),_=b.getImageData(0,0,i.width,i.height),R=S.getImageData(0,0,i.width,i.height);for(let l=0;l<x.data.length;l+=4){const w=R.data[l]/255;x.data[l]=x.data[l]*w+_.data[l]*(1-w),x.data[l+1]=x.data[l+1]*w+_.data[l+1]*(1-w),x.data[l+2]=x.data[l+2]*w+_.data[l+2]*(1-w)}r.putImageData(x,0,0)}else for(const c of e){const s=c.strength||50,v=(c.soften||50)/100,b=.5+s/100*9.5,k=document.createElement("canvas");k.width=i.width,k.height=i.height;const S=k.getContext("2d");S.filter=`blur(${b}px)`,a&&a!=="none"&&(S.filter=`blur(${b}px) ${a}`),S.drawImage(t,0,0);const x=document.createElement("canvas");x.width=i.width,x.height=i.height;const _=x.getContext("2d"),R=_.createRadialGradient(c.x,c.y,0,c.x,c.y,c.radius);R.addColorStop(0,"rgba(255,255,255,1)"),R.addColorStop(.5+v*.3,"rgba(255,255,255,0.5)"),R.addColorStop(1,"rgba(255,255,255,0)"),_.fillStyle=R,_.beginPath(),_.arc(c.x,c.y,c.radius,0,Math.PI*2),_.fill();const l=r.getImageData(0,0,i.width,i.height),w=S.getImageData(0,0,i.width,i.height),T=_.getImageData(0,0,i.width,i.height);for(let E=0;E<l.data.length;E+=4){const L=T.data[E]/255;l.data[E]=l.data[E]*(1-L)+w.data[E]*L,l.data[E+1]=l.data[E+1]*(1-L)+w.data[E+1]*L,l.data[E+2]=l.data[E+2]*(1-L)+w.data[E+2]*L}r.putImageData(l,0,0)}return i.toDataURL("image/png")}var En=F('<div role="button" tabindex="0"><p class="import-title svelte-f1bndr"> </p> <img src="/icons/icon-upload.svg" alt="" class="import-icon svelte-f1bndr"/> <p class="import-hint svelte-f1bndr"> </p> <button class="btn-paste svelte-f1bndr">Paste</button> <input type="file" accept="image/*" class="sr-only"/></div>');function Da(o,a){Te(a,!1);let e=h(a,"title",8,"Import an image"),t=h(a,"hint",8,"Import, drag or paste an image"),i=h(a,"onImageImport",8,I=>{}),r=N(!1),d=N();async function c(I){if(!I||!I.type.startsWith("image/"))return;const C=await Ta(I),P=await pa(C,2048);i()(P)}function s(I){const C=I.target.files?.[0];C&&c(C)}function v(I){I.preventDefault(),z(r,!1);const C=I.dataTransfer?.files?.[0];C&&c(C)}function b(I){I.preventDefault(),z(r,!0)}function k(){z(r,!1)}async function S(){const I=await In();if(I){const C=await pa(I,2048);i()(C)}}function x(){n(d)?.click()}De();var _=En();let R;var l=f(_),w=f(l,!0);g(l);var T=u(l,4),E=f(T,!0);g(T);var L=u(T,2),M=u(L,2);ft(M,I=>z(d,I),()=>n(d)),g(_),J(()=>{R=ue(_,1,"import-area svelte-f1bndr",null,R,{dragging:n(r)}),je(w,e()),je(E,t())}),p("click",L,st(S)),p("change",M,s),p("click",_,x),p("drop",_,v),p("dragover",_,b),p("dragleave",_,k),p("keypress",_,I=>I.key==="Enter"&&x()),A(o,_),Me()}var Pn=F('<div class="action-bar svelte-96zw02"><div class="action-group svelte-96zw02"><button class="action-btn svelte-96zw02" aria-label="Undo"><img src="/icons/icon-undo.svg" alt="" class="action-icon svelte-96zw02"/></button> <button class="action-btn svelte-96zw02" aria-label="Redo"><img src="/icons/icon-redo.svg" alt="" class="action-icon svelte-96zw02"/></button></div> <div class="action-group svelte-96zw02"><button class="action-btn svelte-96zw02" aria-label="Start again"><img src="/icons/icon-startagain.svg" alt="" class="action-icon svelte-96zw02"/></button> <button class="action-btn svelte-96zw02" aria-label="Copy to clipboard"><img src="/icons/icon-copy.svg" alt="" class="action-icon svelte-96zw02"/></button> <button class="action-btn svelte-96zw02" aria-label="Export"><img src="/icons/icon-export.svg" alt="" class="action-icon svelte-96zw02"/></button></div></div>');function la(o,a){let e=h(a,"canUndo",8,!1),t=h(a,"canRedo",8,!1),i=h(a,"onUndo",8,()=>{}),r=h(a,"onRedo",8,()=>{}),d=h(a,"onStartAgain",8,()=>{}),c=h(a,"onCopy",8,()=>{}),s=h(a,"onExport",8,()=>{});var v=Pn(),b=f(v),k=f(b),S=u(k,2);g(b);var x=u(b,2),_=f(x),R=u(_,2),l=u(R,2);g(x),g(v),J(()=>{k.disabled=!e(),S.disabled=!t()}),p("click",k,function(...w){i()?.apply(this,w)}),p("click",S,function(...w){r()?.apply(this,w)}),p("click",_,function(...w){d()?.apply(this,w)}),p("click",R,function(...w){c()?.apply(this,w)}),p("click",l,function(...w){s()?.apply(this,w)}),A(o,v)}var Ln=F("<button> </button>"),Tn=F('<div class="sub-menu-tabs svelte-tv6tw8"></div>');function sa(o,a){Te(a,!1);let e=h(a,"tabs",24,()=>[]),t=h(a,"activeTab",8,""),i=h(a,"onTabChange",8,d=>{});De();var r=Tn();vt(r,5,e,dt,(d,c)=>{var s=Ln();let v;var b=f(s,!0);g(s),J(()=>{v=ue(s,1,"sub-menu-tab svelte-tv6tw8",null,v,{active:t()===n(c).id}),je(b,(n(c),m(()=>n(c).label)))}),p("click",s,()=>i()(n(c).id)),A(d,s)}),g(r),A(o,r),Me()}var Mn=F('<div class="modal-overlay svelte-qik81a" role="dialog" aria-modal="true" tabindex="-1"><div class="modal svelte-qik81a" role="document"><p class="modal-message svelte-qik81a"> </p> <div class="modal-actions svelte-qik81a"><button class="btn-text svelte-qik81a"> </button> <button class="btn-text btn-confirm svelte-qik81a"> </button></div></div></div>');function ta(o,a){Te(a,!1);let e=h(a,"message",8,""),t=h(a,"confirmText",8,"Yes"),i=h(a,"cancelText",8,"Cancel"),r=h(a,"onConfirm",8,()=>{}),d=h(a,"onCancel",8,()=>{});De();var c=Mn(),s=f(c),v=f(s),b=f(v,!0);g(v);var k=u(v,2),S=f(k),x=f(S,!0);g(S);var _=u(S,2),R=f(_,!0);g(_),g(k),g(s),g(c),J(()=>{je(b,e()),je(x,i()),je(R,t())}),p("click",S,function(...l){d()?.apply(this,l)}),p("click",_,function(...l){r()?.apply(this,l)}),p("click",s,st(function(l){Kt.call(this,a,l)})),p("keydown",s,st(function(l){Kt.call(this,a,l)})),p("click",c,function(...l){d()?.apply(this,l)}),p("keydown",c,l=>l.key==="Escape"&&d()()),A(o,c),Me()}var Dn=F('<canvas class="blur-canvas svelte-pjowa5"></canvas>'),An=F('<div class="blur-brush-indicator svelte-pjowa5"></div>'),Fn=F('<div class="blur-brush-preview svelte-pjowa5"></div>'),qn=F('<div class="crop-overlay svelte-pjowa5"><div class="overlay-top svelte-pjowa5"></div> <div class="overlay-bottom svelte-pjowa5"></div> <div class="overlay-left svelte-pjowa5"></div> <div class="overlay-right svelte-pjowa5"></div> <div class="crop-box svelte-pjowa5" role="button" aria-label="Drag to move crop area" tabindex="0"><div class="crop-border svelte-pjowa5"></div> <div class="corner-handle top-left svelte-pjowa5" role="button" aria-label="Resize top-left corner" tabindex="0"></div> <div class="corner-handle top-right svelte-pjowa5" role="button" aria-label="Resize top-right corner" tabindex="0"></div> <div class="corner-handle bottom-left svelte-pjowa5" role="button" aria-label="Resize bottom-left corner" tabindex="0"></div> <div class="corner-handle bottom-right svelte-pjowa5" role="button" aria-label="Resize bottom-right corner" tabindex="0"></div></div></div>'),On=F('<div class="crop-canvas svelte-pjowa5" role="application" aria-label="Image crop canvas"><div class="image-wrapper svelte-pjowa5"><img alt="Crop preview" class="canvas-image svelte-pjowa5" draggable="false"/> <!></div> <!> <!> <!></div>');function Hn(o,a){Te(a,!1);const e=N(),t=N(),i=N(),r=N();let d=h(a,"imageSrc",8,""),c=h(a,"cropBox",24,()=>({x:10,y:10,width:80,height:80})),s=h(a,"isCropping",8,!1),v=h(a,"scale",8,1),b=h(a,"offsetX",8,0),k=h(a,"offsetY",8,0),S=h(a,"imageWidth",8,0),x=h(a,"imageHeight",8,0),_=h(a,"editFilters",8,""),R=h(a,"blurEnabled",8,!1),l=h(a,"blurBrushSize",8,50),w=h(a,"blurStrength",8,50),T=h(a,"blurSoften",8,50),E=h(a,"blurInvert",8,!1),L=h(a,"blurMask",24,()=>[]),M=h(a,"showBrushPreview",8,!1);const I=gn();let C=N(),P=N(),W=N({width:0,height:0}),Y=!1,te=null,me=0,ie=0,K=null,fe=0,q=1,j=!1,le=N({x:0,y:0,visible:!1}),ge=N(null),Be=N("");async function ke(){z(Be,d());const B=new Image;B.crossOrigin="anonymous",B.onload=()=>{z(ge,B)},B.src=d()}function Ze(B){const Z=document.createElement("canvas");Z.width=n(ge).naturalWidth,Z.height=n(ge).naturalHeight;const se=Z.getContext("2d");return se.filter=`blur(${B}px)`,se.drawImage(n(ge),0,0),Z}function H(){if(!n(P)||!n(ge)||!L())return;const B=n(P).getContext("2d"),Z=n(P).width,se=n(P).height;if(B.clearRect(0,0,Z,se),L().length===0)return;const Q=Z/S(),ce=se/x();if(L().some(oe=>oe.invert)){const oe=L().reduce((U,ee)=>U+(ee.strength||50),0)/L().length;L().reduce((U,ee)=>U+(ee.soften||50),0)/L().length;const y=.5+oe/100*9.5,D=Ze(y);B.drawImage(D,0,0,Z,se),B.globalCompositeOperation="destination-out";for(const U of L()){if(!U.invert)continue;const ee=U.x*Q,V=U.y*ce,pe=U.radius*Math.min(Q,ce),xe=(U.soften||50)/100,Se=Math.max(0,.3-xe*.3),Re=.3+(1-xe)*.4,Pe=B.createRadialGradient(ee,V,0,ee,V,pe);Pe.addColorStop(Se,"rgba(0,0,0,1)"),Pe.addColorStop(Re,`rgba(0,0,0,${.5+xe*.3})`),Pe.addColorStop(1,"rgba(0,0,0,0)"),B.fillStyle=Pe,B.beginPath(),B.arc(ee,V,pe,0,Math.PI*2),B.fill()}B.globalCompositeOperation="source-over"}else for(const oe of L()){const y=oe.x*Q,D=oe.y*ce,U=oe.radius*Math.min(Q,ce),ee=oe.strength||50,V=(oe.soften||50)/100,pe=.5+ee/100*9.5,xe=Ze(pe);B.save();const Se=Math.max(0,.2-V*.2),Re=.2+(1-V)*.5,Pe=B.createRadialGradient(y,D,0,y,D,U);Pe.addColorStop(Se,"rgba(255,255,255,1)"),Pe.addColorStop(Re,`rgba(255,255,255,${.4+V*.3})`),Pe.addColorStop(1,"rgba(255,255,255,0)"),B.beginPath(),B.arc(y,D,U,0,Math.PI*2),B.clip(),B.drawImage(xe,0,0,Z,se),B.restore()}}Bt(()=>(X(),window.addEventListener("resize",X),()=>window.removeEventListener("resize",X)));function X(){if(n(C)){const B=n(C).getBoundingClientRect();z(W,{width:B.width,height:B.height})}}function ae(B){return B.touches&&B.touches.length>0?{x:B.touches[0].clientX,y:B.touches[0].clientY}:{x:B.clientX,y:B.clientY}}function be(B){if(B.touches&&B.touches.length>=2){const Z=B.touches[0].clientX-B.touches[1].clientX,se=B.touches[0].clientY-B.touches[1].clientY;return Math.sqrt(Z*Z+se*se)}return 0}function de(B,Z="move"){if(!s())return;if(B.touches&&B.touches.length>=2){fe=be(B),q=v(),te="pinch";return}B.preventDefault(),Y=!0,te=Z;const se=ae(B);me=se.x,ie=se.y,K={...c()}}function Ie(B){if(!s())return;if(te==="pinch"&&B.touches&&B.touches.length>=2){const ze=be(B),oe=q*(ze/fe);I("scaleChange",{scale:Math.max(.5,Math.min(3,oe))});return}if(!Y||!K)return;B.preventDefault();const Z=ae(B),se=(Z.x-me)/n(e)*100,Q=(Z.y-ie)/n(t)*100;let ce={...K};if(te==="move")ce.x=Math.max(0,Math.min(100-K.width,K.x+se)),ce.y=Math.max(0,Math.min(100-K.height,K.y+Q));else if(te.includes("corner")){if(te.includes("left")){const oe=K.x+se,y=K.width-se;y>=10&&oe>=0&&(ce.x=oe,ce.width=y)}if(te.includes("right")){const oe=K.width+se;oe>=10&&K.x+oe<=100&&(ce.width=oe)}if(te.includes("top")){const oe=K.y+Q,y=K.height-Q;y>=10&&oe>=0&&(ce.y=oe,ce.height=y)}if(te.includes("bottom")){const oe=K.height+Q;oe>=10&&K.y+oe<=100&&(ce.height=oe)}}I("cropChange",{cropBox:ce})}function Ee(){Y=!1,te=null,K=null,j&&(j=!1)}function Fe(B){R()&&(B.preventDefault(),j=!0,Ve(B))}function qe(B){if(!R())return;const Z=n(C).getBoundingClientRect(),se=ae(B);z(le,{x:se.x-Z.left,y:se.y-Z.top,visible:!0}),j&&Ve(B)}function Qe(){z(le,{...n(le),visible:!1}),j&&(j=!1)}function Ve(B){const Z=n(C).getBoundingClientRect(),se=ae(B),Q=(se.x-Z.left)/n(e)*S(),ce=(se.y-Z.top)/n(t)*x(),ze=l()/100*Math.min(S(),x())*.15;I("blurPaint",{point:{x:Q,y:ce,radius:ze,strength:w(),soften:T(),invert:E()}})}Ye(()=>n(W),()=>{z(e,n(W).width)}),Ye(()=>(Le(x()),Le(S()),n(e)),()=>{z(t,x()&&S()?n(e)*x()/S():0)}),Ye(()=>(Le(l()),n(e),n(t)),()=>{z(i,l()/100*Math.min(n(e),n(t))*.3)}),Ye(()=>(Le(d()),n(P),n(Be)),()=>{d()&&n(P)&&d()!==n(Be)&&ke()}),Ye(()=>(Le(L()),n(P),n(ge)),()=>{L()&&Array.isArray(L())&&L().length>0&&n(P)&&n(ge)&&H()}),Ye(()=>(Le(c()),n(e),n(t)),()=>{z(r,{x:c().x/100*n(e),y:c().y/100*n(t),width:c().width/100*n(e),height:c().height/100*n(t)})}),pt(),De();var he=On(),Oe=f(he),O=f(Oe),He=u(O,2);{var nt=B=>{var Z=Dn();ft(Z,se=>z(P,se),()=>n(P)),J(()=>{ye(Z,"width",n(e)),ye(Z,"height",n(t)),_e(Z,`filter: ${_()??""};`)}),A(B,Z)};$(He,B=>{R()&&n(e)>0&&n(t)>0&&B(nt)})}g(Oe);var ne=u(Oe,2);{var re=B=>{var Z=An();J(()=>_e(Z,`
				left: ${n(le),m(()=>n(le).x)??""}px;
				top: ${n(le),m(()=>n(le).y)??""}px;
				width: ${n(i)??""}px;
				height: ${n(i)??""}px;
			`)),A(B,Z)};$(ne,B=>{Le(R()),n(le),m(()=>R()&&n(le).visible)&&B(re)})}var Ce=u(ne,2);{var Ue=B=>{var Z=Fn();J(()=>_e(Z,`
				left: ${n(e)/2}px;
				top: ${n(t)/2}px;
				width: ${n(i)??""}px;
				height: ${n(i)??""}px;
			`)),A(B,Z)};$(Ce,B=>{M()&&n(e)>0&&n(t)>0&&B(Ue)})}var Ke=u(Ce,2);{var Ae=B=>{var Z=qn(),se=f(Z),Q=u(se,2),ce=u(Q,2),ze=u(ce,2),oe=u(ze,2),y=u(f(oe),2),D=u(y,2),U=u(D,2),ee=u(U,2);g(oe),g(Z),J(()=>{_e(se,`height: ${n(r),m(()=>n(r).y)??""}px;`),_e(Q,`top: ${n(r),m(()=>n(r).y+n(r).height)??""}px; height: ${n(t),n(r),m(()=>n(t)-n(r).y-n(r).height)??""}px;`),_e(ce,`top: ${n(r),m(()=>n(r).y)??""}px; height: ${n(r),m(()=>n(r).height)??""}px; width: ${n(r),m(()=>n(r).x)??""}px;`),_e(ze,`top: ${n(r),m(()=>n(r).y)??""}px; height: ${n(r),m(()=>n(r).height)??""}px; left: ${n(r),m(()=>n(r).x+n(r).width)??""}px; width: ${n(e),n(r),m(()=>n(e)-n(r).x-n(r).width)??""}px;`),_e(oe,`left: ${n(r),m(()=>n(r).x)??""}px; top: ${n(r),m(()=>n(r).y)??""}px; width: ${n(r),m(()=>n(r).width)??""}px; height: ${n(r),m(()=>n(r).height)??""}px;`)}),p("mousedown",y,st(V=>de(V,"corner-top-left"))),p("touchstart",y,st(V=>de(V,"corner-top-left"))),p("mousedown",D,st(V=>de(V,"corner-top-right"))),p("touchstart",D,st(V=>de(V,"corner-top-right"))),p("mousedown",U,st(V=>de(V,"corner-bottom-left"))),p("touchstart",U,st(V=>de(V,"corner-bottom-left"))),p("mousedown",ee,st(V=>de(V,"corner-bottom-right"))),p("touchstart",ee,st(V=>de(V,"corner-bottom-right"))),p("mousedown",oe,V=>de(V,"move")),p("touchstart",oe,V=>de(V,"move")),A(B,Z)};$(Ke,B=>{s()&&n(t)>0&&B(Ae)})}g(he),ft(he,B=>z(C,B),()=>n(C)),J(()=>{_e(Oe,`transform: scale(${v()??""}) translate(${b()??""}px, ${k()??""}px);`),ye(O,"src",d()),_e(O,`filter: ${_()??""};`)}),p("mousemove",he,function(...B){(R()?qe:Ie)?.apply(this,B)}),p("mouseup",he,Ee),p("mouseleave",he,function(...B){(R()?Qe:Ee)?.apply(this,B)}),p("touchmove",he,function(...B){(R()?qe:Ie)?.apply(this,B)}),p("touchend",he,Ee),p("mousedown",he,function(...B){(R()?Fe:null)?.apply(this,B)}),p("touchstart",he,function(...B){(R()?Fe:null)?.apply(this,B)}),A(o,he),Me()}var Un=F('<img alt="" class="toggle-icon svelte-1gdqxne"/>'),Wn=F('<span class="toggle-label svelte-1gdqxne"> </span>'),jn=F("<div><button><!></button> <!></div>"),Nn=F("<div></div>");function Aa(o,a){Te(a,!1);let e=h(a,"options",24,()=>[]),t=h(a,"value",8,""),i=h(a,"onChange",8,v=>{}),r=h(a,"showLabels",8,!0),d=h(a,"centered",8,!1);De();var c=Nn();let s;vt(c,5,e,dt,(v,b)=>{var k=jn();let S;var x=f(k);let _;var R=f(x);{var l=E=>{var L=Un();J(()=>ye(L,"src",`/icons/${n(b),m(()=>n(b).icon)??""}.svg`)),A(E,L)};$(R,E=>{n(b),m(()=>n(b).icon)&&E(l)})}g(x);var w=u(x,2);{var T=E=>{var L=Wn(),M=f(L,!0);g(L),J(()=>je(M,(n(b),m(()=>n(b).label)))),A(E,L)};$(w,E=>{Le(r()),n(b),m(()=>r()&&n(b).label)&&E(T)})}g(k),J(()=>{S=ue(k,1,"toggle-item svelte-1gdqxne",null,S,{active:t()===n(b).id}),_=ue(x,1,"toggle-btn svelte-1gdqxne",null,_,{active:t()===n(b).id}),ye(x,"aria-label",(n(b),m(()=>n(b).label)))}),p("click",x,()=>i()(n(b).id)),A(v,k)}),g(c),J(()=>s=ue(c,1,"toggle-group svelte-1gdqxne",null,s,{centered:d()})),A(o,c),Me()}var Yn=F('<label class="input-label svelte-1r47u3b"> <input class="input svelte-1r47u3b"/></label>'),Xn=F('<input class="input svelte-1r47u3b"/>'),Gn=F('<div class="input-field svelte-1r47u3b"><!></div>');function wa(o,a){Te(a,!1);let e=h(a,"label",8,""),t=h(a,"value",12,""),i=h(a,"type",8,"text"),r=h(a,"placeholder",8,""),d=h(a,"disabled",8,!1),c=h(a,"onChange",8,x=>{});function s(x){t(x.target.value),c()(t())}De();var v=Gn(),b=f(v);{var k=x=>{var _=Yn(),R=f(_),l=u(R);Ft(l),g(_),J(()=>{je(R,`${e()??""} `),ye(l,"type",i()),qt(l,t()),ye(l,"placeholder",r()),l.disabled=d()}),p("input",l,s),A(x,_)},S=x=>{var _=Xn();Ft(_),J(()=>{ye(_,"type",i()),qt(_,t()),ye(_,"placeholder",r()),_.disabled=d()}),p("input",_,s),A(x,_)};$(b,x=>{e()?x(k):x(S,!1)})}g(v),A(o,v),Me()}var Qn=F('<span class="slider-value svelte-jchife"> </span>'),Vn=F('<div class="slider-header svelte-jchife"><span class="slider-label svelte-jchife"> </span> <!></div>'),Jn=F('<div class="slider-container svelte-jchife"><!> <input type="range" class="slider svelte-jchife"/></div>');function Je(o,a){Te(a,!1);let e=h(a,"label",8,""),t=h(a,"min",8,0),i=h(a,"max",8,100),r=h(a,"value",8,50),d=h(a,"step",8,1),c=h(a,"showValue",8,!1),s=h(a,"onChange",8,T=>{}),v=h(a,"onInteractionStart",8,()=>{}),b=h(a,"onInteractionEnd",8,()=>{});function k(T){const E=Number(T.target.value);s()(E)}function S(){v()()}function x(){b()()}De();var _=Jn(),R=f(_);{var l=T=>{var E=Vn(),L=f(E),M=f(L,!0);g(L);var I=u(L,2);{var C=P=>{var W=Qn(),Y=f(W,!0);g(W),J(()=>je(Y,r())),A(P,W)};$(I,P=>{c()&&P(C)})}g(E),J(()=>je(M,e())),A(T,E)};$(R,T=>{e()&&T(l)})}var w=u(R,2);Ft(w),g(_),J(()=>{ye(w,"min",t()),ye(w,"max",i()),ye(w,"step",d()),qt(w,r())}),p("input",w,k),p("mousedown",w,S),p("touchstart",w,S),p("mouseup",w,x),p("touchend",w,x),A(o,_),Me()}var Zn=F('<div class="apply-row svelte-17iy3mz"><button class="btn-apply svelte-17iy3mz">Apply</button></div>'),Kn=F('<div class="crop-controls svelte-17iy3mz"><!> <div class="dimensions-row svelte-17iy3mz"><div class="dimension-input svelte-17iy3mz"><!></div> <button class="icon-btn svelte-17iy3mz"><img alt="" class="icon-btn-img svelte-17iy3mz"/></button> <div class="dimension-input svelte-17iy3mz"><!></div> <button class="icon-btn svelte-17iy3mz" aria-label="Flip horizontal"><img src="/icons/icon-flip-horizontal.svg" alt="" class="icon-btn-img svelte-17iy3mz"/></button> <button class="icon-btn svelte-17iy3mz" aria-label="Rotate"><img src="/icons/icon-rotate.svg" alt="" class="icon-btn-img svelte-17iy3mz"/></button></div> <!> <!></div>');function $n(o,a){Te(a,!1);let e=h(a,"aspectRatio",8,"9:16"),t=h(a,"cropWidth",8,1080),i=h(a,"cropHeight",8,1920),r=h(a,"ratioLocked",8,!0),d=h(a,"scale",8,100),c=h(a,"cropPending",8,!1),s=h(a,"onRatioChange",8,q=>{}),v=h(a,"onDimensionsChange",8,({width:q,height:j})=>{}),b=h(a,"onLockToggle",8,()=>{}),k=h(a,"onFlip",8,()=>{}),S=h(a,"onRotate",8,()=>{}),x=h(a,"onScaleChange",8,q=>{}),_=h(a,"onApply",8,()=>{});const R=[{id:"9:16",label:"9:16",icon:"icon-vertical"},{id:"1:1",label:"1:1",icon:"icon-square"},{id:"16:9",label:"16:9",icon:"icon-horizontal"},{id:"custom",label:"Custom",icon:"icon-custom"}];function l(q){const j=parseInt(q)||0;v()({width:j,height:i()})}function w(q){const j=parseInt(q)||0;v()({width:t(),height:j})}De();var T=Kn(),E=f(T);Aa(E,{get options(){return R},get value(){return e()},get onChange(){return s()},showLabels:!0});var L=u(E,2),M=f(L),I=f(M);{let q=We(()=>(Le(t()),m(()=>t().toString())));wa(I,{label:"Width",type:"number",get value(){return n(q)},onChange:l})}g(M);var C=u(M,2),P=f(C);g(C);var W=u(C,2),Y=f(W);{let q=We(()=>(Le(i()),m(()=>i().toString())));wa(Y,{label:"Height",type:"number",get value(){return n(q)},onChange:w})}g(W);var te=u(W,2),me=u(te,2);g(L);var ie=u(L,2);Je(ie,{label:"Scale",min:50,max:200,get value(){return d()},step:1,showValue:!0,get onChange(){return x()}});var K=u(ie,2);{var fe=q=>{var j=Zn(),le=f(j);g(j),p("click",le,function(...ge){_()?.apply(this,ge)}),A(q,j)};$(K,q=>{c()&&q(fe)})}g(T),J(()=>{ye(C,"aria-label",r()?"Unlock aspect ratio":"Lock aspect ratio"),ye(P,"src",`/icons/${r()?"icon-lock":"icon-unlock"}.svg`)}),p("click",C,function(...q){b()?.apply(this,q)}),p("click",te,function(...q){k()?.apply(this,q)}),p("click",me,function(...q){S()?.apply(this,q)}),A(o,T),Me()}var eo=F("<button> </button>"),to=F("<button> </button>"),ao=F('<div class="blur-controls svelte-1e1k0ax"><div class="blur-control-row svelte-1e1k0ax"><!> <label class="invert-checkbox svelte-1e1k0ax"><input type="checkbox" class="svelte-1e1k0ax"/> <span class="checkbox-label svelte-1e1k0ax">Invert</span></label></div> <div class="slider-row svelte-1e1k0ax"><div class="slider-track svelte-1e1k0ax"><!></div> <button class="reset-btn svelte-1e1k0ax" aria-label="Reset"><img src="/icons/icon-reset.svg" alt="" class="reset-icon svelte-1e1k0ax"/></button></div> <div class="zoom-row svelte-1e1k0ax"><span class="zoom-label svelte-1e1k0ax">Zoom in</span> <div class="zoom-slider-row svelte-1e1k0ax"><div class="slider-track svelte-1e1k0ax"><!></div> <button class="reset-btn svelte-1e1k0ax" aria-label="Reset zoom"><img src="/icons/icon-reset.svg" alt="" class="reset-icon svelte-1e1k0ax"/></button></div></div> <div class="nudge-row svelte-1e1k0ax"><button class="nudge-btn svelte-1e1k0ax" aria-label="Nudge up"><img src="/icons/icon-nudge-up.svg" alt="" class="svelte-1e1k0ax"/></button> <button class="nudge-btn svelte-1e1k0ax" aria-label="Nudge down"><img src="/icons/icon-nudge-down.svg" alt="" class="svelte-1e1k0ax"/></button> <button class="nudge-btn svelte-1e1k0ax" aria-label="Nudge left"><img src="/icons/icon-nudge-left.svg" alt="" class="svelte-1e1k0ax"/></button> <button class="nudge-btn svelte-1e1k0ax" aria-label="Nudge right"><img src="/icons/icon-nudge-right.svg" alt="" class="svelte-1e1k0ax"/></button></div></div>'),no=F('<div class="edit-controls svelte-1e1k0ax"><div class="enhancement-row svelte-1e1k0ax"></div> <div class="slider-row svelte-1e1k0ax"><div class="slider-track svelte-1e1k0ax"><!></div> <button class="reset-btn svelte-1e1k0ax" aria-label="Reset"><img src="/icons/icon-reset.svg" alt="" class="reset-icon svelte-1e1k0ax"/></button></div> <div class="blur-section svelte-1e1k0ax"><div class="blur-header svelte-1e1k0ax"><button class="chevron-btn svelte-1e1k0ax"><img alt=""/></button> <span class="blur-label svelte-1e1k0ax">Blur</span> <button><span class="toggle-thumb svelte-1e1k0ax"></span></button></div> <!></div></div>');function oo(o,a){Te(a,!1);const e=N(),t=N(),i=N(),r=N(),d=N(),c=N();let s=h(a,"brightness",8,0),v=h(a,"shadows",8,0),b=h(a,"contrast",8,0),k=h(a,"hdr",8,0),S=h(a,"blurBrushSize",8,50),x=h(a,"blurStrength",8,50),_=h(a,"blurSoften",8,50),R=h(a,"blurInvert",8,!1),l=h(a,"zoomLevel",8,1),w=h(a,"blurEnabled",8,!1),T=h(a,"onBrightnessChange",8,Q=>{}),E=h(a,"onShadowsChange",8,Q=>{}),L=h(a,"onContrastChange",8,Q=>{}),M=h(a,"onHdrChange",8,Q=>{}),I=h(a,"onBlurBrushSizeChange",8,Q=>{}),C=h(a,"onBlurStrengthChange",8,Q=>{}),P=h(a,"onBlurSoftenChange",8,Q=>{}),W=h(a,"onBlurInvertChange",8,Q=>{}),Y=h(a,"onZoomChange",8,Q=>{}),te=h(a,"onNudge",8,Q=>{}),me=h(a,"onResetZoom",8,()=>{}),ie=h(a,"onBlurToggle",8,Q=>{}),K=h(a,"onBrushPreviewChange",8,Q=>{}),fe=h(a,"onEditEnd",8,()=>{}),q=N("brightness"),j=N(w()),le=N("brushSize");const ge=[{id:"brightness",label:"Brightness"},{id:"shadows",label:"Shadows"},{id:"contrast",label:"Contrast"},{id:"hdr",label:"HDR"}],Be=[{id:"brushSize",label:"Brush size"},{id:"strength",label:"Strength"},{id:"soften",label:"Soften edges"}];function ke(Q){switch(n(q)){case"brightness":T()(Q);break;case"shadows":E()(Q);break;case"contrast":L()(Q);break;case"hdr":M()(Q);break}}function Ze(){ke(0)}function H(Q){switch(n(le)){case"brushSize":I()(Q);break;case"strength":C()(Q);break;case"soften":P()(Q);break}}function X(){H(50)}function ae(){const Q=!w();ie()(Q),z(j,Q)}function be(){w()&&z(j,!n(j))}function de(){W()(!R())}function Ie(Q){z(q,Q),z(j,!1)}function Ee(Q){z(le,Q)}function Fe(){fe()()}function qe(){n(le)==="brushSize"&&K()(!0)}function Qe(){K()(!1),fe()()}Ye(()=>(n(q),Le(s()),Le(v()),Le(b()),Le(k())),()=>{z(e,(()=>{switch(n(q)){case"brightness":return s();case"shadows":return v();case"contrast":return b();case"hdr":return k();default:return 0}})())}),Ye(()=>n(q),()=>{z(t,n(q)==="hdr"?0:-100)}),Ye(()=>{},()=>{z(i,100)}),Ye(()=>(n(le),Le(S()),Le(x()),Le(_())),()=>{z(r,(()=>{switch(n(le)){case"brushSize":return S();case"strength":return x();case"soften":return _();default:return 50}})())}),Ye(()=>{},()=>{z(d,1)}),Ye(()=>{},()=>{z(c,100)}),pt(),De();var Ve=no(),he=f(Ve);vt(he,5,()=>ge,dt,(Q,ce)=>{var ze=eo();let oe;var y=f(ze,!0);g(ze),J(()=>{oe=ue(ze,1,"enhancement-btn svelte-1e1k0ax",null,oe,{active:n(q)===n(ce).id}),je(y,(n(ce),m(()=>n(ce).label)))}),p("click",ze,()=>Ie(n(ce).id)),A(Q,ze)}),g(he);var Oe=u(he,2),O=f(Oe),He=f(O);Je(He,{get min(){return n(t)},get max(){return n(i)},get value(){return n(e)},step:1,onChange:ke,onInteractionEnd:Fe}),g(O);var nt=u(O,2);g(Oe);var ne=u(Oe,2),re=f(ne),Ce=f(re),Ue=f(Ce);let Ke;g(Ce);var Ae=u(Ce,4);let B;g(re);var Z=u(re,2);{var se=Q=>{var ce=ao(),ze=f(ce),oe=f(ze);vt(oe,1,()=>Be,dt,(G,we)=>{var $e=to();let tt;var Et=f($e,!0);g($e),J(()=>{tt=ue($e,1,"blur-control-btn svelte-1e1k0ax",null,tt,{active:n(le)===n(we).id}),je(Et,(n(we),m(()=>n(we).label)))}),p("click",$e,()=>Ee(n(we).id)),A(G,$e)});var y=u(oe,2),D=f(y);Ft(D),_t(2),g(y),g(ze);var U=u(ze,2),ee=f(U),V=f(ee);Je(V,{get min(){return n(d)},get max(){return n(c)},get value(){return n(r)},step:1,onChange:H,onInteractionStart:qe,onInteractionEnd:Qe}),g(ee);var pe=u(ee,2);g(U);var xe=u(U,2),Se=u(f(xe),2),Re=f(Se),Pe=f(Re);Je(Pe,{min:1,max:3,step:.1,get value(){return l()},get onChange(){return Y()}}),g(Re);var it=u(Re,2);g(Se),g(xe);var Ge=u(xe,2),kt=f(Ge),rt=u(kt,2),lt=u(rt,2),yt=u(lt,2);g(Ge),g(ce),J(()=>_n(D,R())),p("change",D,de),p("click",pe,X),p("click",it,function(...G){me()?.apply(this,G)}),p("click",kt,()=>te()("up")),p("click",rt,()=>te()("down")),p("click",lt,()=>te()("left")),p("click",yt,()=>te()("right")),A(Q,ce)};$(Z,Q=>{n(j)&&w()&&Q(se)})}g(ne),g(Ve),J(()=>{Ce.disabled=!w(),ye(Ce,"aria-label",n(j)?"Collapse":"Expand"),ye(Ue,"src",`/icons/${n(j)?"icon-collapse":"icon-expand"}.svg`),Ke=ue(Ue,1,"chevron-icon svelte-1e1k0ax",null,Ke,{disabled:!w()}),B=ue(Ae,1,"toggle-switch svelte-1e1k0ax",null,B,{active:w()}),ye(Ae,"aria-label",w()?"Disable blur":"Enable blur")}),p("click",nt,Ze),p("click",Ce,be),p("click",Ae,ae),A(o,Ve),Me()}var io=F('<button><div class="filter-preview svelte-183y0dt"></div> <span> </span></button>'),ro=F('<div class="filter-grid svelte-183y0dt"></div>');function lo(o,a){Te(a,!1);let e=h(a,"filters",24,()=>[]),t=h(a,"value",8,"original"),i=h(a,"imageUrl",8,""),r=h(a,"onChange",8,c=>{});De();var d=ro();vt(d,5,e,dt,(c,s)=>{var v=io();let b;var k=f(v),S=u(k,2);let x;var _=f(S,!0);g(S),g(v),J(()=>{b=ue(v,1,"filter-card svelte-183y0dt",null,b,{active:t()===n(s).id}),_e(k,`
					background-image: url(${i()??""});
					filter: ${n(s),m(()=>n(s).css||"none")??""};
				`),x=ue(S,1,"filter-label svelte-183y0dt",null,x,{active:t()===n(s).id}),je(_,(n(s),m(()=>n(s).label)))}),p("click",v,()=>r()(n(s).id)),A(c,v)}),g(d),A(o,d),Me()}var so=F('<div class="filter-controls svelte-1274k9v"><!> <div><div class="slider-track svelte-1274k9v"><!></div> <button class="reset-btn svelte-1274k9v" aria-label="Reset filter"><img src="/icons/icon-reset.svg" alt="" class="reset-icon svelte-1274k9v"/></button></div></div>');function co(o,a){Te(a,!1);const e=N();let t=h(a,"imageUrl",8,""),i=h(a,"activeFilter",8,"original"),r=h(a,"filterStrength",8,50),d=h(a,"onFilterChange",8,w=>{}),c=h(a,"onStrengthChange",8,w=>{}),s=h(a,"onReset",8,()=>{});const v=[{id:"original",label:"Original",css:"none"},{id:"greyscale",label:"Greyscale",css:"grayscale(100%)"},{id:"sepia",label:"Sepia",css:"sepia(100%)"},{id:"sunset",label:"Sunset",css:"sepia(30%) saturate(140%) brightness(110%) hue-rotate(-10deg)"},{id:"azure",label:"Azure",css:"saturate(120%) brightness(105%) hue-rotate(180deg)"},{id:"teal",label:"Teal",css:"saturate(130%) hue-rotate(140deg)"}];Ye(()=>Le(i()),()=>{z(e,i()==="original")}),pt();var b=so(),k=f(b);lo(k,{get filters(){return v},get value(){return i()},get imageUrl(){return t()},get onChange(){return d()}});var S=u(k,2);let x;var _=f(S),R=f(_);{let w=We(()=>n(e)?()=>{}:c());Je(R,{label:"Strength",min:0,max:100,get value(){return r()},get onChange(){return n(w)}})}g(_);var l=u(_,2);g(S),g(b),J(()=>x=ue(S,1,"slider-row svelte-1274k9v",null,x,{disabled:n(e)})),p("click",l,function(...w){s()?.apply(this,w)}),A(o,b),Me()}const xa=[{id:"original",label:"Original",css:"none"},{id:"greyscale",label:"Greyscale",css:"grayscale(100%)"},{id:"sepia",label:"Sepia",css:"sepia(100%)"},{id:"sunset",label:"Sunset",css:"sepia(30%) saturate(140%) brightness(110%) hue-rotate(-10deg)"},{id:"azure",label:"Azure",css:"saturate(120%) brightness(105%) hue-rotate(180deg)"},{id:"teal",label:"Teal",css:"saturate(130%) hue-rotate(140deg)"}];function vo(o){const a=[o];let e=0,t=0;const i=bt({canUndo:!1,canRedo:!1}),{subscribe:r,set:d,update:c}=bt(o);function s(){i.set({canUndo:e>t,canRedo:e<a.length-1})}return{subscribe:r,undoState:i,set:v=>{a.splice(e+1),a.push(v),e=a.length-1,d(v),s()},update:v=>{c(b=>{const k=v(b);return a.splice(e+1),a.push(k),e=a.length-1,s(),k})},silentUpdate:v=>{c(v)},setBaseState:()=>{t=e,s()},undo:()=>{e>t&&(e--,d(a[e]),s())},redo:()=>{e<a.length-1&&(e++,d(a[e]),s())},canUndo:()=>e>t,canRedo:()=>e<a.length-1,reset:()=>{a.length=0,a.push(o),e=0,t=0,d(o),s()}}}const uo={originalImage:null,currentImage:null,aspectRatio:"custom",width:0,height:0,ratioLocked:!1,scale:1,offsetX:0,offsetY:0,brightness:0,contrast:0,shadows:0,hdr:0,activeFilter:"original",filterStrength:50,cropBox:{x:0,y:0,width:0,height:0},isCropping:!1,cropPending:!1,imageWidth:0,imageHeight:0,blurEnabled:!1,blurBrushSize:50,blurStrength:50,blurSoften:50,blurInvert:!1,blurMask:null,showBrushPreview:!1,zoomLevel:1,zoomOffsetX:0,zoomOffsetY:0},ve=vo(uo),At=bt("none"),go=oa(ve,o=>o.currentImage!==null);function ho(){ve.reset(),At.set("none")}var fo=F('<div class="controls-panel svelte-c9tnuw"><!></div>'),bo=F('<div class="controls-panel svelte-c9tnuw"><!></div>'),mo=F("<!> <!> <!> <!>",1),po=F('<div class="crop-tab svelte-c9tnuw"><!> <!> <!></div>');function wo(o,a){Te(a,!1);const e=()=>ot(ve,"$cropState",d),t=()=>ot(At,"$activeSubMenu",d),i=()=>ot(go,"$hasImage",d),r=()=>ot(k,"$undoState",d),[d,c]=Rt(),s=N(),v=N(),b=N(),k=ve.undoState,S=[{id:"crop",label:"Crop"},{id:"edit",label:"Edit"},{id:"filter",label:"Filter"}];let x=N(null),_=null;async function R(y){const D=await Ut(y);ve.set({...e(),originalImage:y,currentImage:y,imageWidth:D.width,imageHeight:D.height,width:D.width,height:D.height,cropBox:{x:0,y:0,width:100,height:100},isCropping:!0,cropPending:!1,aspectRatio:"custom",ratioLocked:!1}),ve.setBaseState(),At.set("crop")}function l(y){if(e().cropPending&&t()==="crop"&&y!=="crop"){_=()=>{At.set(y),ve.silentUpdate(D=>({...D,isCropping:!1}))},z(x,"save");return}y==="crop"?ve.silentUpdate(D=>({...D,isCropping:!0})):ve.silentUpdate(D=>({...D,isCropping:!1})),At.set(t()===y?"none":y)}async function w(){return await Bn(e().currentImage,n(b),e().blurMask)}async function T(){if(e().cropPending){_=async()=>{const y=await w();await $t(y)},z(x,"save");return}if(e().currentImage){const y=await w();await $t(y)}}async function E(){if(e().cropPending){_=async()=>{const y=await w();ea(y,"picflam-export.png")},z(x,"save");return}if(e().currentImage){const y=await w();ea(y,"picflam-export.png")}}function L(){z(x,"startAgain")}function M(){ve.undo()}function I(){ve.redo()}async function C(){z(x,null),await te(),_&&(await _(),_=null)}function P(){z(x,null),_=null}function W(){z(x,null),ho()}function Y(){z(x,null)}async function te(){const y=e();if(!y.currentImage||!y.cropPending)return;const D=await Ma(y.currentImage,y.cropBox,y.imageWidth,y.imageHeight),U=await Ut(D);ve.set({...y,currentImage:D,imageWidth:U.width,imageHeight:U.height,width:U.width,height:U.height,cropBox:{x:0,y:0,width:100,height:100},cropPending:!1})}function me(y){if(y==="custom"){ve.silentUpdate(pe=>({...pe,aspectRatio:"custom",cropBox:{x:0,y:0,width:100,height:100},ratioLocked:!1,cropPending:!1}));return}const U={"9:16":9/16,"1:1":1,"16:9":16/9}[y],ee=e().imageWidth/e().imageHeight;let V;if(y==="9:16"){const xe=U/ee*100;if(xe<=100)V={x:(100-xe)/2,y:0,width:xe,height:100};else{const Se=ee/U*100;V={x:0,y:(100-Se)/2,width:100,height:Se}}}else if(y==="16:9"){const xe=ee/U*100;if(xe<=100)V={x:0,y:(100-xe)/2,width:100,height:xe};else{const Se=U/ee*100;V={x:(100-Se)/2,y:0,width:Se,height:100}}}else if(y==="1:1")if(ee>1){const pe=100/ee;V={x:(100-pe)/2,y:0,width:pe,height:100}}else{const pe=100*ee;V={x:0,y:(100-pe)/2,width:100,height:pe}}ve.silentUpdate(pe=>({...pe,aspectRatio:y,cropBox:V,cropPending:!0,isCropping:!0,ratioLocked:!0}))}function ie({width:y,height:D}){const U=e().imageWidth,ee=e().imageHeight,V=Math.min(Math.max(1,y),U),pe=Math.min(Math.max(1,D),ee),xe=V/U*100,Se=pe/ee*100;let Re;if(e().ratioLocked){const Pe=n(s)/n(v);if(y!==n(s)){const Ge=V/Pe/ee*100;Re={x:(100-xe)/2,y:(100-Math.min(100,Ge))/2,width:xe,height:Math.min(100,Ge)}}else{const Ge=pe*Pe/U*100;Re={x:(100-Math.min(100,Ge))/2,y:(100-Se)/2,width:Math.min(100,Ge),height:Se}}}else Re={x:(100-xe)/2,y:(100-Se)/2,width:xe,height:Se};ve.silentUpdate(Pe=>({...Pe,cropBox:Re,cropPending:!0}))}function K(){ve.silentUpdate(y=>({...y,ratioLocked:!y.ratioLocked}))}async function fe(){const y=await Rn(e().currentImage);ve.set({...e(),currentImage:y})}async function q(){const y=await zn(e().currentImage,90),D=await Ut(y);ve.set({...e(),currentImage:y,imageWidth:D.width,imageHeight:D.height,cropBox:{x:0,y:0,width:100,height:100},cropPending:!1})}function j(y){ve.silentUpdate(D=>({...D,scale:y/100}))}function le(y){const D=y.detail.cropBox;if(e().ratioLocked&&e().aspectRatio!=="custom"){const ee={"9:16":.5625,"1:1":1,"16:9":1.7777777777777777}[e().aspectRatio];e().imageWidth/e().imageHeight;const V=D.width*e().imageWidth/(D.height*e().imageHeight);if(Math.abs(V-ee)>.01){const Se=D.width/100*e().imageWidth/ee/e().imageHeight*100;D.height=Math.min(100,Se),D.y+D.height>100&&(D.y=100-D.height)}}ve.silentUpdate(U=>({...U,cropBox:D,cropPending:!0}))}function ge(){te()}let Be=null;function ke(){Be===null&&(Be={...e()})}function Ze(){Be!==null&&(ve.set(e()),Be=null)}function H(y){ke(),ve.silentUpdate(D=>({...D,brightness:y}))}function X(y){ke(),ve.silentUpdate(D=>({...D,shadows:y}))}function ae(y){ke(),ve.silentUpdate(D=>({...D,contrast:y}))}function be(y){ke(),ve.silentUpdate(D=>({...D,hdr:y}))}function de(y){ve.set({...e(),blurEnabled:y})}function Ie(y){ke(),ve.silentUpdate(D=>({...D,blurBrushSize:y}))}function Ee(y){ke(),ve.silentUpdate(D=>({...D,blurStrength:y}))}function Fe(y){ke(),ve.silentUpdate(D=>({...D,blurSoften:y}))}function qe(y){ve.set({...e(),blurInvert:y})}function Qe(y){ve.silentUpdate(D=>({...D,showBrushPreview:y}))}function Ve(){Ze()}let he=null,Oe=[],O=null;function He(y){const D=y.detail.point;O===null&&(O=e().blurMask?[...e().blurMask]:[]),Oe.push(D),ve.silentUpdate(U=>({...U,blurMask:[...U.blurMask||[],D]})),he&&clearTimeout(he),he=setTimeout(()=>{if(Oe.length>0){const U=[...O,...Oe];ve.set({...e(),blurMask:U}),Oe=[],O=null}he=null},300)}function nt(y){ve.silentUpdate(D=>({...D,zoomLevel:y}))}function ne(y){ve.silentUpdate(U=>{let{zoomOffsetX:ee,zoomOffsetY:V}=U;switch(y){case"up":V-=20;break;case"down":V+=20;break;case"left":ee-=20;break;case"right":ee+=20;break}return{...U,zoomOffsetX:ee,zoomOffsetY:V}})}function re(){ve.silentUpdate(y=>({...y,zoomLevel:1,zoomOffsetX:0,zoomOffsetY:0}))}function Ce(y){ve.silentUpdate(D=>({...D,activeFilter:y}))}function Ue(y){ke(),ve.silentUpdate(D=>({...D,filterStrength:y}))}function Ke(){ve.set({...e(),activeFilter:"original",filterStrength:50})}Ye(()=>e(),()=>{z(s,Math.round(e().imageWidth*e().cropBox.width/100))}),Ye(()=>e(),()=>{z(v,Math.round(e().imageHeight*e().cropBox.height/100))}),Ye(()=>(e(),xa),()=>{z(b,(()=>{let y=[];if(e().brightness!==0&&y.push(`brightness(${1+e().brightness/100})`),e().contrast!==0&&y.push(`contrast(${1+e().contrast/100})`),e().shadows!==0){const D=1+e().shadows/200;y.push(`brightness(${D})`)}if(e().hdr!==0){const D=1+e().hdr/100*.3,U=1+e().hdr/100*.2;y.push(`saturate(${D}) contrast(${U})`)}if(e().activeFilter!=="original"){const D=xa.find(U=>U.id===e().activeFilter);if(D&&D.css!=="none"){const U=e().filterStrength/100,ee=D.css.replace(/(\d+)%/g,(V,pe)=>`${Math.round(parseInt(pe)*U)}%`);y.push(ee)}}return y.length>0?y.join(" "):"none"})())}),pt(),De();var Ae=po(),B=f(Ae);{var Z=y=>{Da(y,{title:"Crop, edit and add filters to photos",hint:"Import, drag or paste an image",onImageImport:R})},se=y=>{var D=mo(),U=Ne(D);la(U,{get canUndo(){return r(),m(()=>r().canUndo)},get canRedo(){return r(),m(()=>r().canRedo)},onUndo:M,onRedo:I,onStartAgain:L,onCopy:T,onExport:E});var ee=u(U,2);{let Re=We(()=>(t(),e(),m(()=>t()==="edit"?e().zoomLevel:e().scale))),Pe=We(()=>(t(),e(),m(()=>t()==="edit"?e().zoomOffsetX:e().offsetX))),it=We(()=>(t(),e(),m(()=>t()==="edit"?e().zoomOffsetY:e().offsetY))),Ge=We(()=>(e(),m(()=>e().blurMask||[])));Hn(ee,{get imageSrc(){return e(),m(()=>e().currentImage)},get cropBox(){return e(),m(()=>e().cropBox)},get isCropping(){return e(),m(()=>e().isCropping)},get scale(){return n(Re)},get offsetX(){return n(Pe)},get offsetY(){return n(it)},get imageWidth(){return e(),m(()=>e().imageWidth)},get imageHeight(){return e(),m(()=>e().imageHeight)},get editFilters(){return n(b)},get blurEnabled(){return e(),m(()=>e().blurEnabled)},get blurBrushSize(){return e(),m(()=>e().blurBrushSize)},get blurStrength(){return e(),m(()=>e().blurStrength)},get blurSoften(){return e(),m(()=>e().blurSoften)},get blurInvert(){return e(),m(()=>e().blurInvert)},get blurMask(){return n(Ge)},get showBrushPreview(){return e(),m(()=>e().showBrushPreview)},$$events:{cropChange:le,blurPaint:He}})}var V=u(ee,2);sa(V,{get tabs(){return S},get activeTab(){return t()},onTabChange:l});var pe=u(V,2);{var xe=Re=>{{let Pe=We(()=>(e(),m(()=>Math.round(e().scale*100))));$n(Re,{get aspectRatio(){return e(),m(()=>e().aspectRatio)},get cropWidth(){return n(s)},get cropHeight(){return n(v)},get ratioLocked(){return e(),m(()=>e().ratioLocked)},get scale(){return n(Pe)},get cropPending(){return e(),m(()=>e().cropPending)},onRatioChange:me,onDimensionsChange:ie,onLockToggle:K,onFlip:fe,onRotate:q,onScaleChange:j,onApply:ge})}},Se=Re=>{var Pe=gt(),it=Ne(Pe);{var Ge=rt=>{var lt=fo(),yt=f(lt);oo(yt,{get brightness(){return e(),m(()=>e().brightness)},get shadows(){return e(),m(()=>e().shadows)},get contrast(){return e(),m(()=>e().contrast)},get hdr(){return e(),m(()=>e().hdr)},get blurEnabled(){return e(),m(()=>e().blurEnabled)},get blurBrushSize(){return e(),m(()=>e().blurBrushSize)},get blurStrength(){return e(),m(()=>e().blurStrength)},get blurSoften(){return e(),m(()=>e().blurSoften)},get blurInvert(){return e(),m(()=>e().blurInvert)},get zoomLevel(){return e(),m(()=>e().zoomLevel)},onBrightnessChange:H,onShadowsChange:X,onContrastChange:ae,onHdrChange:be,onBlurToggle:de,onBlurBrushSizeChange:Ie,onBlurStrengthChange:Ee,onBlurSoftenChange:Fe,onBlurInvertChange:qe,onZoomChange:nt,onNudge:ne,onResetZoom:re,onBrushPreviewChange:Qe,onEditEnd:Ve}),g(lt),A(rt,lt)},kt=rt=>{var lt=gt(),yt=Ne(lt);{var G=we=>{var $e=bo(),tt=f($e);co(tt,{get imageUrl(){return e(),m(()=>e().currentImage)},get activeFilter(){return e(),m(()=>e().activeFilter)},get filterStrength(){return e(),m(()=>e().filterStrength)},onFilterChange:Ce,onStrengthChange:Ue,onReset:Ke}),g($e),A(we,$e)};$(yt,we=>{t()==="filter"&&we(G)},!0)}A(rt,lt)};$(it,rt=>{t()==="edit"?rt(Ge):rt(kt,!1)},!0)}A(Re,Pe)};$(pe,Re=>{t()==="crop"?Re(xe):Re(Se,!1)})}A(y,D)};$(B,y=>{i()?y(se,!1):y(Z)})}var Q=u(B,2);{var ce=y=>{ta(y,{message:"Save changes?",confirmText:"Yes",cancelText:"Cancel",onConfirm:C,onCancel:P})};$(Q,y=>{n(x)==="save"&&y(ce)})}var ze=u(Q,2);{var oe=y=>{ta(y,{message:"Start again? Your changes will be lost.",confirmText:"Yes",cancelText:"Cancel",onConfirm:W,onCancel:Y})};$(ze,y=>{n(x)==="startAgain"&&y(oe)})}g(Ae),A(o,Ae),Me(),c()}var xo=F('<div class="before-after-container svelte-1i0ztfp" role="slider" aria-label="Before and after comparison" tabindex="0"><div class="before-image svelte-1i0ztfp"><img alt="Before" class="svelte-1i0ztfp"/></div> <div class="after-image svelte-1i0ztfp"><img alt="After" class="svelte-1i0ztfp"/></div> <div class="slider-handle svelte-1i0ztfp" role="presentation"><div class="slider-line svelte-1i0ztfp"></div> <div class="slider-thumb svelte-1i0ztfp"><img src="/icons/icon-ai-slider.svg" alt="" class="slider-icon svelte-1i0ztfp"/></div></div></div>');function _o(o,a){Te(a,!1);let e=h(a,"beforeImage",8,""),t=h(a,"afterImage",8,""),i=h(a,"position",12,50),r=h(a,"onChange",8,()=>{}),d=N(),c=!1;Bt(()=>(window.addEventListener("mousemove",b),window.addEventListener("touchmove",k,{passive:!1}),window.addEventListener("mouseup",S),window.addEventListener("touchend",S),()=>{window.removeEventListener("mousemove",b),window.removeEventListener("touchmove",k),window.removeEventListener("mouseup",S),window.removeEventListener("touchend",S)}));function s(){c=!0}function v(M){M.touches.length===1&&(c=!0)}function b(M){!c||!n(d)||x(M.clientX)}function k(M){!c||!n(d)||M.touches.length!==1||(M.preventDefault(),x(M.touches[0].clientX))}function S(){c=!1}function x(M){const I=n(d).getBoundingClientRect(),C=Math.max(0,Math.min(100,(M-I.left)/I.width*100));i(C),r()(C)}function _(M){if(!n(d))return;const I=n(d).getBoundingClientRect(),C=(M.clientX-I.left)/I.width*100;i(Math.max(0,Math.min(100,C))),r()(i())}De();var R=xo(),l=f(R),w=f(l);g(l);var T=u(l,2),E=f(T);g(T);var L=u(T,2);g(R),ft(R,M=>z(d,M),()=>n(d)),J(()=>{ye(w,"src",e()),_e(T,`clip-path: inset(0 ${100-i()}% 0 0)`),ye(E,"src",t()),_e(L,`left: ${i()??""}%`)}),p("mousedown",L,s),p("touchstart",L,v),p("click",R,_),A(o,R),Me()}const _a={originalImage:null,currentImage:null,processedImage:null,isProcessing:!1,processingType:null,upscaleFactor:1,showComparison:!1,comparisonPosition:50};function yo(){const{subscribe:o,set:a,update:e}=bt(_a);return{subscribe:o,setImage:t=>e(i=>({...i,originalImage:t,currentImage:t,processedImage:null})),startProcessing:t=>e(i=>({...i,isProcessing:!0,processingType:t})),finishProcessing:t=>e(i=>({...i,isProcessing:!1,processingType:null,processedImage:t,currentImage:t,showComparison:!0})),cancelProcessing:()=>e(t=>({...t,isProcessing:!1,processingType:null})),setUpscaleFactor:t=>e(i=>({...i,upscaleFactor:t})),setComparisonPosition:t=>e(i=>({...i,comparisonPosition:t})),reset:()=>a(_a)}}const et=yo(),ya=bt("enhance"),ko=oa(et,o=>o.currentImage!==null);let Lt=null;async function Co(o,a=4,e){e?.("Uploading image...");const t=await fetch("/api/face-enhance",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({image:o,scale:a,faceEnhance:.5})}),i=await t.json();if(!t.ok)throw new Error(i.error||`API error: ${t.status}`);if(i.status==="succeeded"&&i.output)return e?.("Downloading result..."),await Fa(i.output);if(i.status==="processing"||i.status==="starting")return e?.("Processing with CodeFormer..."),await So(i.pollUrl,e);throw new Error("Unexpected response")}async function So(o,a,e=60){for(let t=0;t<e;t++){await new Promise(d=>setTimeout(d,2e3));const i=await fetch(`/api/upscale?pollUrl=${encodeURIComponent(o)}`),r=await i.json();if(!i.ok)throw new Error(r.error||`Polling error: ${i.status}`);if(r.status==="succeeded"&&r.output)return a?.("Downloading result..."),await Fa(r.output);if(r.status==="failed")throw new Error(r.error||"Upscaling failed");a?.(`Processing in cloud (${(t+1)*2}s)...`)}throw new Error("Timeout waiting for result")}async function Fa(o){const e=await(await fetch(o)).blob();return new Promise((t,i)=>{const r=new FileReader;r.onload=()=>t(r.result),r.onerror=i,r.readAsDataURL(e)})}async function Io(o){if(Lt)return Lt;console.log("[AI] Loading RMBG background removal model..."),o?.("Downloading model (first time only)...");const{pipeline:a,env:e}=await un(async()=>{const{pipeline:t,env:i}=await import("../chunks/bLAnV4ll.js");return{pipeline:t,env:i}},[],import.meta.url);e.allowLocalModels=!1;try{Lt=await a("image-segmentation","briaai/RMBG-1.4",{device:"webgpu",dtype:"fp32"}),console.log("[AI] RMBG model ready (WebGPU)")}catch(t){console.log("[AI] WebGPU not available, falling back to WASM...",t.message),Lt=await a("image-segmentation","briaai/RMBG-1.4",{dtype:"q8"}),console.log("[AI] RMBG model ready (WASM)")}return Lt}async function zo(o,a){try{console.log("[AI] Starting background removal...");const e=await Io(a);a?.("Processing image...");const t=await e(o);if(console.log("[AI] Segmentation result:",t),!t||t.length===0)throw new Error("No segmentation result returned");const i=t[0];if(console.log("[AI] Segment keys:",Object.keys(i)),i.mask&&i.mask.toDataURL)return console.log("[AI] Background removal complete (RawImage mask)"),await ka(o,i.mask);if(i.mask&&i.mask.data)return console.log("[AI] Background removal complete (data mask)"),await ka(o,i.mask);if(typeof i=="string"&&i.startsWith("data:"))return console.log("[AI] Background removal complete (direct output)"),i;throw console.log("[AI] Segment structure:",JSON.stringify(i,null,2).substring(0,500)),new Error("Unexpected segmentation result format")}catch(e){throw console.error("[AI] Background removal failed:",e),new Error("Background removal failed: "+e.message)}}async function ka(o,a){return new Promise((e,t)=>{const i=new Image;i.onload=async()=>{try{const r=document.createElement("canvas");r.width=i.width,r.height=i.height;const d=r.getContext("2d");d.drawImage(i,0,0);const c=d.getImageData(0,0,r.width,r.height),s=c.data;let v,b,k;if(a.toDataURL){const x=document.createElement("canvas");x.width=a.width,x.height=a.height;const _=x.getContext("2d"),R=new Image;R.onload=()=>{_.drawImage(R,0,0);const l=_.getImageData(0,0,a.width,a.height);Ca(s,l.data,r.width,r.height,a.width,a.height,!0),d.putImageData(c,0,0),e(r.toDataURL("image/png"))},R.onerror=t,R.src=a.toDataURL();return}else v=a.data,b=a.width,k=a.height;const S=v.length===b*k*4;Ca(s,v,r.width,r.height,b,k,S),d.putImageData(c,0,0),e(r.toDataURL("image/png"))}catch(r){t(r)}},i.onerror=t,i.src=o})}function Ca(o,a,e,t,i,r,d){const c=i/e,s=r/t;for(let v=0;v<t;v++)for(let b=0;b<e;b++){const k=Math.floor(b*c),S=Math.floor(v*s);let x;if(d){const R=(S*i+k)*4;x=a[R]}else{const R=S*i+k;x=a[R]||0}const _=(v*e+b)*4;o[_+3]=x}}var Ro=F('<div class="size-display svelte-1rgvkgu"> </div>'),Bo=F('<button class="processing-btn svelte-1rgvkgu" disabled><span class="spinner svelte-1rgvkgu"></span> </button> <button class="cancel-btn svelte-1rgvkgu">Cancel</button>',1),Eo=F('<button class="upscale-btn svelte-1rgvkgu"><img src="/icons/icon-ai.svg" alt="" class="btn-icon svelte-1rgvkgu"/> Upscale image</button> <p class="hint svelte-1rgvkgu">Upscales, sharpens and enhances images</p>',1),Po=F('<div class="error-message svelte-1rgvkgu"> </div>'),Lo=F('<div class="upscale-controls svelte-1rgvkgu"><div class="controls-content svelte-1rgvkgu"><!> <!> <!></div></div>');function To(o,a){Te(a,!1);const e=()=>ot(et,"$aiState",t),[t,i]=Rt(),r=4;let d=N(!1),c=N(""),s=N(null),v=N(null);async function b(){try{const I=await mt(e().originalImage),C=Math.round(I.naturalWidth*r),P=Math.round(I.naturalHeight*r);z(v,`${C} x ${P}`)}catch(I){console.error("Failed to get image dimensions:",I)}}async function k(){if(e().originalImage)try{z(d,!0),z(s,null),z(c,"Starting..."),et.startProcessing("upscale");const I=await Co(e().originalImage,r,C=>{z(c,C)});et.finishProcessing(I)}catch(I){z(s,I.message||"Upscaling failed"),et.cancelProcessing()}finally{z(d,!1),z(c,"")}}function S(){z(d,!1),z(c,""),z(s,null),et.cancelProcessing()}Ye(()=>e(),()=>{e().originalImage&&b()}),pt(),De();var x=Lo(),_=f(x),R=f(_);{var l=I=>{var C=Ro(),P=f(C);g(C),J(()=>je(P,`Output: ${n(v)??""}`)),A(I,C)};$(R,I=>{n(v)&&I(l)})}var w=u(R,2);{var T=I=>{var C=Bo(),P=Ne(C),W=u(f(P));g(P);var Y=u(P,2);J(()=>je(W,` ${n(c)||"Processing..."}`)),p("click",Y,S),A(I,C)},E=I=>{var C=Eo(),P=Ne(C);_t(2),p("click",P,k),A(I,C)};$(w,I=>{n(d)?I(T):I(E,!1)})}var L=u(w,2);{var M=I=>{var C=Po(),P=f(C,!0);g(C),J(()=>je(P,n(s))),A(I,C)};$(L,I=>{n(s)&&I(M)})}g(_),g(x),A(o,x),Me(),i()}var Mo=F('<img alt="Original" class="compare-overlay svelte-1ibkqf6"/>'),Do=F('<div class="brush-indicator svelte-1ibkqf6"></div>'),Ao=F('<div class="brush-preview svelte-1ibkqf6"></div>'),Fo=F('<div class="drawer-overlay svelte-1ibkqf6" role="presentation"><div class="drawer svelte-1ibkqf6" role="dialog"><div class="drawer-header svelte-1ibkqf6"><button class="icon-btn svelte-1ibkqf6" title="Undo"><img src="/icons/icon-undo.svg" alt="Undo" class="svelte-1ibkqf6"/></button> <button class="icon-btn svelte-1ibkqf6" title="Redo"><img src="/icons/icon-redo.svg" alt="Redo" class="svelte-1ibkqf6"/></button> <div class="spacer svelte-1ibkqf6"></div> <button title="Compare"><img src="/icons/icon-compare.svg" alt="Compare" class="svelte-1ibkqf6"/></button></div> <div class="canvas-container svelte-1ibkqf6"><div class="canvas-wrapper svelte-1ibkqf6" role="presentation"><canvas class="svelte-1ibkqf6"></canvas> <!> <!> <!></div></div> <div class="controls-section svelte-1ibkqf6"><div class="button-group svelte-1ibkqf6"><button><img src="/icons/icon-erase.svg" alt="" class="svelte-1ibkqf6"/> Erase</button> <button><img src="/icons/icon-restore.svg" alt="" class="svelte-1ibkqf6"/> Restore</button></div> <div class="control-row svelte-1ibkqf6"><label class="svelte-1ibkqf6">Brush size</label> <div class="control-item svelte-1ibkqf6"><!> <button class="reset-btn svelte-1ibkqf6" title="Reset"><img src="/icons/icon-reset.svg" alt="Reset" class="svelte-1ibkqf6"/></button></div></div> <div class="control-row svelte-1ibkqf6"><label class="svelte-1ibkqf6">Soften edges</label> <div class="control-item svelte-1ibkqf6"><!> <button class="reset-btn svelte-1ibkqf6" title="Reset"><img src="/icons/icon-reset.svg" alt="Reset" class="svelte-1ibkqf6"/></button></div></div> <div class="control-row svelte-1ibkqf6"><label class="svelte-1ibkqf6">Zoom in</label> <div class="control-item svelte-1ibkqf6"><!> <button class="reset-btn svelte-1ibkqf6" title="Reset"><img src="/icons/icon-reset.svg" alt="Reset" class="svelte-1ibkqf6"/></button></div></div> <div class="nudge-buttons svelte-1ibkqf6"><button class="nudge-btn svelte-1ibkqf6">â</button> <button class="nudge-btn svelte-1ibkqf6">â</button> <button class="nudge-btn svelte-1ibkqf6">â</button> <button class="nudge-btn svelte-1ibkqf6">â</button></div> <div class="drawer-footer svelte-1ibkqf6"><button class="btn-cancel svelte-1ibkqf6">Cancel</button> <button class="btn-done svelte-1ibkqf6">Done</button></div></div></div></div>');function qo(o,a){Te(a,!1);const e=N();let t=h(a,"image",8,""),i=h(a,"originalFullImage",8,""),r=h(a,"onClose",8,()=>{}),d=h(a,"onSave",8,()=>{}),c=N(),s=N(),v,b=N(!0),k=N(20),S=N(50),x=N(1),_=N(0),R=N(0),l=!1,w=[],T=0,E=null,L=N({x:0,y:0,visible:!1}),M=N(!1),I=N(0),C=N(0),P=N(!1);Bt(async()=>{const G=await mt(t());ga(c,n(c).width=G.naturalWidth),ga(c,n(c).height=G.naturalHeight),v=n(c).getContext("2d"),v.drawImage(G,0,0),i()?E=await mt(i()):E=G,W(),Y()});function W(){if(n(s)){const G=n(s).getBoundingClientRect();z(I,G.width),z(C,G.height)}}function Y(){w=w.slice(0,T+1),w.push(n(c).toDataURL()),T=w.length-1}function te(){T>0&&(T--,ie())}function me(){T<w.length-1&&(T++,ie())}function ie(){const G=new Image;G.onload=()=>{v.clearRect(0,0,n(c).width,n(c).height),v.drawImage(G,0,0)},G.src=w[T]}function K(G){const we=n(s).getBoundingClientRect(),$e=n(c).width/we.width,tt=n(c).height/we.height,Et=(G.clientX-we.left)*$e,Ot=(G.clientY-we.top)*tt;return{x:Et,y:Ot}}function fe(G){l=!0;const{x:we,y:$e}=K(G);ge(we,$e)}function q(G){const we=n(s).getBoundingClientRect();if(z(L,{x:G.clientX-we.left,y:G.clientY-we.top,visible:!0}),!l)return;const{x:$e,y:tt}=K(G);ge($e,tt)}function j(){l&&(l=!1,Y())}function le(){z(L,{...n(L),visible:!1}),l&&(l=!1,Y())}function ge(G,we){const $e=n(c).width/n(s).getBoundingClientRect().width,tt=n(e)/2*$e,Et=n(S)/100,Ot=Math.min(tt-.001,tt*(1-Et));v.save();try{if(n(b)){const ut=v.createRadialGradient(G,we,Ot,G,we,tt);ut.addColorStop(0,"rgba(0,0,0,1)"),ut.addColorStop(1,"rgba(0,0,0,0)"),v.globalCompositeOperation="destination-out",v.fillStyle=ut,v.beginPath(),v.arc(G,we,tt,0,Math.PI*2),v.fill()}else{if(!E)return;const ut=document.createElement("canvas");ut.width=n(c).width,ut.height=n(c).height;const wt=ut.getContext("2d"),Wt=wt.createRadialGradient(G,we,Ot,G,we,tt);Wt.addColorStop(0,"rgba(0,0,0,1)"),Wt.addColorStop(1,"rgba(0,0,0,0)"),wt.globalCompositeOperation="source-over",wt.drawImage(E,0,0,ut.width,ut.height),wt.globalCompositeOperation="destination-in",wt.fillStyle=Wt,wt.beginPath(),wt.arc(G,we,tt,0,Math.PI*2),wt.fill(),v.globalCompositeOperation="source-over",v.drawImage(ut,0,0)}}finally{v.restore()}}function Be(){z(k,20)}function ke(){z(S,50)}function Ze(){z(x,1),z(_,0),z(R,0)}function H(G){switch(G){case"up":z(R,n(R)-10);break;case"down":z(R,n(R)+10);break;case"left":z(_,n(_)-10);break;case"right":z(_,n(_)+10);break}}function X(){r()()}function ae(){const G=n(c).toDataURL("image/png");d()(G)}Ye(()=>(n(k),n(I),n(C)),()=>{z(e,n(k)/100*Math.min(n(I)||300,n(C)||300)*.5)}),pt(),De();var be=Fo(),de=f(be),Ie=f(de),Ee=f(Ie),Fe=u(Ee,2),qe=u(Fe,4);let Qe;g(Ie);var Ve=u(Ie,2),he=f(Ve),Oe=f(he);ft(Oe,G=>z(c,G),()=>n(c));var O=u(Oe,2);{var He=G=>{var we=Mo();J(()=>ye(we,"src",i())),A(G,we)};$(O,G=>{n(P)&&i()&&G(He)})}var nt=u(O,2);{var ne=G=>{var we=Do();J(()=>_e(we,`
							left: ${n(L),m(()=>n(L).x)??""}px;
							top: ${n(L),m(()=>n(L).y)??""}px;
							width: ${n(e)??""}px;
							height: ${n(e)??""}px;
						`)),A(G,we)};$(nt,G=>{n(L),n(I),m(()=>n(L).visible&&n(I)>0)&&G(ne)})}var re=u(nt,2);{var Ce=G=>{var we=Ao();J(()=>_e(we,`
						left: ${n(I)/2}px;
						top: ${n(C)/2}px;
						width: ${n(e)??""}px;
						height: ${n(e)??""}px;
					`)),A(G,we)};$(re,G=>{n(M)&&n(I)>0&&n(C)>0&&G(Ce)})}g(he),ft(he,G=>z(s,G),()=>n(s)),g(Ve);var Ue=u(Ve,2),Ke=f(Ue),Ae=f(Ke);let B;var Z=u(Ae,2);let se;g(Ke);var Q=u(Ke,2),ce=u(f(Q),2),ze=f(ce);Je(ze,{min:5,max:100,step:1,get value(){return n(k)},onChange:G=>z(k,G),onInteractionStart:()=>{W(),z(M,!0)},onInteractionEnd:()=>z(M,!1)});var oe=u(ze,2);g(ce),g(Q);var y=u(Q,2),D=u(f(y),2),U=f(D);Je(U,{min:0,max:100,step:1,get value(){return n(S)},onChange:G=>z(S,G)});var ee=u(U,2);g(D),g(y);var V=u(y,2),pe=u(f(V),2),xe=f(pe);Je(xe,{min:1,max:3,step:.1,get value(){return n(x)},onChange:G=>z(x,G)});var Se=u(xe,2);g(pe),g(V);var Re=u(V,2),Pe=f(Re),it=u(Pe,2),Ge=u(it,2),kt=u(Ge,2);g(Re);var rt=u(Re,2),lt=f(rt),yt=u(lt,2);g(rt),g(Ue),g(de),g(be),J(()=>{Qe=ue(qe,1,"icon-btn svelte-1ibkqf6",null,Qe,{active:n(P)}),_e(he,`transform: scale(${n(x)??""}) translate(${n(_)??""}px, ${n(R)??""}px)`),B=ue(Ae,1,"mode-btn svelte-1ibkqf6",null,B,{active:n(b)}),se=ue(Z,1,"mode-btn svelte-1ibkqf6",null,se,{active:!n(b)})}),p("click",Ee,te),p("click",Fe,me),p("mousedown",qe,()=>z(P,!0)),p("mouseup",qe,()=>z(P,!1)),p("mouseleave",qe,()=>z(P,!1)),p("touchstart",qe,()=>z(P,!0)),p("touchend",qe,()=>z(P,!1)),p("mousedown",he,fe),p("mousemove",he,q),p("mouseup",he,j),p("mouseleave",he,le),p("click",Ae,()=>z(b,!0)),p("click",Z,()=>z(b,!1)),p("click",oe,Be),p("click",ee,ke),p("click",Se,Ze),p("click",Pe,()=>H("up")),p("click",it,()=>H("down")),p("click",Ge,()=>H("left")),p("click",kt,()=>H("right")),p("click",lt,X),p("click",yt,ae),p("click",de,st(function(G){Kt.call(this,a,G)})),p("click",be,X),A(o,be),Me()}var Oo=F('<button class="processing-btn svelte-1wdmsm1" disabled><span class="spinner svelte-1wdmsm1"></span> </button> <button class="cancel-btn svelte-1wdmsm1">Cancel</button>',1),Ho=F('<button class="remove-btn svelte-1wdmsm1"><img src="/icons/icon-ai.svg" alt="" class="btn-icon svelte-1wdmsm1"/> Remove background</button> <p class="hint svelte-1wdmsm1">Remove image background with AI</p> <button class="erase-btn svelte-1wdmsm1"><img src="/icons/icon-erase.svg" alt="" class="btn-icon svelte-1wdmsm1"/> Erase and restore</button> <p class="hint svelte-1wdmsm1">Manually clean up background</p>',1),Uo=F('<div class="error-message svelte-1wdmsm1"> </div>'),Wo=F('<div class="background-controls svelte-1wdmsm1"><div class="controls-content svelte-1wdmsm1"><!> <!></div> <!></div>');function jo(o,a){Te(a,!1);const e=()=>ot(et,"$aiState",t),[t,i]=Rt(),r=N();let d=N(!1),c=N(""),s=N(null),v=N(!1);async function b(){if(e().originalImage)try{z(d,!0),z(s,null),z(c,"Starting..."),et.startProcessing("background");const C=await zo(e().originalImage,P=>{z(c,P)});et.finishProcessing(C)}catch(C){z(s,C.message||"Background removal failed"),et.cancelProcessing()}finally{z(d,!1),z(c,"")}}function k(){z(d,!1),z(c,""),z(s,null),et.cancelProcessing()}function S(){z(v,!0)}function x(){z(v,!1)}Ye(()=>e(),()=>{z(r,e().showComparison&&e().processedImage)}),pt(),De();var _=Wo(),R=f(_),l=f(R);{var w=C=>{var P=Oo(),W=Ne(P),Y=u(f(W));g(W);var te=u(W,2);J(()=>je(Y,` ${n(c)||"Processing..."}`)),p("click",te,k),A(C,P)},T=C=>{var P=Ho(),W=Ne(P),Y=u(W,4);_t(2),J(()=>Y.disabled=!n(r)),p("click",W,b),p("click",Y,S),A(C,P)};$(l,C=>{n(d)?C(w):C(T,!1)})}var E=u(l,2);{var L=C=>{var P=Uo(),W=f(P,!0);g(P),J(()=>je(W,n(s))),A(C,P)};$(E,C=>{n(s)&&C(L)})}g(R);var M=u(R,2);{var I=C=>{qo(C,{get image(){return e(),m(()=>e().processedImage)},get originalFullImage(){return e(),m(()=>e().originalImage)},onClose:x,onSave:P=>{et.finishProcessing(P),z(v,!1)}})};$(M,C=>{n(v)&&C(I)})}g(_),A(o,_),Me(),i()}var No=F('<img alt="Working image" class="working-image svelte-17agwu4"/>'),Yo=F('<!> <div class="image-container svelte-17agwu4"><!></div> <!> <!>',1),Xo=F('<div class="ai-tab svelte-17agwu4"><!></div>');function Go(o,a){Te(a,!1);const e=()=>ot(et,"$aiState",r),t=()=>ot(ko,"$hasAiImage",r),i=()=>ot(ya,"$activeAiMenu",r),[r,d]=Rt();let c=N(50);function s(T){z(c,T),et.setComparisonPosition(T)}const v=[{id:"upscale",label:"Upscale"},{id:"background",label:"Remove background"}];function b(T){et.setImage(T)}function k(T){ya.set(T)}async function S(){e().currentImage&&await $t(e().currentImage)}function x(){e().currentImage&&ea(e().currentImage,"picflam-ai.png")}De();var _=Xo(),R=f(_);{var l=T=>{Da(T,{title:"Upscale and remove backgrounds using AI power",hint:"Import, drag or paste an image",onImageImport:b})},w=T=>{var E=Yo(),L=Ne(E);la(L,{canUndo:!1,canRedo:!1,onUndo:()=>{},onRedo:()=>{},onStartAgain:()=>et.reset(),onCopy:S,onExport:x});var M=u(L,2),I=f(M);{var C=ie=>{_o(ie,{get beforeImage(){return e().originalImage},get afterImage(){return e().processedImage},get position(){return n(c)},onChange:s})},P=ie=>{var K=No();J(()=>ye(K,"src",e().currentImage)),A(ie,K)};$(I,ie=>{e().showComparison&&e().processedImage?ie(C):ie(P,!1)})}g(M);var W=u(M,2);sa(W,{get tabs(){return v},get activeTab(){return i()},onTabChange:k});var Y=u(W,2);{var te=ie=>{To(ie,{})},me=ie=>{var K=gt(),fe=Ne(K);{var q=j=>{jo(j,{})};$(fe,j=>{i()==="background"&&j(q)},!0)}A(ie,K)};$(Y,ie=>{i()==="upscale"?ie(te):ie(me,!1)})}A(T,E)};$(R,T=>{t()?T(w,!1):T(l)})}g(_),A(o,_),Me(),d()}var Qo=F('<div class="size-controls svelte-1l8e210"><!></div>');function Vo(o,a){Te(a,!1);let e=h(a,"canvasSize",8,"1/1"),t=h(a,"onSizeChange",8,s=>{});const i=[{id:"9/16",label:"9:16",icon:"icon-vertical"},{id:"1/1",label:"1:1",icon:"icon-square"},{id:"16/9",label:"16:9",icon:"icon-horizontal"}];function r(s){t()(s)}De();var d=Qo(),c=f(d);Aa(c,{get options(){return i},get value(){return e()},onChange:r,showLabels:!0,centered:!0}),g(d),A(o,d),Me()}var Jo=F("<button></button>"),Zo=F('<div class="color-picker-popover svelte-x97jji"><input type="color" class="svelte-x97jji"/></div>'),Ko=F('<button aria-label="Custom color"></button> <!>',1),$o=F('<div class="color-swatches svelte-x97jji"><!> <!></div>');function zt(o,a){Te(a,!1);let e=h(a,"colors",24,()=>[]),t=h(a,"value",8,""),i=h(a,"onChange",8,S=>{}),r=h(a,"showRainbow",8,!0),d=N(!1),c=N("#5422b0");De();var s=$o(),v=f(s);vt(v,1,e,dt,(S,x)=>{var _=Jo();let R;J(()=>{R=ue(_,1,"swatch svelte-x97jji",null,R,{active:t()===n(x),white:n(x)==="#FFFFFF"}),_e(_,`background-color: ${n(x)??""};`),ye(_,"aria-label",`Select color ${n(x)??""}`)}),p("click",_,()=>i()(n(x))),A(S,_)});var b=u(v,2);{var k=S=>{var x=Ko(),_=Ne(x);let R;var l=u(_,2);{var w=T=>{var E=Zo(),L=f(E);Ft(L),g(E),kn(L,()=>n(c),M=>z(c,M)),p("change",L,()=>i()(n(c))),A(T,E)};$(l,T=>{n(d)&&T(w)})}J(T=>R=ue(_,1,"swatch rainbow svelte-x97jji",null,R,T),[()=>({active:!e().includes(t())&&t()!=="transparent"})]),p("click",_,()=>z(d,!n(d))),A(S,x)};$(b,S=>{r()&&S(k)})}g(s),A(o,s),Me()}const It={solids:["#FFFFFF","#000000","#007C1F","#00679D","#B20715"],gradients:["linear-gradient(135deg, #5422b0 0%, #4B0082 100%)","linear-gradient(135deg, #15509B 0%, #20244F 100%)","linear-gradient(135deg, #A8076B 0%, #62045F 100%)","linear-gradient(135deg, #EA5C56 0%, #3C0C40 100%)","linear-gradient(135deg, #0A8F9D 0%, #202B54 100%)","linear-gradient(135deg, #D17A29 0%, #41363C 100%)"]},qa=["Inter","Roboto Slab","Saira Condensed","Lora","Playfair Display","Special Elite"],Tt={up:"to top",down:"to bottom",left:"to left",right:"to right"},ei={canvasSize:"1/1",background:{type:"solid",value:"#FFFFFF",direction:"down",gradientColors:["#5422b0","#4B0082"]},text1:"",text1Font:"Inter",text1Size:5,text1YPosition:3,text1LineSpacing:5,text1Color:"#000000",text1HighlightColor:"transparent",text1IsBold:!0,text1Align:"center",text1QuoteStyle:"none",text1QuoteSize:5,text2:"",text2Font:"Inter",text2Size:3,text2YPosition:8,text2LineSpacing:5,text2Color:"#000000",text2LabelColor:"transparent",text2IsBold:!1,text2Align:"center",overlay:null,overlaySize:50,overlayOpacity:100,overlayX:50,overlayY:50,overlayMask:"none",overlayLayer:"above",overlayBorderWidth:0,overlayBorderColor:"#FFFFFF",overlayNaturalWidth:0,overlayNaturalHeight:0};function ti(o){const a=[JSON.parse(JSON.stringify(o))];let e=0;const{subscribe:t,set:i,update:r}=bt(o);return{subscribe:t,set:d=>{a.splice(e+1),a.push(JSON.parse(JSON.stringify(d))),e=a.length-1,i(d)},update:d=>{r(c=>{const s=d(c);return a.splice(e+1),a.push(JSON.parse(JSON.stringify(s))),e=a.length-1,s})},undo:()=>e>0?(e--,i(JSON.parse(JSON.stringify(a[e]))),!0):!1,redo:()=>e<a.length-1?(e++,i(JSON.parse(JSON.stringify(a[e]))),!0):!1,canUndo:()=>e>0,canRedo:()=>e<a.length-1,reset:()=>{const d=JSON.parse(JSON.stringify(o));a.length=0,a.push(d),e=0,i(d)}}}const Xe=ti(ei),aa=bt(!0),ct=bt("none");oa(Xe,o=>o.text1||o.text2||o.overlay||o.background.value!=="#FFFFFF");function ai(){Xe.reset(),aa.set(!0),ct.set("none")}var ni=F('<button aria-label="Select gradient"></button>'),oi=F('<div class="background-controls svelte-18tfgkp"><div class="section svelte-18tfgkp"><div class="color-row svelte-18tfgkp"><!></div></div> <div class="section svelte-18tfgkp"><div class="gradient-row svelte-18tfgkp"></div></div> <div class="section svelte-18tfgkp"><div class="gradient-preview-row svelte-18tfgkp"><button class="gradient-endpoint svelte-18tfgkp" aria-label="Edit start color"></button> <div class="gradient-preview svelte-18tfgkp"></div> <button class="gradient-endpoint svelte-18tfgkp" aria-label="Edit end color"></button></div></div> <div class="section svelte-18tfgkp"><div><button aria-label="Gradient direction up"><img src="/icons/icon-nudge-up.svg" alt="" class="direction-icon svelte-18tfgkp"/></button> <button aria-label="Gradient direction down"><img src="/icons/icon-nudge-down.svg" alt="" class="direction-icon svelte-18tfgkp"/></button> <button aria-label="Gradient direction left"><img src="/icons/icon-nudge-left.svg" alt="" class="direction-icon svelte-18tfgkp"/></button> <button aria-label="Gradient direction right"><img src="/icons/icon-nudge-right.svg" alt="" class="direction-icon svelte-18tfgkp"/></button></div></div></div>');function ii(o,a){Te(a,!1);const e=N();let t=h(a,"background",24,()=>({type:"solid",value:"#FFFFFF",direction:"down",gradientColors:["#5422b0","#4B0082"]})),i=h(a,"onBackgroundChange",8,q=>{});const r=It.gradients.map(q=>{const j=q.match(/#[A-Fa-f0-9]{6}/g);return j?[j[0],j[1]]:["#5422b0","#4B0082"]});function d(q){i()({...t(),type:"solid",value:q})}function c(q){const j=r[q],le=Tt[t().direction]||"to bottom";i()({...t(),type:"gradient",value:`linear-gradient(${le}, ${j[0]} 0%, ${j[1]} 100%)`,gradientColors:j})}function s(q){const j=Tt[q],le=t().gradientColors||["#5422b0","#4B0082"];i()({...t(),direction:q,value:`linear-gradient(${j}, ${le[0]} 0%, ${le[1]} 100%)`})}function v(q,j){const le=[...t().gradientColors||["#5422b0","#4B0082"]];le[q]=j;const ge=Tt[t().direction]||"to bottom";i()({...t(),type:"gradient",value:`linear-gradient(${ge}, ${le[0]} 0%, ${le[1]} 100%)`,gradientColors:le})}Ye(()=>(Le(t()),Tt),()=>{z(e,t().type==="gradient"?`linear-gradient(${Tt[t().direction]||"to bottom"}, ${t().gradientColors?.[0]||"#5422b0"} 0%, ${t().gradientColors?.[1]||"#4B0082"} 100%)`:`linear-gradient(to bottom, ${r[0][0]} 0%, ${r[0][1]} 100%)`)}),pt(),De();var b=oi(),k=f(b),S=f(k),x=f(S);{let q=We(()=>(Le(t()),m(()=>t().type==="solid"?t().value:"")));zt(x,{get colors(){return Le(It),m(()=>It.solids)},get value(){return n(q)},onChange:d,showRainbow:!0})}g(S),g(k);var _=u(k,2),R=f(_);vt(R,5,()=>r,dt,(q,j,le)=>{var ge=ni();let Be;J(()=>{Be=ue(ge,1,"gradient-swatch svelte-18tfgkp",null,Be,{active:t().type==="gradient"&&t().gradientColors?.[0]===n(j)[0]&&t().gradientColors?.[1]===n(j)[1]}),_e(ge,`background: linear-gradient(135deg, ${n(j),m(()=>n(j)[0])??""} 0%, ${n(j),m(()=>n(j)[1])??""} 100%);`)}),p("click",ge,()=>c(le)),A(q,ge)}),g(R),g(_);var l=u(_,2),w=f(l),T=f(w),E=u(T,2),L=u(E,2);g(w),g(l);var M=u(l,2),I=f(M);let C;var P=f(I);let W;var Y=u(P,2);let te;var me=u(Y,2);let ie;var K=u(me,2);let fe;g(I),g(M),g(b),J(()=>{_e(T,`background-color: ${Le(t()),m(()=>t().gradientColors?.[0]||"#5422b0")??""};`),_e(E,`background: ${n(e)??""};`),_e(L,`background-color: ${Le(t()),m(()=>t().gradientColors?.[1]||"#4B0082")??""};`),C=ue(I,1,"direction-row svelte-18tfgkp",null,C,{inactive:t().type!=="gradient"}),W=ue(P,1,"direction-btn svelte-18tfgkp",null,W,{active:t().direction==="up"}),te=ue(Y,1,"direction-btn svelte-18tfgkp",null,te,{active:t().direction==="down"}),ie=ue(me,1,"direction-btn svelte-18tfgkp",null,ie,{active:t().direction==="left"}),fe=ue(K,1,"direction-btn svelte-18tfgkp",null,fe,{active:t().direction==="right"})}),p("click",T,()=>{const q=document.createElement("input");q.type="color",q.value=t().gradientColors?.[0]||"#5422b0",q.addEventListener("input",j=>v(0,j.target.value)),q.click()}),p("click",L,()=>{const q=document.createElement("input");q.type="color",q.value=t().gradientColors?.[1]||"#4B0082",q.addEventListener("input",j=>v(1,j.target.value)),q.click()}),p("click",P,()=>s("up")),p("click",Y,()=>s("down")),p("click",me,()=>s("left")),p("click",K,()=>s("right")),A(o,b),Me()}var ri=F("<button> </button>"),li=F('<div class="font-dropdown-menu svelte-fspusj"></div>'),si=F('<div class="text1-controls svelte-fspusj"><div class="text-input-container svelte-fspusj"><textarea class="text-input svelte-fspusj" placeholder="How to ==highlight== text"></textarea> <div class="resize-handle svelte-fspusj"></div></div> <div class="font-row svelte-fspusj"><span class="row-label svelte-fspusj">Font</span> <div class="font-dropdown-wrapper svelte-fspusj"><button class="font-dropdown-trigger svelte-fspusj"> <span class="dropdown-arrow svelte-fspusj">â¾</span></button> <!></div> <button aria-label="Bold"><img src="/icons/icon-bold.svg" alt="" class="btn-icon svelte-fspusj"/></button> <button class="icon-btn svelte-fspusj"><img alt="" class="btn-icon svelte-fspusj"/></button></div> <div class="slider-row svelte-fspusj"><!> <button class="reset-btn svelte-fspusj" aria-label="Reset size"><img src="/icons/icon-reset.svg" alt="" class="reset-icon svelte-fspusj"/></button></div> <div class="slider-row svelte-fspusj"><!> <button class="reset-btn svelte-fspusj" aria-label="Reset position"><img src="/icons/icon-reset.svg" alt="" class="reset-icon svelte-fspusj"/></button></div> <div class="slider-row svelte-fspusj"><!> <button class="reset-btn svelte-fspusj" aria-label="Reset line spacing"><img src="/icons/icon-reset.svg" alt="" class="reset-icon svelte-fspusj"/></button></div> <div class="color-section svelte-fspusj"><span class="section-label svelte-fspusj">Text colour</span> <!></div> <div class="color-section svelte-fspusj"><span class="section-label svelte-fspusj">Highlight colour</span> <!></div></div>');function ci(o,a){Te(a,!1);let e=h(a,"text1",8,""),t=h(a,"text1Font",8,"Inter"),i=h(a,"text1Size",8,5),r=h(a,"text1YPosition",8,3),d=h(a,"text1LineSpacing",8,5),c=h(a,"text1Color",8,"#000000"),s=h(a,"text1HighlightColor",8,"transparent"),v=h(a,"text1IsBold",8,!0),b=h(a,"text1Align",8,"center"),k=h(a,"onChange",8,(O,He)=>{});const S=It.solids,x=["#FFD700","#000000","#007C1F","#00679D","#B20715"],_=["left","center","right"],R={text1Size:5,text1YPosition:3,text1LineSpacing:5};let l=N(!1),w=N();function T(O){n(w)&&!n(w).contains(O.target)&&z(l,!1)}Bt(()=>{document.addEventListener("click",T)}),ia(()=>{document.removeEventListener("click",T)});function E(O){k()("text1",O.target.value)}function L(O){k()("text1Font",O),z(l,!1)}function M(){k()("text1IsBold",!v())}function I(){const He=(_.indexOf(b())+1)%_.length;k()("text1Align",_[He])}function C(O){k()("text1Color",O)}function P(O){k()("text1HighlightColor",O===s()?"transparent":O)}function W(O){k()(O,R[O])}De();var Y=si(),te=f(Y),me=f(te);La(me),_t(2),g(te);var ie=u(te,2),K=u(f(ie),2),fe=f(K),q=f(fe);_t(),g(fe);var j=u(fe,2);{var le=O=>{var He=li();vt(He,5,()=>qa,dt,(nt,ne)=>{var re=ri();let Ce;var Ue=f(re,!0);g(re),J(()=>{Ce=ue(re,1,"font-option svelte-fspusj",null,Ce,{selected:t()===n(ne)}),_e(re,`font-family: '${n(ne)??""}'`),je(Ue,n(ne)==="Inter"?"Inter (Default)":n(ne))}),p("click",re,()=>L(n(ne))),A(nt,re)}),g(He),A(O,He)};$(j,O=>{n(l)&&O(le)})}g(K),ft(K,O=>z(w,O),()=>n(w));var ge=u(K,2);let Be;var ke=u(ge,2),Ze=f(ke);g(ke),g(ie);var H=u(ie,2),X=f(H);Je(X,{label:"Size",min:1,max:10,get value(){return i()},onChange:O=>k()("text1Size",O)});var ae=u(X,2);g(H);var be=u(H,2),de=f(be);Je(de,{label:"Position",min:0,max:10,get value(){return r()},onChange:O=>k()("text1YPosition",O)});var Ie=u(de,2);g(be);var Ee=u(be,2),Fe=f(Ee);Je(Fe,{label:"Line spacing",min:1,max:10,get value(){return d()},onChange:O=>k()("text1LineSpacing",O)});var qe=u(Fe,2);g(Ee);var Qe=u(Ee,2),Ve=u(f(Qe),2);zt(Ve,{get colors(){return S},get value(){return c()},onChange:C,showRainbow:!0}),g(Qe);var he=u(Qe,2),Oe=u(f(he),2);zt(Oe,{get colors(){return x},get value(){return s()},onChange:P,showRainbow:!0}),g(he),g(Y),J(()=>{qt(me,e()),_e(fe,`font-family: '${t()??""}'`),je(q,`${(t()==="Inter"?"Inter (Default)":t())??""} `),Be=ue(ge,1,"icon-btn svelte-fspusj",null,Be,{active:v()}),ye(ke,"aria-label",`Align ${b()??""}`),ye(Ze,"src",`/icons/icon-align-${b()??""}.svg`)}),p("input",me,E),p("click",fe,()=>z(l,!n(l))),p("click",ge,M),p("click",ke,I),p("click",ae,()=>W("text1Size")),p("click",Ie,()=>W("text1YPosition")),p("click",qe,()=>W("text1LineSpacing")),A(o,Y),Me()}var di=F("<button> </button>"),vi=F('<div class="font-dropdown-menu svelte-n6z268"></div>'),ui=F('<div class="text2-controls svelte-n6z268"><div class="text-input-container svelte-n6z268"><textarea class="text-input svelte-n6z268" placeholder="How to ==highlight== text"></textarea> <div class="resize-handle svelte-n6z268"></div></div> <div class="font-row svelte-n6z268"><span class="row-label svelte-n6z268">Font</span> <div class="font-dropdown-wrapper svelte-n6z268"><button class="font-dropdown-trigger svelte-n6z268"> <span class="dropdown-arrow svelte-n6z268">â¾</span></button> <!></div> <button aria-label="Bold"><img src="/icons/icon-bold.svg" alt="" class="btn-icon svelte-n6z268"/></button> <button class="icon-btn svelte-n6z268"><img alt="" class="btn-icon svelte-n6z268"/></button></div> <div class="slider-row svelte-n6z268"><!> <button class="reset-btn svelte-n6z268" aria-label="Reset size"><img src="/icons/icon-reset.svg" alt="" class="reset-icon svelte-n6z268"/></button></div> <div class="slider-row svelte-n6z268"><!> <button class="reset-btn svelte-n6z268" aria-label="Reset position"><img src="/icons/icon-reset.svg" alt="" class="reset-icon svelte-n6z268"/></button></div> <div class="slider-row svelte-n6z268"><!> <button class="reset-btn svelte-n6z268" aria-label="Reset line spacing"><img src="/icons/icon-reset.svg" alt="" class="reset-icon svelte-n6z268"/></button></div> <div class="color-section svelte-n6z268"><span class="section-label svelte-n6z268">Text colour</span> <!></div> <div class="color-section svelte-n6z268"><span class="section-label svelte-n6z268">Highlight colour</span> <!></div></div>');function gi(o,a){Te(a,!1);let e=h(a,"text2",8,""),t=h(a,"text2Font",8,"Inter"),i=h(a,"text2Size",8,3),r=h(a,"text2YPosition",8,8),d=h(a,"text2LineSpacing",8,5),c=h(a,"text2Color",8,"#000000"),s=h(a,"text2LabelColor",8,"transparent"),v=h(a,"text2IsBold",8,!1),b=h(a,"text2Align",8,"center"),k=h(a,"onChange",8,(O,He)=>{});const S=It.solids,x=["#FFD700","#000000","#007C1F","#00679D","#B20715"],_=["left","center","right"],R={text2Size:3,text2YPosition:8,text2LineSpacing:5};let l=N(!1),w=N();function T(O){n(w)&&!n(w).contains(O.target)&&z(l,!1)}Bt(()=>{document.addEventListener("click",T)}),ia(()=>{document.removeEventListener("click",T)});function E(O){k()("text2",O.target.value)}function L(O){k()("text2Font",O),z(l,!1)}function M(){k()("text2IsBold",!v())}function I(){const He=(_.indexOf(b())+1)%_.length;k()("text2Align",_[He])}function C(O){k()("text2Color",O)}function P(O){k()("text2LabelColor",O===s()?"transparent":O)}function W(O){k()(O,R[O])}De();var Y=ui(),te=f(Y),me=f(te);La(me),_t(2),g(te);var ie=u(te,2),K=u(f(ie),2),fe=f(K),q=f(fe);_t(),g(fe);var j=u(fe,2);{var le=O=>{var He=vi();vt(He,5,()=>qa,dt,(nt,ne)=>{var re=di();let Ce;var Ue=f(re,!0);g(re),J(()=>{Ce=ue(re,1,"font-option svelte-n6z268",null,Ce,{selected:t()===n(ne)}),_e(re,`font-family: '${n(ne)??""}'`),je(Ue,n(ne)==="Inter"?"Inter (Default)":n(ne))}),p("click",re,()=>L(n(ne))),A(nt,re)}),g(He),A(O,He)};$(j,O=>{n(l)&&O(le)})}g(K),ft(K,O=>z(w,O),()=>n(w));var ge=u(K,2);let Be;var ke=u(ge,2),Ze=f(ke);g(ke),g(ie);var H=u(ie,2),X=f(H);Je(X,{label:"Size",min:1,max:10,get value(){return i()},onChange:O=>k()("text2Size",O)});var ae=u(X,2);g(H);var be=u(H,2),de=f(be);Je(de,{label:"Position",min:0,max:10,get value(){return r()},onChange:O=>k()("text2YPosition",O)});var Ie=u(de,2);g(be);var Ee=u(be,2),Fe=f(Ee);Je(Fe,{label:"Line spacing",min:1,max:10,get value(){return d()},onChange:O=>k()("text2LineSpacing",O)});var qe=u(Fe,2);g(Ee);var Qe=u(Ee,2),Ve=u(f(Qe),2);zt(Ve,{get colors(){return S},get value(){return c()},onChange:C,showRainbow:!0}),g(Qe);var he=u(Qe,2),Oe=u(f(he),2);zt(Oe,{get colors(){return x},get value(){return s()},onChange:P,showRainbow:!0}),g(he),g(Y),J(()=>{qt(me,e()),_e(fe,`font-family: '${t()??""}'`),je(q,`${(t()==="Inter"?"Inter (Default)":t())??""} `),Be=ue(ge,1,"icon-btn svelte-n6z268",null,Be,{active:v()}),ye(ke,"aria-label",`Align ${b()??""}`),ye(Ze,"src",`/icons/icon-align-${b()??""}.svg`)}),p("input",me,E),p("click",fe,()=>z(l,!n(l))),p("click",ge,M),p("click",ke,I),p("click",ae,()=>W("text2Size")),p("click",Ie,()=>W("text2YPosition")),p("click",qe,()=>W("text2LineSpacing")),A(o,Y),Me()}var hi=F('<button><img alt="" class="style-icon svelte-4vqdnp"/></button>'),fi=F('<div class="quote-controls svelte-4vqdnp"><div class="style-row svelte-4vqdnp"></div> <div><!> <button class="reset-btn svelte-4vqdnp" aria-label="Reset size"><img src="/icons/icon-reset.svg" alt="" class="reset-icon svelte-4vqdnp"/></button></div></div>');function bi(o,a){Te(a,!1);let e=h(a,"quoteStyle",8,"none"),t=h(a,"quoteSize",8,5),i=h(a,"onChange",8,(R,l)=>{});const r=[{id:"none",icon:"/icons/icon-none.svg",label:"No quote"},{id:"serif",icon:"/icons/icon-quote-serif.svg",label:"Serif quote"},{id:"slab",icon:"/icons/icon-quote-slab.svg",label:"Slab quote"}],d={quoteSize:5};function c(R){i()("text1QuoteStyle",R)}function s(R){i()("text1QuoteSize",d[R])}De();var v=fi(),b=f(v);vt(b,5,()=>r,dt,(R,l)=>{var w=hi();let T;var E=f(w);g(w),J(()=>{T=ue(w,1,"style-btn svelte-4vqdnp",null,T,{active:e()===n(l).id,"is-none":n(l).id==="none"}),ye(w,"aria-label",(n(l),m(()=>n(l).label))),ye(E,"src",(n(l),m(()=>n(l).icon)))}),p("click",w,()=>c(n(l).id)),A(R,w)}),g(b);var k=u(b,2);let S;var x=f(k);Je(x,{label:"Size",min:1,max:10,get value(){return t()},onChange:R=>e()!=="none"&&i()("text1QuoteSize",R)});var _=u(x,2);g(k),g(v),J(()=>{S=ue(k,1,"slider-row svelte-4vqdnp",null,S,{disabled:e()==="none"}),_.disabled=e()==="none"}),p("click",_,()=>s("quoteSize")),A(o,v),Me()}var mi=F('<div class="import-box svelte-qirtgp" role="button" tabindex="0"><label class="import-area svelte-qirtgp"><input type="file" accept="image/*" class="file-input svelte-qirtgp"/> <img src="/icons/icon-upload.svg" alt="" class="upload-icon svelte-qirtgp"/> <span class="import-text svelte-qirtgp">Import, drag or<br/>paste an image</span></label> <button class="paste-btn svelte-qirtgp">Paste</button></div>'),pi=F('<div class="slider-row svelte-qirtgp"><!></div> <div class="slider-row svelte-qirtgp"><!></div> <div class="mask-row svelte-qirtgp"><span class="row-label svelte-qirtgp">Mask</span> <div class="mask-buttons svelte-qirtgp"><button aria-label="No mask"><img src="/icons/icon-none.svg" alt="" class="mask-icon svelte-qirtgp"/></button> <button aria-label="Rounded mask"><img src="/icons/icon-square.svg" alt="" class="mask-icon svelte-qirtgp"/></button> <button aria-label="Circle mask"><div class="circle-icon svelte-qirtgp"></div></button></div> <span class="row-label layer-label svelte-qirtgp">Layers</span> <div class="layer-buttons svelte-qirtgp"><button aria-label="Overlay above text"><img src="/icons/icon-layer-above.svg" alt="" class="layer-icon svelte-qirtgp"/></button> <button aria-label="Overlay below text"><img src="/icons/icon-layer-below.svg" alt="" class="layer-icon svelte-qirtgp"/></button></div></div> <div class="slider-row svelte-qirtgp"><!></div> <div class="color-section svelte-qirtgp"><span class="section-label svelte-qirtgp">Border colour</span> <!></div>',1),wi=F('<div class="overlay-controls svelte-qirtgp"><!></div>');function xi(o,a){Te(a,!1);let e=h(a,"overlay",8,null),t=h(a,"overlaySize",8,50),i=h(a,"overlayOpacity",8,100),r=h(a,"overlayMask",8,"none"),d=h(a,"overlayLayer",8,"above"),c=h(a,"overlayBorderWidth",8,0),s=h(a,"overlayBorderColor",8,"#FFFFFF"),v=h(a,"onChange",8,(M,I)=>{});const b=It.solids,k=[0,1,2,3];function S(M){const I=M.target.files?.[0];if(I&&I.type.startsWith("image/")){const C=new FileReader;C.onload=P=>{v()("overlay",P.target.result)},C.readAsDataURL(I)}M.target.value=""}function x(M){M.preventDefault();const I=M.dataTransfer?.files?.[0];if(I&&I.type.startsWith("image/")){const C=new FileReader;C.onload=P=>{v()("overlay",P.target.result)},C.readAsDataURL(I)}}function _(M){M.preventDefault()}async function R(){try{const M=await navigator.clipboard.read();for(const I of M){const C=I.types.find(P=>P.startsWith("image/"));if(C){const P=await I.getType(C),W=new FileReader;W.onload=Y=>{v()("overlay",Y.target.result)},W.readAsDataURL(P);return}}}catch(M){console.error("Paste failed:",M)}}function l(M){const I=k.reduce((C,P)=>Math.abs(P-M)<Math.abs(C-M)?P:C);v()("overlayBorderWidth",I)}De();var w=wi(),T=f(w);{var E=M=>{var I=mi(),C=f(I),P=f(C);_t(4),g(C);var W=u(C,2);g(I),p("change",P,S),p("click",W,R),p("drop",I,x),p("dragover",I,_),A(M,I)},L=M=>{var I=pi(),C=Ne(I),P=f(C);Je(P,{label:"Size",min:10,max:100,get value(){return t()},onChange:Ie=>v()("overlaySize",Ie)}),g(C);var W=u(C,2),Y=f(W);Je(Y,{label:"Opacity",min:0,max:100,get value(){return i()},onChange:Ie=>v()("overlayOpacity",Ie)}),g(W);var te=u(W,2),me=u(f(te),2),ie=f(me);let K;var fe=u(ie,2);let q;var j=u(fe,2);let le;g(me);var ge=u(me,4),Be=f(ge);let ke;var Ze=u(Be,2);let H;g(ge),g(te);var X=u(te,2),ae=f(X);Je(ae,{label:"Border width",min:0,max:3,step:1,get value(){return c()},onChange:l}),g(X);var be=u(X,2),de=u(f(be),2);zt(de,{get colors(){return b},get value(){return s()},onChange:Ie=>v()("overlayBorderColor",Ie),showRainbow:!0}),g(be),J(()=>{K=ue(ie,1,"mask-btn svelte-qirtgp",null,K,{active:r()==="none"}),q=ue(fe,1,"mask-btn svelte-qirtgp",null,q,{active:r()==="rounded"}),le=ue(j,1,"mask-btn svelte-qirtgp",null,le,{active:r()==="circle"}),ke=ue(Be,1,"layer-btn svelte-qirtgp",null,ke,{active:d()==="above"}),H=ue(Ze,1,"layer-btn svelte-qirtgp",null,H,{active:d()==="below"})}),p("click",ie,()=>v()("overlayMask","none")),p("click",fe,()=>v()("overlayMask","rounded")),p("click",j,()=>v()("overlayMask","circle")),p("click",Be,()=>v()("overlayLayer","above")),p("click",Ze,()=>v()("overlayLayer","below")),A(M,I)};$(T,M=>{e()?M(L,!1):M(E)})}g(w),A(o,w),Me()}var _i=F('<button class="template-card svelte-fxk5n4"><div class="template-placeholder svelte-fxk5n4"> </div></button>'),yi=F('<div class="template-picker svelte-fxk5n4"><p class="picker-title svelte-fxk5n4">Create quotes and cards. Start with a template or blank canvas</p> <button class="blank-canvas-btn svelte-fxk5n4"><img src="/icons/icon-add.svg" alt="" class="add-icon svelte-fxk5n4"/></button> <div class="template-grid svelte-fxk5n4"></div></div>'),ki=F('<div class="canvas-quote svelte-fxk5n4">&#8220;</div>'),Ci=F('<!> <div class="text1-wrapper svelte-fxk5n4"><div class="canvas-text text1 svelte-fxk5n4"><!></div></div>',1),Si=F('<div class="canvas-text text2 svelte-fxk5n4"><!></div>'),Ii=F('<div role="button" tabindex="0"><div><button class="delete-btn svelte-fxk5n4" aria-label="Delete overlay"><img src="/icons/icon-close.svg" alt="" class="delete-icon svelte-fxk5n4"/></button> <div><img alt="Overlay" class="overlay-image svelte-fxk5n4" draggable="false"/></div></div></div>'),zi=F('<!> <div class="canvas-container svelte-fxk5n4"><div class="design-canvas svelte-fxk5n4" role="button" tabindex="0"><!> <!> <!></div></div> <!> <div class="controls-panel svelte-fxk5n4"><!></div>',1),Ri=F('<div class="design-tab svelte-fxk5n4"><!></div>');function Bi(o,a){Te(a,!1);const e=()=>ot(ct,"$activeDesignMenu",r),t=()=>ot(Xe,"$slideState",r),i=()=>ot(aa,"$showTemplatePicker",r),[r,d]=Rt(),c=N();let s=N(),v=N(300),b=300,k=N(300),S,x=!1,_=0,R=0,l=0,w=0;Bt(()=>{n(s)&&(S=new ResizeObserver(([H])=>{const{width:X,height:ae}=H.contentRect;b=X,z(k,ae),z(v,Math.min(X,ae))}),S.observe(n(s)))}),ia(()=>{S&&S.disconnect()});const T=[{id:"size",label:"Size"},{id:"background",label:"Background"},{id:"text1",label:"Text 1"},{id:"text2",label:"Text 2"},{id:"quote",label:"Quote"},{id:"overlay",label:"Overlay"}];function E(H){H==="blank"&&Xe.reset(),aa.set(!1)}function L(H){ct.set(e()===H?"none":H)}async function M(){}function I(){}function C(H){Xe.update(X=>({...X,canvasSize:H}))}function P(H){Xe.update(X=>({...X,background:H}))}function W(H,X){Xe.update(ae=>({...ae,[H]:X}))}function Y(H,X){Xe.update(ae=>({...ae,[H]:X}))}function te(H,X){Xe.update(ae=>({...ae,[H]:X}))}function me(H,X){if(H==="overlay"&&X){const ae=new Image;ae.onload=()=>{Xe.update(be=>({...be,overlay:X,overlayNaturalWidth:ae.naturalWidth,overlayNaturalHeight:ae.naturalHeight,overlayX:50,overlayY:50})),ct.set("overlay")},ae.src=X}else H==="overlayLayer"?(Xe.update(ae=>({...ae,[H]:X})),ct.set("none")):Xe.update(ae=>({...ae,[H]:X}))}function ie(){Xe.update(H=>({...H,overlay:null,overlayNaturalWidth:0,overlayNaturalHeight:0})),ct.set("none")}function K(H){if(H.target.closest(".delete-btn"))return;H.preventDefault(),x=!0;const X=H.touches?.[0]||H;_=X.clientX,R=X.clientY,l=t().overlayX,w=t().overlayY,window.addEventListener("mousemove",fe),window.addEventListener("mouseup",q),window.addEventListener("touchmove",fe,{passive:!1}),window.addEventListener("touchend",q)}function fe(H){if(!x)return;H.preventDefault();const X=H.touches?.[0]||H,ae=X.clientX-_,be=X.clientY-R,de=ae/b*100,Ie=be/n(k)*100,Ee=Math.max(0,Math.min(100,l+de)),Fe=Math.max(0,Math.min(100,w+Ie));Xe.update(qe=>({...qe,overlayX:Ee,overlayY:Fe}))}function q(){x=!1,window.removeEventListener("mousemove",fe),window.removeEventListener("mouseup",q),window.removeEventListener("touchmove",fe),window.removeEventListener("touchend",q)}function j(H){const X=H.target;X.closest(".overlay-wrapper")?ct.set("overlay"):X.closest(".text1-wrapper")?ct.set("text1"):X.closest(".canvas-text.text2")?ct.set("text2"):X.closest(".canvas-quote")?ct.set("quote"):ct.set("none")}function le(H){if(!H.overlay||!H.overlayNaturalWidth)return null;const X=H.overlayNaturalWidth/H.overlayNaturalHeight,ae=H.overlaySize/100*100;let be,de;return X>=1?(be=ae,de=ae/X):(de=ae,be=ae*X),{width:be,height:de}}Ye(()=>t(),()=>{z(c,le(t()))}),pt(),De();var ge=Ri(),Be=f(ge);{var ke=H=>{var X=yi(),ae=u(f(X),2),be=u(ae,2);vt(be,4,()=>[1,2,3,4,5,6],dt,(de,Ie)=>{var Ee=_i(),Fe=f(Ee),qe=f(Fe);g(Fe),g(Ee),J(()=>je(qe,`Template ${Ie??""}`)),p("click",Ee,()=>E(`template-${Ie}`)),A(de,Ee)}),g(be),g(X),p("click",ae,()=>E("blank")),A(H,X)},Ze=H=>{var X=zi(),ae=Ne(X);{let ne=We(()=>(Le(Xe),m(()=>Xe.canUndo()))),re=We(()=>(Le(Xe),m(()=>Xe.canRedo())));la(ae,{get canUndo(){return n(ne)},get canRedo(){return n(re)},onUndo:()=>Xe.undo(),onRedo:()=>Xe.redo(),get onStartAgain(){return ai},onCopy:M,onExport:I})}var be=u(ae,2),de=f(be),Ie=f(de);{var Ee=ne=>{const re=We(()=>(n(v),t(),m(()=>n(v)*.1*t().text1Size/5))),Ce=We(()=>(Le(n(re)),t(),m(()=>n(re)*(1+t().text1LineSpacing*.1)))),Ue=We(()=>(t(),m(()=>t().text1YPosition*10))),Ke=We(()=>n(k)*n(Ue)/100),Ae=We(()=>n(Ce)*3),B=We(()=>n(Ke)-n(Ae)/2),Z=We(()=>(Le(n(Ce)),t(),m(()=>n(Ce)*(t().text1QuoteStyle==="slab"?.35:.4)))),se=We(()=>n(B)-n(Z)),Q=We(()=>(n(v),t(),m(()=>n(v)*.08*t().text1QuoteSize))),ce=We(()=>n(se)-n(Q)*.75),ze=We(()=>n(ce)/n(k)*100);var oe=Ci(),y=Ne(oe);{var D=pe=>{var xe=ki();J(()=>_e(xe,`
								top: ${n(ze)??""}%;
								font-family: ${t(),m(()=>t().text1QuoteStyle==="serif"?'"Playfair Display", serif':'"Alfa Slab One", cursive')??""};
								font-size: ${n(Q)??""}px;
								font-weight: ${t(),m(()=>t().text1QuoteStyle==="serif"?"bold":"normal")??""};
								color: ${t(),m(()=>t().text1Color)??""};
							`)),A(pe,xe)};$(y,pe=>{t(),m(()=>t().text1QuoteStyle!=="none")&&pe(D)})}var U=u(y,2),ee=f(U),V=f(ee);fa(V,()=>(t(),m(()=>t().text1.replace(/==(.+?)==/g,`<span style="color: ${t().text1HighlightColor};">$1</span>`).replace(/\n/g,"<br>")))),g(ee),g(U),J(()=>{_e(U,`top: ${n(Ue)??""}%;`),_e(ee,`
								font-family: '${t(),m(()=>t().text1Font)??""}';
								font-size: ${t(),m(()=>t().text1Size*.5)??""}em;
								font-weight: ${t(),m(()=>t().text1IsBold?"bold":"normal")??""};
								color: ${t(),m(()=>t().text1Color)??""};
								text-align: ${t(),m(()=>t().text1Align)??""};
								line-height: ${t(),m(()=>1+t().text1LineSpacing*.1)??""};
							`)}),A(ne,oe)};$(Ie,ne=>{t(),m(()=>t().text1)&&ne(Ee)})}var Fe=u(Ie,2);{var qe=ne=>{var re=Si(),Ce=f(re);fa(Ce,()=>(t(),m(()=>t().text2.replace(/==(.+?)==/g,`<span style="color: ${t().text2LabelColor};">$1</span>`).replace(/\n/g,"<br>")))),g(re),J(()=>_e(re,`
							font-family: '${t(),m(()=>t().text2Font)??""}';
							font-size: ${t(),m(()=>t().text2Size*.5)??""}em;
							font-weight: ${t(),m(()=>t().text2IsBold?"bold":"normal")??""};
							color: ${t(),m(()=>t().text2Color)??""};
							text-align: ${t(),m(()=>t().text2Align)??""};
							top: ${t(),m(()=>t().text2YPosition*10)??""}%;
							line-height: ${t(),m(()=>1+t().text2LineSpacing*.1)??""};
						`)),A(ne,re)};$(Fe,ne=>{t(),m(()=>t().text2)&&ne(qe)})}var Qe=u(Fe,2);{var Ve=ne=>{var re=Ii();let Ce;var Ue=f(re);let Ke;var Ae=f(Ue),B=u(Ae,2);let Z;var se=f(B);g(B),g(Ue),g(re),J(()=>{Ce=ue(re,1,"overlay-wrapper svelte-fxk5n4",null,Ce,{active:e()==="overlay"}),_e(re,`
							left: ${t(),m(()=>t().overlayX)??""}%;
							top: ${t(),m(()=>t().overlayY)??""}%;
							width: ${n(c),m(()=>n(c).width)??""}%;
							opacity: ${t(),m(()=>t().overlayOpacity/100)??""};
							z-index: ${e(),t(),m(()=>e()==="overlay"?11:t().overlayLayer==="below"?1:10)??""};
						`),Ke=ue(Ue,1,"overlay-bounding-box svelte-fxk5n4",null,Ke,{"mask-none":t().overlayMask==="none","mask-rounded":t().overlayMask==="rounded","mask-circle":t().overlayMask==="circle"}),_e(Ue,`
								border-width: ${t(),m(()=>t().overlayBorderWidth*2)??""}px;
								border-color: ${t(),m(()=>t().overlayBorderColor)??""};
							`),Z=ue(B,1,"overlay-image-container svelte-fxk5n4",null,Z,{"mask-rounded":t().overlayMask==="rounded","mask-circle":t().overlayMask==="circle"}),ye(se,"src",(t(),m(()=>t().overlay)))}),p("click",Ae,ie),p("mousedown",re,K),p("touchstart",re,K),A(ne,re)};$(Qe,ne=>{t(),n(c),m(()=>t().overlay&&n(c))&&ne(Ve)})}g(de),ft(de,ne=>z(s,ne),()=>n(s)),g(be);var he=u(be,2);sa(he,{get tabs(){return T},get activeTab(){return e()},onTabChange:L});var Oe=u(he,2),O=f(Oe);{var He=ne=>{xi(ne,{get overlay(){return t(),m(()=>t().overlay)},get overlaySize(){return t(),m(()=>t().overlaySize)},get overlayOpacity(){return t(),m(()=>t().overlayOpacity)},get overlayMask(){return t(),m(()=>t().overlayMask)},get overlayLayer(){return t(),m(()=>t().overlayLayer)},get overlayBorderWidth(){return t(),m(()=>t().overlayBorderWidth)},get overlayBorderColor(){return t(),m(()=>t().overlayBorderColor)},onChange:me,onDelete:ie})},nt=ne=>{var re=gt(),Ce=Ne(re);{var Ue=Ae=>{Vo(Ae,{get canvasSize(){return t(),m(()=>t().canvasSize)},onSizeChange:C})},Ke=Ae=>{var B=gt(),Z=Ne(B);{var se=ce=>{ii(ce,{get background(){return t(),m(()=>t().background)},onBackgroundChange:P})},Q=ce=>{var ze=gt(),oe=Ne(ze);{var y=U=>{ci(U,{get text1(){return t(),m(()=>t().text1)},get text1Font(){return t(),m(()=>t().text1Font)},get text1Size(){return t(),m(()=>t().text1Size)},get text1YPosition(){return t(),m(()=>t().text1YPosition)},get text1LineSpacing(){return t(),m(()=>t().text1LineSpacing)},get text1Color(){return t(),m(()=>t().text1Color)},get text1HighlightColor(){return t(),m(()=>t().text1HighlightColor)},get text1IsBold(){return t(),m(()=>t().text1IsBold)},get text1Align(){return t(),m(()=>t().text1Align)},onChange:W})},D=U=>{var ee=gt(),V=Ne(ee);{var pe=Se=>{gi(Se,{get text2(){return t(),m(()=>t().text2)},get text2Font(){return t(),m(()=>t().text2Font)},get text2Size(){return t(),m(()=>t().text2Size)},get text2YPosition(){return t(),m(()=>t().text2YPosition)},get text2LineSpacing(){return t(),m(()=>t().text2LineSpacing)},get text2Color(){return t(),m(()=>t().text2Color)},get text2LabelColor(){return t(),m(()=>t().text2LabelColor)},get text2IsBold(){return t(),m(()=>t().text2IsBold)},get text2Align(){return t(),m(()=>t().text2Align)},onChange:Y})},xe=Se=>{var Re=gt(),Pe=Ne(Re);{var it=Ge=>{bi(Ge,{get quoteStyle(){return t(),m(()=>t().text1QuoteStyle)},get quoteSize(){return t(),m(()=>t().text1QuoteSize)},onChange:te})};$(Pe,Ge=>{e()==="quote"&&Ge(it)},!0)}A(Se,Re)};$(V,Se=>{e()==="text2"?Se(pe):Se(xe,!1)},!0)}A(U,ee)};$(oe,U=>{e()==="text1"?U(y):U(D,!1)},!0)}A(ce,ze)};$(Z,ce=>{e()==="background"?ce(se):ce(Q,!1)},!0)}A(Ae,B)};$(Ce,Ae=>{e()==="size"?Ae(Ue):Ae(Ke,!1)},!0)}A(ne,re)};$(O,ne=>{e(),t(),m(()=>e()==="overlay"||e()==="none"&&t().overlay)?ne(He):ne(nt,!1)})}g(Oe),J(()=>_e(de,`
					aspect-ratio: ${t(),m(()=>t().canvasSize)??""};
					background: ${t(),m(()=>(t().background.type==="solid",t().background.value))??""};
				`)),p("click",de,j),p("keydown",de,ne=>ne.key==="Enter"&&j(ne)),A(H,X)};$(Be,H=>{i()?H(ke):H(Ze,!1)})}g(ge),A(o,ge),Me(),d()}const Qt=bt("crop");var Ei=F('<!> <main class="main svelte-1uha8ag"><!></main> <!>',1);function qi(o,a){Te(a,!1);const e=()=>ot(Qt,"$activeTab",i),t=()=>ot(ve,"$cropState",i),[i,r]=Rt();let d=N(!1),c=null;function s(E){if(e()==="crop"&&t().cropPending&&E!=="crop"){c=E,z(d,!0);return}Qt.set(E)}async function v(){z(d,!1);const E=t();if(E.currentImage&&E.cropPending){const L=await Ma(E.currentImage,E.cropBox,E.imageWidth,E.imageHeight),M=await Ut(L);ve.set({...E,currentImage:L,imageWidth:M.width,imageHeight:M.height,cropBox:{x:0,y:0,width:100,height:100},cropPending:!1,isCropping:!1})}c&&(Qt.set(c),c=null)}function b(){z(d,!1),c=null}De();var k=Ei(),S=Ne(k);Sn(S,{get activeTab(){return e()},onTabChange:s});var x=u(S,2),_=f(x);{var R=E=>{wo(E,{})},l=E=>{var L=gt(),M=Ne(L);{var I=P=>{Go(P,{})},C=P=>{var W=gt(),Y=Ne(W);{var te=me=>{Bi(me,{})};$(Y,me=>{e()==="design"&&me(te)},!0)}A(P,W)};$(M,P=>{e()==="ai"?P(I):P(C,!1)},!0)}A(E,L)};$(_,E=>{e()==="crop"?E(R):E(l,!1)})}g(x);var w=u(x,2);{var T=E=>{ta(E,{message:"Save changes?",confirmText:"Yes",cancelText:"Cancel",onConfirm:v,onCancel:b})};$(w,E=>{n(d)&&E(T)})}A(o,k),Me(),r()}export{qi as component};
